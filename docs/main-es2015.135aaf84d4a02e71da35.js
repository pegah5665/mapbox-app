(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+7AZ":function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return i}),r.d(e,"__assign",function(){return o}),r.d(e,"__rest",function(){return a}),r.d(e,"__decorate",function(){return s}),r.d(e,"__param",function(){return l}),r.d(e,"__metadata",function(){return u}),r.d(e,"__awaiter",function(){return c}),r.d(e,"__generator",function(){return h}),r.d(e,"__exportStar",function(){return p}),r.d(e,"__values",function(){return d}),r.d(e,"__read",function(){return f}),r.d(e,"__spread",function(){return m}),r.d(e,"__await",function(){return y}),r.d(e,"__asyncGenerator",function(){return g}),r.d(e,"__asyncDelegator",function(){return _}),r.d(e,"__asyncValues",function(){return v}),r.d(e,"__makeTemplateObject",function(){return b}),r.d(e,"__importStar",function(){return x}),r.d(e,"__importDefault",function(){return w});var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function s(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function l(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n.throw(t))}catch(e){o(e)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})}function h(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function p(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function g(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||s(t,e)})})}function s(t,e){try{(r=i[t](e)).value instanceof y?Promise.resolve(r.value.v).then(l,u):c(o[0][2],r)}catch(n){c(o[0][3],n)}var r}function l(t){s("next",t)}function u(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function _(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function v(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,i,(e=t[r](e)).done,e.value)})}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function w(t){return t&&t.__esModule?t:{default:t}}},0:function(t,e,r){t.exports=r("zUnb")},"1XSQ":function(t,e,r){"use strict";var n=r("8Y7J"),i=r("SVse"),o=r("3N8a");class a extends o.a{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(t,e,r):t.flush(this)}}var s=r("IjjT");class l extends s.a{}const u=new l(a);var c=r("HDdC");r.d(e,"b",function(){return h}),r.d(e,"a",function(){return p});const h=new n.o("angularfire2.realtimeDatabaseURL");class p{constructor(t,e){this.zone=t,this.platformId=e}schedule(...t){return this.zone.runGuarded(function(){return u.schedule.apply(u,t)})}keepUnstableUntilFirst(t){return Object(i.o)(this.platformId)?new c.a(e=>{const r=()=>{},n=Zone.current.scheduleMacroTask("firebaseZoneBlock",r,{},r,r);t.subscribe(t=>{"scheduled"===n.state&&n.invoke(),e.next(t)},t=>{"scheduled"===n.state&&n.invoke(),e.error(t)},()=>{"scheduled"===n.state&&n.invoke(),e.complete()})}):t}runOutsideAngular(t){return new c.a(e=>this.zone.runOutsideAngular(()=>t.subscribe(t=>this.zone.run(()=>e.next(t)),t=>this.zone.run(()=>e.error(t)),()=>this.zone.run(()=>e.complete()))))}}},"2QA8":function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},"2fFW":function(t,e,r){"use strict";r.d(e,"a",function(){return i});let n=!1;const i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){n=t},get useDeprecatedSynchronousErrorHandling(){return n}}},"30Go":function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return i}),r.d(e,"__assign",function(){return o}),r.d(e,"__rest",function(){return a}),r.d(e,"__decorate",function(){return s}),r.d(e,"__param",function(){return l}),r.d(e,"__metadata",function(){return u}),r.d(e,"__awaiter",function(){return c}),r.d(e,"__generator",function(){return h}),r.d(e,"__exportStar",function(){return p}),r.d(e,"__values",function(){return d}),r.d(e,"__read",function(){return f}),r.d(e,"__spread",function(){return m}),r.d(e,"__await",function(){return y}),r.d(e,"__asyncGenerator",function(){return g}),r.d(e,"__asyncDelegator",function(){return _}),r.d(e,"__asyncValues",function(){return v}),r.d(e,"__makeTemplateObject",function(){return b}),r.d(e,"__importStar",function(){return x}),r.d(e,"__importDefault",function(){return w});var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function s(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function l(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n.throw(t))}catch(e){o(e)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})}function h(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function p(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function g(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||s(t,e)})})}function s(t,e){try{(r=i[t](e)).value instanceof y?Promise.resolve(r.value.v).then(l,u):c(o[0][2],r)}catch(n){c(o[0][3],n)}var r}function l(t){s("next",t)}function u(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function _(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function v(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,i,(e=t[r](e)).done,e.value)})}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function w(t){return t&&t.__esModule?t:{default:t}}},"3N8a":function(t,e,r){"use strict";var n=r("quSY");class i extends n.a{constructor(t,e){super()}schedule(t,e=0){return this}}r.d(e,"a",function(){return o});class o extends i{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,r=0){return setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,e,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r=!1,n=void 0;try{this.work(t)}catch(i){r=!0,n=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}},"4ZJM":function(t,e,r){t.exports=function(){"use strict";var t,e,r;function n(n,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),(r=i(a)).workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else e=i;else t=i}return n(0,function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}function a(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!a(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!a(t[n],e[n]))return!1;return!0}return t===e}function s(t,e,n,i){var o=new r(t,e,n,i);return function(t){return o.solve(t)}}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var l=s(.25,.1,.25,1);function u(t,e,r){return Math.min(r,Math.max(e,t))}function c(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function h(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}var p=1;function d(){return p++}function f(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function g(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function v(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?_(t,b):t}var x={};function w(t){x[t]||("undefined"!=typeof console&&console.warn(t),x[t]=!0)}function E(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function C(t){for(var e=0,r=0,n=t.length,i=n-1,o=void 0,a=void 0;r<n;i=r++)e+=((a=t[i]).x-(o=t[r]).x)*(o.y+a.y);return e}function S(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var T,A,I,k=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),P=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,O=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,R={now:k,frame:function(t){var e=P(t);return{cancel:function(){return O(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},resolveURL:function(t){return T||(T=self.document.createElement("a")),T.href=t,T.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio}},D={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},M={supported:!1,testSupport:function(t){!L&&I&&(z?N(t):A=t)}},L=!1,z=!1;function N(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,I),t.isContextLost())return;M.supported=!0}catch(t){}t.deleteTexture(e),L=!0}self.document&&((I=self.document.createElement("img")).onload=function(){A&&N(A),A=null,z=!0},I.onerror=function(){L=!0,A=null},I.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var F="01",B=function(t){this._transformRequestFn=t,this._createSkuToken()};B.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",F,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},B.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},B.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},B.prototype.normalizeStyleURL=function(t,e){return W(t,e)},B.prototype.normalizeGlyphsURL=function(t,e){return G(t,e)},B.prototype.normalizeSourceURL=function(t,e){return Z(t,e)},B.prototype.normalizeSpriteURL=function(t,e,r,n){return Q(t,e,r,n)},B.prototype.normalizeTileURL=function(t,e,r){return this._isSkuTokenExpired()&&this._createSkuToken(),$(t,e,r,this._skuToken)},B.prototype.canonicalizeTileURL=function(t){return Y(t)},B.prototype.canonicalizeTileset=function(t,e){return J(t,e)};var V="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes";function j(t,e){var r=et(D.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"/"!==r.path&&(t.path=""+r.path+t.path),!D.REQUIRE_ACCESS_TOKEN)return rt(t);if(!(e=e||D.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+V);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+V);return t.params.push("access_token="+e),rt(t)}function U(t){return 0===t.indexOf("mapbox:")}var q=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function H(t){return q.test(t)}var W=function(t,e){if(!U(t))return t;var r=et(t);return r.path="/styles/v1"+r.path,j(r,e)},G=function(t,e){if(!U(t))return t;var r=et(t);return r.path="/fonts/v1"+r.path,j(r,e)},Z=function(t,e){if(!U(t))return t;var r=et(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),j(r,e)},Q=function(t,e,r,n){var i=et(t);return U(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,j(i,n)):(i.path+=""+e+r,rt(i))},K=/(\.(png|jpg)\d*)(?=$)/,$=function(t,e,r,n){if(!e||!U(e))return t;var i=et(t);return i.path=i.path.replace(K,(R.devicePixelRatio>=2||512===r?"@2x":"")+(M.supported?".webp":"$1")),i.path="/v4"+i.path,D.REQUIRE_ACCESS_TOKEN&&D.ACCESS_TOKEN&&n&&i.params.push("sku="+n),j(i)},X=/\.[\w]+$/,Y=function(t){var e=et(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(X))return t;var r="mapbox://tiles/";r+=e.path.replace("/v4/","");var n=e.params.filter(function(t){return!t.match(/^access_token=/)});return n.length&&(r+="?"+n.join("&")),r},J=function(t,e){if(!U(e))return t.tiles||[];for(var r=[],n=0,i=t.tiles;n<i.length;n+=1){var o=Y(i[n]);r.push(o)}return r},tt=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/;function et(t){var e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function rt(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function nt(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(self.atob(e[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(t){return null}}var it=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};it.prototype.getStorageKey=function(t){var e,r=nt(D.ACCESS_TOKEN);return e=r&&r.u?self.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))})):D.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},it.prototype.fetchEventData=function(){var t=S("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=self.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=self.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){w("Unable to read from LocalStorage")}},it.prototype.saveEventData=function(){var t=S("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){w("Unable to write to LocalStorage")}},it.prototype.processRequests=function(){},it.prototype.postEvent=function(t,e,r){var n=this;if(D.EVENTS_URL){var i=et(D.EVENTS_URL);i.params.push("access_token="+(D.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.0.0",skuId:F,userId:this.anonId},a=e?h(o,e):o,s={url:rt(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=_t(s,function(t){n.pendingRequest=null,r(t),n.saveEventData(),n.processRequests()})}},it.prototype.queueRequest=function(t){this.queue.push(t),this.processRequests()};var ot=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r){this.skuToken=r,D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return U(t)||H(t)})&&this.queueRequest({id:e,timestamp:Date.now()})},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=this.queue.shift(),r=e.id,n=e.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=f()),this.postEvent(n,{skuToken:this.skuToken},function(e){e||r&&(t.success[r]=!0)}))}},e}(it),at=new(function(t){function e(){t.call(this,"appUserTurnstile")}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return U(t)||H(t)})&&this.queueRequest(Date.now())},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var e=nt(D.ACCESS_TOKEN),r=e?e.u:D.ACCESS_TOKEN,n=r!==this.eventData.tokenU;m(this.anonId)||(this.anonId=f(),n=!0);var i=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),a=new Date(i),s=(i-this.eventData.lastSuccess)/864e5;n=n||s>=1||s<-1||o.getDate()!==a.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(i,{"enabled.telemetry":!1},function(e){e||(t.eventData.lastSuccess=i,t.eventData.tokenU=r)})}},e}(it)),st=at.postTurnstileEvent.bind(at),lt=new ot,ut=lt.postMapLoadEvent.bind(lt),ct={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ct);var ht=function(t){function e(e,r,n){401===r&&H(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function pt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}var dt,ft,mt=pt()?function(){return self.worker&&self.worker.referrer}:function(){var t=self.location.origin;if(t&&"null"!==t&&"file://"!==t)return t+self.location.pathname},yt=function(t,e){if(!/^file:/.test(t.url)){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r=new self.AbortController,n=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:mt(),signal:r.signal});return"json"===t.type&&n.headers.set("Accept","application/json"),self.fetch(n).then(function(r){r.ok?r[t.type||"text"]().then(function(t){e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires"))}).catch(function(t){return e(new Error(t.message))}):e(new ht(r.statusText,r.status,t.url))}).catch(function(t){20!==t.code&&e(new Error(t.message))}),{cancel:function(){return r.abort()}}}(t,e);if(pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e)}return function(t,e){var r=new self.XMLHttpRequest;for(var n in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(n,t.headers[n]);return"json"===t.type&&r.setRequestHeader("Accept","application/json"),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new ht(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},gt=function(t,e){return yt(h(t,{type:"arrayBuffer"}),e)},_t=function(t,e){return yt(h(t,{method:"POST"}),e)};dt=[],ft=0;var vt=function(t,e){if(ft>=D.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return dt.push(r),r}ft++;var n=!1,i=function(){if(!n)for(n=!0,ft--;dt.length&&ft<D.MAX_PARALLEL_IMAGE_REQUESTS;){var t=dt.shift();t.cancelled||(t.cancel=vt(t.requestParameters,t.callback).cancel)}},o=gt(t,function(t,r,n,o){if(i(),t)e(t);else if(r){var a=new self.Image,s=self.URL||self.webkitURL;a.onload=function(){e(null,a),s.revokeObjectURL(a.src)},a.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var l=new self.Blob([new Uint8Array(r)],{type:"image/png"});a.cacheControl=n,a.expires=o,a.src=r.byteLength?s.createObjectURL(l):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}});return{cancel:function(){o.cancel(),i()}}};function bt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function xt(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}var wt=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},Et=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",h({error:e},r))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wt),Ct=function(){};Ct.prototype.on=function(t,e){return this._listeners=this._listeners||{},bt(t,e,this._listeners),this},Ct.prototype.off=function(t,e){return xt(t,e,this._listeners),xt(t,e,this._oneTimeListeners),this},Ct.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},bt(t,e,this._oneTimeListeners),this},Ct.prototype.fire=function(t,e){"string"==typeof t&&(t=new wt(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<a.length;o+=1){var s=a[o];xt(r,s,this._oneTimeListeners),s.call(this,t)}var l=this._eventedParent;l&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof Et&&console.error(t.error);return this},Ct.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Ct.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var St={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:[{"!":"text-offset"}],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[{"!":"text-anchor"},{"!":"text-offset"},{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",requires:["text-field"],values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Tt=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function At(t){var e=t.value;return e?[new Tt(t.key,e,"constants have been deprecated as of v8")]:[]}function It(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}function kt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Pt(t){return Array.isArray(t)?t.map(Pt):kt(t)}var Ot=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Rt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1]}};Rt.prototype.concat=function(t){return new Rt(this,t)},Rt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Rt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Dt={kind:"null"},Mt={kind:"number"},Lt={kind:"string"},zt={kind:"boolean"},Nt={kind:"color"},Ft={kind:"object"},Bt={kind:"value"},Vt={kind:"collator"},jt={kind:"formatted"};function Ut(t,e){return{kind:"array",itemType:t,N:e}}function qt(t){if("array"===t.kind){var e=qt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Ht=[Dt,Mt,Lt,zt,Nt,jt,Ft,Ut(Bt)];function Wt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Wt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=Ht;r<n.length;r+=1)if(!Wt(n[r],e))return null}return"Expected "+qt(t)+" but found "+qt(e)+" instead."}var Gt=e(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function a(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in r)return r[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),u=s.indexOf(")");if(-1!==l&&u+1===s.length){var c=s.substr(0,l),h=s.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),y=m<=.5?m*(f+1):m+f-m*f,g=2*m-y;return[n(255*a(g,y,d+1/3)),n(255*a(g,y,d)),n(255*a(g,y,d-1/3)),p];default:return null}}return null}}catch(t){}}).parseCSSColor,Zt=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};Zt.parse=function(t){if(t){if(t instanceof Zt)return t;if("string"==typeof t){var e=Gt(t);if(e)return new Zt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Zt.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},Zt.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);var Qt=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Qt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Qt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Kt=function(t,e,r){this.text=t,this.scale=e,this.fontStack=r},$t=function(t){this.sections=t};function Xt(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Yt(t){if(null===t)return Dt;if("string"==typeof t)return Lt;if("boolean"==typeof t)return zt;if("number"==typeof t)return Mt;if(t instanceof Zt)return Nt;if(t instanceof Qt)return Vt;if(t instanceof $t)return jt;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=Yt(i[n]);if(e){if(e===o)continue;e=Bt;break}e=o}return Ut(e||Bt,r)}return Ft}function Jt(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Zt||t instanceof $t?t.toString():JSON.stringify(t)}$t.fromString=function(t){return new $t([new Kt(t,null,null)])},$t.prototype.toString=function(){return this.sections.map(function(t){return t.text}).join("")},$t.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),t.push(i)}return t};var te=function(t,e){this.type=t,this.value=e};te.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Zt)return!0;if(e instanceof Qt)return!0;if(e instanceof $t)return!0;if(Array.isArray(e)){for(var r=0,n=e;r<n.length;r+=1)if(!t(n[r]))return!1;return!0}if("object"==typeof e){for(var i in e)if(!t(e[i]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var r=t[1],n=Yt(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new te(n,r)},te.prototype.evaluate=function(){return this.value},te.prototype.eachChild=function(){},te.prototype.possibleOutputs=function(){return[this.value]},te.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Zt?["rgba"].concat(this.value.toArray()):this.value instanceof $t?this.value.serialize():this.value};var ee=function(t){this.name="ExpressionEvaluationError",this.message=t};ee.prototype.toJSON=function(){return this.message};var re={string:Lt,number:Mt,boolean:zt,object:Ft},ne=function(t,e){this.type=t,this.args=e};ne.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in re)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=re[s],n++}else o=Bt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=Ut(o,a)}else r=re[i];for(var l=[];n<t.length;n++){var u=e.parse(t[n],n,Bt);if(!u)return null;l.push(u)}return new ne(r,l)},ne.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Wt(this.type,Yt(r)))return r;if(e===this.args.length-1)throw new ee("Expected value to be of type "+qt(this.type)+", but found "+qt(Yt(r))+" instead.")}return null},ne.prototype.eachChild=function(t){this.args.forEach(t)},ne.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},ne.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(function(t){return t.serialize()}))};var ie=function(t){this.type=jt,this.sections=t};ie.parse=function(t,e){if(t.length<3)return e.error("Expected at least two arguments.");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");for(var r=[],n=1;n<t.length-1;n+=2){var i=e.parse(t[n],1,Bt);if(!i)return null;var o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o)return e.error("Formatted text type must be 'string', 'value', or 'null'.");var a=t[n+1];if("object"!=typeof a||Array.isArray(a))return e.error("Format options argument must be an object.");var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Mt)))return null;var l=null;if(a["text-font"]&&!(l=e.parse(a["text-font"],1,Ut(Lt))))return null;r.push({text:i,scale:s,font:l})}return new ie(r)},ie.prototype.evaluate=function(t){return new $t(this.sections.map(function(e){return new Kt(Jt(e.text.evaluate(t)),e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null)}))},ie.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.text),n.scale&&t(n.scale),n.font&&t(n.font)}},ie.prototype.possibleOutputs=function(){return[void 0]},ie.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.text.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),t.push(i)}return t};var oe={"to-boolean":zt,"to-color":Nt,"to-number":Mt,"to-string":Lt},ae=function(t,e){this.type=t,this.args=e};ae.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=oe[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Bt);if(!a)return null;i.push(a)}return new ae(n,i)},ae.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof Zt)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Xt(e[0],e[1],e[2],e[3])))return new Zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ee(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null===(a=l[s].evaluate(t)))return 0;var u=Number(a);if(!isNaN(u))return u}throw new ee("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?$t.fromString(Jt(this.args[0].evaluate(t))):Jt(this.args[0].evaluate(t))},ae.prototype.eachChild=function(t){this.args.forEach(t)},ae.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},ae.prototype.serialize=function(){if("formatted"===this.type.kind)return new ie([{text:this.args[0],scale:null,font:null}]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var se=["Unknown","Point","LineString","Polygon"],le=function(){this.globals=null,this.feature=null,this.featureState=null,this._parseColorCache={}};le.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},le.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?se[this.feature.type]:this.feature.type:null},le.prototype.properties=function(){return this.feature&&this.feature.properties||{}},le.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Zt.parse(t)),e};var ue=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};ue.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ue.prototype.eachChild=function(t){this.args.forEach(t)},ue.prototype.possibleOutputs=function(){return[void 0]},ue.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},ue.parse=function(t,e){var r,n=t[0],i=ue.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),l=null,u=0,c=s;u<c.length;u+=1){var h=c[u],p=h[0],d=h[1];l=new me(e.registry,e.path,null,e.scope);for(var f=[],m=!1,y=1;y<t.length;y++){var g=t[y],_=Array.isArray(p)?p[y-1]:p.type,v=l.parse(g,1+f.length,_);if(!v){m=!0;break}f.push(v)}if(!m)if(Array.isArray(p)&&p.length!==f.length)l.error("Expected "+p.length+" arguments, but found "+f.length+" instead.");else{for(var b=0;b<f.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=f[b];l.concat(b+1).checkSubtype(x,w.type)}if(0===l.errors.length)return new ue(n,o,d,f)}}if(1===s.length)(r=e.errors).push.apply(r,l.errors);else{for(var E=(s.length?s:a).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(qt).join(", ")+")":"("+qt(e.type)+"...)"}).join(" | "),C=[],S=1;S<t.length;S++){var T=e.parse(t[S],1+C.length);if(!T)return null;C.push(qt(T.type))}e.error("Expected arguments of type "+E+", but found ("+C.join(", ")+") instead.")}return null},ue.register=function(t,e){for(var r in ue.definitions=e,e)t[r]=ue};var ce=function(t,e,r){this.type=Vt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function he(t){if(t instanceof ue){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!he(t)&&(e=!1)}),e}function pe(t){if(t instanceof ue&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!pe(t)&&(e=!1)}),e}function de(t,e){if(t instanceof ue&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!de(t,e)&&(r=!1)}),r}ce.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,zt);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,zt);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,Lt))?null:new ce(n,i,o)},ce.prototype.evaluate=function(t){return new Qt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ce.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ce.prototype.possibleOutputs=function(){return[void 0]},ce.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var fe=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};fe.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new fe(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},fe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},fe.prototype.eachChild=function(){},fe.prototype.possibleOutputs=function(){return[void 0]},fe.prototype.serialize=function(){return["var",this.name]};var me=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Rt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=r};function ye(t,e){for(var r,n=0,i=t.length-1,o=0;n<=i;){if(e===(r=t[o=Math.floor((n+i)/2)])||e>r&&e<t[o+1])return o;if(r<e)n=o+1;else{if(!(r>e))throw new ee("Input is not a number.");i=o-1}}return Math.max(o-1,0)}me.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},me.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new ne(e,[t]):"coerce"===r?new ae(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof te)&&function t(e){if(e instanceof fe)return t(e.boundExpression);if(e instanceof ue&&"error"===e.name)return!1;if(e instanceof ce)return!1;var r=e instanceof ae||e instanceof ne,n=!0;return e.eachChild(function(e){n=r?n&&t(e):n&&e instanceof te}),!!n&&he(e)&&de(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var l=new le;try{o=new te(o.type,o.evaluate(l))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},me.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new me(this.registry,n,e||null,i,this.errors)},me.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Ot(n,t))},me.prototype.checkSubtype=function(t,e){var r=Wt(t,e);return r&&this.error(r),r};var ge=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function _e(t,e,r){return t*(1-r)+e*r}ge.parse=function(t,e){var r=t[1],n=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,1,Mt)))return null;var i=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),n.unshift(-1/0);for(var a=0;a<n.length;a+=2){var s=n[a],l=n[a+1],u=a+1,c=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var h=e.parse(l,c,o);if(!h)return null;o=o||h.type,i.push([s,h])}return new ge(o,r,i)},ge.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[ye(e,n)].evaluate(t)},ge.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},ge.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var ve=Object.freeze({number:_e,color:function(t,e,r){return new Zt(_e(t.r,e.r,r),_e(t.g,e.g,r),_e(t.b,e.b,r),_e(t.a,e.a,r))},array:function(t,e,r){return t.map(function(t,n){return _e(t,e[n],r)})}}),be=.95047,xe=1,we=1.08883,Ee=4/29,Ce=6/29,Se=3*Ce*Ce,Te=Ce*Ce*Ce,Ae=Math.PI/180,Ie=180/Math.PI;function ke(t){return t>Te?Math.pow(t,1/3):t/Se+Ee}function Pe(t){return t>Ce?t*t*t:Se*(t-Ee)}function Oe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Re(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function De(t){var e=Re(t.r),r=Re(t.g),n=Re(t.b),i=ke((.4124564*e+.3575761*r+.1804375*n)/be),o=ke((.2126729*e+.7151522*r+.072175*n)/xe);return{l:116*o-16,a:500*(i-o),b:200*(o-ke((.0193339*e+.119192*r+.9503041*n)/we)),alpha:t.a}}function Me(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=xe*Pe(e),r=be*Pe(r),n=we*Pe(n),new Zt(Oe(3.2404542*r-1.5371385*e-.4985314*n),Oe(-.969266*r+1.8760108*e+.041556*n),Oe(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Le(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var ze={forward:De,reverse:Me,interpolate:function(t,e,r){return{l:_e(t.l,e.l,r),a:_e(t.a,e.a,r),b:_e(t.b,e.b,r),alpha:_e(t.alpha,e.alpha,r)}}},Ne={forward:function(t){var e=De(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*Ie;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Ae,r=t.c;return Me({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Le(t.h,e.h,r),c:_e(t.c,e.c,r),l:_e(t.l,e.l,r),alpha:_e(t.alpha,e.alpha,r)}}},Fe=Object.freeze({lab:ze,hcl:Ne}),Be=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function Ve(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}Be.interpolationFactor=function(t,e,n,i){var o=0;if("exponential"===t.name)o=Ve(e,t.base,n,i);else if("linear"===t.name)o=Ve(e,1,n,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new r(a[0],a[1],a[2],a[3]).solve(Ve(e,1,n,i))}return o},Be.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Mt)))return null;var l=[],u=null;"interpolate-hcl"===r||"interpolate-lab"===r?u=Nt:e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],d=c+3,f=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=e.parse(p,f,u);if(!m)return null;u=u||m.type,l.push([h,m])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new Be(u,r,n,i,l):e.error("Type "+qt(u)+" is not interpolatable.")},Be.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=ye(e,n),a=Be.interpolationFactor(this.interpolation,n,e[o],e[o+1]),s=r[o].evaluate(t),l=r[o+1].evaluate(t);return"interpolate"===this.operator?ve[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Ne.reverse(Ne.interpolate(Ne.forward(s),Ne.forward(l),a)):ze.reverse(ze.interpolate(ze.forward(s),ze.forward(l),a))},Be.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Be.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},Be.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var je=function(t,e){this.type=t,this.args=e};je.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s)}var l=n&&i.some(function(t){return Wt(n,t.type)});return new je(l?Bt:r,i)},je.prototype.evaluate=function(t){for(var e=null,r=0,n=this.args;r<n.length&&null===(e=n[r].evaluate(t));r+=1);return e},je.prototype.eachChild=function(t){this.args.forEach(t)},je.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},je.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ue=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Ue.prototype.evaluate=function(t){return this.result.evaluate(t)},Ue.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},Ue.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new Ue(r,a):null},Ue.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Ue.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};var qe=function(t,e,r){this.type=t,this.index=e,this.input=r};qe.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Mt),n=e.parse(t[2],2,Ut(e.expectedType||Bt));return r&&n?new qe(n.type.itemType,r,n):null},qe.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ee("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ee("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ee("Array index must be an integer, but found "+e+" instead.");return r[e]},qe.prototype.eachChild=function(t){t(this.index),t(this.input)},qe.prototype.possibleOutputs=function(){return[void 0]},qe.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var He=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};He.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,Yt(p)))return null}else r=Yt(p);if(void 0!==i[String(p)])return u.error("Branch labels must be unique.");i[String(p)]=o.length}var d=e.parse(l,a,n);if(!d)return null;n=n||d.type,o.push(d)}var f=e.parse(t[1],1,Bt);if(!f)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==f.type.kind&&e.concat(1).checkSubtype(r,f.type)?null:new He(r,n,f,i,o,m):null},He.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Yt(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},He.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},He.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},He.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,u=r;l<u.length;l+=1){var c=u[l],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var We=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};function Ge(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ze(t,e,r,n){return 0===n.compare(e,r)}function Qe(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=zt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,Bt);if(!o)return null;if(!Ge(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+qt(o.type)+"'.");var a=e.parse(t[2],2,Bt);if(!a)return null;if(!Ge(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+qt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+qt(o.type)+"' and '"+qt(a.type)+"'.");n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new ne(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new ne(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Vt)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=Yt(o),l=Yt(a);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ee('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var u=Yt(o),c=Yt(a);if("string"!==u.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.possibleOutputs=function(){return[!0,!1]},i.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},i}()}We.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,zt);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new We(r,n,s):null},We.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},We.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i)}t(this.otherwise)},We.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(t){return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},We.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ke=Qe("==",function(t,e,r){return e===r},Ze),$e=Qe("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Ze(0,e,r,n)}),Xe=Qe("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),Ye=Qe(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),Je=Qe("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),tr=Qe(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0}),er=function(t,e,r,n,i){this.type=Lt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};er.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Mt);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Lt)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,Lt)))return null;var a=null;if(n["min-fraction-digits"]&&!(a=e.parse(n["min-fraction-digits"],1,Mt)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Mt))?null:new er(r,i,o,a,s)},er.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},er.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},er.prototype.possibleOutputs=function(){return[void 0]},er.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var rr=function(t){this.type=Mt,this.input=t};rr.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+qt(r.type)+" instead."):new rr(r):null},rr.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ee("Expected value to be of type string or array, but found "+qt(Yt(e))+" instead.")},rr.prototype.eachChild=function(t){t(this.input)},rr.prototype.possibleOutputs=function(){return[void 0]},rr.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var nr={"==":Ke,"!=":$e,">":Ye,"<":Xe,">=":tr,"<=":Je,array:ne,at:qe,boolean:ne,case:We,coalesce:je,collator:ce,format:ie,interpolate:Be,"interpolate-hcl":Be,"interpolate-lab":Be,length:rr,let:Ue,literal:te,match:He,number:ne,"number-format":er,object:ne,step:ge,string:ne,"to-boolean":ae,"to-color":ae,"to-number":ae,"to-string":ae,var:fe};function ir(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=Xt(r,n,i,a);if(s)throw new ee(s);return new Zt(r/255*a,n/255*a,i/255*a,a)}function or(t,e){return t in e}function ar(t,e){var r=e[t];return void 0===r?null:r}function sr(t){return{type:t}}function lr(t){return{result:"success",value:t}}function ur(t){return{result:"error",value:t}}function cr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function hr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function pr(t){return!!t.expression&&t.expression.interpolated}function dr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function fr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function mr(t){return t}function yr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function gr(t,e,r,n,i){return yr(typeof r===i?n[r]:void 0,t.default,e.default)}function _r(t,e,r){if("number"!==dr(r))return yr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=xr(t.stops,r);return t.stops[i][1]}function vr(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==dr(r))return yr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o=xr(t.stops,r),a=function(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],u=ve[e.type]||mr;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=Fe[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return u(r,n,a)}}:u(s,l,a)}function br(t,e,r){return"color"===e.type?r=Zt.parse(r):"formatted"===e.type?r=$t.fromString(r.toString()):dr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),yr(r,t.default,e.default)}function xr(t,e){for(var r,n=0,i=t.length-1,o=0;n<=i;){if(e===(r=t[o=Math.floor((n+i)/2)][0])||e>r&&e<t[o+1][0])return o;r<e?n=o+1:r>e&&(i=o-1)}return Math.max(o-1,0)}ue.register(nr,{error:[{kind:"error"},[Lt],function(t,e){throw new ee(e[0].evaluate(t))}],typeof:[Lt,[Bt],function(t,e){return qt(Yt(e[0].evaluate(t)))}],"to-rgba":[Ut(Mt,4),[Nt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Nt,[Mt,Mt,Mt],ir],rgba:[Nt,[Mt,Mt,Mt,Mt],ir],has:{type:zt,overloads:[[[Lt],function(t,e){return or(e[0].evaluate(t),t.properties())}],[[Lt,Ft],function(t,e){var r=e[1];return or(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:Bt,overloads:[[[Lt],function(t,e){return ar(e[0].evaluate(t),t.properties())}],[[Lt,Ft],function(t,e){var r=e[1];return ar(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[Bt,[Lt],function(t,e){return ar(e[0].evaluate(t),t.featureState||{})}],properties:[Ft,[],function(t){return t.properties()}],"geometry-type":[Lt,[],function(t){return t.geometryType()}],id:[Bt,[],function(t){return t.id()}],zoom:[Mt,[],function(t){return t.globals.zoom}],"heatmap-density":[Mt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Mt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Bt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Mt,sr(Mt),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[Mt,sr(Mt),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:Mt,overloads:[[[Mt,Mt],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[Mt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Mt,[Mt,Mt],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[Mt,[Mt,Mt],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[Mt,[],function(){return Math.LN2}],pi:[Mt,[],function(){return Math.PI}],e:[Mt,[],function(){return Math.E}],"^":[Mt,[Mt,Mt],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[Mt,[Mt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Mt,[Mt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Mt,[Mt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Mt,[Mt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Mt,[Mt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Mt,[Mt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Mt,[Mt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Mt,[Mt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Mt,[Mt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Mt,[Mt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Mt,sr(Mt),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[Mt,sr(Mt),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[Mt,[Mt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Mt,[Mt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Mt,[Mt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Mt,[Mt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[zt,[Lt,Bt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[zt,[Bt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[zt,[Lt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[zt,[Lt,Bt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[zt,[Bt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[zt,[Lt,Bt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[zt,[Bt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[zt,[Lt,Bt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[zt,[Bt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[zt,[Lt,Bt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[zt,[Bt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[zt,[Bt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[zt,[],function(t){return null!==t.id()}],"filter-type-in":[zt,[Ut(Lt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[zt,[Ut(Bt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[zt,[Lt,Ut(Bt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[zt,[Lt,Ut(Bt)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:zt,overloads:[[[zt,zt],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[sr(zt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[sr(zt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[zt,[zt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[zt,[Lt],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[Lt,[Lt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Lt,[Lt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Lt,sr(Bt),function(t,e){return e.map(function(e){return Jt(e.evaluate(t))}).join("")}],"resolved-locale":[Lt,[Vt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var wr=function(t,e){var r;this.expression=t,this._warningHistory={},this._evaluator=new le,this._defaultValue=e?"color"===(r=e).type&&fr(r.default)?new Zt(0,0,0,0):"color"===r.type?Zt.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=e&&"enum"===e.type?e.values:null};function Er(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in nr}function Cr(t,e){var r=new me(nr,[],e?function(t){var e={color:Nt,string:Lt,number:Mt,enum:Lt,boolean:zt,formatted:jt};return"array"===t.type?Ut(e[t.value]||Bt,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?lr(new wr(n,e)):ur(r.errors)}wr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this.expression.evaluate(this._evaluator)},wr.prototype.evaluate=function(t,e,r){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null;try{var n=this.expression.evaluate(this._evaluator);if(null==n)return this._defaultValue;if(this._enumValues&&!(n in this._enumValues))throw new ee("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(n)+" instead.");return n}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Sr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!pe(e.expression)};Sr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Sr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)};var Tr=function(t,e,r){this.kind=t,this.zoomStops=r.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!pe(e.expression),r instanceof Be&&(this._interpolationType=r.interpolation)};function Ar(t,e){if("error"===(t=Cr(t,e)).result)return t;var r=t.value.expression,n=he(r);if(!n&&!cr(e))return ur([new Ot("","data expressions not supported")]);var i=de(r,["zoom"]);if(!i&&!hr(e))return ur([new Ot("","zoom expressions not supported")]);var o=function t(e){var r=null;if(e instanceof Ue)r=t(e.result);else if(e instanceof je)for(var n=0,i=e.args;n<i.length&&!(r=t(i[n]));n+=1);else(e instanceof ge||e instanceof Be)&&e.input instanceof ue&&"zoom"===e.input.name&&(r=e);return r instanceof Ot?r:(e.eachChild(function(e){var n=t(e);n instanceof Ot?r=n:!r&&n?r=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r)}(r);return o||i?o instanceof Ot?ur([o]):o instanceof Be&&!pr(e)?ur([new Ot("",'"interpolate" expressions cannot be used with this property')]):lr(o?new Tr(n?"camera":"composite",t.value,o):new Sr(n?"constant":"source",t.value)):ur([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Tr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Tr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)},Tr.prototype.interpolationFactor=function(t,e,r){return this._interpolationType?Be.interpolationFactor(this._interpolationType,t,e,r):0};var Ir=function(t,e){this._parameters=t,this._specification=e,It(this,function t(e,r){var n,i,o,a="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||!(s||void 0!==e.property),u=e.type||(pr(r)?"exponential":"interval");if(a&&((e=It({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],Zt.parse(t[1])]})),e.default=Zt.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Fe[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===u)n=vr;else if("interval"===u)n=_r;else if("categorical"===u){n=gr,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==u)throw new Error('Unknown function type "'+u+'"');n=br}if(s){for(var d={},f=[],m=0;m<e.stops.length;m++){var y=e.stops[m],g=y[0].zoom;void 0===d[g]&&(d[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},f.push(g)),d[g].stops.push([y[0].value,y[1]])}for(var _=[],v=0,b=f;v<b.length;v+=1){var x=b[v];_.push([d[x].zoom,t(d[x],r)])}return{kind:"composite",interpolationFactor:Be.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:_.map(function(t){return t[0]}),evaluate:function(t,n){var i=t.zoom;return vr({stops:_,base:e.base},r,i).evaluate(i,n)}}}return l?{kind:"camera",interpolationFactor:"exponential"===u?Be.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){return n(e,r,t.zoom,i,o)}}:{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?yr(e.default,r.default):n(e,r,s,i,o)}}}(this._parameters,this._specification))};function kr(t,e){if(fr(t))return new Ir(t,e);if(Er(t)){var r=Ar(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=Zt.parse(t)),{kind:"constant",evaluate:function(){return n}}}function Pr(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=dr(r);if("object"!==l)return[new Tt(e,r,"object expected, "+l+" found")];for(var u in r){var c=u.split(".")[0],h=n[c]||n["*"],p=void 0;if(i[c])p=i[c];else if(n[c])p=tn;else if(i["*"])p=i["*"];else{if(!n["*"]){s.push(new Tt(e,r[u],'unknown property "'+u+'"'));continue}p=tn}s=s.concat(p({key:(e?e+".":e)+u,value:r[u],valueSpec:h,style:o,styleSpec:a,object:r,objectKey:u},r))}for(var d in n)i[d]||n[d].required&&void 0===n[d].default&&void 0===r[d]&&s.push(new Tt(e,r,'missing required property "'+d+'"'));return s}function Or(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||tn;if("array"!==dr(e))return[new Tt(o,e,"array expected, "+dr(e)+" found")];if(r.length&&e.length!==r.length)return[new Tt(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===dr(r.value)&&(s=r.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:s,style:n,styleSpec:i,key:o+"["+u+"]"}));return l}function Rr(t){var e=t.key,r=t.value,n=t.valueSpec,i=dr(r);return"number"!==i?[new Tt(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new Tt(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new Tt(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function Dr(t){var e,r,n,i=t.valueSpec,o=kt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,l=!s,u="array"===dr(t.value.stops)&&"array"===dr(t.value.stops[0])&&"object"===dr(t.value.stops[0][0]),c=Pr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Tt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Or({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===dr(r)&&0===r.length&&e.push(new Tt(t.key,r,"array must have at least one stop")),e},default:function(t){return tn({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new Tt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new Tt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!pr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!cr(t.valueSpec)?c.push(new Tt(t.key,t.value,"property functions not supported")):s&&!hr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!u||void 0!==t.value.property||c.push(new Tt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==dr(o))return[new Tt(s,o,"array expected, "+dr(o)+" found")];if(2!==o.length)return[new Tt(s,o,"array length 2 expected, length "+o.length+" found")];if(u){if("object"!==dr(o[0]))return[new Tt(s,o,"object expected, "+dr(o[0])+" found")];if(void 0===o[0].zoom)return[new Tt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Tt(s,o,"object stop key must have value")];if(n&&n>kt(o[0].zoom))return[new Tt(s,o[0].zoom,"stop zoom values must appear in ascending order")];kt(o[0].zoom)!==n&&(n=kt(o[0].zoom),r=void 0,a={}),e=e.concat(Pr({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Rr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Er(Pt(o[1]))?e.concat([new Tt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(tn({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,n){var s=dr(t.value),l=kt(t.value),u=null!==t.value?t.value:n;if(e){if(s!==e)return[new Tt(t.key,u,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Tt(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return cr(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(t.key,u,c)]}return"categorical"!==o||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===s&&void 0!==r&&l<r?[new Tt(t.key,u,"stop domain values must appear in ascending order")]:(r=l,"categorical"===o&&l in a?[new Tt(t.key,u,"stop domain values must be unique")]:(a[l]=!0,[])):[new Tt(t.key,u,"integer expected, found "+l)]}}function Mr(t){var e=("property"===t.expressionContext?Ar:Cr)(Pt(t.value),t.valueSpec);if("error"===e.result)return e.value.map(function(e){return new Tt(""+t.key+e.key,t.value,e.message)});var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==r.possibleOutputs().indexOf(void 0))return[new Tt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!pe(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!pe(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!de(r,["zoom","feature-state"]))return[new Tt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!he(r))return[new Tt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lr(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(kt(r))&&i.push(new Tt(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(kt(r))&&i.push(new Tt(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function zr(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!zr(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Ir.deserialize=function(t){return new Ir(t._parameters,t._specification)},Ir.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Nr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fr(t){if(null==t)return function(){return!0};zr(t)||(t=Vr(t));var e=Cr(t,Nr);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,r){return e.value.evaluate(t,r)}}function Br(t,e){return t<e?-1:t>e?1:0}function Vr(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?jr(t[1],t[2],"=="):"!="===r?Hr(jr(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?jr(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Vr))):"all"===r?["all"].concat(t.slice(1).map(Vr)):"none"===r?["all"].concat(t.slice(1).map(Vr).map(Hr)):"in"===r?Ur(t[1],t.slice(2)):"!in"===r?Hr(Ur(t[1],t.slice(2))):"has"===r?qr(t[1]):"!has"!==r||Hr(qr(t[1]))}function jr(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Ur(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Br)]]:["filter-in-small",t,["literal",e]]}}function qr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Hr(t){return["!",t]}function Wr(t){return zr(Pt(t.value))?Mr(It({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==dr(r))return[new Tt(n,r,"array expected, "+dr(r)+" found")];var i,o=e.styleSpec,a=[];if(r.length<1)return[new Tt(n,r,"filter array must have at least 1 element")];switch(a=a.concat(Lr({key:n+"[0]",value:r[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),kt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===kt(r[1])&&a.push(new Tt(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new Tt(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(i=dr(r[1]))&&a.push(new Tt(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=dr(r[s]),"$type"===kt(r[1])?a=a.concat(Lr({key:n+"["+s+"]",value:r[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Tt(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var l=1;l<r.length;l++)a=a.concat(t({key:n+"["+l+"]",value:r[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=dr(r[1]),2!==r.length?a.push(new Tt(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Tt(n+"[1]",r[1],"string expected, "+i+" found"))}return a}(t)}function Gr(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return tn({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var u,c=t.valueSpec||s[a];if(!c)return[new Tt(r,o,'unknown property "'+a+'"')];if("string"===dr(o)&&cr(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Tt(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Tt(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&fr(Pt(o))&&"identity"===kt(o.type)&&h.push(new Tt(r,o,'"text-font" does not support identity functions'))),h.concat(tn({key:t.key,value:o,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function Zr(t){return Gr(t,"paint")}function Qr(t){return Gr(t,"layout")}function Kr(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new Tt(n,r,'either "type" or "ref" is required'));var a,s=kt(r.type),l=kt(r.ref);if(r.id)for(var u=kt(r.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];kt(h.id)===u&&e.push(new Tt(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new Tt(n,r[t],'"'+t+'" is prohibited for ref layers'))}),i.layers.forEach(function(t){kt(t.id)===l&&(a=t)}),a?a.ref?e.push(new Tt(n,r.ref,"ref cannot reference another ref layer")):s=kt(a.type):e.push(new Tt(n,r.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(r.source){var p=i.sources&&i.sources[r.source],d=p&&kt(p.type);p?"vector"===d&&"raster"===s?e.push(new Tt(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===d&&"raster"!==s?e.push(new Tt(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==d||r["source-layer"]?"raster-dem"===d&&"hillshade"!==s?e.push(new Tt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===d&&p.lineMetrics||e.push(new Tt(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Tt(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Tt(n,r.source,'source "'+r.source+'" not found'))}else e.push(new Tt(n,r,'missing required property "source"'));return e=e.concat(Pr({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return tn({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Wr,layout:function(t){return Pr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Qr(It({layerType:s},t))}}})},paint:function(t){return Pr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Zr(It({layerType:s},t))}}})}}}))}function $r(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new Tt(r,e,'"type" is required')];var o,a=kt(e.type);switch(a){case"vector":case"raster":case"raster-dem":if(o=Pr({key:r,value:e,valueSpec:n["source_"+a.replace("-","_")],style:t.style,styleSpec:n}),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&o.push(new Tt(r+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return o;case"geojson":if(o=Pr({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n}),e.cluster)for(var l in e.clusterProperties){var u=e.clusterProperties[l],c=u[0],h="string"==typeof c?[c,["accumulated"],["get",l]]:c;o.push.apply(o,Mr({key:r+"."+l+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,Mr({key:r+"."+l+".reduce",value:h,expressionContext:"cluster-reduce"}))}return o;case"video":return Pr({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Pr({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lr({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function Xr(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],a=dr(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Tt("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=o.concat(l&&n[l[1]]&&n[l[1]].transition?tn({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?tn({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new Tt(s,e[s],'unknown property "'+s+'"')])}return o}function Yr(t){var e=t.value,r=t.key,n=dr(e);return"string"!==n?[new Tt(r,e,"string expected, "+n+" found")]:[]}var Jr={"*":function(){return[]},array:Or,boolean:function(t){var e=t.value,r=t.key,n=dr(e);return"boolean"!==n?[new Tt(r,e,"boolean expected, "+n+" found")]:[]},number:Rr,color:function(t){var e=t.key,r=t.value,n=dr(r);return"string"!==n?[new Tt(e,r,"color expected, "+n+" found")]:null===Gt(r)?[new Tt(e,r,'color expected, "'+r+'" found')]:[]},constants:At,enum:Lr,filter:Wr,function:Dr,layer:Kr,object:Pr,source:$r,light:Xr,string:Yr,formatted:function(t){return 0===Yr(t).length?[]:Mr(t)}};function tn(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&fr(kt(e))?Dr(t):r.expression&&Er(Pt(e))?Mr(t):r.type&&Jr[r.type]?Jr[r.type](t):Pr(It({},t,{valueSpec:r.type?n[r.type]:r}))}function en(t){var e=t.value,r=t.key,n=Yr(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Tt(r,e,'"glyphs" url must include a "{range}" token')),n)}function rn(t,e){var r=[];return r=r.concat(tn({key:"",value:t,valueSpec:(e=e||St).$root,styleSpec:e,style:t,objectElementValidators:{glyphs:en,"*":function(){return[]}}})),t.constants&&(r=r.concat(At({key:"constants",value:t.constants,style:t,styleSpec:e}))),nn(r)}function nn(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function on(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return nn(t.apply(this,e))}}rn.source=on($r),rn.light=on(Xr),rn.layer=on(Kr),rn.filter=on(Wr),rn.paintProperty=on(Zr),rn.layoutProperty=on(Qr);var an=rn,sn=rn.light,ln=rn.paintProperty,un=rn.layoutProperty;function cn(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1)t.fire(new Et(new Error(i[n].message))),r=!0;return r}var hn=dn,pn=3;function dn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[pn+o],s=i[pn+o+1];n.push(a===s?null:i.subarray(a,s))}var l=i[pn+n.length+1];this.keys=i.subarray(i[pn+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}dn.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},dn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},dn.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},dn.prototype.query=function(t,e,r,n,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},dn.prototype._queryCell=function(t,e,r,n,i,o,a,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===a[p]){var d=4*p;(s?s(c[d+0],c[d+1],c[d+2],c[d+3]):t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&n>=c[d+1])?(a[p]=!0,o.push(u[p])):a[p]=!1}}},dn.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,t,e,r,n,f,o,a,s))return}},dn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},dn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},dn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=pn+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[pn+a]=o,i.set(s,o),o+=s.length}return i[pn+t.length]=o,i.set(this.keys,o),i[pn+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var fn=self.ImageData,mn={};function yn(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),mn[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var gn in yn("Object",Object),hn.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},hn.deserialize=function(t){return new hn(t.buffer)},yn("Grid",hn),yn("Color",Zt),yn("Error",Error),yn("StylePropertyFunction",Ir),yn("StyleExpression",wr,{omit:["_evaluator"]}),yn("ZoomDependentExpression",Tr),yn("ZoomConstantExpression",Sr),yn("CompoundExpression",ue,{omit:["_evaluate"]}),nr)nr[gn]._classRegistryKey||yn("Expression_"+gn,nr[gn]);function _n(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof fn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,o=t;i<o.length;i+=1)n.push(_n(o[i],e));return n}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var u in t)if(t.hasOwnProperty(u)&&!(mn[s].omit.indexOf(u)>=0)){var c=t[u];l[u]=mn[s].shallow.indexOf(u)>=0?c:_n(c,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function vn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof fn)return t;if(Array.isArray(t))return t.map(vn);if("object"==typeof t){var e=t.$name||"Object",r=mn[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];n[a]=mn[e].shallow.indexOf(a)>=0?s:vn(s)}}return n}throw new Error("can't deserialize object of type "+typeof t)}var bn=function(){this.first=!0};bn.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var xn={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function wn(t){for(var e=0,r=t;e<r.length;e+=1)if(Sn(r[e].charCodeAt(0)))return!0;return!1}function En(t){for(var e=0,r=t;e<r.length;e+=1)if(!Cn(r[e].charCodeAt(0)))return!1;return!0}function Cn(t){return!(xn.Arabic(t)||xn["Arabic Supplement"](t)||xn["Arabic Extended-A"](t)||xn["Arabic Presentation Forms-A"](t)||xn["Arabic Presentation Forms-B"](t))}function Sn(t){return!(746!==t&&747!==t&&(t<4352||!(xn["Bopomofo Extended"](t)||xn.Bopomofo(t)||xn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||xn["CJK Compatibility Ideographs"](t)||xn["CJK Compatibility"](t)||xn["CJK Radicals Supplement"](t)||xn["CJK Strokes"](t)||!(!xn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||xn["CJK Unified Ideographs Extension A"](t)||xn["CJK Unified Ideographs"](t)||xn["Enclosed CJK Letters and Months"](t)||xn["Hangul Compatibility Jamo"](t)||xn["Hangul Jamo Extended-A"](t)||xn["Hangul Jamo Extended-B"](t)||xn["Hangul Jamo"](t)||xn["Hangul Syllables"](t)||xn.Hiragana(t)||xn["Ideographic Description Characters"](t)||xn.Kanbun(t)||xn["Kangxi Radicals"](t)||xn["Katakana Phonetic Extensions"](t)||xn.Katakana(t)&&12540!==t||!(!xn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!xn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||xn["Unified Canadian Aboriginal Syllabics"](t)||xn["Unified Canadian Aboriginal Syllabics Extended"](t)||xn["Vertical Forms"](t)||xn["Yijing Hexagram Symbols"](t)||xn["Yi Syllables"](t)||xn["Yi Radicals"](t))))}function Tn(t){return!(Sn(t)||function(t){return!!(xn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||xn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||xn["Letterlike Symbols"](t)||xn["Number Forms"](t)||xn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||xn["Control Pictures"](t)&&9251!==t||xn["Optical Character Recognition"](t)||xn["Enclosed Alphanumerics"](t)||xn["Geometric Shapes"](t)||xn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||xn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||xn["CJK Symbols and Punctuation"](t)||xn.Katakana(t)||xn["Private Use Area"](t)||xn["CJK Compatibility Forms"](t)||xn["Small Form Variants"](t)||xn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function An(t,e){return!(!e&&(t>=1424&&t<=2303||xn["Arabic Presentation Forms-A"](t)||xn["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||xn.Khmer(t))}var In,kn=!1,Pn=null,On=!1,Rn=new Ct,Dn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return On||null!=Dn.applyArabicShaping}},Mn=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bn,this.transition={})};Mn.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!An(n[r].charCodeAt(0),e))return!1;return!0}(t,Dn.isLoaded())},Mn.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Mn.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var Ln=function(t,e){this.property=t,this.value=e,this.expression=kr(void 0===e?t.specification.default:e,t.specification)};Ln.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Ln.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var zn=function(t){this.property=t,this.value=new Ln(t,void 0)};zn.prototype.transitioned=function(t,e){return new Fn(this.property,this.value,e,h({},t.transition,this.transition),t.now)},zn.prototype.untransitioned=function(){return new Fn(this.property,this.value,null,{},0)};var Nn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Nn.prototype.getValue=function(t){return b(this._values[t].value.value)},Nn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zn(this._values[t].property)),this._values[t].value=new Ln(this._values[t].property,null===e?void 0:b(e))},Nn.prototype.getTransition=function(t){return b(this._values[t].transition)},Nn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zn(this._values[t].property)),this._values[t].transition=b(e)||void 0},Nn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},Nn.prototype.transitioned=function(t,e){for(var r=new Bn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},Nn.prototype.untransitioned=function(){for(var t=new Bn(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var Fn=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};Fn.prototype.possiblyEvaluate=function(t){var e=t.now||0,r=this.value.possiblyEvaluate(t),n=this.prior;if(n){if(e>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(e<this.begin)return n.possiblyEvaluate(t);var i=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t),r,function(t){if(i<=0)return 0;if(i>=1)return 1;var e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}())}return r};var Bn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Bn.prototype.possiblyEvaluate=function(t){for(var e=new Un(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var i=n[r];e._values[i]=this._values[i].possiblyEvaluate(t)}return e},Bn.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var Vn=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Vn.prototype.getValue=function(t){return b(this._values[t].value)},Vn.prototype.setValue=function(t,e){this._values[t]=new Ln(this._values[t].property,null===e?void 0:b(e))},Vn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},Vn.prototype.possiblyEvaluate=function(t){for(var e=new Un(this._properties),r=0,n=Object.keys(this._values);r<n.length;r+=1){var i=n[r];e._values[i]=this._values[i].possiblyEvaluate(t)}return e};var jn=function(t,e,r){this.property=t,this.value=e,this.parameters=r};jn.prototype.isConstant=function(){return"constant"===this.value.kind},jn.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},jn.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.parameters,t,e)};var Un=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Un.prototype.get=function(t){return this._values[t]};var qn=function(t){this.specification=t};qn.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},qn.prototype.interpolate=function(t,e,r){var n=ve[this.specification.type];return n?n(t,e,r):t};var Hn=function(t){this.specification=t};Hn.prototype.possiblyEvaluate=function(t,e){return new jn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e)}:t.expression,e)},Hn.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new jn(this,{kind:"constant",value:void 0},t.parameters);var n=ve[this.specification.type];return n?new jn(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},Hn.prototype.evaluate=function(t,e,r,n){return"constant"===t.kind?t.value:t.evaluate(e,r,n)};var Wn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e){if(void 0===t.value)return new jn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var r=t.expression.evaluate(e),n=this._calculate(r,r,r,e);return new jn(this,{kind:"constant",value:n},e)}if("camera"===t.expression.kind){var i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new jn(this,{kind:"constant",value:i},e)}return new jn(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,n){if("source"===t.kind){var i=t.evaluate(e,r,n);return this._calculate(i,i,i,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value},e.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(Hn),Gn=function(t){this.specification=t};Gn.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Mn(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Mn(Math.floor(e.zoom),e)),t.expression.evaluate(new Mn(Math.floor(e.zoom+1),e)),e)}},Gn.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Gn.prototype.interpolate=function(t){return t};var Zn=function(t){this.specification=t};Zn.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Zn.prototype.interpolate=function(){return!1};var Qn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var r=t[e],n=this.defaultPropertyValues[e]=new Ln(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new zn(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};yn("DataDrivenProperty",Hn),yn("DataConstantProperty",qn),yn("CrossFadedDataDrivenProperty",Wn),yn("CrossFadedProperty",Gn),yn("ColorRampProperty",Zn);var Kn=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Vn(r.layout)),r.paint)){for(var n in this._transitionablePaint=new Nn(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(un,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return g(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(ln,"layers."+this.id+".paint."+t,t,e,r))return!1;if(g(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"]&&!n.value.value&&e,o=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var a=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),a||o||i},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&cn(this,t.call(an,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:St,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof jn&&cr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Ct),$n={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Xn=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Yn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Jn(t,e){void 0===e&&(e=1);var r=0,n=0;return{members:t.map(function(t){var i=$n[t.type].BYTES_PER_ELEMENT,o=r=ti(r,Math.max(e,i)),a=t.components||1;return n=Math.max(n,i),r+=i*a,{name:t.name,type:t.type,components:a,offset:o}}),size:ti(r,Math.max(n,e)),alignment:e}}function ti(t,e){return Math.ceil(t/e)*e}Yn.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Yn.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Yn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Yn.prototype.clear=function(){this.length=0},Yn.prototype.resize=function(t){this.reserve(t),this.length=t},Yn.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Yn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t},e}(Yn);ei.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",ei);var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,t},e}(Yn);ri.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",ri);var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Yn);ni.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",ni);var ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,o,a,s)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l){var u=6*t,c=12*t;return this.int16[u+0]=e,this.int16[u+1]=r,this.int16[u+2]=n,this.int16[u+3]=i,this.uint8[c+8]=o,this.uint8[c+9]=a,this.uint8[c+10]=s,this.uint8[c+11]=l,t},e}(Yn);ii.prototype.bytesPerElement=12,yn("StructArrayLayout4i4ub12",ii);var oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,o,a,s)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l){var u=8*t;return this.uint16[u+0]=e,this.uint16[u+1]=r,this.uint16[u+2]=n,this.uint16[u+3]=i,this.uint16[u+4]=o,this.uint16[u+5]=a,this.uint16[u+6]=s,this.uint16[u+7]=l,t},e}(Yn);oi.prototype.bytesPerElement=16,yn("StructArrayLayout8ui16",oi);var ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,o,a,s)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l){var u=8*t;return this.int16[u+0]=e,this.int16[u+1]=r,this.int16[u+2]=n,this.int16[u+3]=i,this.uint16[u+4]=o,this.uint16[u+5]=a,this.uint16[u+6]=s,this.uint16[u+7]=l,t},e}(Yn);ai.prototype.bytesPerElement=16,yn("StructArrayLayout4i4ui16",ai);var si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t},e}(Yn);si.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",si);var li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Yn);li.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",li);var ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,n,i,o,a,s,l,u,c)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h){var p=12*t,d=6*t;return this.int16[p+0]=e,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=i,this.int16[p+4]=o,this.int16[p+5]=a,this.uint32[d+3]=s,this.uint16[p+8]=l,this.uint16[p+9]=u,this.int16[p+10]=c,this.int16[p+11]=h,t},e}(Yn);ui.prototype.bytesPerElement=24,yn("StructArrayLayout6i1ul2ui2i24",ui);var ci=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Yn);ci.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",ci);var hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[a+1]=n,this.float32[a+2]=i,t},e}(Yn);hi.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",hi);var pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m=this.length;return this.resize(m+1),this.emplace(m,t,e,r,n,i,o,a,s,l,u,c,h,p,d,f)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m){var y=22*t,g=11*t,_=44*t;return this.int16[y+0]=e,this.int16[y+1]=r,this.uint16[y+2]=n,this.uint16[y+3]=i,this.uint32[g+2]=o,this.uint32[g+3]=a,this.uint32[g+4]=s,this.uint16[y+10]=l,this.uint16[y+11]=u,this.uint16[y+12]=c,this.float32[g+7]=h,this.float32[g+8]=p,this.uint8[_+36]=d,this.uint8[_+37]=f,this.uint32[g+10]=m,t},e}(Yn);pi.prototype.bytesPerElement=44,yn("StructArrayLayout2i2ui3ul3ui2f2ub1ul44",pi);var di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,y,g){var _=this.length;return this.resize(_+1),this.emplace(_,t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,y,g)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,y,g,_){var v=22*t,b=11*t;return this.int16[v+0]=e,this.int16[v+1]=r,this.int16[v+2]=n,this.int16[v+3]=i,this.int16[v+4]=o,this.int16[v+5]=a,this.uint16[v+6]=s,this.uint16[v+7]=l,this.uint16[v+8]=u,this.uint16[v+9]=c,this.uint16[v+10]=h,this.uint16[v+11]=p,this.uint16[v+12]=d,this.uint16[v+13]=f,this.uint16[v+14]=m,this.uint32[b+8]=y,this.float32[b+9]=g,this.float32[b+10]=_,t},e}(Yn);di.prototype.bytesPerElement=44,yn("StructArrayLayout6i9ui1ul2f44",di);var fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Yn);fi.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",fi);var mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t},e}(Yn);mi.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",mi);var yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=r,this.uint16[i+3]=n,t},e}(Yn);yi.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",yi);var gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t},e}(Yn);gi.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",gi);var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t},e}(Yn);_i.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",_i);var vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Yn);vi.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",vi);var bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t},e}(Yn);bi.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",bi);var xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,t},e}(Yn);xi.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",xi);var wi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},r.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Xn);wi.prototype.size=24;var Ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new wi(this,t)},e}(ui);yn("CollisionBoxArray",Ei);var Ci=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},Object.defineProperties(e.prototype,r),e}(Xn);Ci.prototype.size=44;var Si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ci(this,t)},e}(pi);yn("PlacedSymbolArray",Si);var Ti=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},radialTextOffset:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},r.key.get=function(){return this._structArray.uint16[this._pos2+6]},r.key.set=function(t){this._structArray.uint16[this._pos2+6]=t},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+7]},r.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+7]=t},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.featureIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+12]},r.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+13]},r.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+13]=t},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+14]},r.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+14]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+8]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+8]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+9]},r.textBoxScale.set=function(t){this._structArray.float32[this._pos4+9]=t},r.radialTextOffset.get=function(){return this._structArray.float32[this._pos4+10]},r.radialTextOffset.set=function(t){this._structArray.float32[this._pos4+10]=t},Object.defineProperties(e.prototype,r),e}(Xn);Ti.prototype.size=44;var Ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ti(this,t)},e}(di);yn("SymbolInstanceArray",Ai);var Ii=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={offsetX:{configurable:!0}};return r.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},r.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,r),e}(Xn);Ii.prototype.size=4;var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new Ii(this,t)},e}(fi);yn("GlyphOffsetArray",ki);var Pi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return r.x.get=function(){return this._structArray.int16[this._pos2+0]},r.x.set=function(t){this._structArray.int16[this._pos2+0]=t},r.y.get=function(){return this._structArray.int16[this._pos2+1]},r.y.set=function(t){this._structArray.int16[this._pos2+1]=t},r.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},r.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,r),e}(Xn);Pi.prototype.size=6;var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new Pi(this,t)},e}(mi);yn("SymbolLineVertexArray",Oi);var Ri=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,r),e}(Xn);Ri.prototype.size=8;var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ri(this,t)},e}(yi);yn("FeatureIndexArray",Di);var Mi=Jn([{name:"a_pos",components:2,type:"Int16"}],4).members,Li=function(t){void 0===t&&(t=[]),this.segments=t};function zi(t,e){return 256*(t=u(Math.floor(t),0,255))+u(Math.floor(e),0,255)}Li.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return t>Li.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+Li.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>Li.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},Li.prototype.get=function(){return this.segments},Li.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},Li.simpleSegment=function(t,e,r,n){return new Li([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},Li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",Li);var Ni=function(){this.ids=[],this.positions=[],this.indexed=!1};function Fi(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}Ni.prototype.add=function(t,e,r,n){this.ids.push(t),this.positions.push(e,r,n)},Ni.prototype.getPositions=function(t){for(var e=0,r=this.ids.length-1;e<r;){var n=e+r>>1;this.ids[n]>=t?r=n:e=n+1}for(var i=[];this.ids[e]===t;)i.push({index:this.positions[3*e],start:this.positions[3*e+1],end:this.positions[3*e+2]}),e++;return i},Ni.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){if(!(n>=i)){for(var o=e[n+i>>1],a=n-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;Fi(e,a,s),Fi(r,3*a,3*s),Fi(r,3*a+1,3*s+1),Fi(r,3*a+2,3*s+2)}t(e,r,n,s),t(e,r,s+1,i)}}(r,n,0,r.length-1),e.push(r.buffer,n.buffer),{ids:r,positions:n}},Ni.deserialize=function(t){var e=new Ni;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},yn("FeaturePositionMap",Ni);var Bi=function(t,e){this.gl=t.gl,this.location=e},Vi=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(Bi),ji=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(Bi),Ui=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(Bi),qi=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(Bi),Hi=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(Bi),Wi=function(t){function e(e,r){t.call(this,e,r),this.current=Zt.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(Bi),Gi=new Float32Array(16),Zi=function(t){function e(e,r){t.call(this,e,r),this.current=Gi}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Bi);function Qi(t){return[zi(255*t.r,255*t.g),zi(255*t.b,255*t.a)]}var Ki=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0};Ki.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Ki.prototype.setConstantPatternPositions=function(){},Ki.prototype.populatePaintArray=function(){},Ki.prototype.updatePaintArray=function(){},Ki.prototype.upload=function(){},Ki.prototype.destroy=function(){},Ki.prototype.setUniforms=function(t,e,r,n){e.set(n.constantOr(this.value))},Ki.prototype.getBinding=function(t,e){return"color"===this.type?new Wi(t,e):new ji(t,e)},Ki.serialize=function(t){var e=t.names,r=t.type;return{value:_n(t.value),names:e,type:r}},Ki.deserialize=function(t){var e=t.names,r=t.type;return new Ki(vn(t.value),e,r)};var $i=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};$i.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},$i.prototype.populatePaintArray=function(){},$i.prototype.updatePaintArray=function(){},$i.prototype.upload=function(){},$i.prototype.destroy=function(){},$i.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},$i.prototype.setUniforms=function(t,e,r,n,i){var o=this.patternPositions;"u_pattern_to"===i&&o.patternTo&&e.set(o.patternTo),"u_pattern_from"===i&&o.patternFrom&&e.set(o.patternFrom)},$i.prototype.getBinding=function(t,e){return new Hi(t,e)};var Xi=function(t,e,r,n){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"a_"+t}),this.maxValue=-1/0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}}),this.paintVertexArray=new n};Xi.prototype.defines=function(){return[]},Xi.prototype.setConstantPatternPositions=function(){},Xi.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,n=r.length;r.reserve(t);var i=this.expression.evaluate(new Mn(0),e,{});if("color"===this.type)for(var o=Qi(i),a=n;a<t;a++)r.emplaceBack(o[0],o[1]);else{for(var s=n;s<t;s++)r.emplaceBack(i);this.maxValue=Math.max(this.maxValue,i)}},Xi.prototype.updatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:0},r,n);if("color"===this.type)for(var a=Qi(o),s=t;s<e;s++)i.emplace(s,a[0],a[1]);else{for(var l=t;l<e;l++)i.emplace(l,o);this.maxValue=Math.max(this.maxValue,o)}},Xi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xi.prototype.setUniforms=function(t,e){e.set(0)},Xi.prototype.getBinding=function(t,e){return new ji(t,e)};var Yi=function(t,e,r,n,i,o){this.expression=t,this.names=e,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=-1/0;var a=o;this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}}),this.paintVertexArray=new a};Yi.prototype.defines=function(){return[]},Yi.prototype.setConstantPatternPositions=function(){},Yi.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,n=r.length;r.reserve(t);var i=this.expression.evaluate(new Mn(this.zoom),e,{}),o=this.expression.evaluate(new Mn(this.zoom+1),e,{});if("color"===this.type)for(var a=Qi(i),s=Qi(o),l=n;l<t;l++)r.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var u=n;u<t;u++)r.emplaceBack(i,o);this.maxValue=Math.max(this.maxValue,i,o)}},Yi.prototype.updatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:this.zoom},r,n),a=this.expression.evaluate({zoom:this.zoom+1},r,n);if("color"===this.type)for(var s=Qi(o),l=Qi(a),u=t;u<e;u++)i.emplace(u,s[0],s[1],l[0],l[1]);else{for(var c=t;c<e;c++)i.emplace(c,o,a);this.maxValue=Math.max(this.maxValue,o,a)}},Yi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Yi.prototype.interpolationFactor=function(t){return this.expression.interpolationFactor(this.useIntegerZoom?Math.floor(t):t,this.zoom,this.zoom+1)},Yi.prototype.setUniforms=function(t,e,r){e.set(this.interpolationFactor(r.zoom))},Yi.prototype.getBinding=function(t,e){return new ji(t,e)};var Ji=function(t,e,r,n,i,o,a){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.useIntegerZoom=n,this.zoom=i,this.maxValue=-1/0,this.layerId=a,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}}),this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o};Ji.prototype.defines=function(){return[]},Ji.prototype.setConstantPatternPositions=function(){},Ji.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray,i=this.zoomOutPaintVertexArray,o=this.layerId,a=n.length;if(n.reserve(t),i.reserve(t),r&&e.patterns&&e.patterns[o]){var s=e.patterns[o],l=r[s.min],u=r[s.mid],c=r[s.max];if(!l||!u||!c)return;for(var h=a;h<t;h++)n.emplaceBack(u.tl[0],u.tl[1],u.br[0],u.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1]),i.emplaceBack(u.tl[0],u.tl[1],u.br[0],u.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1])}},Ji.prototype.updatePaintArray=function(t,e,r,n,i){var o=this.zoomInPaintVertexArray,a=this.zoomOutPaintVertexArray,s=this.layerId;if(i&&r.patterns&&r.patterns[s]){var l=r.patterns[s],u=i[l.min],c=i[l.mid],h=i[l.max];if(!u||!c||!h)return;for(var p=t;p<e;p++)o.emplace(p,c.tl[0],c.tl[1],c.br[0],c.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1]),a.emplace(p,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1])}},Ji.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ji.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},Ji.prototype.setUniforms=function(t,e){e.set(0)},Ji.prototype.getBinding=function(t,e){return new ji(t,e)};var to=function(){this.binders={},this.cacheKey="",this._buffers=[],this._featureMap=new Ni,this._bufferOffset=0};to.createDynamic=function(t,e,r){var n=new to,i=[];for(var o in t.paint._values)if(r(o)){var a=t.paint.get(o);if(a instanceof jn&&cr(a.property.specification)){var s=ro(o,t.type),l=a.property.specification.type,u=a.property.useIntegerZoom;if("cross-faded"===a.property.specification["property-type"]||"cross-faded-data-driven"===a.property.specification["property-type"])if("constant"===a.value.kind)n.binders[o]=new $i(a.value.value,s,l),i.push("/u_"+o);else{var c=no(o,l,"source");n.binders[o]=new Ji(a.value,s,l,u,e,c,t.id),i.push("/a_"+o)}else if("constant"===a.value.kind)n.binders[o]=new Ki(a.value.value,s,l),i.push("/u_"+o);else if("source"===a.value.kind){var h=no(o,l,"source");n.binders[o]=new Xi(a.value,s,l,h),i.push("/a_"+o)}else{var p=no(o,l,"composite");n.binders[o]=new Yi(a.value,s,l,u,e,p),i.push("/z_"+o)}}}return n.cacheKey=i.sort().join(""),n},to.prototype.populatePaintArrays=function(t,e,r,n){for(var i in this.binders)this.binders[i].populatePaintArray(t,e,n);void 0!==e.id&&this._featureMap.add(+e.id,r,this._bufferOffset,t),this._bufferOffset=t},to.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders)this.binders[r].setConstantPatternPositions(t,e)},to.prototype.updatePaintArrays=function(t,e,r,n){var i=!1;for(var o in t)for(var a=0,s=this._featureMap.getPositions(+o);a<s.length;a+=1){var l=s[a],u=e.feature(l.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Ki||h instanceof $i)&&!0===h.expression.isStateDependent){var p=r.paint.get(c);h.expression=p.value,h.updatePaintArray(l.start,l.end,u,t[o],n),i=!0}}}return i},to.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},to.prototype.getPaintVertexBuffers=function(){return this._buffers},to.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders)for(var i=this.binders[n],o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var l=i.getBinding(t,e[s]);r.push({name:s,property:n,binding:l})}}return r},to.prototype.setUniforms=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,l=a.property;this.binders[l].setUniforms(t,a.binding,n,r.get(l),s)}},to.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var r in this.binders){var n=this.binders[r];if(n instanceof Ji){var i=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;i&&e.push(i)}else(n instanceof Xi||n instanceof Yi)&&n.paintVertexBuffer&&e.push(n.paintVertexBuffer)}this._buffers=e},to.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var r=[];for(var n in this.binders){var i=this.binders[n];(i instanceof Xi||i instanceof Yi)&&i.paintVertexBuffer&&r.push(i.paintVertexBuffer)}this._buffers=r},to.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var eo=function(t,e,r,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var i=0,o=e;i<o.length;i+=1){var a=o[i];this.programConfigurations[a.id]=to.createDynamic(a,r,n),this.programConfigurations[a.id].layoutAttributes=t}this.needsUpload=!1};function ro(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function no(t,e,r){var n={color:{source:bi,composite:xi},number:{source:fi,composite:bi}},i=function(t){return{"line-pattern":{source:oi,composite:oi},"fill-pattern":{source:oi,composite:oi},"fill-extrusion-pattern":{source:oi,composite:oi}}[t]}(t);return i&&i[r]||n[e][r]}eo.prototype.populatePaintArrays=function(t,e,r,n){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n);this.needsUpload=!0},eo.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,o=r;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,e,a,n)||this.needsUpload}},eo.prototype.get=function(t){return this.programConfigurations[t]},eo.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},eo.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",Ki),yn("CrossFadedConstantBinder",$i),yn("SourceExpressionBinder",Xi),yn("CrossFadedCompositeBinder",Ji),yn("CompositeExpressionBinder",Yi),yn("ProgramConfiguration",to,{omit:["_buffers"]}),yn("ProgramConfigurationSet",eo);var io=8192,oo={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function ao(t){for(var e=io/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){var a=i[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<oo.min||a.x>oo.max||a.y<oo.min||a.y>oo.max)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function so(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}var lo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ei,this.indexArray=new gi,this.segments=new Li,this.programConfigurations=new eo(Mi,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function uo(t,e){for(var r=0;r<t.length;r++)if(vo(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(vo(t,e[n]))return!0;return!!fo(t,e)}function co(t,e,r){return!!vo(t,e)||!!yo(e,t,r)}function ho(t,e){if(1===t.length)return _o(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(vo(t,n[i]))return!0;for(var o=0;o<t.length;o++)if(_o(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(fo(t,e[a]))return!0;return!1}function po(t,e,r){if(t.length>1){if(fo(t,e))return!0;for(var n=0;n<e.length;n++)if(yo(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(yo(t[i],e,r))return!0;return!1}function fo(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],o=0;o<e.length-1;o++)if(mo(n,i,e[o],e[o+1]))return!0;return!1}function mo(t,e,r,n){return E(t,r,n)!==E(e,r,n)&&E(t,e,r)!==E(t,e,n)}function yo(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if(go(t,e[i-1],e[i])<n)return!0;return!1}function go(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function _o(t,e){for(var r,n,i,o=!1,a=0;a<t.length;a++)for(var s=0,l=(r=t[a]).length-1;s<r.length;l=s++)(n=r[s]).y>e.y!=(i=r[l]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o);return o}function vo(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var o=t[n],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function bo(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;var o=E(t,e,r[0]);return o!==E(t,e,r[1])||o!==E(t,e,r[2])||o!==E(t,e,r[3])}function xo(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).binders[t].maxValue}function wo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Eo(t,e,r,n,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===r&&a._rotate(-n);for(var s=[],l=0;l<t.length;l++)s.push(t[l].sub(a));return s}lo.prototype.populate=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Mn(this.zoom),o)){var l=ao(o);this.addFeature(o,l,a),e.featureIndex.insert(o,l,a,s,this.index)}}},lo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},lo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},lo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},lo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},lo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},lo.prototype.addFeature=function(t,e,r){for(var n=0,i=e;n<i.length;n+=1)for(var o=0,a=i[n];o<a.length;o+=1){var s=a[o],l=s.x,u=s.y;if(!(l<0||l>=io||u<0||u>=io)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=c.vertexLength;so(this.layoutVertexArray,l,u,-1,-1),so(this.layoutVertexArray,l,u,1,-1),so(this.layoutVertexArray,l,u,1,1),so(this.layoutVertexArray,l,u,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{})},yn("CircleBucket",lo,{omit:["layers"]});var Co={paint:new Qn({"circle-radius":new Hn(St.paint_circle["circle-radius"]),"circle-color":new Hn(St.paint_circle["circle-color"]),"circle-blur":new Hn(St.paint_circle["circle-blur"]),"circle-opacity":new Hn(St.paint_circle["circle-opacity"]),"circle-translate":new qn(St.paint_circle["circle-translate"]),"circle-translate-anchor":new qn(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qn(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qn(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Hn(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Hn(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Hn(St.paint_circle["circle-stroke-opacity"])})},So="undefined"!=typeof Float32Array?Float32Array:Array;function To(){var t=new So(9);return So!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ao(){var t=new So(3);return So!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Io(t,e,r){var n=new So(3);return n[0]=t,n[1]=e,n[2]=r,n}function ko(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}function Po(){var t=new So(4);return So!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math,Ao(),function(){var t;t=new So(4),So!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),Ao(),Io(1,0,0),Io(0,1,0),Po(),Po(),To(),function(){var t;t=new So(2),So!=Float32Array&&(t[0]=0,t[1]=0)}();var Oo=function(t){function e(e){t.call(this,e,Co)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new lo(t)},e.prototype.queryRadius=function(t){var e=t;return xo("circle-radius",this,e)+xo("circle-stroke-width",this,e)+wo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a,s){for(var l=Eo(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),u=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),c="map"===this.paint.get("circle-pitch-alignment"),h=c?l:function(t,e){return l.map(function(t){return Ro(t,e)})}(0,s),p=c?u*a:u,d=0,f=n;d<f.length;d+=1)for(var m=0,y=f[d];m<y.length;m+=1){var g=y[m],_=c?g:Ro(g,s),v=p,b=ko([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=b[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=o.cameraToCenterDistance/b[3]),co(h,_,v))return!0}return!1},e}(Kn);function Ro(t,e){var r=ko([],[t.x,t.y,0,1],e);return new i(r[0]/r[3],r[1]/r[3])}var Do=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(lo);function Mo(t,e,r,n){var i=e.width,o=e.height;if(n){if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return t.width=i,t.height=o,t.data=n,t}function Lo(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var o=Mo({},{width:n,height:i},r);zo(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=o.data}}function zo(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<i.height;l++)for(var u=((r.y+l)*t.width+r.x)*o,c=((n.y+l)*e.width+n.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[u+h];return e}yn("HeatmapBucket",Do,{omit:["layers"]});var No=function(t,e){Mo(this,t,1,e)};No.prototype.resize=function(t){Lo(this,t,1)},No.prototype.clone=function(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))},No.copy=function(t,e,r,n,i){zo(t,e,r,n,i,1)};var Fo=function(t,e){Mo(this,t,4,e)};Fo.prototype.resize=function(t){Lo(this,t,4)},Fo.prototype.replace=function(t,e){e?this.data.set(t):this.data=t},Fo.prototype.clone=function(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))},Fo.copy=function(t,e,r,n,i){zo(t,e,r,n,i,4)},yn("AlphaImage",No),yn("RGBAImage",Fo);var Bo={paint:new Qn({"heatmap-radius":new Hn(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Hn(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qn(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zn(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qn(St.paint_heatmap["heatmap-opacity"])})};function Vo(t,e){for(var r=new Uint8Array(1024),n={},i=0,o=0;i<256;i++,o+=4){n[e]=i/255;var a=t.evaluate(n);r[o+0]=Math.floor(255*a.r/a.a),r[o+1]=Math.floor(255*a.g/a.a),r[o+2]=Math.floor(255*a.b/a.a),r[o+3]=Math.floor(255*a.a)}return new Fo({width:256,height:1},r)}var jo=function(t){function e(e){t.call(this,e,Bo),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Do(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=Vo(this._transitionablePaint._values["heatmap-color"].value.expression,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Kn),Uo={paint:new Qn({"hillshade-illumination-direction":new qn(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qn(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qn(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qn(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qn(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qn(St.paint_hillshade["hillshade-accent-color"])})},qo=function(t){function e(e){t.call(this,e,Uo)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Kn),Ho=Jn([{name:"a_pos",components:2,type:"Int16"}],4).members,Wo=Zo,Go=Zo;function Zo(t,e,r){r=r||2;var n,i,o,a,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=Qo(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Qo(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(ia(a));for(s.sort(ea),i=0;i<s.length;i++)ra(s[i],r),r=Ko(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return $o(p,d,r,n,i,u),d}function Qo(t,e,r,n,i){var o,a;if(i===ma(t,e,r,n)>0)for(o=e;o<r;o+=n)a=pa(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=pa(o,t[o],t[o+1],a);return a&&la(a,a.next)&&(da(a),a=a.next),a}function Ko(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!la(n,n.next)&&0!==sa(n.prev,n,n.next))n=n.next;else{if(da(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function $o(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=na(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Yo(t,n,i,o):Xo(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),da(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?$o(t=Jo(t,e,r),e,r,n,i,o,2):2===a&&ta(t,e,r,n,i,o):$o(Ko(t),e,r,n,i,o,1);break}}}function Xo(t){var e=t.prev,r=t,n=t.next;if(sa(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(oa(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&sa(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Yo(t,e,r,n){var i=t.prev,o=t,a=t.next;if(sa(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=na(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),c=na(s,l,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&oa(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&sa(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&oa(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&sa(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&oa(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&sa(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&oa(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&sa(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Jo(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!la(i,o)&&ua(i,n,n.next,o)&&ca(i,o)&&ca(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),da(n),da(n.next),n=t=o),n=n.next}while(n!==t);return n}function ta(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&aa(a,s)){var l=ha(a,s);return a=Ko(a,a.next),l=Ko(l,l.next),$o(a,e,r,n,i,o),void $o(l,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function ea(t,e){return t.x-e.x}function ra(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var l,u=r,c=r.x,h=r.y,p=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=c&&i!==n.x&&oa(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(i-n.x))<p||l===p&&n.x>r.x)&&ca(n,t)&&(r=n,p=l),n=n.next;return r}(t,e)){var r=ha(e,t);Ko(r,r.next)}}function na(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ia(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function oa(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function aa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ua(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&ca(t,e)&&ca(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function sa(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function la(t,e){return t.x===e.x&&t.y===e.y}function ua(t,e,r,n){return!!(la(t,e)&&la(r,n)||la(t,n)&&la(r,e))||sa(t,e,r)>0!=sa(t,e,n)>0&&sa(r,n,t)>0!=sa(r,n,e)>0}function ca(t,e){return sa(t.prev,t,t.next)<0?sa(t,e,t.next)>=0&&sa(t,t.prev,e)>=0:sa(t,e,t.prev)<0||sa(t,t.next,e)<0}function ha(t,e){var r=new fa(t.i,t.x,t.y),n=new fa(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function pa(t,e,r,n){var i=new fa(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function da(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fa(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ma(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ya(t,e,r,n,i){!function t(e,r,n,i,o){for(;i>n;){if(i-n>600){var a=i-n+1,s=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*u/a+c)),Math.min(i,Math.floor(r+(a-s)*u/a+c)),o)}var h=e[r],p=n,d=i;for(ga(e,n,r),o(e[i],h)>0&&ga(e,n,i);p<d;){for(ga(e,p,d),p++,d--;o(e[p],h)<0;)p++;for(;o(e[d],h)>0;)d--}0===o(e[n],h)?ga(e,n,d):ga(e,++d,i),d<=r&&(n=d+1),r<=d&&(i=d-1)}}(t,e,r||0,n||t.length-1,i||_a)}function ga(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function _a(t,e){return t<e?-1:t>e?1:0}function va(t,e){var r=t.length;if(r<=1)return[t];for(var n,i,o=[],a=0;a<r;a++){var s=C(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),e>1)for(var l=0;l<o.length;l++)o[l].length<=e||(ya(o[l],e,1,o[l].length-1,ba),o[l]=o[l].slice(0,e));return o}function ba(t,e){return e.area-t.area}function xa(t,e,r){for(var n=r.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var l=s.constantOr(null);l&&(i=!0,n[l.to]=!0,n[l.from]=!0)}return i}function wa(t,e,r,n,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.paint.get(t+"-pattern").value;if("constant"!==u.kind){var c=u.evaluate({zoom:n-1},r,{}),h=u.evaluate({zoom:n},r,{}),p=u.evaluate({zoom:n+1},r,{});o[c]=!0,o[h]=!0,o[p]=!0,r.patterns[l.id]={min:c,mid:h,max:p}}}return r}Zo.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(ma(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(ma(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*r,c=n[a+1]*r,h=n[a+2]*r;l+=Math.abs((t[u]-t[h])*(t[c+1]-t[u+1])-(t[u]-t[c])*(t[h+1]-t[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Zo.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&r.holes.push(n+=t[i-1].length)}return r},Wo.default=Go;var Ea=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ei,this.indexArray=new gi,this.indexArray2=new _i,this.programConfigurations=new eo(Ho,t.layers,t.zoom),this.segments=new Li,this.segments2=new Li,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Ea.prototype.populate=function(t,e){this.features=[],this.hasPattern=xa("fill",this.layers,e);for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Mn(this.zoom),o)){var l=ao(o),u={sourceLayerIndex:s,index:a,geometry:l,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(u.id=o.id),this.hasPattern?this.features.push(wa("fill",this.layers,u,this.zoom,e)):this.addFeature(u,l,a,{}),e.featureIndex.insert(o,l,a,s,this.index)}}},Ea.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Ea.prototype.addFeatures=function(t,e){for(var r=0,n=this.features;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Ea.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ea.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ea.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ho),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ea.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ea.prototype.addFeature=function(t,e,r,n){for(var i=0,o=va(e,500);i<o.length;i+=1){for(var a=o[i],s=0,l=0,u=a;l<u.length;l+=1)s+=u[l].length;for(var c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=c.vertexLength,p=[],d=[],f=0,m=a;f<m.length;f+=1){var y=m[f];if(0!==y.length){y!==a[0]&&d.push(p.length/2);var g=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=g.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),p.push(y[0].x),p.push(y[0].y);for(var v=1;v<y.length;v++)this.layoutVertexArray.emplaceBack(y[v].x,y[v].y),this.indexArray2.emplaceBack(_+v-1,_+v),p.push(y[v].x),p.push(y[v].y);g.vertexLength+=y.length,g.primitiveLength+=y.length}}for(var b=Wo(p,d),x=0;x<b.length;x+=3)this.indexArray.emplaceBack(h+b[x],h+b[x+1],h+b[x+2]);c.vertexLength+=s,c.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n)},yn("FillBucket",Ea,{omit:["layers","features"]});var Ca={paint:new Qn({"fill-antialias":new qn(St.paint_fill["fill-antialias"]),"fill-opacity":new Hn(St.paint_fill["fill-opacity"]),"fill-color":new Hn(St.paint_fill["fill-color"]),"fill-outline-color":new Hn(St.paint_fill["fill-outline-color"]),"fill-translate":new qn(St.paint_fill["fill-translate"]),"fill-translate-anchor":new qn(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wn(St.paint_fill["fill-pattern"])})},Sa=function(t){function e(e){t.call(this,e,Ca)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new Ea(t)},e.prototype.queryRadius=function(){return wo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){return ho(Eo(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),n)},e.prototype.isTileClipped=function(){return!0},e}(Kn),Ta=Jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Aa=Ia;function Ia(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(ka,this,e)}function ka(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function Pa(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)n+=((r=t[a]).x-(e=t[i]).x)*(e.y+r.y);return n}Ia.types=["Unknown","Point","LineString","Polygon"],Ia.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,o=0,a=0,s=0,l=[];t.pos<r;){if(o<=0){var u=t.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new i(a,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},Ia.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},Ia.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=Ia.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=Pa(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Oa=Ra;function Ra(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Da,this,e),this.length=this._features.length}function Da(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function Ma(t,e,r){if(3===t){var n=new Oa(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Ra.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Aa(this._pbf,e,this.extent,this._keys,this._values)};var La={VectorTile:function(t,e){this.layers=t.readFields(Ma,{},e)},VectorTileFeature:Aa,VectorTileLayer:Oa},za=La.VectorTileFeature.types,Na=Math.pow(2,13);function Fa(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,2*Math.floor(n*Na)+a,i*Na*2,o*Na*2,Math.round(s))}var Ba=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ni,this.indexArray=new gi,this.programConfigurations=new eo(Ta,t.layers,t.zoom),this.segments=new Li,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Va(t,e){return t.x===e.x&&(t.x<0||t.x>io)||t.y===e.y&&(t.y<0||t.y>io)}function ja(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>io})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>io})}Ba.prototype.populate=function(t,e){this.features=[],this.hasPattern=xa("fill-extrusion",this.layers,e);for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Mn(this.zoom),o)){var l=ao(o),u={sourceLayerIndex:s,index:a,geometry:l,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(u.id=o.id),this.hasPattern?this.features.push(wa("fill-extrusion",this.layers,u,this.zoom,e)):this.addFeature(u,l,a,{}),e.featureIndex.insert(o,l,a,s,this.index,!0)}}},Ba.prototype.addFeatures=function(t,e){for(var r=0,n=this.features;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Ba.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Ba.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ba.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ba.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ta),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ba.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ba.prototype.addFeature=function(t,e,r,n){for(var i=0,o=va(e,500);i<o.length;i+=1){for(var a=o[i],s=0,l=0,u=a;l<u.length;l+=1)s+=u[l].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,p=a;h<p.length;h+=1){var d=p[h];if(0!==d.length&&!ja(d))for(var f=0,m=0;m<d.length;m++){var y=d[m];if(m>=1){var g=d[m-1];if(!Va(y,g)){c.vertexLength+4>Li.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(g)._perp()._unit(),v=g.dist(y);f+v>32768&&(f=0),Fa(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,f),Fa(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,f),Fa(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,f+=v),Fa(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,f);var b=c.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),c.vertexLength+=4,c.primitiveLength+=2}}}}if(c.vertexLength+s>Li.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===za[t.type]){for(var x=[],w=[],E=c.vertexLength,C=0,S=a;C<S.length;C+=1){var T=S[C];if(0!==T.length){T!==a[0]&&w.push(x.length/2);for(var A=0;A<T.length;A++){var I=T[A];Fa(this.layoutVertexArray,I.x,I.y,0,0,1,1,0),x.push(I.x),x.push(I.y)}}}for(var k=Wo(x,w),P=0;P<k.length;P+=3)this.indexArray.emplaceBack(E+k[P],E+k[P+2],E+k[P+1]);c.primitiveLength+=k.length/3,c.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n)},yn("FillExtrusionBucket",Ba,{omit:["layers","features"]});var Ua={paint:new Qn({"fill-extrusion-opacity":new qn(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Hn(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qn(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qn(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wn(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Hn(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Hn(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qn(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},qa=function(t){function e(e){t.call(this,e,Ua)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ba(t)},e.prototype.queryRadius=function(){return wo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s,l){var u=Eo(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),p=function(t,e,r,n){for(var o=[],a=0,s=t;a<s.length;a+=1){var l=s[a],u=[l.x,l.y,0,1];ko(u,u,e),o.push(new i(u[0]/u[3],u[1]/u[3]))}return o}(u,l),d=function(t,e,r,n){for(var o=[],a=[],s=n[8]*e,l=n[9]*e,u=n[10]*e,c=n[11]*e,h=n[8]*r,p=n[9]*r,d=n[10]*r,f=n[11]*r,m=0,y=t;m<y.length;m+=1){for(var g=[],_=[],v=0,b=y[m];v<b.length;v+=1){var x=b[v],w=x.x,E=x.y,C=n[0]*w+n[4]*E+n[12],S=n[1]*w+n[5]*E+n[13],T=n[2]*w+n[6]*E+n[14],A=n[3]*w+n[7]*E+n[15],I=T+u,k=A+c,P=C+h,O=S+p,R=T+d,D=A+f,M=new i((C+s)/k,(S+l)/k);M.z=I/k,g.push(M);var L=new i(P/D,O/D);L.z=R/D,_.push(L)}o.push(g),a.push(_)}return[o,a]}(n,h,c,l);return function(t,e,r){var n=1/0;ho(r,e)&&(n=Wa(r,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var l=o[s],u=[l,o[s+1],a[s+1],a[s],l];uo(r,u)&&(n=Math.min(n,Wa(r,u)))}return n!==1/0&&n}(d[0],d[1],p)},e}(Kn);function Ha(t,e){return t.x*e.x+t.y*e.y}function Wa(t,e){if(1===t.length){var r=e[0],n=e[1],i=e[3],o=t[0],a=n.sub(r),s=i.sub(r),l=o.sub(r),u=Ha(a,a),c=Ha(a,s),h=Ha(s,s),p=Ha(l,a),d=Ha(l,s),f=u*h-c*c,m=(h*p-c*d)/f,y=(u*d-c*p)/f;return r.z*(1-m-y)+n.z*m+i.z*y}for(var g=1/0,_=0,v=e;_<v.length;_+=1)g=Math.min(g,v[_].z);return g}var Ga=Jn([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Za=La.VectorTileFeature.types,Qa=63,Ka=Math.cos(Math.PI/180*37.5),$a=.5,Xa=Math.pow(2,14)/$a;function Ya(t,e,r,n,i,o,a){t.emplaceBack(e.x,e.y,n?1:0,i?1:-1,Math.round(Qa*r.x)+128,Math.round(Qa*r.y)+128,1+(0===o?0:o<0?-1:1)|(a*$a&63)<<2,a*$a>>6)}var Ja=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.features=[],this.hasPattern=!1,this.layoutVertexArray=new ii,this.indexArray=new gi,this.programConfigurations=new eo(Ga,t.layers,t.zoom),this.segments=new Li,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function ts(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Xa-1)}Ja.prototype.populate=function(t,e){this.features=[],this.hasPattern=xa("line",this.layers,e);for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Mn(this.zoom),o)){var l=ao(o),u={sourceLayerIndex:s,index:a,geometry:l,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(u.id=o.id),this.hasPattern?this.features.push(wa("line",this.layers,u,this.zoom,e)):this.addFeature(u,l,a,{}),e.featureIndex.insert(o,l,a,s,this.index)}}},Ja.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Ja.prototype.addFeatures=function(t,e){for(var r=0,n=this.features;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Ja.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ja.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ja.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ga),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ja.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ja.prototype.addFeature=function(t,e,r,n){for(var i=this.layers[0].layout,o=i.get("line-join").evaluate(t,{}),a=i.get("line-cap"),s=i.get("line-miter-limit"),l=i.get("line-round-limit"),u=0,c=e;u<c.length;u+=1)this.addLine(c[u],t,o,a,s,l,r,n)},Ja.prototype.addLine=function(t,e,r,n,i,o,a,s){var l=null;e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")&&(l={start:e.properties.mapbox_clip_start,end:e.properties.mapbox_clip_end,tileTotal:void 0});for(var u="Polygon"===Za[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(u?3:2))){l&&(l.tileTotal=function(t,e,r){for(var n=0,i=h;i<r-1;i++)n+=t[i].dist(t[i+1]);return n}(t,0,c)),"bevel"===r&&(i=1.05);var p=io/(512*this.overscaling)*15,d=t[h],f=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);this.distance=0;var m,y,g,_=n,v=u?"butt":n,b=!0,x=void 0,w=void 0,E=void 0,C=void 0;this.e1=this.e2=this.e3=-1,u&&(C=d.sub(m=t[c-2])._unit()._perp());for(var S=h;S<c;S++)if(!(w=u&&S===c-1?t[h+1]:t[S+1])||!t[S].equals(w)){C&&(E=C),m&&(x=m),m=t[S],C=w?w.sub(m)._unit()._perp():E;var T=(E=E||C).add(C);0===T.x&&0===T.y||T._unit();var A=T.x*C.x+T.y*C.y,I=0!==A?1/A:1/0,k=A<Ka&&x&&w;if(k&&S>h){var P=m.dist(x);if(P>2*p){var O=m.sub(m.sub(x)._mult(p/P)._round());this.distance+=O.dist(x),this.addCurrentVertex(O,this.distance,E.mult(1),0,0,!1,f,l),x=O}}var R=x&&w,D=R?r:w?_:v;if(R&&"round"===D&&(I<o?D="miter":I<=2&&(D="fakeround")),"miter"===D&&I>i&&(D="bevel"),"bevel"===D&&(I>2&&(D="flipbevel"),I<i&&(D="miter")),x&&(this.distance+=m.dist(x)),"miter"===D)T._mult(I),this.addCurrentVertex(m,this.distance,T,0,0,!1,f,l);else if("flipbevel"===D){if(I>100)T=C.clone().mult(-1);else{var M=E.x*C.y-E.y*C.x>0?-1:1,L=I*E.add(C).mag()/E.sub(C).mag();T._perp()._mult(L*M)}this.addCurrentVertex(m,this.distance,T,0,0,!1,f,l),this.addCurrentVertex(m,this.distance,T.mult(-1),0,0,!1,f,l)}else if("bevel"===D||"fakeround"===D){var z=E.x*C.y-E.y*C.x>0,N=-Math.sqrt(I*I-1);if(z?(g=0,y=N):(y=0,g=N),b||this.addCurrentVertex(m,this.distance,E,y,g,!1,f,l),"fakeround"===D){for(var F=Math.floor(8*(.5-(A-.5))),B=void 0,V=0;V<F;V++)B=C.mult((V+1)/(F+1))._add(E)._unit(),this.addPieSliceVertex(m,this.distance,B,z,f,l);this.addPieSliceVertex(m,this.distance,T,z,f,l);for(var j=F-1;j>=0;j--)B=E.mult((j+1)/(F+1))._add(C)._unit(),this.addPieSliceVertex(m,this.distance,B,z,f,l)}w&&this.addCurrentVertex(m,this.distance,C,-y,-g,!1,f,l)}else"butt"===D?(b||this.addCurrentVertex(m,this.distance,E,0,0,!1,f,l),w&&this.addCurrentVertex(m,this.distance,C,0,0,!1,f,l)):"square"===D?(b||(this.addCurrentVertex(m,this.distance,E,1,1,!1,f,l),this.e1=this.e2=-1),w&&this.addCurrentVertex(m,this.distance,C,-1,-1,!1,f,l)):"round"===D&&(b||(this.addCurrentVertex(m,this.distance,E,0,0,!1,f,l),this.addCurrentVertex(m,this.distance,E,1,1,!0,f,l),this.e1=this.e2=-1),w&&(this.addCurrentVertex(m,this.distance,C,-1,-1,!0,f,l),this.addCurrentVertex(m,this.distance,C,0,0,!1,f,l)));if(k&&S<c-1){var U=m.dist(w);if(U>2*p){var q=m.add(w.sub(m)._mult(p/U)._round());this.distance+=q.dist(m),this.addCurrentVertex(q,this.distance,C.mult(1),0,0,!1,f,l),m=q}}b=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,s)}},Ja.prototype.addCurrentVertex=function(t,e,r,n,i,o,a,s){var l,u=this.layoutVertexArray,c=this.indexArray;s&&(e=ts(e,s)),l=r.clone(),n&&l._sub(r.perp()._mult(n)),Ya(u,t,l,o,!1,n,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,l=r.mult(-1),i&&l._sub(r.perp()._mult(i)),Ya(u,t,l,o,!0,-i,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Xa/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,n,i,o,a))},Ja.prototype.addPieSliceVertex=function(t,e,r,n,i,o){r=r.mult(n?-1:1);var a=this.layoutVertexArray,s=this.indexArray;o&&(e=ts(e,o)),Ya(a,t,r,!1,n,0,e),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3},yn("LineBucket",Ja,{omit:["layers","features"]});var es=new Qn({"line-cap":new qn(St.layout_line["line-cap"]),"line-join":new Hn(St.layout_line["line-join"]),"line-miter-limit":new qn(St.layout_line["line-miter-limit"]),"line-round-limit":new qn(St.layout_line["line-round-limit"])}),rs={paint:new Qn({"line-opacity":new Hn(St.paint_line["line-opacity"]),"line-color":new Hn(St.paint_line["line-color"]),"line-translate":new qn(St.paint_line["line-translate"]),"line-translate-anchor":new qn(St.paint_line["line-translate-anchor"]),"line-width":new Hn(St.paint_line["line-width"]),"line-gap-width":new Hn(St.paint_line["line-gap-width"]),"line-offset":new Hn(St.paint_line["line-offset"]),"line-blur":new Hn(St.paint_line["line-blur"]),"line-dasharray":new Gn(St.paint_line["line-dasharray"]),"line-pattern":new Wn(St.paint_line["line-pattern"]),"line-gradient":new Zn(St.paint_line["line-gradient"])}),layout:es},ns=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new Mn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n,i){return r=h({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n,i)},e}(Hn))(rs.paint.properties["line-width"].specification);ns.useIntegerZoom=!0;var is=function(t){function e(e){t.call(this,e,rs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){this.gradient=Vo(this._transitionablePaint._values["line-gradient"].value.expression,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=ns.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ja(t)},e.prototype.queryRadius=function(t){var e=t,r=os(xo("line-width",this,e),xo("line-gap-width",this,e)),n=xo("line-offset",this,e);return r/2+Math.abs(n)+wo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s){var l=Eo(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),u=s/2*os(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(n=function(t,e){for(var r=[],n=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],l=0;l<a.length;l++){var u=a[l],c=a[l+1],h=0===l?n:u.sub(a[l-1])._unit()._perp(),p=l===a.length-1?n:c.sub(u)._unit()._perp(),d=h._add(p)._unit();d._mult(1/(d.x*p.x+d.y*p.y)),s.push(d._mult(e)._add(u))}r.push(s)}return r}(n,c*s)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.length>=3)for(var o=0;o<i.length;o++)if(vo(t,i[o]))return!0;if(po(t,i,r))return!0}return!1}(l,n,u)},e.prototype.isTileClipped=function(){return!0},e}(Kn);function os(t,e){return e>0?e+2*t:t}var as=Jn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),ss=Jn([{name:"a_projected_pos",components:3,type:"Float32"}],4),ls=(Jn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Jn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),us=(Jn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),cs=Jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function hs(t,e,r){return t.sections.forEach(function(t){t.text=function(t,e,r){var n=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Dn.applyArabicShaping&&(t=Dn.applyArabicShaping(t)),t}(t.text,e,r)}),t}Jn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"}]),Jn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"radialTextOffset"}]),Jn([{type:"Float32",name:"offsetX"}]),Jn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ps={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},ds=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);yn("Anchor",ds);var fs=256;function ms(t,e){var r=e.expression;if("constant"===r.kind)return{functionType:"constant",layoutSize:r.evaluate(new Mn(t+1))};if("source"===r.kind)return{functionType:"source"};for(var n=r.zoomStops,i=0;i<n.length&&n[i]<=t;)i++;for(var o=i=Math.max(0,i-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var a={min:n[i],max:n[o]};return"composite"===r.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:r.evaluate(new Mn(t+1)),zoomRange:a,sizeRange:{min:r.evaluate(new Mn(a.min)),max:r.evaluate(new Mn(a.max))},propertyValue:e.value}}function ys(t,e,r){var n=e;return"source"===t.functionType?r.lowerSize/fs:"composite"===t.functionType?_e(r.lowerSize/fs,r.upperSize/fs,n.uSizeT):n.uSize}function gs(t,e,r){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var n=t.zoomRange,i=t.sizeRange,o=u(kr(t.propertyValue,r.specification).interpolationFactor(e,n.min,n.max),0,1);return{uSizeT:0,uSize:i.min+o*(i.max-i.min)}}var a=t.zoomRange;return{uSizeT:u(kr(t.propertyValue,r.specification).interpolationFactor(e,a.min,a.max),0,1),uSize:0}}var _s=Object.freeze({getSizeData:ms,evaluateSizeForFeature:ys,evaluateSizeForZoom:gs,SIZE_PACK_FACTOR:fs}),vs=La.VectorTileFeature.types,bs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xs(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),o,a,s?s[0]:0,s?s[1]:0)}function ws(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}var Es=function(t){this.layoutVertexArray=new ai,this.indexArray=new gi,this.programConfigurations=t,this.segments=new Li,this.dynamicLayoutVertexArray=new si,this.opacityVertexArray=new li,this.placedSymbolArray=new Si};Es.prototype.upload=function(t,e,r,n){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,as.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ss.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,bs,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t)},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",Es);var Cs=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new Li,this.collisionVertexArray=new hi};Cs.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ls.members,!0)},Cs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",Cs);var Ss=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ms(this.zoom,e["text-size"]),this.iconSizeData=ms(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&(r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id}),this.sourceID=t.sourceID};Ss.prototype.createArrays=function(){this.text=new Es(new eo(as.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Es(new eo(as.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Cs(ci,us.members,_i),this.collisionCircle=new Cs(ci,cs.members,gi),this.glyphOffsetArray=new ki,this.lineVertexArray=new Oi,this.symbolInstances=new Ai},Ss.prototype.calculateGlyphDependencies=function(t,e,r,n){for(var i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,r&&n){var o=ps[t.charAt(i)];o&&(e[o.charCodeAt(0)]=!0)}},Ss.prototype.populate=function(t,e){var r=this.layers[0],n=r.layout,i=n.get("text-font"),o=n.get("text-field"),a=n.get("icon-image"),s=("constant"!==o.value.kind||o.value.value.toString().length>0)&&("constant"!==i.value.kind||i.value.value.length>0),l="constant"!==a.value.kind||a.value.value&&a.value.value.length>0,u=n.get("symbol-sort-key");if(this.features=[],s||l){for(var c=e.iconDependencies,h=e.glyphDependencies,p=new Mn(this.zoom),d=0,f=t;d<f.length;d+=1){var m=f[d],y=m.feature,g=m.index,_=m.sourceLayerIndex;if(r._featureFilter(p,y)){var v=void 0;if(s){var b=r.getValueAndResolveTokens("text-field",y);v=hs(b instanceof $t?b:$t.fromString(b),r,y)}var x=void 0;if(l&&(x=r.getValueAndResolveTokens("icon-image",y)),v||x){var w=this.sortFeaturesByKey?u.evaluate(y,{}):void 0,E={text:v,icon:x,index:g,sourceLayerIndex:_,geometry:ao(y),properties:y.properties,type:vs[y.type],sortKey:w};if(void 0!==y.id&&(E.id=y.id),this.features.push(E),x&&(c[x]=!0),v)for(var C=i.evaluate(y,{}).join(","),S="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement"),T=0,A=v.sections;T<A.length;T+=1){var I=A[T],k=wn(v.toString()),P=I.fontStack||C,O=h[P]=h[P]||{};this.calculateGlyphDependencies(I.text,O,S,k)}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function o(e){n.push(t[e]),i++}function a(t,e,i){var o=r[t];return delete r[t],r[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function s(t,r,i){var o=e[r];return delete e[r],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function l(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.text?c.text.toString():null;if(p){var d=l(p,h),f=l(p,h,!0);if(d in r&&f in e&&r[d]!==e[f]){var m=s(d,f,h),y=a(d,f,n[m].geometry);delete e[d],delete r[f],r[l(p,n[y].geometry,!0)]=y,n[m].geometry=null}else d in r?a(d,f,h):f in e?s(d,f,h):(o(u),e[d]=i-1,r[f]=i-1)}else o(u)}return n.filter(function(t){return t.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(t,e){return t.sortKey-e.sortKey})}},Ss.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},Ss.prototype.isEmpty=function(){return 0===this.symbolInstances.length},Ss.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ss.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ss.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},Ss.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Ss.prototype.addSymbols=function(t,e,r,n,i,o,a,s,l,u){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,d=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,o.sortKey),f=this.glyphOffsetArray.length,m=d.vertexLength,y=0,g=e;y<g.length;y+=1){var _=g[y],v=_.tl,b=_.tr,x=_.bl,w=_.br,E=_.tex,C=d.vertexLength,S=_.glyphOffset[1];xs(h,s.x,s.y,v.x,S+v.y,E.x,E.y,r),xs(h,s.x,s.y,b.x,S+b.y,E.x+E.w,E.y,r),xs(h,s.x,s.y,x.x,S+x.y,E.x,E.y+E.h,r),xs(h,s.x,s.y,w.x,S+w.y,E.x+E.w,E.y+E.h,r),ws(p,s,0),c.emplaceBack(C,C+1,C+2),c.emplaceBack(C+1,C+2,C+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,f,this.glyphOffsetArray.length-f,m,l,u,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,!1,0),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{})},Ss.prototype._addCollisionDebugVertex=function(t,e,r,n,i,o){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(o.x),Math.round(o.y))},Ss.prototype.addCollisionDebugVertices=function(t,e,r,n,o,a,s,l){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=u.vertexLength,h=o.layoutVertexArray,p=o.collisionVertexArray,d=s.anchorX,f=s.anchorY;if(this._addCollisionDebugVertex(h,p,a,d,f,new i(t,e)),this._addCollisionDebugVertex(h,p,a,d,f,new i(r,e)),this._addCollisionDebugVertex(h,p,a,d,f,new i(r,n)),this._addCollisionDebugVertex(h,p,a,d,f,new i(t,n)),u.vertexLength+=4,l){var m=o.indexArray;m.emplaceBack(c,c+1,c+2),m.emplaceBack(c,c+2,c+3),u.primitiveLength+=2}else{var y=o.indexArray;y.emplaceBack(c,c+1),y.emplaceBack(c+1,c+2),y.emplaceBack(c+2,c+3),y.emplaceBack(c+3,c),u.primitiveLength+=4}},Ss.prototype.addDebugCollisionBoxes=function(t,e,r){for(var n=t;n<e;n++){var i=this.collisionBoxArray.get(n),o=i.radius>0;this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,o?this.collisionCircle:this.collisionBox,i.anchorPoint,r,o)}},Ss.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e)}},Ss.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i){for(var o={},a=e;a<r;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},o.textFeatureIndex=s.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=s.featureIndex),o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var l=n;l<i;l++){var u=t.get(l);if(0===u.radius){o.iconBox={x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,anchorPointX:u.anchorPointX,anchorPointY:u.anchorPointY},o.iconFeatureIndex=u.featureIndex;break}}return o},Ss.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex))}},Ss.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ss.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ss.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},Ss.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},Ss.prototype.addIndicesForPlacedTextSymbol=function(t){for(var e=this.text.placedSymbolArray.get(t),r=e.vertexStartIndex+4*e.numGlyphs,n=e.vertexStartIndex;n<r;n+=4)this.text.indexArray.emplaceBack(n,n+1,n+2),this.text.indexArray.emplaceBack(n+1,n+2,n+3)},Ss.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],n=0;n<this.symbolInstances.length;n++)r.push(n);for(var i=Math.sin(t),o=Math.cos(t),a=[],s=[],l=0;l<this.symbolInstances.length;l++){var u=this.symbolInstances.get(l);a.push(0|Math.round(i*u.anchorX+o*u.anchorY)),s.push(u.featureIndex)}r.sort(function(t,e){return a[t]-a[e]||s[e]-s[t]}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,h=r;c<h.length;c+=1){var p=h[c],d=this.symbolInstances.get(p);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(function(t,r,n){t>=0&&n.indexOf(t)===r&&e.addIndicesForPlacedTextSymbol(t)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedTextSymbol(d.verticalPlacedTextSymbolIndex);var f=this.icon.placedSymbolArray.get(p);if(f.numGlyphs){var m=f.vertexStartIndex;this.icon.indexArray.emplaceBack(m,m+1,m+2),this.icon.indexArray.emplaceBack(m+1,m+2,m+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Ss,{omit:["layers","collisionBoxArray","features","compareText"]}),Ss.MAX_GLYPHS=65535,Ss.addDynamicAttributes=ws;var Ts=new Qn({"symbol-placement":new qn(St.layout_symbol["symbol-placement"]),"symbol-spacing":new qn(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qn(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Hn(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qn(St.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qn(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qn(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new qn(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qn(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new Hn(St.layout_symbol["icon-size"]),"icon-text-fit":new qn(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qn(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new Hn(St.layout_symbol["icon-image"]),"icon-rotate":new Hn(St.layout_symbol["icon-rotate"]),"icon-padding":new qn(St.layout_symbol["icon-padding"]),"icon-keep-upright":new qn(St.layout_symbol["icon-keep-upright"]),"icon-offset":new Hn(St.layout_symbol["icon-offset"]),"icon-anchor":new Hn(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qn(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qn(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qn(St.layout_symbol["text-rotation-alignment"]),"text-field":new Hn(St.layout_symbol["text-field"]),"text-font":new Hn(St.layout_symbol["text-font"]),"text-size":new Hn(St.layout_symbol["text-size"]),"text-max-width":new Hn(St.layout_symbol["text-max-width"]),"text-line-height":new qn(St.layout_symbol["text-line-height"]),"text-letter-spacing":new Hn(St.layout_symbol["text-letter-spacing"]),"text-justify":new Hn(St.layout_symbol["text-justify"]),"text-radial-offset":new Hn(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qn(St.layout_symbol["text-variable-anchor"]),"text-anchor":new Hn(St.layout_symbol["text-anchor"]),"text-max-angle":new qn(St.layout_symbol["text-max-angle"]),"text-rotate":new Hn(St.layout_symbol["text-rotate"]),"text-padding":new qn(St.layout_symbol["text-padding"]),"text-keep-upright":new qn(St.layout_symbol["text-keep-upright"]),"text-transform":new Hn(St.layout_symbol["text-transform"]),"text-offset":new Hn(St.layout_symbol["text-offset"]),"text-allow-overlap":new qn(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qn(St.layout_symbol["text-ignore-placement"]),"text-optional":new qn(St.layout_symbol["text-optional"])}),As={paint:new Qn({"icon-opacity":new Hn(St.paint_symbol["icon-opacity"]),"icon-color":new Hn(St.paint_symbol["icon-color"]),"icon-halo-color":new Hn(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new Hn(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Hn(St.paint_symbol["icon-halo-blur"]),"icon-translate":new qn(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new qn(St.paint_symbol["icon-translate-anchor"]),"text-opacity":new Hn(St.paint_symbol["text-opacity"]),"text-color":new Hn(St.paint_symbol["text-color"]),"text-halo-color":new Hn(St.paint_symbol["text-halo-color"]),"text-halo-width":new Hn(St.paint_symbol["text-halo-width"]),"text-halo-blur":new Hn(St.paint_symbol["text-halo-blur"]),"text-translate":new qn(St.paint_symbol["text-translate"]),"text-translate-anchor":new qn(St.paint_symbol["text-translate-anchor"])}),layout:Ts},Is=function(t){function e(e){t.call(this,e,As)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var r,n=this.layout.get(t).evaluate(e,{}),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||Er(i.value)?n:(r=e.properties,n.replace(/{([^{}]+)}/g,function(t,e){return e in r?String(r[e]):""}))},e.prototype.createBucket=function(t){return new Ss(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Kn),ks={paint:new Qn({"background-color":new qn(St.paint_background["background-color"]),"background-pattern":new Gn(St.paint_background["background-pattern"]),"background-opacity":new qn(St.paint_background["background-opacity"])})},Ps=function(t){function e(e){t.call(this,e,ks)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Kn),Os={paint:new Qn({"raster-opacity":new qn(St.paint_raster["raster-opacity"]),"raster-hue-rotate":new qn(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qn(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qn(St.paint_raster["raster-brightness-max"]),"raster-saturation":new qn(St.paint_raster["raster-saturation"]),"raster-contrast":new qn(St.paint_raster["raster-contrast"]),"raster-resampling":new qn(St.paint_raster["raster-resampling"]),"raster-fade-duration":new qn(St.paint_raster["raster-fade-duration"])})},Rs=function(t){function e(e){t.call(this,e,Os)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Kn),Ds=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t)},e}(Kn),Ms={circle:Oo,heatmap:jo,hillshade:qo,fill:Sa,"fill-extrusion":qa,line:is,symbol:Is,background:Ps,raster:Rs};function Ls(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];e+=o.w*o.h,r=Math.max(r,o.w)}t.sort(function(t,e){return e.h-t.h});for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,l=0,u=0,c=t;u<c.length;u+=1)for(var h=c[u],p=a.length-1;p>=0;p--){var d=a[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var f=a.pop();p<a.length&&(a[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(a.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}var zs=function(t,e){var r=e.pixelRatio,n=e.version;this.paddedRect=t,this.pixelRatio=r,this.version=n},Ns={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ns.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ns.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ns.tlbr.get=function(){return this.tl.concat(this.br)},Ns.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(zs.prototype,Ns);var Fs=function(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var o=Ls(i),a=new Fo({width:o.w||1,height:o.h||1});for(var s in t){var l=t[s],u=r[s].paddedRect;Fo.copy(l.data,a,{x:0,y:0},{x:u.x+1,y:u.y+1},l.data)}for(var c in e){var h=e[c],p=n[c].paddedRect,d=p.x+1,f=p.y+1,m=h.data.width,y=h.data.height;Fo.copy(h.data,a,{x:0,y:0},{x:d,y:f},h.data),Fo.copy(h.data,a,{x:0,y:y-1},{x:d,y:f-1},{width:m,height:1}),Fo.copy(h.data,a,{x:0,y:0},{x:d,y:f+y},{width:m,height:1}),Fo.copy(h.data,a,{x:m-1,y:0},{x:d-1,y:f},{width:1,height:y}),Fo.copy(h.data,a,{x:0,y:0},{x:d+m,y:f},{width:1,height:y})}this.image=a,this.iconPositions=r,this.patternPositions=n};Fs.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(o),e[n]=new zs(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},Fs.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},Fs.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]})}},yn("ImagePosition",zs),yn("ImageAtlas",Fs);var Bs=self.HTMLImageElement,Vs=self.HTMLCanvasElement,js=self.HTMLVideoElement,Us=self.ImageData,qs=function(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)};qs.prototype.update=function(t,e,r){var n=t.width,i=t.height,o=!(this.size&&this.size[0]===n&&this.size[1]===i||r),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[n,i],t instanceof Bs||t instanceof Vs||t instanceof js||t instanceof Us?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var l=r||{x:0,y:0},u=l.x,c=l.y;t instanceof Bs||t instanceof Vs||t instanceof js||t instanceof Us?s.texSubImage2D(s.TEXTURE_2D,0,u,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,u,c,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},qs.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},qs.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},qs.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Hs=function(t,e,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=u}return(d?-1:1)*a*Math.pow(2,o-n)},Ws=function(t,e,r,n,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+d]=255&a,d+=f,a/=256,u-=8);t[r+d-f]|=128*m},Gs=Zs;function Zs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Qs(t){return t.type===Zs.Bytes?t.readVarint()+t.pos:t.pos+1}function Ks(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function $s(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function Xs(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Ys(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Js(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function tl(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function el(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function rl(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function nl(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function il(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function ol(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function al(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function sl(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function ll(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Zs.Varint=0,Zs.Fixed64=1,Zs.Bytes=2,Zs.Fixed32=5,Zs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=al(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ll(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=al(this.buf,this.pos)+4294967296*al(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=al(this.buf,this.pos)+4294967296*ll(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Hs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Hs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return Ks(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return Ks(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return Ks(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return Ks(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return Ks(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return Ks(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,l=t[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=Qs(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Qs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Zs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Zs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Zs.Fixed32)this.pos+=4;else{if(e!==Zs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),sl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),sl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),sl(this.buf,-1&t,this.pos),sl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),sl(this.buf,-1&t,this.pos),sl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&$s(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Ws(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ws(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&$s(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Zs.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,Xs,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Ys,e)},writePackedBoolean:function(t,e){this.writeMessage(t,el,e)},writePackedFloat:function(t,e){this.writeMessage(t,Js,e)},writePackedDouble:function(t,e){this.writeMessage(t,tl,e)},writePackedFixed32:function(t,e){this.writeMessage(t,rl,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,nl,e)},writePackedFixed64:function(t,e){this.writeMessage(t,il,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,ol,e)},writeBytesField:function(t,e){this.writeTag(t,Zs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Zs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Zs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Zs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var ul=3;function cl(t,e,r){1===t&&r.readMessage(hl,e)}function hl(t,e,r){if(3===t){var n=r.readMessage(pl,{}),i=n.width,o=n.height,a=n.left,s=n.top,l=n.advance;e.push({id:n.id,bitmap:new No({width:i+2*ul,height:o+2*ul},n.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:l}})}}function pl(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}var dl=ul,fl=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.callbackID=0,y(["receive"],this),this.target.addEventListener("message",this.receive,!1)};function ml(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}fl.prototype.send=function(t,e,r,n){var i=this,o=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[o]=r);var a=[];if(this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:t,id:String(o),data:_n(e,a)},a),r)return{cancel:function(){return i.target.postMessage({targetMapId:n,sourceMapId:i.mapId,type:"<cancel>",id:String(o)})}}},fl.prototype.receive=function(t){var e,r=this,n=t.data,i=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var o=function(t,e){delete r.callbacks[i];var n=[];r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(i),error:t?_n(t):null,data:_n(e,n)},n)};if("<response>"===n.type||"<cancel>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&n.error?e(vn(n.error)):e&&e(null,vn(n.data));else if(void 0!==n.id&&this.parent[n.type]){this.callbacks[n.id]=null;var a=this.parent[n.type](n.sourceMapId,vn(n.data),o);a&&null===this.callbacks[n.id]&&(this.callbacks[n.id]=a.cancel)}else if(void 0!==n.id&&this.parent.getWorkerSource){var s=n.type.split("."),l=vn(n.data);this.parent.getWorkerSource(n.sourceMapId,s[0],l.source)[s[1]](l,o)}else this.parent[n.type](vn(n.data))}},fl.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var yl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};yl.prototype.setNorthEast=function(t){return this._ne=t instanceof gl?new gl(t.lng,t.lat):gl.convert(t),this},yl.prototype.setSouthWest=function(t){return this._sw=t instanceof gl?new gl(t.lng,t.lat):gl.convert(t),this},yl.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof gl)e=t,r=t;else{if(!(t instanceof yl))return Array.isArray(t)?t.every(Array.isArray)?this.extend(yl.convert(t)):this.extend(gl.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new gl(e.lng,e.lat),this._ne=new gl(r.lng,r.lat)),this},yl.prototype.getCenter=function(){return new gl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},yl.prototype.getSouthWest=function(){return this._sw},yl.prototype.getNorthEast=function(){return this._ne},yl.prototype.getNorthWest=function(){return new gl(this.getWest(),this.getNorth())},yl.prototype.getSouthEast=function(){return new gl(this.getEast(),this.getSouth())},yl.prototype.getWest=function(){return this._sw.lng},yl.prototype.getSouth=function(){return this._sw.lat},yl.prototype.getEast=function(){return this._ne.lng},yl.prototype.getNorth=function(){return this._ne.lat},yl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},yl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},yl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},yl.convert=function(t){return!t||t instanceof yl?t:new yl(t)};var gl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};function _l(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function vl(t){return(180+t)/360}function bl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function xl(t,e){return t/_l(e)}function wl(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}gl.prototype.wrap=function(){return new gl(c(this.lng,-180,180),this.lat)},gl.prototype.toArray=function(){return[this.lng,this.lat]},gl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},gl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new yl(new gl(this.lng-r,this.lat-e),new gl(this.lng+r,this.lat+e))},gl.convert=function(t){if(t instanceof gl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new gl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new gl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var El=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};El.fromLngLat=function(t,e){void 0===e&&(e=0);var r=gl.convert(t);return new El(vl(r.lng),bl(r.lat),xl(e,r.lat))},El.prototype.toLngLat=function(){return new gl(360*this.x-180,wl(this.y))},El.prototype.toAltitude=function(){return this.z*_l(wl(this.y))};var Cl=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Al(0,t,e,r)};Cl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Cl.prototype.url=function(t,e){var r,n,i,o,a,s=(n=this.y,i=this.z,o=ml(256*(r=this.x),256*(n=Math.pow(2,i)-n-1),i),a=ml(256*(r+1),256*(n+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),l=function(t,e,r){for(var n,i="",o=t;o>0;o--)i+=(e&(n=1<<o-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},Cl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i((t.x*e-this.x)*io,(t.y*e-this.y)*io)};var Sl=function(t,e){this.wrap=t,this.canonical=e,this.key=Al(t,e.z,e.x,e.y)},Tl=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Cl(r,+n,+i),this.key=Al(e,t,n,i)};function Al(t,e,r,n){(t*=2)<0&&(t=-1*t-1);var i=1<<e;return 32*(i*i*t+i*n+r)+e}Tl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Tl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Tl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Tl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Tl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Tl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Tl(e,this.wrap,e,r,n),new Tl(e,this.wrap,e,r+1,n),new Tl(e,this.wrap,e,r,n+1),new Tl(e,this.wrap,e,r+1,n+1)]},Tl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Tl.prototype.wrapped=function(){return new Tl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Tl.prototype.unwrapTo=function(t){return new Tl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Tl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Tl.prototype.toUnwrapped=function(){return new Sl(this.wrap,this.canonical)},Tl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Tl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new El(t.x-this.wrap,t.y))},yn("CanonicalTileID",Cl),yn("OverscaledTileID",Tl,{omit:["posMatrix"]});var Il=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return w('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');var n=this.dim=e.height;this.stride=this.dim+2,this.data=new Int32Array(this.stride*this.stride);for(var i=e.data,o="terrarium"===r?this._unpackTerrarium:this._unpackMapbox,a=0;a<n;a++)for(var s=0;s<n;s++){var l=4*(a*n+s);this.set(s,a,o(i[l],i[l+1],i[l+2]))}for(var u=0;u<n;u++)this.set(-1,u,this.get(0,u)),this.set(n,u,this.get(n-1,u)),this.set(u,-1,this.get(u,0)),this.set(u,n,this.get(u,n-1));this.set(-1,-1,this.get(0,0)),this.set(n,-1,this.get(n-1,0)),this.set(-1,n,this.get(0,n-1)),this.set(n,n,this.get(n-1,n-1))};Il.prototype.set=function(t,e,r){this.data[this._idx(t,e)]=r+65536},Il.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},Il.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Il.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Il.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Il.prototype.getPixels=function(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Il.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,l=-r*this.dim,u=o;u<a;u++)for(var c=n;c<i;c++)this.set(c,u,t.get(c+s,u+l))},yn("DEMData",Il);var kl=Jn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Pl=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Pl.prototype.encode=function(t){return this._stringToNumber[t]},Pl.prototype.decode=function(t){return this._numberToString[t]};var Ol=function(t,e,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},Rl={geometry:{configurable:!0}};Rl.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Rl.geometry.set=function(t){this._geometry=t},Ol.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Ol.prototype,Rl);var Dl=function(){this.state={},this.stateChanges={},this.deletedStates={}};Dl.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},h(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var o in this.deletedStates[t][n]={},this.state[t][n])r[o]||(this.deletedStates[t][n][o]=null);else for(var a in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][a]&&delete this.deletedStates[t][n][a]},Dl.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},Dl.prototype.getState=function(t,e){var r=String(e),n=h({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete n[o]}return n},Dl.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Dl.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var o in this.stateChanges[n])this.state[n][o]||(this.state[n][o]={}),h(this.state[n][o],this.stateChanges[n][o]),i[o]=this.state[n][o];r[n]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var l in this.state[a])s[l]={},this.state[a][l]={};else for(var u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else for(var c=0,p=Object.keys(this.deletedStates[a][u]);c<p.length;c+=1)delete this.state[a][u][p[c]];s[u]=this.state[a][u]}r[a]=r[a]||{},h(r[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var d in t)t[d].setFeatureState(r,e)};var Ml=function(t,e,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new hn(io,16,0),this.grid3D=new hn(io,16,0),this.featureIndexArray=r||new Di};function Ll(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y)}return{minX:e,minY:r,maxX:n,maxY:i}}function zl(t,e){return e-t}Ml.prototype.insert=function(t,e,r,n,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=o?this.grid3D:this.grid,l=0;l<e.length;l++){for(var u=e[l],c=[1/0,1/0,-1/0,-1/0],h=0;h<u.length;h++){var p=u[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<io&&c[1]<io&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},Ml.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new La.VectorTile(new Gs(this.rawTileData)).layers,this.sourceLayerCoder=new Pl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ml.prototype.query=function(t,e,r){var n=this;this.loadVTLayers();for(var o=t.params||{},a=io/t.tileSize/t.scale,s=Fr(o.filter),l=t.queryGeometry,u=t.queryPadding*a,c=Ll(l),h=this.grid.query(c.minX-u,c.minY-u,c.maxX+u,c.maxY+u),p=Ll(t.cameraQueryGeometry),d=0,f=this.grid3D.query(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u,function(e,r,n,o){return function(t,e,r,n,o){for(var a=0,s=t;a<s.length;a+=1){var l=s[a];if(e<=l.x&&r<=l.y&&n>=l.x&&o>=l.y)return!0}var u=[new i(e,r),new i(e,o),new i(n,o),new i(n,r)];if(t.length>2)for(var c=0,h=u;c<h.length;c+=1)if(vo(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(bo(t[p],t[p+1],u))return!0;return!1}(t.cameraQueryGeometry,e-u,r-u,n+u,o+u)});d<f.length;d+=1)h.push(f[d]);h.sort(zl);for(var m,y={},g=function(i){var u=h[i];if(u!==m){m=u;var c=n.featureIndexArray.get(u),p=null;n.loadMatchingFeature(y,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,s,o.layers,e,function(e,i){p||(p=ao(e));var o={};return e.id&&(o=r.getState(i.sourceLayer||"_geojsonTileLayer",e.id)),i.queryIntersectsFeature(l,e,o,p,n.z,t.transform,a,t.pixelPosMatrix)})}},_=0;_<h.length;_++)g(_);return y},Ml.prototype.loadMatchingFeature=function(t,e,r,n,i,o,a,s){var l=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(o,l)){var u=this.sourceLayerCoder.decode(r),c=this.vtLayers[u].feature(n);if(i(new Mn(this.tileID.overscaledZ),c))for(var h=0;h<l.length;h++){var p=l[h];if(!(o&&o.indexOf(p)<0)){var d=a[p];if(d){var f=!s||s(c,d);if(f){var m=new Ol(c,this.z,this.x,this.y);m.layer=d.serialize();var y=t[p];void 0===y&&(y=t[p]=[]),y.push({featureIndex:n,feature:m,intersectionZ:f})}}}}}},Ml.prototype.lookupSymbolFeatures=function(t,e,r,n,i,o){var a={};this.loadVTLayers();for(var s=Fr(n),l=0,u=t;l<u.length;l+=1)this.loadMatchingFeature(a,e,r,u[l],s,i,o);return a},Ml.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},yn("FeatureIndex",Ml,{omit:["rawTileData","sourceLayerCoder"]});var Nl=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.expiredRequestCount=0,this.state="loading"};Nl.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<R.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Nl.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Nl.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var n=function(){var t=o[i],n=t.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map(function(t){return n.filter(function(e){return e.id===t})[0]}));for(var a=0,s=n;a<s.length;a+=1)r[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)n();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof Ss){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}for(var o in this.queryPadding=0,this.buckets){var a=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(o).queryRadius(a))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Ei},Nl.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Nl.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Nl.prototype.getBucket=function(t){return this.buckets[t.id]},Nl.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qs(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qs(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},Nl.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Nl.prototype.queryRenderedFeatures=function(t,e,r,n,i,o,a,s,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:i,tileSize:this.tileSize,pixelPosMatrix:l,transform:a,params:o,queryPadding:this.queryPadding*s},t,e):{}},Nl.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var r=this.latestFeatureIndex.loadVTLayers(),n=r._geojsonTileLayer||r[e?e.sourceLayer:""];if(n)for(var i=Fr(e&&e.filter),o=this.tileID.canonical,a=o.z,s=o.x,l=o.y,u={z:a,x:s,y:l},c=0;c<n.length;c++){var h=n.feature(c);if(i(new Mn(this.tileID.overscaledZ),h)){var p=new Ol(h,a,s,l);p.tile=u,t.push(p)}}}},Nl.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Nl.prototype.setMask=function(t,e){if(!a(this.mask,t)&&(this.mask=t,this.clearMask(),!a(t,{0:!0}))){var r=new ri,n=new gi;this.segments=new Li,this.segments.prepareSegment(0,r,n);for(var o=Object.keys(t),s=0;s<o.length;s++){var l=t[o[s]],u=io>>l.z,c=new i(l.x*u,l.y*u),h=new i(c.x+u,c.y+u),p=this.segments.prepareSegment(4,r,n);r.emplaceBack(c.x,c.y,c.x,c.y),r.emplaceBack(h.x,c.y,h.x,c.y),r.emplaceBack(c.x,h.y,c.x,h.y),r.emplaceBack(h.x,h.y,h.x,h.y);var d=p.vertexLength;n.emplaceBack(d,d+1,d+2),n.emplaceBack(d+1,d+2,d+3),p.vertexLength+=4,p.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(r,kl.members),this.maskedIndexBuffer=e.createIndexBuffer(n)}},Nl.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Nl.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Nl.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,r,n,i){var o=n||i;return e[r]=!o||o.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Nl.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Nl.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets){var i=this.buckets[n],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],s=t[o];a&&s&&0!==Object.keys(s).length&&(i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(n).queryRadius(i))))}}},Nl.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Nl.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<R.now()},Nl.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Nl.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=R.now()+t};var Fl=24,Bl={horizontal:1,vertical:2,horizontalOnly:3},Vl=function(){this.text="",this.sectionIndex=[],this.sections=[]};function jl(t,e,r,n,i,o,a,s,l,u){var c,h=Vl.fromFeature(t,r);u===Bl.vertical&&h.verticalizePunctuation();var p=Dn.processBidirectionalText,d=Dn.processStyledBidirectionalText;if(p&&1===h.sections.length){c=[];for(var f=0,m=p(h.toString(),Zl(h,s,n,e));f<m.length;f+=1){var y=m[f],g=new Vl;g.text=y,g.sections=h.sections;for(var _=0;_<y.length;_++)g.sectionIndex.push(0);c.push(g)}}else if(d){c=[];for(var v=0,b=d(h.text,h.sectionIndex,Zl(h,s,n,e));v<b.length;v+=1){var x=b[v],w=new Vl;w.text=x[0],w.sectionIndex=x[1],w.sections=h.sections,c.push(w)}}else c=function(t,e){for(var r=[],n=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t.substring(i,s)),i=s}return i<n.length&&r.push(t.substring(i,n.length)),r}(h,Zl(h,s,n,e));var E=[],C={positionedGlyphs:E,text:h.toString(),top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:u,lineCount:c.length};return function(t,e,r,n,i,o,a,s){for(var l=0,u=-17,c=0,h=t.positionedGlyphs,p="right"===o?1:"left"===o?0:.5,d=0,f=r;d<f.length;d+=1){var m=f[d];m.trim();var y=m.getMaxScale();if(m.length()){for(var g=h.length,_=0;_<m.length();_++){var v=m.getSection(_),b=m.getCharCode(_),x=24*(y-v.scale),w=e[v.fontStack],E=w&&w[b];E&&(Sn(b)&&a!==Bl.horizontal?(h.push({glyph:b,x:l,y:x,vertical:!0,scale:v.scale,fontStack:v.fontStack}),l+=Fl*v.scale+s):(h.push({glyph:b,x:l,y:u+x,vertical:!1,scale:v.scale,fontStack:v.fontStack}),l+=E.metrics.advance*v.scale+s))}h.length!==g&&(c=Math.max(l-s,c),Kl(h,e,g,h.length-1,p)),l=0,u+=n*y}else u+=n}var C=Ql(i),S=C.horizontalAlign,T=C.verticalAlign;!function(t,e,r,n,i,o,a){for(var s=(p-S)*c,l=(-T*a+.5)*o,u=0;u<t.length;u++)t[u].x+=s,t[u].y+=l}(h,0,0,0,0,n,r.length);var A=u- -17;t.top+=-T*A,t.bottom=t.top+A,t.left+=-S*c,t.right=t.left+c}(C,e,c,i,o,a,u,s),!!E.length&&C}Vl.fromFeature=function(t,e){for(var r=new Vl,n=0;n<t.sections.length;n++){var i=t.sections[n];r.sections.push({scale:i.scale||1,fontStack:i.fontStack||e}),r.text+=i.text;for(var o=0;o<i.text.length;o++)r.sectionIndex.push(n)}return r},Vl.prototype.length=function(){return this.text.length},Vl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Vl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Vl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;n&&Tn(n)&&!ps[t[r+1]]||i&&Tn(i)&&!ps[t[r-1]]||!ps[t[r]]?e+=t[r]:e+=ps[t[r]]}return e}(this.text)},Vl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Ul[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=t&&Ul[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},Vl.prototype.substring=function(t,e){var r=new Vl;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Vl.prototype.toString=function(){return this.text},Vl.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,r){return Math.max(e,t.sections[r].scale)},0)};var Ul={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ql={};function Hl(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Wl(t,e){var r=0;return 10===t&&(r-=1e4),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Gl(t,e,r,n,i,o){for(var a=null,s=Hl(e,r,i,o),l=0,u=n;l<u.length;l+=1){var c=u[l],h=Hl(e-c.x,r,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Zl(t,e,r,n){if(!r)return[];if(!t)return[];for(var i,o=[],a=function(t,e,r,n){for(var i=0,o=0;o<t.length();o++){var a=t.getSection(o),s=n[a.fontStack],l=s&&s[t.getCharCode(o)];l&&(i+=l.metrics.advance*a.scale+e)}return i/Math.max(1,Math.ceil(i/r))}(t,e,r,n),s=0,l=0;l<t.length();l++){var u=t.getSection(l),c=t.getCharCode(l),h=n[u.fontStack],p=h&&h[c];p&&!Ul[c]&&(s+=p.metrics.advance*u.scale+e),l<t.length()-1&&(ql[c]||!((i=c)<11904)&&(xn["Bopomofo Extended"](i)||xn.Bopomofo(i)||xn["CJK Compatibility Forms"](i)||xn["CJK Compatibility Ideographs"](i)||xn["CJK Compatibility"](i)||xn["CJK Radicals Supplement"](i)||xn["CJK Strokes"](i)||xn["CJK Symbols and Punctuation"](i)||xn["CJK Unified Ideographs Extension A"](i)||xn["CJK Unified Ideographs"](i)||xn["Enclosed CJK Letters and Months"](i)||xn["Halfwidth and Fullwidth Forms"](i)||xn.Hiragana(i)||xn["Ideographic Description Characters"](i)||xn["Kangxi Radicals"](i)||xn["Katakana Phonetic Extensions"](i)||xn.Katakana(i)||xn["Vertical Forms"](i)||xn["Yi Radicals"](i)||xn["Yi Syllables"](i)))&&o.push(Gl(l+1,s,a,o,Wl(c,t.getCharCode(l+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Gl(t.length(),s,a,o,0,!0))}function Ql(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Kl(t,e,r,n,i){if(i){var o=t[n],a=e[o.fontStack],s=a&&a[o.glyph];if(s)for(var l=(t[n].x+s.metrics.advance*o.scale)*i,u=r;u<=n;u++)t[u].x-=l}}function $l(t,e,r){var n=Ql(r),i=e[0]-t.displaySize[0]*n.horizontalAlign,o=e[1]-t.displaySize[1]*n.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}function Xl(t,e,r,n,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<r/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),u+=p;s-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;a++,s+=c.dist(h)}return!0}function Yl(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Jl(t,e,r){return t?.6*e*r:0}function tu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function eu(t,e,r,n,i,o){for(var a=Jl(r,i,o),s=tu(r,n)*o,l=0,u=Yl(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],d=h.dist(p);if(l+d>u){var f=(u-l)/d,m=_e(h.x,p.x,f),y=_e(h.y,p.y,f),g=new ds(m,y,p.angleTo(h),c);return g._round(),!a||Xl(t,g,s,a,e)?g:void 0}l+=d}}function ru(t,e,r,n,i,o,a,s,l){var u=Jl(n,o,a),c=tu(n,i),h=c*a,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,r,n,i,o,a,s,l,u){for(var c=a/2,h=Yl(e),p=0,d=r-n,f=[],m=0;m<e.length-1;m++){for(var y=e[m],g=e[m+1],_=y.dist(g),v=g.angleTo(y);d+n<p+_;){var b=((d+=n)-p)/_,x=_e(y.x,g.x,b),w=_e(y.y,g.y,b);if(x>=0&&x<u&&w>=0&&w<u&&d-c>=0&&d+c<=h){var E=new ds(x,w,v,m);E._round(),i&&!Xl(e,E,a,i,o)||f.push(E)}}p+=_}return l||f.length||s||(f=t(e,p/2,n,i,o,a,s,!0,u)),f}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,u,r,h,p,!1,l)}ql[10]=!0,ql[32]=!0,ql[38]=!0,ql[40]=!0,ql[41]=!0,ql[43]=!0,ql[45]=!0,ql[47]=!0,ql[173]=!0,ql[183]=!0,ql[8203]=!0,ql[8208]=!0,ql[8211]=!0,ql[8231]=!0;var nu=function(t,e,r,n,o,a,s,l,u,c,h,p){var d=s.top*l-u,f=s.bottom*l+u,m=s.left*l-u,y=s.right*l+u;if(this.boxStartIndex=t.length,c){var g=f-d,_=y-m;g>0&&(g=Math.max(10*l,g),this._addLineCollisionCircles(t,e,r,r.segment,_,g,n,o,a,h))}else{if(p){var v=new i(m,d),b=new i(y,d),x=new i(m,f),w=new i(y,f),E=p*Math.PI/180;v._rotate(E),b._rotate(E),x._rotate(E),w._rotate(E),m=Math.min(v.x,b.x,x.x,w.x),y=Math.max(v.x,b.x,x.x,w.x),d=Math.min(v.y,b.y,x.y,w.y),f=Math.max(v.y,b.y,x.y,w.y)}t.emplaceBack(r.x,r.y,m,d,y,f,n,o,a,0,0)}this.boxEndIndex=t.length};nu.prototype._addLineCollisionCircles=function(t,e,r,n,i,o,a,s,l,u){var c=o/2,h=Math.floor(i/c)||1,p=1+.4*Math.log(u)/Math.LN2,d=Math.floor(h*p/2),f=-o/2,m=r,y=n+1,g=f,_=-i/2,v=_-i/4;do{if(--y<0){if(g>_)return;y=0;break}g-=e[y].dist(m),m=e[y]}while(g>v);for(var b=e[y].dist(e[y+1]),x=-d;x<h+d;x++){var w=x*c,E=_+w;if(w<0&&(E+=w),w>i&&(E+=w-i),!(E<g)){for(;g+b<E;){if(g+=b,++y+1>=e.length)return;b=e[y].dist(e[y+1])}var C=E-g,S=e[y],T=e[y+1].sub(S)._unit()._mult(C)._add(S)._round(),A=Math.abs(E-f)<c?0:.8*(E-f);t.emplaceBack(T.x,T.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,A)}}};var iu=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=ou),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function ou(t,e){return t<e?-1:t>e?1:0}function au(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,l=t[0],u=0;u<l.length;u++){var c=l[u];(!u||c.x<n)&&(n=c.x),(!u||c.y<o)&&(o=c.y),(!u||c.x>a)&&(a=c.x),(!u||c.y>s)&&(s=c.y)}var h=Math.min(a-n,s-o),p=h/2,d=new iu([],su);if(0===h)return new i(n,o);for(var f=n;f<a;f+=h)for(var m=o;m<s;m+=h)d.push(new lu(f+p,m+p,p,t));for(var y=function(t){for(var e=0,r=0,n=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var l=i[o],u=i[s],c=l.x*u.y-u.x*l.y;r+=(l.x+u.x)*c,n+=(l.y+u.y)*c,e+=3*c}return new lu(r/e,n/e,0,t)}(t),g=d.length;d.length;){var _=d.pop();(_.d>y.d||!y.d)&&(y=_,r&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,g)),_.max-y.d<=e||(d.push(new lu(_.p.x-(p=_.h/2),_.p.y-p,p,t)),d.push(new lu(_.p.x+p,_.p.y-p,p,t)),d.push(new lu(_.p.x-p,_.p.y+p,p,t)),d.push(new lu(_.p.x+p,_.p.y+p,p,t)),g+=4)}return r&&(console.log("num probes: "+g),console.log("best distance: "+y.d)),y.p}function su(t,e){return e.max-t.max}function lu(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(r=!r),n=Math.min(n,go(t,u,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}iu.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},iu.prototype.pop=function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},iu.prototype.peek=function(){return this.data[0]},iu.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n},iu.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&r(e[s],a)<0&&(o=s,a=e[s]),r(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var uu=e(function(t){t.exports=function(t,e){var r,n,i,o,a,s,l,u;for(n=t.length-(r=3&t.length),i=e,a=3432918353,s=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),cu=e(function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,o=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),hu=uu,pu=cu;hu.murmur3=uu,hu.murmur2=pu;var du=7;function fu(t,e){var r=0,n=0,i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-du;break;case"bottom-right":case"bottom-left":n=-i+du;break;case"bottom":n=-e+du;break;case"top":n=e-du}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}function mu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yu(t,e,r,n,o,a,s){var l=a.layoutTextSize.evaluate(e,{}),u=a.layoutIconSize.evaluate(e,{}),c=a.textMaxSize.evaluate(e,{});void 0===c&&(c=l);var h=t.layers[0].layout,p=h.get("icon-offset").evaluate(e,{}),d=vu(r.horizontal),f=t.tilePixelRatio*(l/24),m=t.tilePixelRatio*c/24,y=t.tilePixelRatio*u,g=t.tilePixelRatio*h.get("symbol-spacing"),_=h.get("text-padding")*t.tilePixelRatio,v=h.get("icon-padding")*t.tilePixelRatio,b=h.get("text-max-angle")/180*Math.PI,x="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),E="map"===h.get("icon-rotation-alignment")&&"point"!==h.get("symbol-placement"),C=h.get("symbol-placement"),S=g/2,T=function(l,u){u.x<0||u.x>=io||u.y<0||u.y>=io||function(t,e,r,n,o,a,s,l,u,c,h,p,d,f,m,y,g,_,v,b,x){var E,C,S=t.addToLineVertexArray(e,r),T=0,A=0,I=0,k={},P=hu(""),O=(a.layout.get("text-radial-offset").evaluate(v,{})||0)*Fl;for(var R in n.horizontal){var D=n.horizontal[R];if(!E){P=hu(D.text);var M=a.layout.get("text-rotate").evaluate(v,{});E=new nu(s,r,e,l,u,c,D,h,p,d,t.overscaling,M)}var L=1===D.lineCount;if(A+=_u(t,e,D,a,d,v,f,S,n.vertical?Bl.horizontal:Bl.horizontalOnly,L?Object.keys(n.horizontal):[R],k,b,x),L)break}n.vertical&&(I+=_u(t,e,n.vertical,a,d,v,f,S,Bl.vertical,["vertical"],k,b,x));var z=E?E.boxStartIndex:t.collisionBoxArray.length,N=E?E.boxEndIndex:t.collisionBoxArray.length;if(o){var F=function(t,e,r,n,o,a){var s,l,u,c,h=e.image,p=r.layout,d=e.top-1/h.pixelRatio,f=e.left-1/h.pixelRatio,m=e.bottom+1/h.pixelRatio,y=e.right+1/h.pixelRatio;if("none"!==p.get("icon-text-fit")&&o){var g=y-f,_=m-d,v=p.get("text-size").evaluate(a,{})/24,b=o.left*v,x=o.top*v,w=o.right*v-b,E=o.bottom*v-x,C=p.get("icon-text-fit-padding")[0],S=p.get("icon-text-fit-padding")[1],T=p.get("icon-text-fit-padding")[2],A=p.get("icon-text-fit-padding")[3],I="width"===p.get("icon-text-fit")?.5*(E-_):0,k="height"===p.get("icon-text-fit")?.5*(w-g):0,P="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?w:g,O="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?E:_;s=new i(b+k-A,x+I-C),l=new i(b+k+S+P,x+I-C),u=new i(b+k+S+P,x+I+T+O),c=new i(b+k-A,x+I+T+O)}else s=new i(f,d),l=new i(y,d),u=new i(y,m),c=new i(f,m);var R=r.layout.get("icon-rotate").evaluate(a,{})*Math.PI/180;if(R){var D=Math.sin(R),M=Math.cos(R),L=[M,-D,D,M];s._matMult(L),l._matMult(L),c._matMult(L),u._matMult(L)}return[{tl:s,tr:l,bl:c,br:u,tex:h.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,o,a,0,vu(n.horizontal),v),B=a.layout.get("icon-rotate").evaluate(v,{});C=new nu(s,r,e,l,u,c,o,m,y,!1,t.overscaling,B),T=4*F.length;var V=t.iconSizeData,j=null;"source"===V.functionType?(j=[fs*a.layout.get("icon-size").evaluate(v,{})])[0]>gu&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'):"composite"===V.functionType&&((j=[fs*x.compositeIconSizes[0].evaluate(v,{}),fs*x.compositeIconSizes[1].evaluate(v,{})])[0]>gu||j[1]>gu)&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'),t.addSymbols(t.icon,F,j,_,g,v,!1,e,S.lineStartIndex,S.lineLength)}var U=C?C.boxStartIndex:t.collisionBoxArray.length,q=C?C.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=Ss.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,k.right>=0?k.right:-1,k.center>=0?k.center:-1,k.left>=0?k.left:-1,k.vertical||-1,P,z,N,U,q,l,A,I,T,0,h,O)}(t,u,l,r,n,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,f,_,x,s,y,v,E,p,e,o,a)};if("line"===C)for(var A=0,I=function(t,e,r,n,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],p=l[c+1];h.x<0&&p.x<0||(h.x<0?h=new i(0,h.y+(0-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<0&&(p=new i(0,h.y+(0-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<0&&p.y<0||(h.y<0?h=new i(h.x+(0-h.y)/(p.y-h.y)*(p.x-h.x),0)._round():p.y<0&&(p=new i(h.x+(0-h.y)/(p.y-h.y)*(p.x-h.x),0)._round()),h.x>=n&&p.x>=n||(h.x>=n?h=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=n&&(p=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),u&&h.equals(u[u.length-1])||a.push(u=[h]),u.push(p)))))}return a}(e.geometry,0,0,io,io);A<I.length;A+=1)for(var k=I[A],P=0,O=ru(k,g,b,r.vertical||d,n,24,m,t.overscaling,io);P<O.length;P+=1){var R=O[P];d&&bu(t,d.text,S,R)||T(k,R)}else if("line-center"===C)for(var D=0,M=e.geometry;D<M.length;D+=1){var L=M[D];if(L.length>1){var z=eu(L,b,r.vertical||d,n,24,m);z&&T(L,z)}}else if("Polygon"===e.type)for(var N=0,F=va(e.geometry,0);N<F.length;N+=1){var B=F[N],V=au(B,16);T(B[0],new ds(V.x,V.y,0))}else if("LineString"===e.type)for(var j=0,U=e.geometry;j<U.length;j+=1){var q=U[j];T(q,new ds(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var H=0,W=e.geometry;H<W.length;H+=1)for(var G=0,Z=W[H];G<Z.length;G+=1){var Q=Z[G];T([Q],new ds(Q.x,Q.y,0))}}var gu=65535;function _u(t,e,r,n,o,a,s,l,u,c,h,p,d){var f=function(t,e,r,n,o,a,s){for(var l=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,u=e.positionedGlyphs,c=[],h=0;h<u.length;h++){var p=u[h],d=s[p.fontStack],f=d&&d[p.glyph];if(f){var m=f.rect;if(m){var y=dl+1,g=f.metrics.advance*p.scale/2,_=o?[p.x+g,p.y]:[0,0],v=o?[0,0]:[p.x+g+r[0],p.y+r[1]],b=(f.metrics.left-y)*p.scale-g+v[0],x=(-f.metrics.top-y)*p.scale+v[1],w=b+m.w*p.scale,E=x+m.h*p.scale,C=new i(b,x),S=new i(w,x),T=new i(b,E),A=new i(w,E);if(o&&p.vertical){var I=new i(-g,g),k=-Math.PI/2,P=new i(5,0);C._rotateAround(k,I)._add(P),S._rotateAround(k,I)._add(P),T._rotateAround(k,I)._add(P),A._rotateAround(k,I)._add(P)}if(l){var O=Math.sin(l),R=Math.cos(l),D=[R,-O,O,R];C._matMult(D),S._matMult(D),T._matMult(D),A._matMult(D)}c.push({tl:C,tr:S,bl:T,br:A,tex:m,writingMode:e.writingMode,glyphOffset:_})}}}return c}(0,r,s,n,o,a,p),m=t.textSizeData,y=null;"source"===m.functionType?(y=[fs*n.layout.get("text-size").evaluate(a,{})])[0]>gu&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'):"composite"===m.functionType&&((y=[fs*d.compositeTextSizes[0].evaluate(a,{}),fs*d.compositeTextSizes[1].evaluate(a,{})])[0]>gu||y[1]>gu)&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'),t.addSymbols(t.text,f,y,s,o,a,u,e,l.lineStartIndex,l.lineLength);for(var g=0,_=c;g<_.length;g+=1)h[_[g]]=t.text.placedSymbolArray.length-1;return 4*f.length}function vu(t){for(var e in t)return t[e];return null}function bu(t,e,r,n){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(n.dist(o[a])<r)return!0}else i[e]=[];return i[e].push(n),!1}t.Actor=fl,t.AlphaImage=No,t.CanonicalTileID=Cl,t.CollisionBoxArray=Ei,t.Color=Zt,t.DEMData=Il,t.DataConstantProperty=qn,t.DictionaryCoder=Pl,t.EXTENT=io,t.ErrorEvent=Et,t.EvaluationParameters=Mn,t.Event=wt,t.Evented=Ct,t.FeatureIndex=Ml,t.FillBucket=Ea,t.FillExtrusionBucket=Ba,t.ImageAtlas=Fs,t.ImagePosition=zs,t.LineBucket=Ja,t.LngLat=gl,t.LngLatBounds=yl,t.MercatorCoordinate=El,t.ONE_EM=Fl,t.OverscaledTileID=Tl,t.Point=i,t.Point$1=i,t.ProgramConfiguration=to,t.Properties=Qn,t.Protobuf=Gs,t.RGBAImage=Fo,t.RequestManager=B,t.ResourceType=ct,t.SegmentVector=Li,t.SourceFeatureState=Dl,t.StructArrayLayout1ui2=vi,t.StructArrayLayout2i4=ei,t.StructArrayLayout2ui4=_i,t.StructArrayLayout3ui6=gi,t.StructArrayLayout4i8=ri,t.SymbolBucket=Ss,t.Texture=qs,t.Tile=Nl,t.Transitionable=Nn,t.Uniform1f=ji,t.Uniform1i=Vi,t.Uniform2f=Ui,t.Uniform3f=qi,t.Uniform4f=Hi,t.UniformColor=Wi,t.UniformMatrix4f=Zi,t.UnwrappedTileID=Sl,t.ValidationError=Tt,t.WritingMode=Bl,t.ZoomHistory=bn,t.addDynamicAttributes=ws,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),i[a]=e,0==--n&&r(o,i)})})},t.bezier=s,t.bindAll=y,t.browser=R,t.clamp=u,t.clone=function(t){var e=new So(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.config=D,t.create=function(){var t=new So(16);return So!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=To,t.create$2=function(){var t=new So(4);return So!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Cr,t.createLayout=Jn,t.createStyleLayer=function(t){return"custom"===t.type?new Ds(t):new Ms[t.type](t)},t.deepEqual=a,t.ease=l,t.emitValidationErrors=cn,t.endsWith=g,t.evaluateRadialOffset=fu,t.evaluateSizeForFeature=ys,t.evaluateSizeForZoom=gs,t.evented=Rn,t.extend=h,t.featureFilter=Fr,t.filterObject=v,t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ql,t.getAnchorJustification=mu,t.getArrayBuffer=gt,t.getImage=vt,t.getJSON=function(t,e){return yt(h(t,{type:"json"}),e)},t.getReferrer=mt,t.getVideo=function(t,e){var r,n,i=self.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");r=t[o],n=void 0,(n=self.document.createElement("a")).href=r,(n.protocol!==self.document.location.protocol||n.host!==self.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],y=e[14],g=e[15],_=r*s-n*a,v=r*l-i*a,b=r*u-o*a,x=n*l-i*s,w=n*u-o*s,E=i*u-o*l,C=c*m-h*f,S=c*y-p*f,T=c*g-d*f,A=h*y-p*m,I=h*g-d*m,k=p*g-d*y,P=_*k-v*I+b*A+x*T-w*S+E*C;return P?(t[0]=(s*k-l*I+u*A)*(P=1/P),t[1]=(i*I-n*k-o*A)*P,t[2]=(m*E-y*w+g*x)*P,t[3]=(p*w-h*E-d*x)*P,t[4]=(l*T-a*k-u*S)*P,t[5]=(r*k-i*T+o*S)*P,t[6]=(y*b-f*E-g*v)*P,t[7]=(c*E-p*b+d*v)*P,t[8]=(a*I-s*T+u*C)*P,t[9]=(n*T-r*I-o*C)*P,t[10]=(f*w-m*b+g*_)*P,t[11]=(h*b-c*w-d*_)*P,t[12]=(s*S-a*A-l*C)*P,t[13]=(r*A-n*S+i*C)*P,t[14]=(m*v-f*x-y*_)*P,t[15]=(c*x-h*v+p*_)*P,t):null},t.isChar=xn,t.isMapboxURL=U,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.makeRequest=yt,t.mapObject=_,t.mercatorXfromLng=vl,t.mercatorYfromLat=bl,t.mercatorZfromAltitude=xl,t.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],y=e[13],g=e[14],_=e[15],v=r[0],b=r[1],x=r[2],w=r[3];return t[0]=v*n+b*s+x*h+w*m,t[1]=v*i+b*l+x*p+w*y,t[2]=v*o+b*u+x*d+w*g,t[3]=v*a+b*c+x*f+w*_,t[4]=(v=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=v*i+b*l+x*p+w*y,t[6]=v*o+b*u+x*d+w*g,t[7]=v*a+b*c+x*f+w*_,t[8]=(v=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=v*i+b*l+x*p+w*y,t[10]=v*o+b*u+x*d+w*g,t[11]=v*a+b*c+x*f+w*_,t[12]=(v=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=v*i+b*l+x*p+w*y,t[14]=v*o+b*u+x*d+w*g,t[15]=v*a+b*c+x*f+w*_,t},t.mvt=La,t.number=_e,t.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),l=1/(n-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*l,t[14]=(a+o)*u,t[15]=1,t},t.parseGlyphPBF=function(t){return new Gs(t).readFields(cl,[])},t.pbf=Gs,t.performSymbolLayout=function(t,e,r,n,i,o){t.createArrays(),t.tilePixelRatio=io/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var a=t.layers[0].layout,s=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.functionType){var u=t.textSizeData.zoomRange,c=u.max;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Mn(u.min)),s["text-size"].possiblyEvaluate(new Mn(c))]}if("composite"===t.iconSizeData.functionType){var h=t.iconSizeData.zoomRange,p=h.max;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Mn(h.min)),s["icon-size"].possiblyEvaluate(new Mn(p))]}l.layoutTextSize=s["text-size"].possiblyEvaluate(new Mn(t.zoom+1)),l.layoutIconSize=s["icon-size"].possiblyEvaluate(new Mn(t.zoom+1)),l.textMaxSize=s["text-size"].possiblyEvaluate(new Mn(18));for(var d=a.get("text-line-height")*Fl,f="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement"),m=a.get("text-keep-upright"),y=0,g=t.features;y<g.length;y+=1){var _=g[y],v=a.get("text-font").evaluate(_,{}).join(","),b=r,x={horizontal:{},vertical:void 0},E=_.text,C=[0,0];if(E){var S=E.toString(),T=a.get("text-letter-spacing").evaluate(_,{})*Fl,A=En(S)?T:0,I=a.get("text-anchor").evaluate(_,{}),k=a.get("text-variable-anchor"),P=a.get("text-radial-offset").evaluate(_,{});k||(C=P?fu(I,P*Fl):a.get("text-offset").evaluate(_,{}).map(function(t){return t*Fl}));var O=f?"center":a.get("text-justify").evaluate(_,{}),R="point"===a.get("symbol-placement")?a.get("text-max-width").evaluate(_,{})*Fl:0;if(!f&&k)for(var D="auto"===O?k.map(function(t){return mu(t)}):[O],M=!1,L=0;L<D.length;L++){var z=D[L];if(!x.horizontal[z])if(M)x.horizontal[z]=x.horizontal[0];else{var N=jl(E,e,v,R,d,"center",z,A,C,Bl.horizontal);N&&(x.horizontal[z]=N,M=1===N.lineCount)}}else{"auto"===O&&(O=mu(I));var F=jl(E,e,v,R,d,I,O,A,C,Bl.horizontal);F&&(x.horizontal[O]=F),wn(S)&&f&&m&&(x.vertical=jl(E,e,v,R,d,I,O,A,C,Bl.vertical))}}var B=void 0;if(_.icon){var V=n[_.icon];V&&(B=$l(i[_.icon],a.get("icon-offset").evaluate(_,{}),a.get("icon-anchor").evaluate(_,{})),void 0===t.sdfIcons?t.sdfIcons=V.sdf:t.sdfIcons!==V.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),V.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==a.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(Object.keys(x.horizontal).length||B)&&yu(t,_,x,B,b,l,C)}o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=Dn,t.polygonIntersectsPolygon=uo,t.postMapLoadEvent=ut,t.postTurnstileEvent=st,t.potpack=Ls,t.properties=As,t.rasterBoundsAttributes=kl,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=yn,t.registerForPluginAvailability=function(t){return Pn?t({pluginURL:Pn,completionCallback:In}):Rn.once("pluginAvailable",t),t},t.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*s,t[1]=i*l+a*s,t[2]=n*-s+o*l,t[3]=i*-s+a*l,t},t.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=l*i+p*n,t[8]=u*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-l*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=l*i+p*n,t[4]=u*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-l*n,t},t.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setRTLTextPlugin=function(t,e){if(kn)throw new Error("setRTLTextPlugin cannot be called multiple times.");kn=!0,Pn=R.resolveURL(t),In=function(t){t?(kn=!1,Pn=null,e&&e(t)):On=!0},Rn.fire(new wt("pluginAvailable",{pluginURL:Pn,completionCallback:In}))},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.styleSpec=St,t.symbolSize=_s,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},t.transformMat4=ko,t.translate=function(t,e,r){var n,i,o,a,s,l,u,c,h,p,d,f,m=r[0],y=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+s*y+h*g+e[12],t[13]=i*m+l*y+p*g+e[13],t[14]=o*m+u*y+d*g+e[14],t[15]=a*m+c*y+f*g+e[15]),t},t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=sn,t.validateStyle=an,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=La,t.version="1.0.0",t.warnOnce=w,t.webpSupported=M,t.window=self,t.wrap=c}),n(0,function(t){function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",i=0,o=t;i<o.length;i+=1)n+=e(o[i])+",";return n+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function r(r){for(var n="",i=0,o=t.refProperties;i<o.length;i+=1)n+="/"+e(r[o[i]]);return n}var n=function(t){t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(e,n){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=t.createStyleLayer(s);l._featureFilter=t.featureFilter(l.filter)}for(var u=0,c=n;u<c.length;u+=1){var h=c[u];delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,d=function(t){for(var e={},n=0;n<t.length;n++){var i=r(t[n]),o=e[i];o||(o=e[i]=[]),o.push(t[n])}var a=[];for(var s in e)a.push(e[s]);return a}(t.values(this._layerConfigs));p<d.length;p+=1){var f=d[p].map(function(t){return i._layers[t.id]}),m=f[0];if("none"!==m.visibility){var y=m.source||"",g=this.familiesBySource[y];g||(g=this.familiesBySource[y]={});var _=m.sourceLayer||"_geojsonTileLayer",v=g[_];v||(v=g[_]=[]),v.push(f)}}};var i=function(e){var r={},n=[];for(var i in e){var o=e[i],a=r[i]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};n.push(u),a[s]={rect:u,metrics:l.metrics}}}}var c=t.potpack(n),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var d=e[p];for(var f in d){var m=d[+f];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var y=r[p][f].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:y.x+1,y:y.y+1},m.bitmap)}}}this.image=h,this.positions=r};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function a(e,r){for(var n=new t.EvaluationParameters(r),i=0,o=e;i<o.length;i+=1)o[i].recalculate(n)}o.prototype.parse=function(e,r,n,o){var s=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),u=new t.FeatureIndex(this.tileID);u.bucketLayerIDs=[];var c,h,p,d,f={},m={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{}},y=r.familiesBySource[this.source];for(var g in y){var _=e.layers[g];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var v=l.encode(g),b=[],x=0;x<_.length;x++){var w=_.feature(x);b.push({feature:w,index:x,sourceLayerIndex:v})}for(var E=0,C=y[g];E<C.length;E+=1){var S=C[E],T=S[0];T.minzoom&&this.zoom<Math.floor(T.minzoom)||T.maxzoom&&this.zoom>=T.maxzoom||"none"!==T.visibility&&(a(S,this.zoom),(f[T.id]=T.createBucket({index:u.bucketLayerIDs.length,layers:S,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:v,sourceID:this.source})).populate(b,m),u.bucketLayerIDs.push(S.map(function(t){return t.id})))}}}var A=t.mapObject(m.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(A).length?n.send("getGlyphs",{uid:this.uid,stacks:A},function(t,e){c||(c=t,h=e,P.call(s))}):h={};var I=Object.keys(m.iconDependencies);I.length?n.send("getImages",{icons:I},function(t,e){c||(c=t,p=e,P.call(s))}):p={};var k=Object.keys(m.patternDependencies);function P(){if(c)return o(c);if(h&&p&&d){var e=new i(h),r=new t.ImageAtlas(p,d);for(var n in f){var s=f[n];s instanceof t.SymbolBucket?(a(s.layers,this.zoom),t.performSymbolLayout(s,h,e.positions,p,r.iconPositions,this.showCollisionBoxes)):s.hasPattern&&(s instanceof t.LineBucket||s instanceof t.FillBucket||s instanceof t.FillExtrusionBucket)&&(a(s.layers,this.zoom),s.addFeatures(m,r.patternPositions))}this.status="done",o(null,{buckets:t.values(f).filter(function(t){return!t.isEmpty()}),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}k.length?n.send("getImages",{icons:k},function(t,e){c||(c=t,d=e,P.call(s))}):d={},P.call(this)};var s="undefined"!=typeof performance,l={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,r){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,r)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},u=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},l.mark(this._marks.start)};function c(e,r){var n=t.getArrayBuffer(e.request,function(e,n,i,o){e?r(e):n&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(n)),rawData:n,cacheControl:i,expires:o})});return function(){n.cancel(),r()}}u.prototype.finish=function(){l.mark(this._marks.end);var t=l.getEntriesByName(this._marks.measure);return 0===t.length&&(l.measure(this._marks.measure,this._marks.start,this._marks.end),t=l.getEntriesByName(this._marks.measure),l.clearMarks(this._marks.start),l.clearMarks(this._marks.end),l.clearMeasures(this._marks.measure)),t},l.Performance=u;var h=function(t,e,r){this.actor=t,this.layerIndex=e,this.loadVectorData=r||c,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,r){var n=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new l.Performance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,function(e,o){if(delete n.loading[i],e||!o)return s.status="done",n.loaded[i]=s,r(e);var l=o.rawData,u={};o.expires&&(u.expires=o.expires),o.cacheControl&&(u.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,n.layerIndex,n.actor,function(e,n){if(e||!n)return r(e);r(null,t.extend({rawTileData:l.slice(0)},n,u,c))}),n.loaded=n.loaded||{},n.loaded[i]=s})},h.prototype.reloadTile=function(t,e){var r=this.loaded,n=t.uid,i=this;if(r&&r[n]){var o=r[n];o.showCollisionBoxes=t.showCollisionBoxes;var a=function(t,r){var n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,i.actor,n)),e(t,r)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.actor,a):a())}},h.prototype.abortTile=function(t,e){var r=this.loading,n=t.uid;r&&r[n]&&r[n].abort&&(r[n].abort(),delete r[n]),e()},h.prototype.removeTile=function(t,e){var r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()};var p=function(){this.loaded={}};p.prototype.loadTile=function(e,r){var n=e.uid,i=new t.DEMData(n,e.rawImageData,e.encoding);this.loaded=this.loaded||{},this.loaded[n]=i,r(null,i)},p.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var d={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function f(t){var e=0;if(t&&t.length>0){e+=Math.abs(m(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(m(t[r]))}return e}function m(t){var e,r,n,i,o,a,s=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(n=l-2,i=l-1,o=0):a===l-1?(n=l-1,i=0,o=1):(n=a,i=a+1,o=a+2),e=t[n],r=t[i],s+=(y(t[o][0])-y(e[0]))*Math.sin(y(r[1]));s=s*d.RADIUS*d.RADIUS/2}return s}function y(t){return t*Math.PI/180}var g={geometry:function t(e){var r,n=0;switch(e.type){case"Polygon":return f(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)n+=f(e.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)n+=t(e.geometries[r]);return n}},ring:m};function _(t,e){return function(r){return t(r,e)}}function v(t,e){t[0]=b(t[0],e=!!e);for(var r=1;r<t.length;r++)t[r]=b(t[r],!e);return t}function b(t,e){return function(t){return g.ring(t)>=0}(t)===e?t:t.reverse()}var x=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,w=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};w.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,n=this._feature.geometry;r<n.length;r+=1){var i=n[r];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,c=s[a];u<c.length;u+=1){var h=c[u];l.push(new t.Point$1(h[0],h[1]))}o.push(l)}return o},w.prototype.toGeoJSON=function(t,e,r){return x.call(this,t,e,r)};var E=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};E.prototype.feature=function(t){return new w(this._features[t])};var C=t.vectorTile.VectorTileFeature,S=T;function T(t,e){this.options=e||{},this.features=t,this.length=t.length}function A(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}T.prototype.feature=function(t){return new A(this.features[t],this.options.extent)},A.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],i=[],o=0;o<n.length;o++)i.push(new t.Point$1(n[o][0],n[o][1]));this.geometry.push(i)}return this.geometry},A.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,r,i]},A.prototype.toGeoJSON=C.prototype.toGeoJSON;var I=P,k=S;function P(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,O,t.layers[r])}(e,r),r.finish()}function O(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,R,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,N,o[r])}function R(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,D,t),e.writeVarintField(3,r.type),e.writeMessage(4,z,r)}function D(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=o[s];void 0===l&&(n.push(s),o[s]=l=n.length-1),e.writeVarint(l);var u=r.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(i.push(u),a[h]=p=i.length-1),e.writeVarint(p)}}function M(t,e){return(e<<3)+(7&t)}function L(t){return t<<1^t>>31}function z(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===n&&(u=l.length),e.writeVarint(M(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&e.writeVarint(M(2,c-1));var p=l[h].x-i,d=l[h].y-o;e.writeVarint(L(p)),e.writeVarint(L(d)),i+=p,o+=d}3===n&&e.writeVarint(M(7,1))}}function N(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function F(t,e,r,n){B(t,r,n),B(e,2*r,2*n),B(e,2*r+1,2*n+1)}function B(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function V(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}I.fromVectorTileJs=P,I.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new S(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return P({layers:r})},I.GeoJSONWrapper=k;var j=function(t){return t[0]},U=function(t){return t[1]},q=function(t,e,r,n,i){void 0===e&&(e=j),void 0===r&&(r=U),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=r(t[l]);!function t(e,r,n,i,o,a){if(!(o-i<=n)){var s=i+o>>1;!function t(e,r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=n-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,r,n,Math.max(i,Math.floor(n-l*c/s+h)),Math.min(o,Math.floor(n+(s-l)*c/s+h)),a)}var p=r[2*n+a],d=i,f=o;for(F(e,r,i,n),r[2*o+a]>p&&F(e,r,i,o);d<f;){for(F(e,r,d,f),d++,f--;r[2*d+a]<p;)d++;for(;r[2*f+a]>p;)f--}r[2*i+a]===p?F(e,r,i,f):F(e,r,++f,o),f<=n&&(i=f+1),n<=f&&(o=f-1)}}(e,r,s,i,o,a%2),t(e,r,n,i,s-1,a+1),t(e,r,n,s+1,o,a+1)}}(a,s,n,0,a.length-1,0)};q.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),p=u.pop(),d=u.pop();if(p-d<=a)for(var f=d;f<=p;f++)l=e[2*f+1],(s=e[2*f])>=r&&s<=i&&l>=n&&l<=o&&c.push(t[f]);else{var m=Math.floor((d+p)/2);l=e[2*m+1],(s=e[2*m])>=r&&s<=i&&l>=n&&l<=o&&c.push(t[m]);var y=(h+1)%2;(0===h?r<=s:n<=l)&&(u.push(d),u.push(m-1),u.push(y)),(0===h?i>=s:o>=l)&&(u.push(m+1),u.push(p),u.push(y))}}return c}(this.ids,this.coords,t,e,r,n,this.nodeSize)},q.prototype.within=function(t,e,r){return function(t,e,r,n,i,o){for(var a=[0,t.length-1,0],s=[],l=i*i;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)V(e[2*p],e[2*p+1],r,n)<=l&&s.push(t[p]);else{var d=Math.floor((h+c)/2),f=e[2*d],m=e[2*d+1];V(f,m,r,n)<=l&&s.push(t[d]);var y=(u+1)%2;(0===u?r-i<=f:n-i<=m)&&(a.push(h),a.push(d-1),a.push(y)),(0===u?r+i>=f:n+i>=m)&&(a.push(d+1),a.push(c),a.push(y))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var H={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},W=function(t){this.options=Y(Object.create(H),t),this.trees=new Array(this.options.maxZoom+1)};function G(t,e,r,n,i){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function Z(t,e){var r=t.geometry.coordinates,n=r[1];return{x:$(r[0]),y:X(n),zoom:1/0,index:e,parentId:-1}}function Q(t){return{type:"Feature",id:t.id,properties:K(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,n}function K(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return Y(Y({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function $(t){return t/360+.5}function X(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function Y(t,e){for(var r in e)t[r]=e[r];return t}function J(t){return t.x}function tt(t){return t.y}function et(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return(a=t-r)*a+(s=e-n)*s}function rt(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)nt(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)nt(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)nt(t,e[n][i])}(i),i}function nt(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function it(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)ot(i,s);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)ot(i[u],s);else if("LineString"===o)at(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)at(i[u],s=[],a,!1),t.push(rt(l,"LineString",s,e.properties));return}st(i,s,a,!1)}else if("Polygon"===o)st(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)it(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];st(i[u],c,a,!0),s.push(c)}}t.push(rt(l,o,s,e.properties))}}function ot(t,e){e.push(lt(t[0])),e.push(ut(t[1])),e.push(0)}function at(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var l=lt(t[s][0]),u=ut(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var c=e.length-3;e[2]=1,function t(e,r,n,i){for(var o,a=i,s=n-r>>1,l=n-r,u=e[r],c=e[r+1],h=e[n],p=e[n+1],d=r+3;d<n;d+=3){var f=et(e[d],e[d+1],u,c,h,p);if(f>a)o=d,a=f;else if(f===a){var m=Math.abs(d-s);m<l&&(o=d,l=m)}}a>i&&(o-r>3&&t(e,r,o,i),e[o+2]=a,n-o>3&&t(e,o,n,i))}(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function st(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];at(t[i],o,r,n),e.push(o)}}function lt(t){return t/360+.5}function ut(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function ct(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||o>=n)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,d=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(d>=r&&f<n)l.push(c);else if(!(f<r||d>=n)){var m=[];if("Point"===p||"MultiPoint"===p)ht(h,m,r,n,i);else if("LineString"===p)pt(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===p)ft(h,m,r,n,i,!1);else if("Polygon"===p)ft(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var y=0;y<h.length;y++){var g=[];ft(h[y],g,r,n,i,!0),g.length&&m.push(g)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(y=0;y<m.length;y++)l.push(rt(c.id,p,m[y],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(rt(c.id,p,m,c.tags))}}}return l.length?l:null}function ht(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function pt(t,e,r,n,i,o,a){for(var s,l,u=dt(t),c=0===i?yt:gt,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],y=t[p+3],g=t[p+4],_=0===i?d:f,v=0===i?y:g,b=!1;a&&(s=Math.sqrt(Math.pow(d-y,2)+Math.pow(f-g,2))),_<r?v>r&&(l=c(u,d,f,y,g,r),a&&(u.start=h+s*l)):_>n?v<n&&(l=c(u,d,f,y,g,n),a&&(u.start=h+s*l)):mt(u,d,f,m),v<r&&_>=r&&(l=c(u,d,f,y,g,r),b=!0),v>n&&_<=n&&(l=c(u,d,f,y,g,n),b=!0),!o&&b&&(a&&(u.end=h+s*l),e.push(u),u=dt(t)),a&&(h+=s)}var x=t.length-3;d=t[x],f=t[x+1],m=t[x+2],(_=0===i?d:f)>=r&&_<=n&&mt(u,d,f,m),x=u.length-3,o&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&mt(u,u[0],u[1],u[2]),u.length&&e.push(u)}function dt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ft(t,e,r,n,i,o){for(var a=0;a<t.length;a++)pt(t[a],e,r,n,i,o,!1)}function mt(t,e,r,n){t.push(e),t.push(r),t.push(n)}function yt(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function gt(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function _t(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=vt(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(vt(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(vt(o.geometry[s][u],e));i.push(l)}r.push(rt(o.id,a,i,o.tags))}return r}function vt(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function bt(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(xt(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var h=[];for(i=0;i<u[n].length;i+=2)h.push(xt(u[n][i],u[n][i+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function xt(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function wt(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Et(a,t[s],o,i);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function Et(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Ct(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)Ct(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)Ct(a,u[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function Ct(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function St(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)it(r,t.features[n],e,n);else it(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=ct(t,1,-1-r,r,0,-1,2,e),o=ct(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=ct(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=_t(i,1).concat(n)),o&&(n=n.concat(_t(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Tt(t,e,r){return 32*((1<<t)*r+e)+t}function At(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);var i=new E(n.features),o=I(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}W.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a="prepare "+t.length+" points";r&&console.time(a),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(Z(t[l],l));this.trees[i+1]=new q(s,J,tt,o,Float32Array),r&&console.timeEnd(a);for(var u=i;u>=n;u--){var c=+Date.now();s=this._cluster(s,u),this.trees[u]=new q(s,J,tt,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",u,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this},W.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=[],c=0,h=l.range($(r),X(o),$(i),X(n));c<h.length;c+=1){var p=l.points[h[c]];u.push(p.numPoints?Q(p):this.points[p.index])}return u},W.prototype.getChildren=function(t){var e=t>>5,r=t%32,n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],l=0,u=i.within(o.x,o.y,a);l<u.length;l+=1){var c=i.points[u[l]];c.parentId===t&&s.push(c.numPoints?Q(c):this.points[c.index])}if(0===s.length)throw new Error(n);return s},W.prototype.getLeaves=function(t,e,r){var n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n},W.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(r-a)/i,l=(r+1+a)/i,u={features:[]};return this._addTileFeatures(n.range((e-a)/i,s,(e+1+a)/i,l),n.points,e,r,i,u),0===e&&this._addTileFeatures(n.range(1-a/i,s,1,l),n.points,i,r,i,u),e===i-1&&this._addTileFeatures(n.range(0,s,a/i,l),n.points,-1,r,i,u),u.features.length?u:null},W.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},W.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?i+l.point_count<=n?i+=l.point_count:i=this._appendLeaves(t,l.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},W.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],u={type:1,geometry:[[Math.round(this.options.extent*(l.x*i-r)),Math.round(this.options.extent*(l.y*i-n))]],tags:l.numPoints?K(l):this.points[l.index].properties},c=l.numPoints?l.id:this.points[l.index].id;void 0!==c&&(u.id=c),o.features.push(u)}},W.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},W.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.reduce,o=n.radius/(n.extent*Math.pow(2,e)),a=0;a<t.length;a++){var s=t[a];if(!(s.zoom<=e)){s.zoom=e;for(var l=this.trees[e+1],u=l.within(s.x,s.y,o),c=s.numPoints||1,h=s.x*c,p=s.y*c,d=i?this._map(s,!0):null,f=(a<<5)+(e+1),m=0,y=u;m<y.length;m+=1){var g=l.points[y[m]];if(!(g.zoom<=e)){g.zoom=e;var _=g.numPoints||1;h+=g.x*_,p+=g.y*_,c+=_,g.parentId=f,i&&i(d,this._map(g))}}1===c?r.push(s):(s.parentId=f,r.push(G(h/c,p/c,f,c,d)))}}return r},W.prototype._map=function(t,e){if(t.numPoints)return e?Y({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?Y({},n):n},St.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},St.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Tt(e,r,n),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=wt(t,e,r,n,l),this.tileCoords.push({z:e,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,i){if(e===l.maxZoom||e===i)continue;var f=1<<i-e;if(r!==Math.floor(o/f)||n!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var m,y,g,_,v,b,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,C=1+x;m=y=g=_=null,v=ct(t,c,r-x,r+E,0,p.minX,p.maxX,l),b=ct(t,c,r+w,r+C,0,p.minX,p.maxX,l),t=null,v&&(m=ct(v,c,n-x,n+E,1,p.minY,p.maxY,l),y=ct(v,c,n+w,n+C,1,p.minY,p.maxY,l),v=null),b&&(g=ct(b,c,n-x,n+E,1,p.minY,p.maxY,l),_=ct(b,c,n+w,n+C,1,p.minY,p.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(y||[],e+1,2*r,2*n+1),s.push(g||[],e+1,2*r+1,2*n),s.push(_||[],e+1,2*r+1,2*n+1)}}},St.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=Tt(t,e=(e%a+a)%a,r);if(this.tiles[s])return bt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[Tt(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?bt(this.tiles[s],i):null):null};var It=function(e){function r(t,r,n){e.call(this,t,r,At),n&&(this.loadGeoJSON=n)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(n&&n.request&&n.request.collectResourceTiming)&&new l.Performance(n.request);this.loadGeoJSON(n,function(o,a){if(o||!a)return r(o);if("object"!=typeof a)return r(new Error("Input data is not a valid GeoJSON object."));!function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(_(t,r)),e;case"GeometryCollection":return e.geometries=e.geometries.map(_(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=v(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(_(v,e))),t}(e,r);default:return e}}(a,!0);try{e._geoJSONIndex=n.cluster?new W(function(e){var r=e.superclusterOptions,n=e.clusterProperties;if(!n||!r)return r;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(n),u=0,c=l;u<c.length;u+=1){var h=c[u],p=n[h],d=p[0],f=t.createExpression(p[1]),m=t.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);i[h]=f.value,o[h]=m.value}return r.map=function(t){s.properties=t;for(var e={},r=0,n=l;r<n.length;r+=1){var o=n[r];e[o]=i[o].evaluate(a,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,n=l;r<n.length;r+=1){var i=n[r];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},r}(n)).load(a.features):new St(a,n.geojsonVtOptions)}catch(o){return r(o)}e.loaded={};var s={};if(i){var l=i.finish();l&&(s.resourceTiming={},s.resourceTiming[n.source]=JSON.parse(JSON.stringify(l)))}r(null,s)})}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var n=this.loaded;return n&&n[t.uid]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},r.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},r.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},r}(h),kt=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:h,geojson:It},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return kt.prototype.setReferrer=function(t,e){this.referrer=e},kt.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},kt.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},kt.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},kt.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},kt.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},kt.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},kt.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},kt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},kt.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}},kt.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},kt.prototype.loadRTLTextPlugin=function(e,r,n){try{t.plugin.isLoaded()||(this.self.importScripts(r),n(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)))}catch(t){n(t.toString())}},kt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e},kt.prototype.getWorkerSource=function(t,e,r){var n=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r]||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:function(e,r,i){n.actor.send(e,r,i,t)}},this.getLayerIndex(t))),this.workerSources[t][e][r]},kt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new kt(t.window)),kt}),n(0,function(t){var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===r[t]&&(r[t]=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.probablySupportsContext?r.probablySupportsContext("webgl",n)||r.probablySupportsContext("experimental-webgl",n):r.supportsContext?r.supportsContext("webgl",n)||r.supportsContext("experimental-webgl",n):r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}(t)),r[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),r={create:function(e,r,n){var i=t.window.document.createElement(e);return r&&(i.className=r),n&&n.appendChild(i),i},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},n=t.window.document?t.window.document.documentElement.style:null;function i(t){if(!n)return null;for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){n&&a&&(o=n[a],n[a]="none")},r.enableDrag=function(){n&&a&&(n[a]=o)};var s=i(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var l=!1;try{var u=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",u,u),t.window.removeEventListener("test",u,u)}catch(t){l=!1}r.addEventListener=function(t,e,r,n){void 0===n&&(n={}),t.addEventListener(e,r,"passive"in n&&l?n:n.capture)},r.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),t.removeEventListener(e,r,"passive"in n&&l?n:n.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout(function(){t.window.removeEventListener("click",c,!0)},0)},r.mousePos=function(e,r){var n=e.getBoundingClientRect();return new t.Point((r=r.touches?r.touches[0]:r).clientX-n.left-e.clientLeft,r.clientY-n.top-e.clientTop)},r.touchPos=function(e,r){for(var n=e.getBoundingClientRect(),i=[],o="touchend"===r.type?r.changedTouches:r.touches,a=0;a<o.length;a++)i.push(new t.Point(o[a].clientX-n.left-e.clientLeft,o[a].clientY-n.top-e.clientTop));return i},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var n=r[e];this._notify(n.ids,n.callback)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this.images[t]=e},r.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var n=0,i=t;n<i.length;n+=1)this.images[i[n]]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?n[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,n)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],n=this.getImage(e);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{var i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},o=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var n=t.potpack(e),i=n.w,o=n.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var l=this.patterns[s].bin,u=l.x+1,c=l.y+1,h=this.images[s].data,p=h.width,d=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c},{width:p,height:d}),t.RGBAImage.copy(h,a,{x:0,y:d-1},{x:u,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c+d},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:u-1,y:c},{width:1,height:d}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u+p,y:c},{width:1,height:d})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var i=this.images[n];h(i)&&this.updateImage(n,i)}}},r}(t.Evented),d=m,f=1e20;function m(t,e,r,n,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function y(t,e,r,n,i,o,a){for(var s=0;s<e;s++){for(var l=0;l<r;l++)n[l]=t[l*e+s];for(g(n,i,o,a,r),l=0;l<r;l++)t[l*e+s]=i[l]}for(l=0;l<r;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(g(n,i,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(i[s])}}function g(t,e,r,n,i){r[0]=0,n[0]=-f,n[1]=+f;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);s<=n[a];)s=(t[o]+o*o-(t[r[--a]]+r[a]*r[a]))/(2*o-2*r[a]);r[++a]=o,n[a]=s,n[a+1]=+f}for(o=0,a=0;o<i;o++){for(;n[a+1]<o;)a++;e[o]=(o-r[a])*(o-r[a])+t[r[a]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var i=e.data[4*n+3]/255;this.gridOuter[n]=1===i?0:0===i?f:Math.pow(Math.max(0,.5-i),2),this.gridInner[n]=1===i?f:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++)r[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))));return r};var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,r){var n=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,function(t,e){var r=t.stack,i=t.id,o=n.entries[r];o||(o=n.entries[r]={glyphs:{},requests:{}});var a=o.glyphs[i];if(void 0===a)if(a=n._tinySDF(o,r,i))e(null,{stack:r,id:i,glyph:a});else{var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var l=o.requests[s];l||(l=o.requests[s]=[],_.loadGlyphRange(r,s,n.url,n.requestManager,function(t,e){if(e)for(var r in e)o.glyphs[+r]=e[+r];for(var n=0,i=l;n<i.length;n+=1)(0,i[n])(t,e);delete o.requests[s]})),l.push(function(t,n){t?e(t):n&&e(null,{stack:r,id:i,glyph:n[i]||null})})}}else e(null,{stack:r,id:i,glyph:a})},function(t,e){if(t)r(t);else if(e){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,l=a.id,u=a.glyph;(n[s]||(n[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}r(null,n)}})},_.prototype._tinySDF=function(e,r,n){var i=this.localIdeographFontFamily;if(i&&(t.isChar["CJK Unified Ideographs"](n)||t.isChar["Hangul Syllables"](n))){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(r)?a="900":/medium/i.test(r)?a="500":/light/i.test(r)&&(a="200"),o=e.tinySDF=new _.TinySDF(24,3,8,.25,i,a)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,r,n,i,o){var a=256*r,s=a+255,l=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,function(e,r){if(e)o(e);else if(r){for(var n={},i=0,a=t.parseGlyphPBF(r);i<a.length;i+=1){var s=a[i];n[s.id]=s}o(null,n)}})},_.TinySDF=d;var v=function(){this.specification=t.styleSpec.light.position};v.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},v.prototype.interpolate=function(e,r,n){return{x:t.number(e.x,r.x,n),y:t.number(e.y,r.y,n),z:t.number(e.z,r.z,n)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new v,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),x=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var n in e){var i=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),i):this._transitionable.setValue(n,i)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),w=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};w.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.positions[r]||(this.positions[r]=this.addDash(t,e)),this.positions[r]},w.prototype.addDash=function(e,r){var n=r?7:0,i=2*n+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];for(var s=this.width/o,l=s/2,u=e.length%2==1,c=-n;c<=n;c++)for(var h=this.width*(this.nextRow+n+c),p=u?-e[e.length-1]:0,d=e[0],f=1,m=0;m<this.width;m++){for(;d<m/s;)p=d,d+=e[f],u&&f===e.length-1&&(d+=e[0]),f++;var y=Math.abs(m-p*s),g=Math.abs(m-d*s),_=Math.min(y,g),v=f%2==1,b=void 0;if(r){var x=n?c/n*(l+1):0;if(v){var w=l-Math.abs(x);b=Math.sqrt(_*_+w*w)}else b=l-Math.sqrt(_*_+x*x)}else b=(v?1:-1)*_;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,b+128))}var E={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:o};return this.nextRow+=i,this.dirty=!0,E},w.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var E=function e(r,n){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],n,this.id);a.name="Worker "+o,this.actors.push(a)}};function C(e,r,n){var i=function(i,o){if(i)return n(i);if(o){var a=t.pick(o,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map(function(t){return t.id})),e.url&&(a.tiles=r.canonicalizeTileset(a,e.url)),n(null,a)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame(function(){return i(null,e)})}E.prototype.broadcast=function(e,r,n){t.asyncAll(this.actors,function(t,n){t.send(e,r,n)},n=n||function(){})},E.prototype.send=function(t,e,r,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,r),n},E.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var S=function(e,r,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=n||24};S.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},S.prototype.contains=function(e){var r=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=n&&e.x<o&&e.y>=i&&e.y<a};var T=function(e){function r(r,n,i,o){if(e.call(this),this.id=r,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,t.extend(this,t.pick(n,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,function(r,n){e._tileJSONRequest=null,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new S(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,null),i={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function o(t,n){return e.aborted?r(null):t&&404!==t.status?r(t):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",i,o.bind(this)):"loading"===e.state?e.reloadCallback=r:this.dispatcher.send("reloadTile",i,o.bind(this),e.workerID)},r.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),A=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,function(r,n){e._tileJSONRequest=null,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new S(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var n=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(o){n.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=n.map.painter.context,s=a.gl;e.texture=n.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",r(null)}})},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),I=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({},n),this.encoding=n.encoding||"mapbox"}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),(function(n,i){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(i){this.map._refreshExpiredTiles&&e.setExpiryData(i),delete i.cacheControl,delete i.expires;var o=t.browser.getImageData(i);e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",{uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding},(function(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}).bind(this)))}}).bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,o=0===r.x?e.wrap-1:e.wrap,a=(r.x+1+n)%n,s=r.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},r}(A),k=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=i,this.setEventedParent(o),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution);var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(n.clusterRadius||50)*a,log:!1},clusterProperties:n.clusterProperties},n.workerOptions)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(r){if(r)e.fire(new t.ErrorEvent(r));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}})},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)r.fire(new t.ErrorEvent(e));else{var n={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(n.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",n))}}),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e,this.workerID),this},r.prototype.getClusterChildren=function(t,e){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e,this.workerID),this},r.prototype.getClusterLeaves=function(t,e,r,n){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},n,this.workerID),this},r.prototype._updateWorkerData=function(e){var r=this,n=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this.workerID=this.dispatcher.send(this.type+".loadData",n,function(t,i){r._removed||i&&i.abandoned||(r._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[r.id]&&(r._resourceTiming=i.resourceTiming[r.id].slice(0)),r.dispatcher.send(r.type+".coalesce",{source:n.source},null,r.workerID),e(t))},this.workerID)},r.prototype.loadTile=function(e,r){var n=this,i=void 0===e.workerID?"loadTile":"reloadTile";e.workerID=this.dispatcher.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes},function(t,o){return e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(o,n.map.painter,"reloadTile"===i),r(null))},this.workerID)},r.prototype.abortTile=function(t){t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},r.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),P=function(e){function r(t,r,n,i){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(i),this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(e,r){var n=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),function(i,o){i?n.fire(new t.ErrorEvent(i)):o&&(n.image=o,e&&(n.coordinates=e),r&&r(),n._finishLoading())})},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,function(){e.texture=null}),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=e;var n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,n=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var l=s[a];r=Math.min(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),o=Math.max(o,l.y)}var u=Math.max(i-r,o-n),c=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((r+i)/2*h),Math.floor((n+o)/2*h))}(n),this.minzoom=this.maxzoom=this.tileID.z;var i=n.map(function(t){return r.tileID.getTilePoint(t)._round()});return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),O=function(e){function r(t,r,n,i){e.call(this,t,r,n,i),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this,r=this.options;this.urls=[];for(var n=0,i=r.urls;n<i.length;n+=1)this.urls.push(this.map._requestManager.transformRequest(i[n],t.ResourceType.Source).url);t.getVideo(this.urls,function(r,n){r?e.fire(new t.ErrorEvent(r)):n&&(e.video=n,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map.triggerRepaint()}),e.map&&e.video.play(),e._finishLoading())})},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(P),R=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,n=r.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,n.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(P),D={vector:T,raster:A,"raster-dem":I,geojson:k,video:O,image:P,canvas:R},M=function(e,r,n,i){var o=new D[r.type](e,r,n,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function L(e,r){var n=t.identity([]);return t.translate(n,n,[1,1,0]),t.scale(n,n,[.5*e.width,.5*e.height,1]),t.multiply(n,n,e.calculatePosMatrix(r.toUnwrapped()))}function z(t,e,r,n,i){var o=function(t,e,r){if(t)for(var n=0,i=t;n<i.length;n+=1){var o=e[i[n]];if(o&&o.source===r&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(n&&n.layers,e,t.id),a=i.maxPitchScaleFactor(),s=t.tilesIn(r,a,o);s.sort(N);for(var l=[],u=0,c=s;u<c.length;u+=1){var h=c[u];l.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,n,i,a,L(t.transform,h.tileID))})}var p=function(t){for(var e={},r={},n=0,i=t;n<i.length;n+=1){var o=i[n],a=o.queryResults,s=o.wrappedTileID,l=r[s]=r[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],d=0,f=c;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(l);for(var d in p)p[d].forEach(function(e){var r=e.feature,n=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=n});return p}function N(t,e){var r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}var F=function(t,e){this.max=t,this.onRemove=e,this.reset()};F.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var n=r[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},F.prototype.add=function(t,e,r){var n=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout(function(){n.remove(t,o)},r)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},F.prototype.has=function(t){return t.wrapped().key in this.data},F.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},F.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},F.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},F.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this},F.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var B=function(t,e,r){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};B.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},B.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},B.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},j=function(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}},j.prototype.setVertexAttribPointers=function(t,e,r){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[V[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var U=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};U.prototype.get=function(){return this.current},U.prototype.set=function(t){},U.prototype.getDefault=function(){return this.default},U.prototype.setDefault=function(){this.set(this.default)};var q=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(U),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(U),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(U),G=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(U),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(U),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(U),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(U),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(U),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(U),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(U),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(U),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(U),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(U),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(U),nt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(U),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(U),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(U),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(U),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(U),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(U),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(U),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(U),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(U),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(U),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(U),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(U),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(U),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(U),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(U),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(U),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(U),bt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(U),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),Et=function(t,e,r){this.context=t,this.width=e,this.height=r;var n=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new xt(t,n),this.depthAttachment=new wt(t,n)};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r),t.deleteFramebuffer(this.framebuffer)};var Ct=function(t,e,r){this.func=t,this.mask=e,this.range=r};Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);var St=function(t,e,r,n,i,o){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o};St.disabled=new St({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var At=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};At.disabled=new At(!1,1029,2305),At.backCCW=new At(!0,1029,2305);var It=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new q(this),this.clearDepth=new H(this),this.clearStencil=new W(this),this.colorMask=new G(this),this.depthMask=new Z(this),this.stencilMask=new Q(this),this.stencilFunc=new K(this),this.stencilOp=new $(this),this.stencilTest=new X(this),this.depthRange=new Y(this),this.depthTest=new J(this),this.depthFunc=new tt(this),this.blend=new et(this),this.blendFunc=new rt(this),this.blendColor=new nt(this),this.blendEquation=new it(this),this.cullFace=new ot(this),this.cullFaceSide=new at(this),this.frontFace=new st(this),this.program=new lt(this),this.activeTexture=new ut(this),this.viewport=new ct(this),this.bindFramebuffer=new ht(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new ft(this),this.bindElementBuffer=new mt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new vt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};It.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},It.prototype.createIndexBuffer=function(t,e){return new B(this,t,e)},It.prototype.createVertexBuffer=function(t,e,r){return new j(this,t,e,r)},It.prototype.createRenderbuffer=function(t,e,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i},It.prototype.createFramebuffer=function(t,e){return new Et(this,t,e)},It.prototype.clear=function(t){var e=t.color,r=t.depth,n=this.gl,i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),n.clear(i)},It.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},It.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},It.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},It.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},It.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var kt=function(e){function r(r,n,i){var o=this;e.call(this),this.id=r,this.dispatcher=i,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))}),this.on("error",function(){o._sourceErrored=!0}),this._source=M(r,n,i,this),this._tiles={},this._cache=new F(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(Pt)},r.prototype.getRenderableIds=function(e){var r=this,n=[];for(var i in this._tiles)this._isIdRenderable(+i,e)&&n.push(+i);return n.sort(e?function(e,n){var i=r._tiles[e].tileID,o=r._tiles[n].tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(r.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(r.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x}:Pt)},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){var i=this.getTileByID(n);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},r.prototype._retainLoadedChildren=function(t,e,r,n){for(var i in this._tiles){var o=this._tiles[i];if(!(n[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var l=a;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){n[a.key]=a;break}}}},r.prototype.findLoadedParent=function(t,e){for(var r=t.overscaledZ-1;r>=e;r--){var n=t.scaledTo(r);if(!n)return;var i=String(n.key),o=this._tiles[i];if(o&&o.hasData())return o;if(this._cache.has(n))return this._cache.get(n)}},r.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),r=Math.floor(5*e),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(n)},r.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},r.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter(function(t){return n._source.hasTile(t)}))):i=[];var o=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),a=Math.max(o-r.maxOverzooming,this._source.minzoom),s=Math.max(o+r.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(i,o);if(Ot(this._source.type)){for(var u={},c={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],f=l[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var y=this.findLoadedParent(f,a);y&&(this._addTile(y.tileID),u[y.tileID.key]=y.tileID),c[d]=f}}for(var g in this._retainLoadedChildren(c,o,s,l),u)l[g]||(this._coveredTiles[g]=!0,l[g]=u[g])}for(var _ in l)this._tiles[_].clearFadeHold();for(var v=0,b=t.keysDifference(this._tiles,l);v<b.length;v+=1){var x=b[v],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var n={},i={},o=Math.max(e-r.maxOverzooming,this._source.minzoom),a=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},l=0,u=t;l<u.length;l+=1){var c=u[l],h=this._addTile(c);n[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,n);for(var p=0,d=t;p<d.length;p+=1){var f=d[p],m=this._tiles[f.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var y=f.children(this._source.maxzoom)[0],g=this.getTile(y);if(g&&g.hasData()){n[y.key]=y;continue}}else{var _=f.children(this._source.maxzoom);if(n[_[0].key]&&n[_[1].key]&&n[_[2].key]&&n[_[3].key])continue}for(var v=m.wasRequested(),b=f.overscaledZ-1;b>=o;--b){var x=f.scaledTo(b);if(i[x.key])break;if(i[x.key]=!0,!(m=this.getTile(x))&&v&&(m=this._addTile(x)),m&&(n[x.key]=x,v=m.wasRequested(),m.hasData()))break}}}return n},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var n=Boolean(r);return n||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){r._reloadTile(t,"expired"),delete r._timers[t]},n))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,n){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=n?a.getCameraQueryGeometry(e):e,l=e.map(function(t){return a.pointCoordinate(t)}),u=s.map(function(t){return a.pointCoordinate(t)}),c=this.getIds(),h=1/0,p=1/0,d=-1/0,f=-1/0,m=0,y=u;m<y.length;m+=1){var g=y[m];h=Math.min(h,g.x),p=Math.min(p,g.y),d=Math.max(d,g.x),f=Math.max(f,g.y)}for(var _=function(e){var n=i._tiles[c[e]];if(!n.holdingForFade()){var s=n.tileID,m=Math.pow(2,a.zoom-n.tileID.overscaledZ),y=r*n.queryPadding*t.EXTENT/n.tileSize/m,g=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(d,f))];if(g[0].x-y<t.EXTENT&&g[0].y-y<t.EXTENT&&g[1].x+y>=0&&g[1].y+y>=0){var _=l.map(function(t){return s.getTilePoint(t)}),v=u.map(function(t){return s.getTilePoint(t)});o.push({tile:n,tileID:s,queryGeometry:_,cameraQueryGeometry:v,scale:m})}}},v=0;v<c.length;v++)_(v);return o},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map(function(t){return e._tiles[t].tileID}),n=0,i=r;n<i.length;n+=1){var o=i[n];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ot(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},r.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},r.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},r}(t.Evented);function Pt(t,e){return t%32-e%32||e-t}function Ot(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(Jn.workerUrl)}kt.maxOverzooming=10,kt.maxUnderzooming=3;var Dt=function(){this.active={}};Dt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},Dt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var Mt,Lt=Math.floor(t.browser.hardwareConcurrency/2);function zt(e,r){var n={};for(var i in e)"ref"!==i&&(n[i]=e[i]);return t.refProperties.forEach(function(t){t in r&&(n[t]=r[t])}),n}function Nt(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=zt(t[n],e[t[n].ref]));return t}Dt.workerCount=Math.max(Math.min(Lt,6),1);var Ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Bt(t,e,r){r.push({command:Ft.addSource,args:[t,e[t]]})}function Vt(t,e,r){e.push({command:Ft.removeSource,args:[t]}),r[t]=!0}function jt(t,e,r,n){Vt(t,r,n),Bt(t,e,r)}function Ut(e,r,n){var i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;return!0}function qt(e,r,n,i,o,a){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}))}function Ht(t){return t.id}function Wt(t,e){return t[e.id]=e,t}var Gt=function(t,e,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};Gt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Gt.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Gt.prototype.insertCircle=function(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)},Gt.prototype._insertBoxCell=function(t,e,r,n,i,o){this.boxCells[i].push(o)},Gt.prototype._insertCircleCell=function(t,e,r,n,i,o){this.circleCells[i].push(o)},Gt.prototype._query=function(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Gt.prototype._queryCircle=function(t,e,r,n,i){var o=t-r,a=t+r,s=e-r,l=e+r;if(a<0||o>this.width||l<0||s>this.height)return!n&&[];var u=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,u,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?u.length>0:u},Gt.prototype.query=function(t,e,r,n,i){return this._query(t,e,r,n,!1,i)},Gt.prototype.hitTest=function(t,e,r,n,i){return this._query(t,e,r,n,!0,i)},Gt.prototype.hitTestCircle=function(t,e,r,n){return this._queryCircle(t,e,r,!0,n)},Gt.prototype._queryCell=function(t,e,r,n,i,o,a,s){var l=a.seenUids,u=this.boxCells[i];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(t<=c[f+2]&&e<=c[f+3]&&r>=c[f+0]&&n>=c[f+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:c[f],y1:c[f+1],x2:c[f+2],y2:c[f+3]})}}}var m=this.circleCells[i];if(null!==m)for(var y=this.circles,g=0,_=m;g<_.length;g+=1){var v=_[g];if(!l.circle[v]){l.circle[v]=!0;var b=3*v;if(this._circleAndRectCollide(y[b],y[b+1],y[b+2],t,e,r,n)&&(!s||s(this.circleKeys[v]))){if(a.hitTest)return o.push(!0),!0;var x=y[b],w=y[b+1],E=y[b+2];o.push({key:this.circleKeys[v],x1:x-E,y1:w-E,x2:x+E,y2:w+E})}}}},Gt.prototype._queryCellCircle=function(t,e,r,n,i,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,d=c;p<d.length;p+=1){var f=d[p];if(!u.box[f]){u.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[f])))return o.push(!0),!0}}var y=this.circleCells[i];if(null!==y)for(var g=this.circles,_=0,v=y;_<v.length;_+=1){var b=v[_];if(!u.circle[b]){u.circle[b]=!0;var x=3*b;if(this._circlesCollide(g[x],g[x+1],g[x+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}},Gt.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++)if(i.call(this,t,e,r,n,this.xCellCount*d+p,o,a,s))return},Gt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Gt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Gt.prototype._circlesCollide=function(t,e,r,n,i,o){var a=n-t,s=i-e,l=r+o;return l*l>a*a+s*s},Gt.prototype._circleAndRectCollide=function(t,e,r,n,i,o,a){var s=(o-n)/2,l=Math.abs(t-(n+s));if(l>s+r)return!1;var u=(a-i)/2,c=Math.abs(e-(i+u));if(c>u+r)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=r*r};var Zt=t.properties.layout;function Qt(e,r,n,i,o){var a=t.create();return r?(t.scale(a,a,[1/o,1/o,1]),n||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Kt(e,r,n,i,o){if(r){var a=t.clone(e);return t.scale(a,a,[o,o,1]),n||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function $t(e,r){var n=[e.x,e.y,0,1];ae(n,n,r);var i=n[3];return{point:new t.Point(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function Xt(t,e){var r=t[0]/t[3],n=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&n>=-e[1]&&n<=e[1]}function Yt(e,r,n,i,o,a,s,l){var u=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(u,n.transform.zoom,Zt.properties[i?"text-size":"icon-size"]),h=[256/n.width*2+1,256/n.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,f=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,y=!1,g=0;g<f.length;g++){var _=f.get(g);if(_.hidden||_.writingMode===t.WritingMode.vertical&&!y)oe(_.numGlyphs,p);else{y=!1;var v=[_.anchorX,_.anchorY,0,1];if(t.transformMat4(v,v,r),Xt(v,h)){var b=.5+v[3]/n.transform.cameraToCenterDistance*.5,x=t.evaluateSizeForFeature(u,c,_),w=s?x*b:x/b,E=new t.Point(_.anchorX,_.anchorY),C=$t(E,o).point,S={},T=ee(_,w,!1,l,r,o,a,e.glyphOffsetArray,d,p,C,E,S,m);y=T.useVertical,(T.notEnoughRoom||y||T.needsFlipping&&ee(_,w,!0,l,r,o,a,e.glyphOffsetArray,d,p,C,E,S,m).notEnoughRoom)&&oe(_.numGlyphs,p)}else oe(_.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function Jt(t,e,r,n,i,o,a,s,l,u,c,h){var p=s.glyphStartIndex+s.numGlyphs,d=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(p-1),g=ne(t*m,r,n,i,o,a,s.segment,d,f,l,u,c,h);if(!g)return null;var _=ne(t*y,r,n,i,o,a,s.segment,d,f,l,u,c,h);return _?{first:g,last:_}:null}function te(e,r,n,i){return e===t.WritingMode.horizontal&&Math.abs(n.y-r.y)>Math.abs(n.x-r.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<n.y:r.x>n.x)?{needsFlipping:!0}:null}function ee(e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m,y=r/24,g=e.lineOffsetX*y,_=e.lineOffsetY*y;if(e.numGlyphs>1){var v=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=Jt(y,l,g,_,n,h,p,e,u,a,d,!1);if(!w)return{notEnoughRoom:!0};var E=$t(w.first.point,s).point,C=$t(w.last.point,s).point;if(i&&!n){var S=te(e.writingMode,E,C,f);if(S)return S}m=[w.first];for(var T=e.glyphStartIndex+1;T<v-1;T++)m.push(ne(y*l.getoffsetX(T),g,_,n,h,p,e.segment,b,x,u,a,d,!1));m.push(w.last)}else{if(i&&!n){var A=$t(p,o).point,I=e.lineStartIndex+e.segment+1,k=new t.Point(u.getx(I),u.gety(I)),P=$t(k,o),O=P.signedDistanceFromCamera>0?P.point:re(p,k,A,1,o),R=te(e.writingMode,A,O,f);if(R)return R}var D=ne(y*l.getoffsetX(e.glyphStartIndex),g,_,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,a,d,!1);if(!D)return{notEnoughRoom:!0};m=[D]}for(var M=0,L=m;M<L.length;M+=1){var z=L[M];t.addDynamicAttributes(c,z.point,z.angle)}return{}}function re(t,e,r,n,i){var o=$t(t.add(t.sub(e)._unit()),i).point,a=r.sub(o);return r.add(a._mult(n/a.mag()))}function ne(e,r,n,i,o,a,s,l,u,c,h,p,d){var f=i?e-r:e+r,m=f>0?1:-1,y=0;i&&(m*=-1,y=Math.PI),m<0&&(y+=Math.PI);for(var g=m>0?l+s:l+s+1,_=g,v=o,b=o,x=0,w=0,E=Math.abs(f);x+w<=E;){if((g+=m)<l||g>=u)return null;if(b=v,void 0===(v=p[g])){var C=new t.Point(c.getx(g),c.gety(g)),S=$t(C,h);if(S.signedDistanceFromCamera>0)v=p[g]=S.point;else{var T=g-m;v=re(0===x?a:new t.Point(c.getx(T),c.gety(T)),C,b,E-x+1,h)}}x+=w,w=b.dist(v)}var A=(E-x)/w,I=v.sub(b),k=I.mult(A)._add(b);return k._add(I._unit()._perp()._mult(n*m)),{point:k,angle:y+Math.atan2(v.y-b.y,v.x-b.x),tileDistance:d?{prevTileDistance:g-m===_?0:c.gettileUnitDistanceFromAnchor(g-m),lastSegmentViewportDistance:E-x}:null}}var ie=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oe(t,e){for(var r=0;r<t;r++){var n=e.length;e.resize(n+4),e.float32.set(ie,3*n)}}function ae(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}var se=function(t,e,r){void 0===e&&(e=new Gt(t.width+200,t.height+200,25)),void 0===r&&(r=new Gt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function le(t,e,r){t[e+4]=r?1:0}function ue(e,r,n){return r*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}se.prototype.placeCollisionBox=function(t,e,r,n,i){var o=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),a=r*o.perspectiveRatio,s=t.x1*a+o.point.x,l=t.y1*a+o.point.y,u=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,l,u,c)||!e&&this.grid.hitTest(s,l,u,c,i)?{box:[],offscreen:!1}:{box:[s,l,u,c],offscreen:this.isOffscreen(s,l,u,c)}},se.prototype.approximateTileDistance=function(t,e,r,n,i){var o=t.lastSegmentViewportDistance*r;return t.prevTileDistance+o+((i?1:n/this.pitchfactor)-1)*o*Math.abs(Math.sin(e))},se.prototype.placeCollisionCircles=function(e,r,n,i,o,a,s,l,u,c,h,p,d){var f=[],m=this.projectAnchor(u,o.anchorX,o.anchorY),y=l/24,g=o.lineOffsetX*l,_=o.lineOffsetY*l,v=new t.Point(o.anchorX,o.anchorY),b=Jt(y,s,g,_,!1,$t(v,c).point,v,o,a,c,{},!0),x=!1,w=!1,E=!0,C=m.perspectiveRatio*i,S=1/(i*n),T=0,A=0;b&&(T=this.approximateTileDistance(b.first.tileDistance,b.first.angle,S,m.cameraDistance,p),A=this.approximateTileDistance(b.last.tileDistance,b.last.angle,S,m.cameraDistance,p));for(var I=0;I<e.length;I+=5){var k=e[I],P=e[I+1],O=e[I+2],R=e[I+3];if(!b||R<-T||R>A)le(e,I,!1);else{var D=this.projectPoint(u,k,P),M=O*C;if(f.length>0){var L=D.x-f[f.length-4],z=D.y-f[f.length-3];if(M*M*2>L*L+z*z&&I+8<e.length){var N=e[I+8];if(N>-T&&N<A){le(e,I,!1);continue}}}f.push(D.x,D.y,M,I/5),le(e,I,!0);var F=D.x-M,B=D.y-M,V=D.x+M,j=D.y+M;if(E=E&&this.isOffscreen(F,B,V,j),w=w||this.isInsideGrid(F,B,V,j),!r&&this.grid.hitTestCircle(D.x,D.y,M,d)){if(!h)return{circles:[],offscreen:!1};x=!0}}}return{circles:x||!w?[]:f,offscreen:E}},se.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],n=1/0,i=1/0,o=-1/0,a=-1/0,s=0,l=e;s<l.length;s+=1){var u=l[s],c=new t.Point(u.x+100,u.y+100);n=Math.min(n,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),r.push(c)}for(var h={},p={},d=0,f=this.grid.query(n,i,o,a).concat(this.ignoredGrid.query(n,i,o,a));d<f.length;d+=1){var m=f[d],y=m.key;if(void 0===h[y.bucketInstanceId]&&(h[y.bucketInstanceId]={}),!h[y.bucketInstanceId][y.featureIndex]){var g=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(r,g)&&(h[y.bucketInstanceId][y.featureIndex]=!0,void 0===p[y.bucketInstanceId]&&(p[y.bucketInstanceId]=[]),p[y.bucketInstanceId].push(y.featureIndex))}}return p},se.prototype.insertCollisionBox=function(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])},se.prototype.insertCollisionCircles=function(t,e,r,n,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},se.prototype.projectAnchor=function(t,e,r){var n=[e,r,0,1];return ae(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},se.prototype.projectPoint=function(e,r,n){var i=[r,n,0,1];return ae(i,i,e),new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100)},se.prototype.projectAndGetPerspectiveRatio=function(e,r,n){var i=[r,n,0,1];return ae(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},se.prototype.isOffscreen=function(t,e,r,n){return r<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},se.prototype.isInsideGrid=function(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary};var ce=function(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var he=function(t,e,r,n,i){this.text=new ce(t?t.text:null,e,r,i),this.icon=new ce(t?t.icon:null,e,n,i)};he.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var pe=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},de=function(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i},fe=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function me(e,r,n,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*r,l=-(a.verticalAlign-.5)*n,u=t.evaluateRadialOffset(e,i);return new t.Point(s+u[0]*o,l+u[1]*o)}fe.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var ye=function(t,e,r,n){this.transform=t.clone(),this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new fe(r),this.prevPlacement=n,n&&(n.prevPlacement=void 0)};function ge(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}ye.prototype.placeLayerTile=function(e,r,n,i){var o=r.getBucket(e),a=r.latestFeatureIndex;if(o&&a&&e.id===o.layerIds[0]){var s=r.collisionBoxArray,l=o.layers[0].layout,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p=Qt(h,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,ue(r,1,this.transform.zoom)),d=Qt(h,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.transform,ue(r,1,this.transform.zoom));this.retainedQueryData[o.bucketInstanceId]=new de(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID),this.placeLayerBucket(o,h,p,d,u,c,n,r.holdingForFade(),i,s)}},ye.prototype.attemptAnchorPlacement=function(e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m,y=me(e,n,i,o,a),g=this.collisionIndex.placeCollisionBox(function(e,r,n,i,o,a){var s=e.x1,l=e.x2,u=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,d=new t.Point(y.x,y.y);return i&&d._rotate(o?a:-a),{x1:s+d.x,y1:u+d.y,x2:l+d.x,y2:c+d.y,anchorPointX:h,anchorPointY:p}}(r,0,0,s,l,this.transform.angle),p,u,c,h.predicate);if(g.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID].text&&(m=this.prevPlacement.variableOffsets[d.crossTileID].anchor),this.variableOffsets[d.crossTileID]={radialOffset:o,width:n,height:i,anchor:e,textBoxScale:a,prevAnchor:m},this.markUsedJustification(f,e,d),g},ye.prototype.placeLayerBucket=function(e,r,n,i,o,a,s,l,u,c){var h=e.layers[0].layout,p=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,t.properties.layout.properties["text-size"]),d=h.get("text-optional"),f=h.get("icon-optional"),m=h.get("text-allow-overlap"),y=h.get("icon-allow-overlap"),g=m&&(y||!e.hasIconData()||f),_=y&&(m||!e.hasTextData()||d),v=this.collisionGroups.get(e.sourceID),b="map"===h.get("text-rotation-alignment"),x="map"===h.get("text-pitch-alignment");!e.collisionArrays&&c&&e.deserializeCollisionBoxes(c);for(var w=0;w<e.symbolInstances.length;w++){var E=e.symbolInstances.get(w);if(!u[E.crossTileID]){if(l){this.placements[E.crossTileID]=new pe(!1,!1,!1);continue}var C=!1,S=!1,T=!0,A=null,I=null,k=null,P=0,O=0,R=e.collisionArrays[w];R.textFeatureIndex&&(P=R.textFeatureIndex);var D=R.textBox;if(D)if(h.get("text-variable-anchor")){var M=D.x2-D.x1,L=D.y2-D.y1,z=E.textBoxScale,N=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[E.crossTileID]){var F=this.prevPlacement.variableOffsets[E.crossTileID];N[0]!==F.anchor&&(N=N.filter(function(t){return t!==F.anchor})).unshift(F.anchor)}for(var B=0,V=N;B<V.length;B+=1)if(A=this.attemptAnchorPlacement(V[B],D,M,L,E.radialTextOffset,z,b,x,a,r,v,m,E,e)){C=!0;break}if(!this.variableOffsets[E.crossTileID]&&this.prevPlacement){var j=this.prevPlacement.variableOffsets[E.crossTileID];j&&(this.variableOffsets[E.crossTileID]=j,this.markUsedJustification(e,j.anchor,E))}}else C=(A=this.collisionIndex.placeCollisionBox(D,h.get("text-allow-overlap"),a,r,v.predicate)).box.length>0;T=A&&A.offscreen;var U=R.textCircles;if(U){var q=e.text.placedSymbolArray.get(E.centerJustifiedTextSymbolIndex),H=t.evaluateSizeForFeature(e.textSizeData,p,q);I=this.collisionIndex.placeCollisionCircles(U,h.get("text-allow-overlap"),o,a,q,e.lineVertexArray,e.glyphOffsetArray,H,r,n,s,x,v.predicate),C=h.get("text-allow-overlap")||I.circles.length>0,T=T&&I.offscreen}R.iconFeatureIndex&&(O=R.iconFeatureIndex),R.iconBox&&(S=(k=this.collisionIndex.placeCollisionBox(R.iconBox,h.get("icon-allow-overlap"),a,r,v.predicate)).box.length>0,T=T&&k.offscreen);var W=d||0===E.numHorizontalGlyphVertices&&0===E.numVerticalGlyphVertices,G=f||0===E.numIconVertices;W||G?G?W||(S=S&&C):C=S&&C:S=C=S&&C,C&&A&&this.collisionIndex.insertCollisionBox(A.box,h.get("text-ignore-placement"),e.bucketInstanceId,P,v.ID),S&&k&&this.collisionIndex.insertCollisionBox(k.box,h.get("icon-ignore-placement"),e.bucketInstanceId,O,v.ID),C&&I&&this.collisionIndex.insertCollisionCircles(I.circles,h.get("text-ignore-placement"),e.bucketInstanceId,P,v.ID),this.placements[E.crossTileID]=new pe(C||g,S||_,T||e.justReloaded),u[E.crossTileID]=!0}}e.justReloaded=!1},ye.prototype.markUsedJustification=function(e,r,n){var i={left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex},o=i[t.getAnchorJustification(r)];for(var a in i){var s=i[a];s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=o>=0&&s!==o?0:n.crossTileID)}},ye.prototype.commit=function(t){this.commitTime=t;var e=this.prevPlacement,r=!1,n=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,i=e?e.opacities:{},o=e?e.variableOffsets:{};for(var a in this.placements){var s=this.placements[a],l=i[a];l?(this.opacities[a]=new he(l,n,s.text,s.icon),r=r||s.text!==l.text.placed||s.icon!==l.icon.placed):(this.opacities[a]=new he(null,n,s.text,s.icon,s.skipFade),r=r||s.text||s.icon)}for(var u in i){var c=i[u];if(!this.opacities[u]){var h=new he(c,n,!1,!1);h.isHidden()||(this.opacities[u]=h,r=r||c.text.placed||c.icon.placed)}}for(var p in o)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=o[p]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},ye.prototype.updateLayerOpacities=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1){var o=i[n],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,r,o.collisionBoxArray)}},ye.prototype.updateBucketOpacities=function(e,r,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();var i=e.layers[0].layout,o=new he(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),s=i.get("icon-allow-overlap"),l=i.get("text-variable-anchor"),u="map"===i.get("text-rotation-alignment"),c="map"===i.get("text-pitch-alignment"),h=new he(null,0,a&&(s||!e.hasIconData()||i.get("icon-optional")),s&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasCollisionBoxData()||e.hasCollisionCircleData())&&e.deserializeCollisionBoxes(n);for(var p=0;p<e.symbolInstances.length;p++){var d=e.symbolInstances.get(p),f=d.numHorizontalGlyphVertices,m=d.numVerticalGlyphVertices,y=d.crossTileID,g=r[y],_=this.opacities[y];g?_=o:_||(this.opacities[y]=_=h),r[y]=!0;var v=d.numIconVertices>0;if(f>0||m>0){for(var b=Se(_.text),x=(f+m)/4,w=0;w<x;w++)e.text.opacityVertexArray.emplaceBack(b);var E=_.text.isHidden()?1:0;[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex].forEach(function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=E)});var C=this.variableOffsets[d.crossTileID];C&&this.markUsedJustification(e,C.anchor,d)}if(v){for(var S=Se(_.icon),T=0;T<d.numIconVertices/4;T++)e.icon.opacityVertexArray.emplaceBack(S);e.icon.placedSymbolArray.get(p).hidden=_.icon.isHidden()}if(e.hasCollisionBoxData()||e.hasCollisionCircleData()){var A=e.collisionArrays[p];if(A){if(A.textBox){var I=new t.Point(0,0),k=!0;if(l){var P=this.variableOffsets[y];P?(I=me(P.anchor,P.width,P.height,P.radialOffset,P.textBoxScale),u&&I._rotate(c?this.transform.angle:-this.transform.angle)):k=!1}ge(e.collisionBox.collisionVertexArray,_.text.placed,!k,I.x,I.y)}A.iconBox&&ge(e.collisionBox.collisionVertexArray,_.icon.placed,!1);var O=A.textCircles;if(O&&e.hasCollisionCircleData())for(var R=0;R<O.length;R+=5)ge(e.collisionCircle.collisionVertexArray,_.text.placed,g||0===O[R+4])}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray)},ye.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},ye.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},ye.prototype.stillRecent=function(t){return this.commitTime+this.fadeDuration>t},ye.prototype.setStale=function(){this.stale=!0};var _e=Math.pow(2,25),ve=Math.pow(2,24),be=Math.pow(2,17),xe=Math.pow(2,16),we=Math.pow(2,9),Ee=Math.pow(2,8),Ce=Math.pow(2,1);function Se(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*_e+e*ve+r*be+e*xe+r*we+e*Ee+r*Ce+e}var Te=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Te.prototype.continuePlacement=function(t,e,r,n,i){for(;this._currentTileIndex<t.length;)if(e.placeLayerTile(n,t[this._currentTileIndex],r,this._seenCrossTileIDs),this._currentTileIndex++,i())return!0};var Ae=function(t,e,r,n,i,o,a){this.placement=new ye(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1};Ae.prototype.isDone=function(){return this._done},Ae.prototype.continuePlacement=function(e,r,n){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new Te),this._inProgressLayer.continuePlacement(n[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ae.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Ie=512/t.EXTENT/2,ke=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var n=0;n<e.length;n++){var i=e.get(n),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};ke.prototype.getScaledCoordinates=function(e,r){var n=Ie/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*n)}},ke.prototype.findMatches=function(t,e,r){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),l=0,u=a;l<u.length;l+=1){var c=u[l];if(Math.abs(c.coord.x-s.x)<=n&&Math.abs(c.coord.y-s.y)<=n&&!r[c.crossTileID]){r[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Pe=function(){this.maxCrossTileID=0};Pe.prototype.generate=function(){return++this.maxCrossTileID};var Oe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Oe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var n=this.indexes[r],i={};for(var o in n){var a=n[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[r]=i}this.lng=t},Oe.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var l=a[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,i)}else{var u=a[t.scaledTo(Number(o)).key];u&&u.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ke(t,e.symbolInstances,e.bucketInstanceId),!0},Oe.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var n=0,i=e.indexedSymbolInstances[r];n<i.length;n+=1)delete this.usedCrossTileIDs[t][i[n].crossTileID]},Oe.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var n=this.indexes[r];for(var i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e};var Re=function(){this.layerIndexes={},this.crossTileIDs=new Pe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Re.prototype.addLayer=function(t,e,r){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new Oe);var i=!1,o={};n.handleWrapJump(r);for(var a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.getBucket(t);u&&t.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(l.tileID,u,this.crossTileIDs)&&(i=!0),o[u.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(i=!0),i},Re.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var De=function(e,r){return t.emitValidationErrors(e,r&&r.filter(function(t){return"source.canvas"!==t.identifier}))},Me=t.pick(Ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Le=t.pick(Ft,["setCenter","setZoom","setBearing","setPitch"]),ze=function(e){function r(n,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=n,this.dispatcher=new E((Mt||(Mt=new Dt),Mt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(n._requestManager,i.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Re,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=r.registerForPluginAvailability(function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),a.sourceCaches)a.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var n in o._layers){var i=o._layers[n];i.source===r.id&&o._validateLayer(i)}}}})}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadURL=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,function(e,r){n._request=null,e?n.fire(new t.ErrorEvent(e)):r&&n._load(r,i)})},r.prototype.loadJSON=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame(function(){n._request=null,n._load(e,!1!==r.validate)})},r.prototype._load=function(e,r){var n=this;if(!r||!De(this,t.validateStyle(e))){for(var i in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(i,e.sources[i],{validate:!1});e.sprite?this._spriteRequest=function(e,r,n){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),function(t,e){l=null,a||(a=t,i=e,c())}),u=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),function(t,e){u=null,a||(a=t,o=e,c())});function c(){if(a)n(a);else if(i&&o){var e=t.browser.getImageData(o),r={};for(var s in i){var l=i[s],u=l.width,c=l.height,h=l.x,p=l.y,d=l.sdf,f=l.pixelRatio,m=new t.RGBAImage({width:u,height:c});t.RGBAImage.copy(e,m,{x:h,y:p},{x:0,y:0},{width:u,height:c}),r[s]={data:m,pixelRatio:f,sdf:d}}n(null,r)}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(e.sprite,this.map._requestManager,function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n.fire(new t.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var o=Nt(this.stylesheet.layers);this._order=o.map(function(t){return t.id}),this._layers={};for(var a=0,s=o;a<s.length;a+=1){var l=s[a];(l=t.createStyleLayer(l)).setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=l}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var n=e.sourceLayer;if(n){var i=r.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=this._layers[n[r]];"custom"!==i.type&&e.push(i.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var n=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(n.length||i.length)&&this._updateWorkerLayers(n,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var l in this.sourceCaches)this.sourceCaches[l].used=!1;for(var u=0,c=this._order;u<c.length;u+=1){var h=this._layers[c[u]];h.recalculate(e),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),De(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Nt(e.layers);var n=function(e,r){if(!e)return[{command:Ft.setStyle,args:[r]}];var n=[];try{if(!t.deepEqual(e.version,r.version))return[{command:Ft.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||n.push({command:Ft.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||n.push({command:Ft.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||n.push({command:Ft.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||n.push({command:Ft.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||n.push({command:Ft.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||n.push({command:Ft.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||n.push({command:Ft.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||n.push({command:Ft.setLight,args:[r.light]});var i={},o=[];!function(e,r,n,i){var o;for(o in r=r||{},e=e||{})e.hasOwnProperty(o)&&(r.hasOwnProperty(o)||Vt(o,n,i));for(o in r)r.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],r[o])||("geojson"===e[o].type&&"geojson"===r[o].type&&Ut(e,r,o)?n.push({command:Ft.setGeoJSONSourceData,args:[o,r[o].data]}):jt(o,r,n,i)):Bt(o,r,n))}(e.sources,r.sources,o,i);var a=[];e.layers&&e.layers.forEach(function(t){i[t.source]?n.push({command:Ft.removeLayer,args:[t.id]}):a.push(t)}),n=n.concat(o),function(e,r,n){r=r||[];var i,o,a,s,l,u,c,h=(e=e||[]).map(Ht),p=r.map(Ht),d=e.reduce(Wt,{}),f=r.reduce(Wt,{}),m=h.slice(),y=Object.create(null);for(i=0,o=0;i<h.length;i++)f.hasOwnProperty(a=h[i])?o++:(n.push({command:Ft.removeLayer,args:[a]}),m.splice(m.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)m[m.length-1-i]!==(a=p[p.length-1-i])&&(d.hasOwnProperty(a)?(n.push({command:Ft.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-o),1)):o++,n.push({command:Ft.addLayer,args:[f[a],u=m[m.length-i]]}),m.splice(m.length-i,0,a),y[a]=!0);for(i=0;i<p.length;i++)if(s=d[a=p[i]],l=f[a],!y[a]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(c in qt(s.layout,l.layout,n,a,null,Ft.setLayoutProperty),qt(s.paint,l.paint,n,a,null,Ft.setPaintProperty),t.deepEqual(s.filter,l.filter)||n.push({command:Ft.setFilter,args:[a,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||n.push({command:Ft.setLayerZoomRange,args:[a,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],l[c],n,a,c.slice(6),Ft.setPaintProperty):t.deepEqual(s[c],l[c])||n.push({command:Ft.setLayerProperty,args:[a,c,l[c]]}));for(c in l)l.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],l[c],n,a,c.slice(6),Ft.setPaintProperty):t.deepEqual(s[c],l[c])||n.push({command:Ft.setLayerProperty,args:[a,c,l[c]]}))}else n.push({command:Ft.removeLayer,args:[a]}),u=m[m.lastIndexOf(a)+1],n.push({command:Ft.addLayer,args:[l,u]})}(a,r.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Ft.setStyle,args:[r]}]}return n}(this.serialize(),e).filter(function(t){return!(t.command in Le)});if(0===n.length)return!1;var i=n.filter(function(t){return!(t.command in Me)});if(i.length>0)throw new Error("Unimplemented: "+i.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)}),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,n){var i=this;if(void 0===n&&(n={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,n))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var o=this.sourceCaches[e]=new kt(e,r,this.dispatcher);o.style=this,o.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}}),o.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(De(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},n))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}var a=r?this._order.indexOf(r):this._order.length;if(r&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var n=this._order.indexOf(e);this._order.splice(n,1);var i=r?this._order.indexOf(r):this._order.length;r&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.setLayerZoomRange=function(e,r,n){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===r&&i.maxzoom===n||(null!=r&&(i.minzoom=r),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",r,null,n)||(i.filter=t.clone$1(r),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(r),n)||(o.setLayoutProperty(r,n,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var n=this.getLayer(e);if(n)return n.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(r),n)||(o.setPaintProperty(r,n,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=e.sourceLayer,o=this.sourceCaches[n],a=parseInt(e.id,10);if(void 0!==o){var s=o.getSource().type;"geojson"===s&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||i?isNaN(a)||a<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):o.setFeatureState(i,a,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=this.sourceCaches[n];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==o||a?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):i.removeFeatureState(a,s,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,n=e.sourceLayer,i=this.sourceCaches[r],o=parseInt(e.id,10);if(void 0!==i)if("vector"!==i.getSource().type||n){if(!(isNaN(o)||o<0))return i.getFeatureState(n,o);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},n={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(r(a)){n[a]=o;for(var s=0,l=t;s<l.length;s+=1){var u=l[s][a];if(u)for(var c=0,h=u;c<h.length;c+=1)i.push(h[c])}}}i.sort(function(t,e){return e.intersectionZ-t.intersectionZ});for(var p=[],d=this._order.length-1;d>=0;d--){var f=this._order[d];if(r(f))for(var m=i.length-1;m>=0;m--){var y=i[m].feature;if(n[y.layer.id]<d)break;p.push(y),i.pop()}else for(var g=0,_=t;g<_.length;g+=1){var v=_[g][f];if(v)for(var b=0,x=v;b<x.length;b+=1)p.push(x[b].feature)}}return p},r.prototype.queryRenderedFeatures=function(e,r,n){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter);var i={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=r.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[l.source]=!0}}var u=[];for(var c in this.sourceCaches)r.layers&&!i[c]||u.push(z(this.sourceCaches[c],this._layers,e,r,n));return this.placement&&u.push(function(t,e,r,n,i,o){for(var a={},s=i.queryRenderedSymbols(r),l=[],u=0,c=Object.keys(s).map(Number);u<c.length;u+=1)l.push(o[c[u]]);l.sort(N);for(var h=function(){var e=d[p],r=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,n.filter,n.layers,t);for(var i in r){var o=a[i]=a[i]||[],l=r[i];l.sort(function(t,r){var n=e.featureSortOrder;if(n){var i=n.indexOf(t.featureIndex);return n.indexOf(r.featureIndex)-i}return r.featureIndex-t.featureIndex});for(var u=0,c=l;u<c.length;u+=1)o.push(c[u])}},p=0,d=l;p<d.length;p+=1)h();var f=function(r){a[r].forEach(function(n){var i=n.feature,o=e[t[r].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o})};for(var m in a)f(m);return a}(this._layers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter);var n=this.sourceCaches[e];return n?function(t,e){for(var r=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],i={},o=0;o<r.length;o++){var a=r[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(n,e))}return n}(n,r):[]},r.prototype.addSourceType=function(t,e,n){return r.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var n=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],n[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(a)}},r.prototype._validate=function(e,r,n,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&De(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:n,styleSpec:t.styleSpec},i)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,n,i){for(var o=!1,a=!1,s={},l=0,u=this._order;l<u.length;l+=1){var c=this._layers[u[l]];if("symbol"===c.type){if(!s[c.source]){var h=this.sourceCaches[c.source];s[c.source]=h.getRenderableIds(!0).map(function(t){return h.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(c,s[c.source],e.center.lng);o=o||p}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var d=this._layerOrderChanged||0===n;if((d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now()))&&(this.pauseablePlacement=new Ae(e,this._order,d,r,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(var f=0,m=this._order;f<m.length;f+=1){var y=this._layers[m[f]];"symbol"===y.type&&this.placement.updateLayerOpacities(y,s[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,n){return t.makeRequest(r,n)},r}(t.Evented);ze.getSourceType=function(t){return D[t]},ze.setSourceType=function(t,e){D[t]=e},ze.registerForPluginAvailability=t.registerForPluginAvailability;var Ne=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),Fe=ur("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Be=ur("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ve=ur("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),je=ur("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ue=ur("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qe=ur("#pragma mapbox: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),He=ur("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),We=ur("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ge=ur("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Ze=ur("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Qe=ur("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=ur("#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_pos;void main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),$e=ur("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Xe=ur("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Ye=ur("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),Je=ur("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),tr=ur("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;return (data.r+data.g*256.0+data.b*256.0*256.0)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),er=ur("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),rr=ur("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),nr=ur("#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ir=ur("uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_gl_units_to_pixels;uniform mediump float u_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),or=ur("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),ar=ur("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),sr=ur("uniform sampler2D u_texture;\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;\n#pragma mapbox: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),lr=ur("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}");function ur(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n={};return{fragmentSource:t=t.replace(r,function(t,e,r,i,o){return n[o]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+r+" "+i+" "+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n"}),vertexSource:e=e.replace(r,function(t,e,r,i,o){var a="float"===i?"vec2":"vec4",s=o.match(/color/)?"color":a;return n[o]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+r+" "+a+" a_"+o+";\nvarying "+r+" "+i+" "+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = a_"+o+";\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+s+"(a_"+o+", a_"+o+"_t);\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+r+" "+a+" a_"+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = a_"+o+";\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = unpack_mix_"+s+"(a_"+o+", a_"+o+"_t);\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n"})}}var cr=Object.freeze({prelude:Fe,background:Be,backgroundPattern:Ve,circle:je,clippingMask:Ue,heatmap:qe,heatmapTexture:He,collisionBox:We,collisionCircle:Ge,debug:Ze,fill:Qe,fillOutline:Ke,fillOutlinePattern:$e,fillPattern:Xe,fillExtrusion:Ye,fillExtrusionPattern:Je,hillshadePrepare:tr,hillshade:er,line:rr,lineGradient:nr,linePattern:ir,lineSDF:or,raster:ar,symbolIcon:sr,symbolSDF:lr}),hr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};hr.prototype.bind=function(t,e,r,n,i,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!l&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,r,n,i,o,a,s)},hr.prototype.freshBind=function(t,e,r,n,i,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,d=r;p<d.length;p+=1)d[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var f=0,m=r;f<m.length;f+=1){var y=m[f];y.bind(),y.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),u.currentNumAttributes=l},hr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pr=function(e,r,n,i,o){var a=e.gl;this.program=a.createProgram();var s=n.defines().concat("#define DEVICE_PIXEL_RATIO "+t.browser.devicePixelRatio.toFixed(1));o&&s.push("#define OVERDRAW_INSPECTOR;");var l=s.concat(Fe.fragmentSource,r.fragmentSource).join("\n"),u=s.concat(Fe.vertexSource,r.vertexSource).join("\n"),c=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(c,l),a.compileShader(c),a.attachShader(this.program,c);var h=a.createShader(a.VERTEX_SHADER);a.shaderSource(h,u),a.compileShader(h),a.attachShader(this.program,h);for(var p=n.layoutAttributes||[],d=0;d<p.length;d++)a.bindAttribLocation(this.program,d,p[d].name);a.linkProgram(this.program),this.numAttributes=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES),this.attributes={};for(var f={},m=0;m<this.numAttributes;m++){var y=a.getActiveAttrib(this.program,m);y&&(this.attributes[y.name]=a.getAttribLocation(this.program,y.name))}for(var g=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS),_=0;_<g;_++){var v=a.getActiveUniform(this.program,_);v&&(f[v.name]=a.getUniformLocation(this.program,v.name))}this.fixedUniforms=i(e,f),this.binderUniforms=n.getUniforms(e,f)};function dr(e,r,n){var i=1/ue(n,1,r.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,r.transform.tileZoom)/o,s=a*(n.tileID.canonical.x+n.tileID.wrap*o),l=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l]}}pr.prototype.draw=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m){var y,g=t.gl;for(var _ in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[_].set(a[_]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var v=(y={},y[g.LINES]=2,y[g.TRIANGLES]=3,y[g.LINE_STRIP]=1,y)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new hr)).bind(t,this,l,d?d.getPaintVertexBuffers():[],u,w.vertexOffset,f,m),g.drawElements(e,w.primitiveLength*v,g.UNSIGNED_SHORT,w.primitiveOffset*v*2)}};var fr=function(e,r,n,i){var o=r.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(l,-r.transform.angle),t.transformMat3(s,s,l);var u=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i}},mr=function(e,r,n,i,o,a,s){return t.extend(fr(e,r,n,i),dr(a,r,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},yr=function(t){return{u_matrix:t}},gr=function(e,r,n,i){return t.extend(yr(e),dr(n,r,i))},_r=function(t,e){return{u_matrix:t,u_world:e}},vr=function(e,r,n,i,o){return t.extend(gr(e,r,n,i),{u_world:o})},br=function(t,e,r,n){var i,o,a=t.transform;if("map"===n.paint.get("circle-pitch-alignment")){var s=ue(r,1,a.zoom);i=!0,o=[s,s]}else i=!1,o=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,r,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+i,u_extrude_scale:o}},xr=function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},wr=function(t,e,r){var n=ue(r,1,e.zoom),i=Math.pow(2,e.zoom-r.tileID.overscaledZ),o=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*i),e.pixelsToGLUnits[1]/(n*i)],u_overscale_factor:o}},Er=function(t,e){return{u_matrix:t,u_color:e}},Cr=function(t){return{u_matrix:t}},Sr=function(t,e,r,n){return{u_matrix:t,u_extrude_scale:ue(e,1,r),u_intensity:n}},Tr=function(t,e,r){var n=r.paint.get("hillshade-shadow-color"),i=r.paint.get("hillshade-highlight-color"),o=r.paint.get("hillshade-accent-color"),a=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Ir(0,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:i,u_accent:o}},Ar=function(e,r){var n=e.dem.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.tileID.overscaledZ,u_maxzoom:r}};function Ir(e,r){var n=Math.pow(2,r.canonical.z),i=r.canonical.y;return[new t.MercatorCoordinate(0,i/n).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/n).toLngLat().lat]}var kr=function(t,e,r){var n=t.transform;return{u_matrix:Mr(t,e,r),u_ratio:1/ue(e,1,n.zoom),u_gl_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},Pr=function(e,r,n){return t.extend(kr(e,r,n),{u_image:0})},Or=function(e,r,n,i){var o=e.transform,a=Dr(r,o);return{u_matrix:Mr(e,r,n),u_texsize:r.imageAtlasTexture.size,u_ratio:1/ue(r,1,o.zoom),u_image:0,u_scale:[t.browser.devicePixelRatio,a,i.fromScale,i.toScale],u_fade:i.t,u_gl_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Rr=function(e,r,n,i,o){var a=e.lineAtlas,s=Dr(r,e.transform),l="round"===n.layout.get("line-cap"),u=a.getDash(i.from,l),c=a.getDash(i.to,l),h=u.width*o.fromScale,p=c.width*o.toScale;return t.extend(kr(e,r,n),{u_patternscale_a:[s/h,-u.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:c.y,u_mix:o.t})};function Dr(t,e){return 1/ue(t,1,e.tileZoom)}function Mr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var Lr=function(t,e,r,n,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:zr(i.paint.get("raster-hue-rotate"))};var o,a};function zr(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var Nr=function(t,e,r,n,i,o,a,s,l,u){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_gl_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+n,u_texsize:u,u_texture:0}},Fr=function(e,r,n,i,o,a,s,l,u,c,h){var p=o.transform;return t.extend(Nr(e,r,n,i,o,a,s,l,u,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_is_halo:+h})},Br=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},Vr=function(e,r,n,i,o,a){return t.extend(function(t,e,r,n){var i=r.imageManager.getPattern(t.from),o=r.imageManager.getPattern(t.to),a=r.imageManager.getPixelSize(),s=a.width,l=a.height,u=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/u,h=c*(n.tileID.canonical.x+n.tileID.wrap*u),p=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/ue(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,n,o),{u_matrix:e,u_opacity:r})},jr={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:xr,collisionCircle:xr,debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_maxzoom:new t.Uniform1f(e,r.u_maxzoom)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_image:new t.Uniform1i(e,r.u_image),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,r.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,r.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_is_halo:new t.Uniform1f(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}}};function Ur(e,r){for(var n=e.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),i=0;i<n.length;i++){var o={},a=n[i],s=n.slice(i+1);qr(a.tileID.wrapped(),a.tileID,s,new t.OverscaledTileID(0,a.tileID.wrap+1,0,0,0),o),a.setMask(o,r)}}function qr(e,r,n,i,o){for(var a=0;a<n.length;a++){var s=n[a];if(i.isLessThan(s.tileID))break;if(r.key===s.tileID.key)return;if(s.tileID.isChildOf(r)){for(var l=r.children(1/0),u=0;u<l.length;u++)qr(e,l[u],n.slice(a),i,o);return}}var c=r.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(c,r.canonical.x-(e.canonical.x<<c),r.canonical.y-(e.canonical.y<<c));o[h.key]=o[h.key]||h}function Hr(t,e,r,n,i){for(var o=t.context,a=o.gl,s=t.useProgram(i?"collisionCircle":"collisionBox"),l=0;l<n.length;l++){var u=n[l],c=e.getTile(u),h=c.getBucket(r);if(h){var p=i?h.collisionCircle:h.collisionBox;p&&s.draw(o,i?a.TRIANGLES:a.LINES,Ct.disabled,St.disabled,t.colorModeForRenderPass(),At.disabled,wr(u.posMatrix,t.transform,c),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,t.transform.zoom,null,null,p.collisionVertexBuffer)}}}var Wr=t.identity(new Float32Array(16)),Gr=t.properties.layout;function Zr(e,r,n,i,o,a){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*r,u=-(s.verticalAlign-.5)*n,c=t.evaluateRadialOffset(e,i);return new t.Point((l/o+c[0])*a,(u/o+c[1])*a)}function Qr(e,r,n,i,o,a,s,l,u,c){var h=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray;p.clear();for(var d=0;d<h.length;d++){var f=h.get(d),m=!f.hidden&&f.crossTileID?i[f.crossTileID]:null;if(m){var y=new t.Point(f.anchorX,f.anchorY),g=$t(y,n?l:s),_=.5+a.cameraToCenterDistance/g.signedDistanceFromCamera*.5,v=o.evaluateSizeForFeature(e.textSizeData,c,f)*_/t.ONE_EM;n&&(v*=e.tilePixelRatio/u);for(var b=Zr(m.anchor,m.width,m.height,m.radialOffset,m.textBoxScale,v),x=n?$t(y.add(b),s).point:g.point.add(r?b.rotate(-a.angle):b),w=0;w<f.numGlyphs;w++)t.addDynamicAttributes(p,x,0)}else oe(f.numGlyphs,p)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function Kr(e,r,n,i,o,a,s,l,u,c,h,p,d){for(var f,m,y=e.context,g=y.gl,_=e.transform,v="map"===l,b="map"===u,x=v&&"point"!==n.layout.get("symbol-placement"),w=v&&!b&&!x,E=void 0!==n.layout.get("symbol-sort-key").constantOr(1),C=e.depthModeForSublayer(0,Ct.ReadOnly),S=n.layout.get("text-variable-anchor"),T=[],A=0,I=i;A<I.length;A+=1){var k=I[A],P=r.getTile(k),O=P.getBucket(n);if(O){var R=o?O.text:O.icon;if(R&&R.segments.get().length){var D=R.programConfigurations.get(n.id),M=o||O.sdfIcons,L=o?O.textSizeData:O.iconSizeData;f||(f=e.useProgram(M?"symbolSDF":"symbolIcon",D),m=t.evaluateSizeForZoom(L,_.zoom,Gr.properties[o?"text-size":"icon-size"])),y.activeTexture.set(g.TEXTURE0);var z=void 0,N=void 0,F=void 0;if(o)N=P.glyphAtlasTexture,F=g.LINEAR,z=P.glyphAtlasTexture.size;else{var B=1!==n.layout.get("icon-size").constantOr(0)||O.iconsNeedLinear;N=P.imageAtlasTexture,F=M||e.options.rotating||e.options.zooming||B||b||0!==_.pitch?g.LINEAR:g.NEAREST,z=P.imageAtlasTexture.size}var V=ue(P,1,e.transform.zoom),j=Qt(k.posMatrix,b,v,e.transform,V),U=Kt(k.posMatrix,b,v,e.transform,V);if(x)Yt(O,k.posMatrix,e,o,j,U,b,c);else if(o&&m&&S){var q=Math.pow(2,_.zoom-P.tileID.overscaledZ);Qr(O,v,b,d,t.symbolSize,_,j,k.posMatrix,q,m)}var H=e.translatePosMatrix(k.posMatrix,P,a,s),W=x||o&&S?Wr:j,G=e.translatePosMatrix(U,P,a,s,!0),Z=M&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:f,buffers:R,uniformValues:M?Fr(L.functionType,m,w,b,e,H,W,G,o,z,!0):Nr(L.functionType,m,w,b,e,H,W,G,o,z),atlasTexture:N,atlasInterpolation:F,isSDF:M,hasHalo:Z};if(E)for(var K=0,$=R.segments.get();K<$.length;K+=1){var X=$[K];T.push({segments:new t.SegmentVector([X]),sortKey:X.sortKey,state:Q})}else T.push({segments:R.segments,sortKey:0,state:Q})}}}E&&T.sort(function(t,e){return t.sortKey-e.sortKey});for(var Y=0,J=T;Y<J.length;Y+=1){var tt=J[Y],et=tt.state;if(et.atlasTexture.bind(et.atlasInterpolation,g.CLAMP_TO_EDGE),et.isSDF){var rt=et.uniformValues;et.hasHalo&&(rt.u_is_halo=1,$r(et.buffers,tt.segments,n,e,et.program,C,h,p,rt)),rt.u_is_halo=0}$r(et.buffers,tt.segments,n,e,et.program,C,h,p,et.uniformValues)}}function $r(t,e,r,n,i,o,a,s,l){var u=n.context;i.draw(u,u.gl.TRIANGLES,o,a,s,At.disabled,l,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Xr(t,e,r,n,i,o,a){var s,l,u,c,h,p=t.context.gl,d=r.paint.get("fill-pattern"),f=d&&d.constantOr(1),m=r.getCrossfadeParameters();a?(l=f&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=f?"fillPattern":"fill",s=p.TRIANGLES);for(var y=0,g=n;y<g.length;y+=1){var _=g[y],v=e.getTile(_);if(!f||v.patternsLoaded()){var b=v.getBucket(r);if(b){var x=b.programConfigurations.get(r.id),w=t.useProgram(l,x);f&&(t.context.activeTexture.set(p.TEXTURE0),v.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),x.updatePatternPaintBuffers(m));var E=d.constantOr(null);if(E&&v.imageAtlas){var C=v.imageAtlas.patternPositions[E.to],S=v.imageAtlas.patternPositions[E.from];C&&S&&x.setConstantPatternPositions(C,S)}var T=t.translatePosMatrix(_.posMatrix,v,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){c=b.indexBuffer2,h=b.segments2;var A=[p.drawingBufferWidth,p.drawingBufferHeight];u="fillOutlinePattern"===l&&f?vr(T,t,m,v,A):_r(T,A)}else c=b.indexBuffer,h=b.segments,u=f?gr(T,t,m,v):yr(T);w.draw(t.context,s,i,t.stencilModeForClipping(_),o,At.disabled,u,r.id,b.layoutVertexBuffer,c,h,r.paint,t.transform.zoom,x)}}}}function Yr(t,e,r,n,i,o,a){for(var s=t.context,l=s.gl,u=r.paint.get("fill-extrusion-pattern"),c=u.constantOr(1),h=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),d=0,f=n;d<f.length;d+=1){var m=f[d],y=e.getTile(m),g=y.getBucket(r);if(g){var _=g.programConfigurations.get(r.id),v=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",_);c&&(t.context.activeTexture.set(l.TEXTURE0),y.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePatternPaintBuffers(h));var b=u.constantOr(null);if(b&&y.imageAtlas){var x=y.imageAtlas.patternPositions[b.to],w=y.imageAtlas.patternPositions[b.from];x&&w&&_.setConstantPatternPositions(x,w)}var E=t.translatePosMatrix(m.posMatrix,y,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),C=r.paint.get("fill-extrusion-vertical-gradient"),S=c?mr(E,t,C,p,m,h,y):fr(E,t,C,p);v.draw(s,s.gl.TRIANGLES,i,o,a,At.backCCW,S,r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,_)}}}function Jr(t,e,r,n,i,o){var a=t.context,s=a.gl,l=e.fbo;if(l){var u=t.useProgram("hillshade");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,l.colorAttachment.get());var c=Tr(t,e,r);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?u.draw(a,s.TRIANGLES,n,i,o,At.disabled,c,r.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):u.draw(a,s.TRIANGLES,n,i,o,At.disabled,c,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function tn(e,r,n,i,o,a,s){var l=e.context,u=l.gl;if(r.dem&&r.dem.data){var c=r.dem.dim,h=r.dem.stride,p=r.dem.getPixels();if(l.activeTexture.set(u.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(h),r.demTexture){var d=r.demTexture;d.update(p,{premultiply:!1}),d.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(l,p,u.RGBA,{premultiply:!1}),r.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);l.activeTexture.set(u.TEXTURE0);var f=r.fbo;if(!f){var m=new t.Texture(l,{width:c,height:c,data:null},u.RGBA);m.bind(u.LINEAR,u.CLAMP_TO_EDGE),(f=r.fbo=l.createFramebuffer(c,c)).colorAttachment.set(m.texture)}l.bindFramebuffer.set(f.framebuffer),l.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(l,u.TRIANGLES,o,a,s,At.disabled,Ar(r,i),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function en(e,r,n,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),l=(s-e.timeAdded)/a,u=r?(s-r.timeAdded)/a:-1,c=n.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=p&&e.refreshedUponExpiration?1:t.clamp(p?l:1-u,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}function rn(e,r,n){var i=e.context,o=i.gl,a=n.posMatrix,s=e.useProgram("debug"),l=Ct.disabled,u=St.disabled,c=e.colorModeForRenderPass(),h="$debug";s.draw(i,o.LINE_STRIP,l,u,c,At.disabled,Er(a,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);for(var p=r.getTileByID(n.key).latestRawTileData,d=Math.floor((p&&p.byteLength||0)/1024),f=function(t,e,r,n){n=n||1;var i,o,a,s,l,u,c,h,p=[];for(i=0,o=t.length;i<o;i++)if(l=nn[t[i]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)-1===l[1][a]&&-1===l[1][a+1]?h=null:(u=e+l[1][a]*n,c=200-l[1][a+1]*n,h&&p.push(h.x,h.y,u,c),h={x:u,y:c});e+=l[0]*n}return p}(n.toString()+" "+d+"kb",50,0,5),m=new t.StructArrayLayout2i4,y=new t.StructArrayLayout2ui4,g=0;g<f.length;g+=2)m.emplaceBack(f[g],f[g+1]),y.emplaceBack(g,g+1);for(var _=i.createVertexBuffer(m,Ne.members),v=i.createIndexBuffer(y),b=t.SegmentVector.simpleSegment(0,0,m.length/2,m.length/2),x=r.getTile(n).tileSize,w=t.EXTENT/(Math.pow(2,e.transform.zoom-n.overscaledZ)*x),E=[[-1,-1],[-1,1],[1,-1],[1,1]],C=0;C<E.length;C++){var S=E[C];s.draw(i,o.LINES,l,u,c,At.disabled,Er(t.translate([],a,[w*S[0],w*S[1],0]),t.Color.white),h,_,v,b)}s.draw(i,o.LINES,l,u,c,At.disabled,Er(a,t.Color.black),h,_,v,b)}var nn={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},on={symbol:function(t,e,r,n,i){if("translucent"===t.renderPass){var o=St.disabled,a=t.colorModeForRenderPass();0!==r.paint.get("icon-opacity").constantOr(1)&&Kr(t,e,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,a,i),0!==r.paint.get("text-opacity").constantOr(1)&&Kr(t,e,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,a,i),e.map.showCollisionBoxes&&function(t,e,r,n){Hr(t,e,r,n,!1),Hr(t,e,r,n,!0)}(t,e,r,n)}},circle:function(t,e,r,n){if("translucent"===t.renderPass){var i=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity");if(0!==i.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=t.context,l=s.gl,u=t.depthModeForSublayer(0,Ct.ReadOnly),c=St.disabled,h=t.colorModeForRenderPass(),p=0;p<n.length;p++){var d=n[p],f=e.getTile(d),m=f.getBucket(r);if(m){var y=m.programConfigurations.get(r.id);t.useProgram("circle",y).draw(s,l.TRIANGLES,u,c,h,At.disabled,br(t,d,f,r),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,t.transform.zoom,y)}}}},heatmap:function(e,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=e.depthModeForSublayer(0,Ct.ReadOnly),l=St.disabled,u=new Tt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,r,n,i){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r.width/4,r.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),i.colorAttachment.set(n),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,i.colorAttachment.setDirty(),t(e,r,n,i))}(t,e,o,i)}}(o,e,n),o.clear({color:t.Color.transparent});for(var c=0;c<i.length;c++){var h=i[c];if(!r.hasRenderableParent(h)){var p=r.getTile(h),d=p.getBucket(n);if(d){var f=d.programConfigurations.get(n.id);e.useProgram("heatmap",f).draw(o,a.TRIANGLES,s,l,u,At.disabled,Sr(h.posMatrix,p,e.transform.zoom,n.paint.get("heatmap-intensity")),n.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,f)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var n=e.context,i=n.gl,o=r.heatmapFbo;if(o){n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);var a=r.colorRampTexture;a||(a=r.colorRampTexture=new t.Texture(n,r.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,i.TRIANGLES,Ct.disabled,St.disabled,e.colorModeForRenderPass(),At.disabled,function(e,r,n,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")}}(e,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,n))},line:function(e,r,n,i){if("translucent"===e.renderPass){var o=n.paint.get("line-opacity"),a=n.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=e.depthModeForSublayer(0,Ct.ReadOnly),l=e.colorModeForRenderPass(),u=n.paint.get("line-dasharray"),c=n.paint.get("line-pattern"),h=c.constantOr(1),p=n.paint.get("line-gradient"),d=n.getCrossfadeParameters(),f=u?"lineSDF":h?"linePattern":p?"lineGradient":"line",m=e.context,y=m.gl,g=!0;if(p){m.activeTexture.set(y.TEXTURE0);var _=n.gradientTexture;if(!n.gradient)return;_||(_=n.gradientTexture=new t.Texture(m,n.gradient,y.RGBA)),_.bind(y.LINEAR,y.CLAMP_TO_EDGE)}for(var v=0,b=i;v<b.length;v+=1){var x=b[v],w=r.getTile(x);if(!h||w.patternsLoaded()){var E=w.getBucket(n);if(E){var C=E.programConfigurations.get(n.id),S=e.context.program.get(),T=e.useProgram(f,C),A=g||T.program!==S,I=c.constantOr(null);if(I&&w.imageAtlas){var k=w.imageAtlas.patternPositions[I.to],P=w.imageAtlas.patternPositions[I.from];k&&P&&C.setConstantPatternPositions(k,P)}var O=u?Rr(e,w,n,u,d):h?Or(e,w,n,d):p?Pr(e,w,n):kr(e,w,n);u&&(A||e.lineAtlas.dirty)?(m.activeTexture.set(y.TEXTURE0),e.lineAtlas.bind(m)):h&&(m.activeTexture.set(y.TEXTURE0),w.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),C.updatePatternPaintBuffers(d)),T.draw(m,y.TRIANGLES,s,e.stencilModeForClipping(x),l,At.disabled,O,n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,e.transform.zoom,C),g=!1}}}}}},fill:function(e,r,n,i){var o=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ct.ReadWrite:Ct.ReadOnly);Xr(e,r,n,i,c,s,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){var h=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);Xr(e,r,n,i,h,s,!0)}}},"fill-extrusion":function(t,e,r,n){var i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))Yr(t,e,r,n,o,St.disabled,Tt.disabled),Yr(t,e,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();Yr(t,e,r,n,o,St.disabled,a)}}},hillshade:function(t,e,r,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=e.getSource().maxzoom,a=t.depthModeForSublayer(0,Ct.ReadOnly),s=St.disabled,l=t.colorModeForRenderPass(),u=0,c=n;u<c.length;u+=1){var h=e.getTile(c[u]);h.needsHillshadePrepare&&"offscreen"===t.renderPass?tn(t,h,r,o,a,s,l):"translucent"===t.renderPass&&Jr(t,h,r,a,s,l)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,n){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity"))for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),l=St.disabled,u=t.colorModeForRenderPass(),c=n.length&&n[0].overscaledZ,h=!t.options.moving,p=0,d=n;p<d.length;p+=1){var f=d[p],m=t.depthModeForSublayer(f.overscaledZ-c,1===r.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,o.LESS),y=e.getTile(f),g=t.transform.calculatePosMatrix(f.toUnwrapped(),h);y.registerFadeDuration(r.paint.get("raster-fade-duration"));var _=e.findLoadedParent(f,0),v=en(y,_,e,r,t.transform),b=void 0,x=void 0,w="nearest"===r.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),y.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),_?(_.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),b=Math.pow(2,_.tileID.overscaledZ-y.tileID.overscaledZ),x=[y.tileID.canonical.x*b%1,y.tileID.canonical.y*b%1]):y.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var E=Lr(g,x||[0,0],b||1,v,r);a instanceof P?s.draw(i,o.TRIANGLES,m,l,u,At.disabled,E,r.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):y.maskedBoundsBuffer&&y.maskedIndexBuffer&&y.segments?s.draw(i,o.TRIANGLES,m,l,u,At.disabled,E,r.id,y.maskedBoundsBuffer,y.maskedIndexBuffer,y.segments,r.paint,t.transform.zoom):s.draw(i,o.TRIANGLES,m,l,u,At.disabled,E,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var n=r.paint.get("background-color"),i=r.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=r.paint.get("background-pattern");if(!t.isPatternMissing(u)){var c=u||1!==n.a||1!==i?"translucent":"opaque";if(t.renderPass===c){var h=St.disabled,p=t.depthModeForSublayer(0,"opaque"===c?Ct.ReadWrite:Ct.ReadOnly),d=t.colorModeForRenderPass(),f=t.useProgram(u?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:l});u&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var y=r.getCrossfadeParameters(),g=0,_=m;g<_.length;g+=1){var v=_[g],b=t.transform.calculatePosMatrix(v.toUnwrapped()),x=u?Vr(b,i,t,u,{tileID:v,tileSize:l},y):Br(b,i,n);f.draw(o,a.TRIANGLES,p,h,d,At.disabled,x,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var n=0;n<r.length;n++)rn(t,e,r[n])},custom:function(t,e,r){var n=t.context,i=r.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),o.call(i,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(St.disabled);var a="3d"===i.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);n.setDepthMode(a),i.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}},an=function(e,r){this.context=new It(e),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=kt.maxUnderzooming+kt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new Re};function sn(t,e){if(t.y>e.y){var r=t;t=e,e=r}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function ln(t,e,r,n,i){var o=Math.max(r,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=t.dx>0,h=e.dx<0,p=o;p<a;p++){var d=l*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,f=u*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;i(Math.floor(f),Math.ceil(d),p)}}function un(t,e,r,n,i,o){var a,s=sn(t,e),l=sn(e,r),u=sn(r,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>u.dy&&(a=s,s=u,u=a),l.dy>u.dy&&(a=l,l=u,u=a),s.dy&&ln(u,s,n,i,o),l.dy&&ln(u,l,n,i,o)}an.prototype.resize=function(e,r){var n=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,o=this.style._order;i<o.length;i+=1)this.style._layers[o[i]].resize();this.depthRbo&&(n.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},an.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,Ne.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,Ne.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,Ne.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var l=this.context.gl;this.stencilClearMode=new St({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},an.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=t.create();t.ortho(n,0,this.width,this.height,0,0,1),t.scale(n,n,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,Ct.disabled,this.stencilClearMode,Tt.disabled,At.disabled,Cr(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},an.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,n=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(Tt.disabled),r.setDepthMode(Ct.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(r,n.TRIANGLES,Ct.disabled,new St({func:n.ALWAYS,mask:0},l,255,n.KEEP,n.KEEP,n.REPLACE),Tt.disabled,At.disabled,Cr(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},an.prototype.stencilModeFor3D=function(){this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new St({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},an.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new St({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},an.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},an.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return Ct.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(r||this.context.gl.LEQUAL,e,[n,n])},an.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},an.prototype.render=function(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var n=this.style._order,i=this.style.sourceCaches;for(var o in i){var a=i[o];a.used&&a.prepare(this.context)}var s={},l={},u={};for(var c in i){var h=i[c];s[c]=h.getVisibleCoordinates(),l[c]=s[c].slice().reverse(),u[c]=h.getVisibleCoordinates(!0).reverse()}for(var p in i){var d=i[p],f=d.getSource();if("raster"===f.type||"raster-dem"===f.type){for(var m=[],y=0,g=s[p];y<g.length;y+=1)m.push(d.getTile(g[y]));Ur(m,this.context)}}this.opaquePassCutoff=1/0;for(var _=0;_<n.length;_++)if(this.style._layers[n[_]].is3D()){this.opaquePassCutoff=_;break}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var v=0,b=n;v<b.length;v+=1){var x=this.style._layers[b[v]];if(x.hasOffscreenPass()&&!x.isHidden(this.transform.zoom)){var w=l[x.source];("custom"===x.type||w.length)&&this.renderLayer(this,i[x.source],x,w)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){var E=this.style._layers[n[this.currentLayer]],C=i[E.source],S=s[E.source];this._renderTileClippingMasks(E,S),this.renderLayer(this,C,E,S)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var T=this.style._layers[n[this.currentLayer]],A=i[T.source],I=("symbol"===T.type?u:l)[T.source];this._renderTileClippingMasks(T,s[T.source]),this.renderLayer(this,A,T,I)}if(this.options.showTileBoundaries)for(var k in i){on.debug(this,i[k],s[k]);break}this.setCustomLayerDefaults()},an.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},an.prototype.renderLayer=function(t,e,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||n.length)&&(this.id=r.id,on[r.type](t,e,r,n,this.style.placement.variableOffsets))},an.prototype.translatePosMatrix=function(e,r,n,i,o){if(!n[0]&&!n[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),l=Math.cos(a);n=[n[0]*l-n[1]*s,n[0]*s+n[1]*l]}var u=[o?n[0]:ue(r,n[0],this.transform.zoom),o?n[1]:ue(r,n[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,u),c},an.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},an.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},an.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from),r=this.imageManager.getPattern(t.to);return!e||!r},an.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var r=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new pr(this.context,cr[t],e,jr[t],this._showOverdrawInspector)),this.cache[r]},an.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},an.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var cn=function(e,r,n){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===n||n,this._minZoom=e||0,this._maxZoom=r||22,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},hn={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};cn.prototype.clone=function(){var t=new cn(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},hn.minZoom.get=function(){return this._minZoom},hn.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},hn.maxZoom.get=function(){return this._maxZoom},hn.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},hn.renderWorldCopies.get=function(){return this._renderWorldCopies},hn.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},hn.worldSize.get=function(){return this.tileSize*this.scale},hn.centerPoint.get=function(){return this.size._div(2)},hn.size.get=function(){return new t.Point(this.width,this.height)},hn.bearing.get=function(){return-this.angle/Math.PI*180},hn.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},hn.pitch.get=function(){return this._pitch/Math.PI*180},hn.pitch.set=function(e){var r=t.clamp(e,0,60)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},hn.fov.get=function(){return this._fov/Math.PI*180},hn.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},hn.zoom.get=function(){return this._zoom},hn.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},hn.center.get=function(){return this._center},hn.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},cn.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},cn.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(n.x,i.x,o.x,a.x)),l=Math.floor(Math.max(n.x,i.x,o.x,a.x)),u=s-1;u<=l+1;u++)0!==u&&r.push(new t.UnwrappedTileID(u,e));return r},cn.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),n=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,r),a=new t.Point(o*i.x-.5,o*i.y-.5);return function(e,r,n,i){void 0===i&&(i=!0);var o=1<<e,a={};function s(r,s,l){var u,c,h;if(l>=0&&l<=o)for(u=r;u<s;u++)0!==(c=Math.floor(u/o))&&!0!==i||(h=new t.OverscaledTileID(n,c,e,(u%o+o)%o,l),a[h.key]=h)}var l=r.map(function(e){return new t.Point(e.x,e.y)._mult(o)});return un(l[0],l[1],l[2],0,o,s),un(l[2],l[3],l[0],0,o,s),Object.keys(a).map(function(t){return a[t]})}(r,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?n:r,this._renderWorldCopies).sort(function(t,e){return a.dist(t.canonical)-a.dist(e.canonical)})},cn.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},hn.unmodified.get=function(){return this._unmodified},cn.prototype.zoomScale=function(t){return Math.pow(2,t)},cn.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},cn.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},cn.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},hn.point.get=function(){return this.project(this.center)},cn.prototype.setLocationAtPoint=function(e,r){var n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(n.x-i.x),o.y-(n.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},cn.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},cn.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},cn.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},cn.prototype.coordinateLocation=function(t){return t.toLngLat()},cn.prototype.pointCoordinate=function(e){var r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse);var i=r[3],o=n[3],a=r[1]/i,s=n[1]/o,l=r[2]/i,u=n[2]/o,c=l===u?0:(0-l)/(u-l);return new t.MercatorCoordinate(t.number(r[0]/i,n[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},cn.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},cn.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},cn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},cn.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},cn.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var n=e.key,i=r?this._alignedPosMatrixCache:this._posMatrixCache;if(i[n])return i[n];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*a,o.y*a,0]),t.scale(l,l,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(l,r?this.alignedProjMatrix:this.projMatrix,l),i[n]=new Float32Array(l),i[n]},cn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},cn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,n,i,o=-90,a=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<u.y?u.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,r=(l=t.mercatorXfromLng(p[1])*this.worldSize)-s<u.x?u.x/(l-s):0}var d=this.point,f=Math.max(r||0,e||0);if(f)return this.center=this.unproject(new t.Point(r?(l+s)/2:d.x,e?(a+o)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=d.y,y=u.y/2;m-y<o&&(i=o+y),m+y>a&&(i=a-y)}if(this.lngRange){var g=d.x,_=u.x/2;g-_<s&&(n=s+_),g+_>l&&(n=l-_)}void 0===n&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==n?n:d.x,void 0!==i?i:d.y))),this._unmodified=c,this._constraining=!1}},cn.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,r=Math.PI/2+this._pitch,n=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-r-e),i=this.point,o=i.x,a=i.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),l=new Float64Array(16);t.perspective(l,this._fov,this.width/this.height,1,s),t.scale(l,l,[1,-1,1]),t.translate(l,l,[0,0,-this.cameraToCenterDistance]),t.rotateX(l,l,this._pitch),t.rotateZ(l,l,this.angle),t.translate(l,l,[-o,-a,0]),this.mercatorMatrix=t.scale([],l,[this.worldSize,this.worldSize,this.worldSize]),t.scale(l,l,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=l;var u=this.width%2/2,c=this.height%2/2,h=Math.cos(this.angle),p=Math.sin(this.angle),d=o-Math.round(o)+h*u+p*c,f=a-Math.round(a)+h*c+p*u,m=new Float64Array(l);if(t.translate(m,m,[d>.5?d-1:d,f>.5?f-1:f,0]),this.alignedProjMatrix=m,l=t.create(),t.scale(l,l,[this.width/2,-this.height/2,1]),t.translate(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=t.create(),t.scale(l,l,[1,-1,1]),t.translate(l,l,[-1,-1,0]),t.scale(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}},cn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},cn.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},cn.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var n=r.x,i=r.y,o=r.x,a=r.y,s=0,l=e;s<l.length;s+=1){var u=l[s];n=Math.min(n,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}return[new t.Point(n,i),new t.Point(o,i),new t.Point(o,a),new t.Point(n,a),new t.Point(n,i)]},Object.defineProperties(cn.prototype,hn);var pn=function(){var e,r,n,i;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),r=!1,n=0,i=function(){n=0,r&&(e(),n=setTimeout(i,300),r=!1)},function(){return r=!0,n||i(),n})};pn.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},pn.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},pn.prototype.getHashString=function(t){var e=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this._map.getBearing(),l=this._map.getPitch(),u="";return u+=t?"#/"+o+"/"+a+"/"+r:"#"+r+"/"+a+"/"+o,(s||l)&&(u+="/"+Math.round(10*s)/10),l&&(u+="/"+Math.round(l)),u},pn.prototype._onHashChange=function(){var e=t.window.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},pn.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var dn=function(e){function n(n,i,o,a){void 0===a&&(a={});var s=r.mousePos(i.getCanvasContainer(),o),l=i.unproject(s);e.call(this,n,t.extend({point:s,lngLat:l,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),fn=function(e){function n(n,i,o){var a=r.touchPos(i.getCanvasContainer(),o),s=a.map(function(t){return i.unproject(t)}),l=a.reduce(function(t,e,r,n){return t.add(e.div(n.length))},new t.Point(0,0)),u=i.unproject(l);e.call(this,n,{points:a,point:l,lngLats:s,lngLat:u,originalEvent:o}),this._defaultPrevented=!1}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),mn=function(t){function e(e,r,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),yn=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};yn.prototype.isEnabled=function(){return!!this._enabled},yn.prototype.isActive=function(){return!!this._active},yn.prototype.isZooming=function(){return!!this._zooming},yn.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},yn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},yn.prototype.onWheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=t.browser.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this.isActive()||this._start(e)),e.preventDefault()}},yn.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},yn.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var n=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},yn.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var r=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a="number"==typeof this._targetZoom?this._targetZoom:r.zoom,s=this._startZoom,l=this._easing,u=!1;if("wheel"===this._type&&s&&l){var c=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=l(c);r.zoom=t.number(s,a,h),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):u=!0}else r.zoom=a,u=!0;r.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),u&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom},200))}},yn.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var n=this._prevEase,i=(t.browser.now()-n.start)/n.duration,o=n.easing(i+.01)-n.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);r=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r};var gn=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};gn.prototype.isEnabled=function(){return!!this._enabled},gn.prototype.isActive=function(){return!!this._active},gn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},gn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gn.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),r.disableDrag(),this._startPos=this._lastPos=r.mousePos(this._el,e),this._active=!0)},gn.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var n=this._startPos;this._lastPos=e,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var i=Math.min(n.x,e.x),o=Math.max(n.x,e.x),a=Math.min(n.y,e.y),s=Math.max(n.y,e.y);r.setTransform(this._box,"translate("+i+"px,"+a+"px)"),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"}},gn.prototype._onMouseUp=function(e){if(0===e.button){var n=this._startPos,i=r.mousePos(this._el,e);this._finish(),r.suppressClick(),n.x===i.x&&n.y===i.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},gn.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},gn.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},gn.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var _n=t.bezier(0,0,.25,1),vn=function(e,r){this._map=e,this._el=r.element||e.getCanvasContainer(),this._state="disabled",this._button=r.button||"right",this._bearingSnap=r.bearingSnap||0,this._pitchWithRotate=!1!==r.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};vn.prototype.isEnabled=function(){return"disabled"!==this._state},vn.prototype.isActive=function(){return"active"===this._state},vn.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},vn.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},vn.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=r.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==r.mouseButton(e))return;this._eventButton=0}r.disableDrag(),t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._lastPos=r.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},vn.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},vn.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var r=this._map.transform,n=this._startPos,i=this._lastPos,o=r.bearing-.8*(n.x-i.x),a=r.pitch- -.5*(n.y-i.y),s=this._inertia,l=s[s.length-1];this._drainInertiaBuffer(),s.push([t.browser.now(),this._map._normalizeBearing(o,l[1])]),r.bearing=o,this._pitchWithRotate&&(this._fireEvent("pitch",e),r.pitch=a),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._startPos=this._lastPos}},vn.prototype._onMouseUp=function(t){if(r.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},vn.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},vn.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),r.enableDrag()},vn.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos},vn.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var r=this._map,n=r.getBearing(),i=this._inertia,o=function(){Math.abs(n)<e._bearingSnap?r.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(i.length<2)o();else{var a=i[0],s=i[i.length-1],l=r._normalizeBearing(n,i[i.length-2][1]),u=s[1]-a[1],c=u<0?-1:1,h=(s[0]-a[0])/1e3;if(0!==u&&0!==h){var p=Math.abs(u*(.25/h));p>180&&(p=180);var d=p/180;l+=c*p*(d/2),Math.abs(r._normalizeBearing(l,0))<this._bearingSnap&&(l=r._normalizeBearing(0,l)),r.rotateTo(l,{duration:1e3*d,easing:_n,noMoveStart:!0},{originalEvent:t})}else o()}},vn.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},vn.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var bn=t.bezier(0,0,.3,1),xn=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};xn.prototype.isEnabled=function(){return"disabled"!==this._state},xn.prototype.isActive=function(){return"active"===this._state},xn.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},xn.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},xn.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==r.mouseButton(e)||(r.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},xn.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(r.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},xn.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=r.mousePos(this._el,e),this._inertia=[[t.browser.now(),this._startPos]]},xn.prototype._onMove=function(e){e.preventDefault();var n=r.mousePos(this._el,e);this._lastPos.equals(n)||"pending"===this._state&&n.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=n,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},xn.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._startPos=this._lastPos,delete this._lastMoveEvent}},xn.prototype._onMouseUp=function(t){if(0===r.mouseButton(t))switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},xn.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},xn.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},xn.prototype._unbind=function(){r.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onTouchEnd),r.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.removeEventListener(t.window.document,"mouseup",this._onMouseUp),r.removeEventListener(t.window,"blur",this._onBlur)},xn.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos},xn.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var r=e[e.length-1],n=e[0],i=r[1].sub(n[1]),o=(r[0]-n[0])/1e3;if(0===o||r[1].equals(n[1]))this._fireEvent("moveend",t);else{var a=i.mult(.3/o),s=a.mag();s>1400&&(s=1400,a._unit()._mult(s));var l=s/750,u=a.mult(-l/2);this._map.panBy(u,{duration:1e3*l,easing:bn,noMoveStart:!0},{originalEvent:t})}}},xn.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},xn.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var wn=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function En(t){return t*(2-t)}wn.prototype.isEnabled=function(){return!!this._enabled},wn.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},wn.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},wn.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,r=0,n=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),l={duration:300,delayEndEvents:500,easing:En,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*r,pitch:a.getPitch()+10*n,offset:[100*-i,100*-o],center:a.getCenter()};a.easeTo(l,{originalEvent:t})}};var Cn=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};Cn.prototype.isEnabled=function(){return!!this._enabled},Cn.prototype.isActive=function(){return!!this._active},Cn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Cn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Cn.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null},300)))},Cn.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Cn.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Cn.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Sn=t.bezier(0,0,.15,1),Tn=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Tn.prototype.isEnabled=function(){return!!this._enabled},Tn.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Tn.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Tn.prototype.disableRotation=function(){this._rotationDisabled=!0},Tn.prototype.enableRotation=function(){this._rotationDisabled=!1},Tn.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var n=r.mousePos(this._el,e.touches[0]),i=r.mousePos(this._el,e.touches[1]),o=n.add(i).div(2);this._startVec=n.sub(i),this._startAround=this._map.transform.pointLocation(o),this._gestureIntent=void 0,this._inertia=[],r.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.addEventListener(t.window.document,"touchend",this._onEnd)}},Tn.prototype._getTouchEventData=function(t){var e=r.mousePos(this._el,t.touches[0]),n=r.mousePos(this._el,t.touches[1]),i=e.sub(n);return{vec:i,center:e.add(n).div(2),scale:i.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*i.angleWith(this._startVec)/Math.PI}},Tn.prototype._onMove=function(e){if(2===e.touches.length){var r=this._getTouchEventData(e),n=r.vec,i=r.scale,o=r.bearing;if(!this._gestureIntent){var a=this._rotationDisabled&&1!==i||Math.abs(1-i)>.15;Math.abs(o)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=n)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Tn.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var r=this._map.transform;this._startScale||(this._startScale=r.scale,this._startBearing=r.bearing);var n=this._getTouchEventData(this._lastTouchEvent),i=n.center,o=n.bearing,a=n.scale,s=r.pointLocation(i),l=r.locationPoint(s);"rotate"===e&&(r.bearing=this._startBearing+o),r.zoom=r.scaleZoom(this._startScale*a),r.setLocationAtPoint(this._startAround,l),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),a,i])}},Tn.prototype._onEnd=function(e){r.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onEnd);var n=this._gestureIntent,i=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,n){this._map.fire(new t.Event(n+"end",{originalEvent:e})),this._drainInertiaBuffer();var o=this._inertia,a=this._map;if(o.length<2)a.snapToNorth({},{originalEvent:e});else{var s=o[o.length-1],l=o[0],u=a.transform.scaleZoom(i*s[1]),c=a.transform.scaleZoom(i*l[1]),h=(s[0]-l[0])/1e3,p=s[2];if(0!==h&&u!==c){var d=.15*(u-c)/h;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var f=1e3*Math.abs(d/(12*.15)),m=u+d*f/2e3;m<0&&(m=0),a.easeTo({zoom:m,duration:f,easing:Sn,around:this._aroundCenter?a.getCenter():a.unproject(p),noMoveStart:!0},{originalEvent:e})}else a.snapToNorth({},{originalEvent:e})}}},Tn.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>2&&r-e[0][0]>160;)e.shift()};var An={scrollZoom:yn,boxZoom:gn,dragRotate:vn,dragPan:xn,keyboard:wn,doubleClickZoom:Cn,touchZoomRotate:Tn},In=function(e){function r(r,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,n){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),n)},r.prototype.panTo=function(e,r,n){return this.easeTo(t.extend({center:e},r),n)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,n){return this.easeTo(t.extend({zoom:e},r),n)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.rotateTo=function(e,r,n){return this.easeTo(t.extend({bearing:e},r),n)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,r)},r.prototype._cameraForBoxAndBearing=function(e,r,n,i){if("number"==typeof(i=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}if(t.deepEqual(Object.keys(i.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){var a=this.transform,s=a.project(t.LngLat.convert(e)),l=a.project(t.LngLat.convert(r)),u=s.rotate(-n*Math.PI/180),c=l.rotate(-n*Math.PI/180),h=new t.Point(Math.max(u.x,c.x),Math.max(u.y,c.y)),p=new t.Point(Math.min(u.x,c.x),Math.min(u.y,c.y)),d=h.sub(p),f=(a.width-i.padding.left-i.padding.right)/d.x,m=(a.height-i.padding.top-i.padding.bottom)/d.y;if(!(m<0||f<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(f,m)),i.maxZoom),g=t.Point.convert(i.offset),_=new t.Point(g.x+(i.padding.left-i.padding.right)/2,g.y+(i.padding.top-i.padding.bottom)/2).mult(a.scale/a.zoomScale(y));return{center:a.unproject(s.add(l).div(2).sub(_)),zoom:y,bearing:n}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,n,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),n,i),i,o)},r.prototype._fitInternal=function(e,r,n){return e?(r=t.extend(e,r)).linear?this.easeTo(r,n):this.flyTo(r,n):this},r.prototype.jumpTo=function(e,r){this.stop();var n=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),i&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),o&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),a&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.easeTo=function(e,r){var n=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l="zoom"in e?+e.zoom:o,u="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,h=i.centerPoint.add(t.Point.convert(e.offset)),p=i.pointLocation(h),d=t.LngLat.convert(e.center||p);this._normalizeCenter(d);var f,m,y=i.project(p),g=i.project(d).sub(y),_=i.zoomScale(l-o);return e.around&&(f=t.LngLat.convert(e.around),m=i.locationPoint(f)),this._zooming=l!==o,this._rotating=a!==u,this._pitching=c!==s,this._prepareEase(r,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(n._zooming&&(i.zoom=t.number(o,l,e)),n._rotating&&(i.bearing=t.number(a,u,e)),n._pitching&&(i.pitch=t.number(s,c,e)),f)i.setLocationAtPoint(f,m);else{var p=i.zoomScale(i.zoom-o),d=l>o?Math.min(2,_):Math.max(.5,_),v=Math.pow(d,1-e),b=i.unproject(y.add(g.mult(e*v)).mult(p));i.setLocationAtPoint(i.renderWorldCopies?b.wrap():b,h)}n._fireMoveEvents(r)},function(){e.delayEndEvents?n._easeEndTimeoutID=setTimeout(function(){return n._afterEase(r)},e.delayEndEvents):n._afterEase(r)},e),this},r.prototype._prepareEase=function(e,r){this._moving=!0,r||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e){var r=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,r&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),i&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},r.prototype.flyTo=function(e,r){var n=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l="zoom"in e?t.clamp(+e.zoom,i.minZoom,i.maxZoom):o,u="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,h=i.zoomScale(l-o),p=i.centerPoint.add(t.Point.convert(e.offset)),d=i.pointLocation(p),f=t.LngLat.convert(e.center||d);this._normalizeCenter(f);var m=i.project(d),y=i.project(f).sub(m),g=e.curve,_=Math.max(i.width,i.height),v=_/h,b=y.mag();if("minZoom"in e){var x=t.clamp(Math.min(e.minZoom,o,l),i.minZoom,i.maxZoom),w=_/i.zoomScale(x-o);g=Math.sqrt(w/b*2)}var E=g*g;function C(t){var e=(v*v-_*_+(t?-1:1)*E*E*b*b)/(2*(t?v:_)*E*b);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}var A=C(0),I=function(t){return T(A)/T(A+g*t)},k=function(t){return _*((T(A)*(S(e=A+g*t)/T(e))-S(A))/E)/b;var e},P=(C(1)-A)/g;if(Math.abs(b)<1e-6||!isFinite(P)){if(Math.abs(_-v)<1e-6)return this.easeTo(e,r);var O=v<_?-1:1;P=Math.abs(Math.log(v/_))/g,k=function(){return 0},I=function(t){return Math.exp(O*g*t)}}return e.duration="duration"in e?+e.duration:1e3*P/("screenSpeed"in e?+e.screenSpeed/g:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=a!==u,this._pitching=c!==s,this._prepareEase(r,!1),this._ease(function(e){var h=e*P,d=1/I(h);i.zoom=1===e?l:o+i.scaleZoom(d),n._rotating&&(i.bearing=t.number(a,u,e)),n._pitching&&(i.pitch=t.number(s,c,e));var g=1===e?f:i.unproject(m.add(y.mult(k(h))).mult(d));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,p),n._fireMoveEvents(r)},function(){return n._afterEase(r)},e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},r.prototype._ease=function(e,r,n){!1===n.animate||0===n.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var n=Math.abs(e-r);return Math.abs(e-360-r)<n&&(e-=360),Math.abs(e+360-r)<n&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),kn=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};kn.prototype.getDefaultPosition=function(){return"bottom-right"},kn.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},kn.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},kn.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:t.config.ACCESS_TOKEN}];if(e){var n=r.reduce(function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<r.length-1?"&":"")),t},"?");e.href=t.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener"}},kn.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},kn.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(function(t){return"string"!=typeof t?"":t})):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var n in r){var i=r[n];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,r){for(var n=r+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})).length?(this._innerContainer.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},kn.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Pn=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Pn.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Pn.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Pn.prototype.getDefaultPosition=function(){return"bottom-left"},Pn.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Pn.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Pn.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var On=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};On.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},On.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r+=1){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},On.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!n.cancelled&&(n.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},On.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Rn=t.window.HTMLImageElement,Dn=t.window.HTMLElement,Mn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Ln=function(n){function i(e){var i=this;if(null!=(e=t.extend({},Mn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var o=new cn(e.minZoom,e.maxZoom,e.renderWorldCopies);if(n.call(this,o,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new On,this._controls=[],this._mapId=t.uniqueId(),this._requestManager=new t.RequestManager(e.transformRequest),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Dn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return i._update(!1)}),this.on("moveend",function(){return i._update(!1)}),this.on("zoom",function(){return i._update(!0)}),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var n=t.getCanvasContainer(),i=null,o=!1,a=null;for(var s in An)t[s]=new An[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);r.addEventListener(n,"mouseout",function(e){t.fire(new dn("mouseout",t,e))}),r.addEventListener(n,"mousedown",function(i){o=!0,a=r.mousePos(n,i);var s=new dn("mousedown",t,i);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(i),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(i),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(i))}),r.addEventListener(n,"mouseup",function(e){var r=t.dragRotate.isActive();i&&!r&&t.fire(new dn("contextmenu",t,i)),i=null,o=!1,t.fire(new dn("mouseup",t,e))}),r.addEventListener(n,"mousemove",function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var r=e.target;r&&r!==n;)r=r.parentNode;r===n&&t.fire(new dn("mousemove",t,e))}}),r.addEventListener(n,"mouseover",function(e){for(var r=e.target;r&&r!==n;)r=r.parentNode;r===n&&t.fire(new dn("mouseover",t,e))}),r.addEventListener(n,"touchstart",function(r){var n=new fn("touchstart",t,r);t.fire(n),n.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(r),t.touchZoomRotate.onStart(r),t.doubleClickZoom.onTouchStart(n))},{passive:!1}),r.addEventListener(n,"touchmove",function(e){t.fire(new fn("touchmove",t,e))},{passive:!1}),r.addEventListener(n,"touchend",function(e){t.fire(new fn("touchend",t,e))}),r.addEventListener(n,"touchcancel",function(e){t.fire(new fn("touchcancel",t,e))}),r.addEventListener(n,"click",function(i){var o=r.mousePos(n,i);(o.equals(a)||o.dist(a)<e.clickTolerance)&&t.fire(new dn("click",t,i))}),r.addEventListener(n,"dblclick",function(e){var r=new dn("dblclick",t,e);t.fire(r),r.defaultPrevented||t.doubleClickZoom.onDblClick(r)}),r.addEventListener(n,"contextmenu",function(e){var r=t.dragRotate.isActive();o||r?o&&(i=e):t.fire(new dn("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()}),r.addEventListener(n,"wheel",function(r){e.interactive&&t.stop();var n=new mn("wheel",t,r);t.fire(n),n.defaultPrevented||t.scrollZoom.onWheel(r)},{passive:!1})}(this,e),this._hash=e.hash&&(new pn).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new kn({customAttribution:e.customAttribution})),this.addControl(new Pn,e.logoPosition),this.on("style.load",function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)}),this.on("data",function(e){i._update("style"===e.dataType),i.fire(new t.Event(e.dataType+"data",e))}),this.on("dataloading",function(e){i.fire(new t.Event(e.dataType+"dataloading",e))})}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,r){if(void 0===r&&e.getDefaultPosition&&(r=e.getDefaultPosition()),void 0===r&&(r="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var n=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},i.prototype.resize=function(e){var r=this._containerDimensions(),n=r[0],i=r[1];return this._resizeCanvas(n,i),this.transform.resize(n,i),this.painter.resize(n,i),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},i.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},i.prototype.on=function(t,e,r){var i=this;if(void 0===r)return n.prototype.on.call(this,t,e);var o=function(){var n;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){var a=i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[];a.length?o||(o=!0,r.call(i,new dn(t,i,n.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){(i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,r.call(i,new dn(t,i,n.originalEvent)))},mouseout:function(e){a&&(a=!1,r.call(i,new dn(t,i,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(n={},n[t]=function(t){var n=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,r.call(i,t),delete t.features)},n)}}();for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o),o.delegates)this.on(a,o.delegates[a]);return this},i.prototype.off=function(t,e,r){if(void 0===r)return n.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var i=this._delegatedListeners[t],o=0;o<i.length;o++){var a=i[o];if(a.layer===e&&a.listener===r){for(var s in a.delegates)this.off(s,a.delegates[s]);return i.splice(o,1),this}}return this},i.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var n;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])n=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);n=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(n,r,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:Mn.localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new ze(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._diffStyle=function(e,r){var n=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,function(e,i){e?n.fire(new t.ErrorEvent(e)):i&&n._updateDiff(i,r)})}else"object"==typeof e&&this._updateDiff(e,r)},i.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce("Unable to perform style diff: "+(n.message||n.error||n)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var n in r){var i=r[n];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,r){return this.style.addSourceType(t,e,r)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,r,n){void 0===n&&(n={});var i=n.pixelRatio;void 0===i&&(i=1);var o=n.sdf;if(void 0===o&&(o=!1),r instanceof Rn){var a=t.browser.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:a.width,height:a.height},a.data),pixelRatio:i,sdf:o,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var s=r;this.style.addImage(e,{data:new t.RGBAImage({width:r.width,height:r.height},new Uint8Array(r.data)),pixelRatio:i,sdf:o,version:0,userImage:s}),s.onAdd&&s.onAdd(this,e)}},i.prototype.updateImage=function(e,r){var n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=r instanceof Rn?t.browser.getImageData(r):r,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==n.data.width||a!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(s,!(r instanceof Rn)),void this.style.updateImage(e,n))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},i.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,r,n),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,r,n),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=r.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){o[t]=r.create("div","mapboxgl-ctrl-"+t,i)})},i.prototype._resizeCanvas=function(e,r){var n=t.window.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},i.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(this.painter=new an(n,this.transform),t.webpSupported.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var r=this.transform.zoom,n=t.browser.now();this.style.zoomHistory.update(r,n);var i=new t.EvaluationParameters(r,{now:n,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),o=i.crossFadingFactor();1===o&&o===this._crossFadingFactor||(e=!0,this._crossFadingFactor=o),this.style.update(i)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),zn(this._canvasContainer),zn(this._controlContainer),zn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame(function(){e._frame=null,e._render()}))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},Object.defineProperties(i.prototype,o),i}(In);function zn(t){t.parentNode&&t.parentNode.removeChild(t)}var Nn={showCompass:!0,showZoom:!0},Fn=function(e){var n=this;this.options=t.extend({},Nn,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(t.bindAll(["_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom in",function(){return n._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom out",function(){return n._map.zoomOut()})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset bearing to north",function(){return n._map.resetNorth()}),this._compassArrow=r.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function Bn(e,r,n){if(e=new t.LngLat(e.lng,e.lat),r){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=n.locationPoint(e).distSqr(r);n.locationPoint(i).distSqr(r)<a?e=i:n.locationPoint(o).distSqr(r)<a&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){var s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}Fn.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMaxZoom()),this._zoomOutButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMinZoom())},Fn.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Fn.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vn(t,{button:"left",element:this._compass}),r.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Fn.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),r.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map},Fn.prototype._createButton=function(t,e,n){var i=r.create("button",t,this._container);return i.type="button",i.title=e,i.setAttribute("aria-label",e),i.addEventListener("click",n),i};var Vn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jn(t,e,r){var n=t.classList;for(var i in Vn)n.remove("mapboxgl-"+r+"-anchor-"+i);n.add("mapboxgl-"+r+"-anchor-"+e)}var Un,qn=function(e){function n(n,i){if(e.call(this),(n instanceof t.window.HTMLElement||i)&&(n=t.extend({element:n},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._draggable=n&&n.draggable||!1,this._state="inactive",n&&n.element)this._element=n.element,this._offset=t.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div");var o=r.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=r.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var l=r.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");for(var u=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];u<c.length;u+=1){var h=c[u],p=r.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),l.appendChild(p)}var d=r.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var f=r.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(f);var m=r.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var y=r.createNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(y);var g=r.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var _=r.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");var v=r.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#000000"),v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962");var b=r.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),_.appendChild(v),_.appendChild(b),s.appendChild(l),s.appendChild(d),s.appendChild(m),s.appendChild(g),s.appendChild(_),o.appendChild(s),this._element.appendChild(o),this._offset=t.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(t){t.preventDefault()}),jn(this._element,this._anchor,"marker"),this._popup=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},n.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.getElement=function(){return this._element},n.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},n.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},n.prototype.getPopup=function(){return this._popup},n.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},n.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Bn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,Vn[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"))},n.prototype.getOffset=function(){return this._offset},n.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},n.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},n.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},n.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},n.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},n.prototype.isDraggable=function(){return this._draggable},n}(t.Evented),Hn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},Wn=function(e){function n(r){e.call(this),this.options=t.extend({},Hn,r),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(e){var n;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Un?n(Un):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(function(t){n(Un="denied"!==t.state)}):n(Un=!!t.window.navigator.geolocation),this._container},n.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),r.remove(this._container),this._map=void 0},n.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},n.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),o,{geolocateSource:!0})},n.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},n.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},n.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},n.prototype._setupUI=function(e){var n=this;!1!==e?(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=r.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new qn(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==n._watchState||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new t.Event("trackuserlocationend")))})):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.")},n.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},n.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},n}(t.Evented),Gn={maxWidth:100,unit:"metric"},Zn=function(e){this.options=t.extend({},Gn,e),t.bindAll(["_onMove","setUnit"],this)};function Qn(t,e,r){var n,i,o,a,s,l,u=r&&r.maxWidth||100,c=t._container.clientHeight/2,h=(n=t.unproject([0,c]),i=t.unproject([u,c]),o=Math.PI/180,a=n.lat*o,s=i.lat*o,l=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((i.lng-n.lng)*o),6371e3*Math.acos(Math.min(l,1)));if(r&&"imperial"===r.unit){var p=3.2808*h;p>5280?Kn(e,u,p/5280,"mi"):Kn(e,u,p,"ft")}else r&&"nautical"===r.unit?Kn(e,u,h/1852,"nm"):Kn(e,u,h,"m")}function Kn(t,e,r,n){var i,o,a,s=(i=r,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a))),l=s/r;"m"===n&&s>=1e3&&(s/=1e3,n="km"),t.style.width=e*l+"px",t.innerHTML=s+n}Zn.prototype.getDefaultPosition=function(){return"bottom-left"},Zn.prototype._onMove=function(){Qn(this._map,this._container,this.options)},Zn.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Zn.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Zn.prototype.setUnit=function(t){this.options.unit=t,Qn(this._map,this._container,this.options)};var $n=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};$n.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},$n.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},$n.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},$n.prototype._setupUI=function(){(this._fullscreenButton=r.create("button",this._className+"-icon "+this._className+"-fullscreen",this._controlContainer)).type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},$n.prototype._updateTitle=function(){var t=this._isFullscreen()?"Exit fullscreen":"Enter fullscreen";this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},$n.prototype._isFullscreen=function(){return this._fullscreen},$n.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"),this._updateTitle())},$n.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Xn={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Yn=function(e){function n(r){e.call(this),this.options=t.extend(Object.create(Xn),r),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this.fire(new t.Event("open")),this},n.prototype.isOpen=function(){return!!this._map},n.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),delete this._map),this.fire(new t.Event("close")),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._update(),this},n.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},n.prototype.setHTML=function(e){var r,n=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;r=i.firstChild;)n.appendChild(r);return this.setDOMContent(n)},n.prototype.getMaxWidth=function(){return this._container.style.maxWidth},n.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},n.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},n.prototype._createContent=function(){this._content&&r.remove(this._content),this._content=r.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},n.prototype._update=function(){var e=this;if(this._map&&this._lngLat&&this._content){this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return e._container.classList.add(t)})),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&(this._lngLat=Bn(this._lngLat,this._pos,this._map.transform));var n=this._pos=this._map.project(this._lngLat),i=this.options.anchor,o=function e(r){if(r){if("number"==typeof r){var n=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(n,n),"top-right":new t.Point(-n,n),bottom:new t.Point(0,-r),"bottom-left":new t.Point(n,-n),"bottom-right":new t.Point(-n,-n),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var i=t.Point.convert(r);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!i){var a,s=this._container.offsetWidth,l=this._container.offsetHeight;a=n.y+o.bottom.y<l?["top"]:n.y>this._map.transform.height-l?["bottom"]:[],n.x<s/2?a.push("left"):n.x>this._map.transform.width-s/2&&a.push("right"),i=0===a.length?"bottom":a.join("-")}var u=n.add(o[i]).round();r.setTransform(this._container,Vn[i]+" translate("+u.x+"px,"+u.y+"px)"),jn(this._container,i,"popup")}},n.prototype._onClickClose=function(){this.remove()},n}(t.Evented),Jn={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,Map:Ln,NavigationControl:Fn,GeolocateControl:Wn,AttributionControl:kn,ScaleControl:Zn,FullscreenControl:$n,Popup:Yn,Marker:qn,Style:ze,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Dt.workerCount},set workerCount(t){Dt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},workerUrl:""};return Jn}),r}()},"5+tZ":function(t,e,r){"use strict";r.d(e,"a",function(){return l});var n=r("ZUHj"),i=r("l7GE"),o=r("51Dv"),a=r("lJxs"),s=r("Cfvw");function l(t,e,r=Number.POSITIVE_INFINITY){return"function"==typeof e?n=>n.pipe(l((r,n)=>Object(s.a)(t(r,n)).pipe(Object(a.a)((t,i)=>e(r,t,n,i))),r)):("number"==typeof e&&(r=e),e=>e.lift(new u(t,r)))}class u{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new c(t,this.project,this.concurrent))}}class c extends i.a{constructor(t,e,r=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(n){return void this.destination.error(n)}this.active++,this._innerSub(e,t,r)}_innerSub(t,e,r){const i=new o.a(this,void 0,void 0);this.destination.add(i),Object(n.a)(this,t,e,r,i)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t,e,r,n,i){this.destination.next(e)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},"51Dv":function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("7o/Q");class i extends n.a{constructor(t,e,r){super(),this.parent=t,this.outerValue=e,this.outerIndex=r,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}},6233:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r("O0a9"))},"7o/Q":function(t,e,r){"use strict";r.d(e,"a",function(){return u});var n=r("n6bG"),i=r("gRHU"),o=r("quSY"),a=r("2QA8"),s=r("2fFW"),l=r("NJ4a");class u extends o.a{constructor(t,e,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=i.a;break;case 1:if(!t){this.destination=i.a;break}if("object"==typeof t){t instanceof u?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new c(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new c(this,t,e,r)}}[a.a](){return this}static create(t,e,r){const n=new u(t,e,r);return n.syncErrorThrowable=!1,n}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parent:t,_parents:e}=this;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this}}class c extends u{constructor(t,e,r,o){let a;super(),this._parentSubscriber=t;let s=this;Object(n.a)(e)?a=e:e&&(a=e.next,r=e.error,o=e.complete,e!==i.a&&(s=Object.create(e),Object(n.a)(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=a,this._error=r,this._complete=o}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;s.a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:r}=s.a;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):Object(l.a)(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;Object(l.a)(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);s.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(r){if(this.unsubscribe(),s.a.useDeprecatedSynchronousErrorHandling)throw r;Object(l.a)(r)}}__tryOrSetError(t,e,r){if(!s.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(n){return s.a.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=n,t.syncErrorThrown=!0,!0):(Object(l.a)(n),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}},"8Y7J":function(t,e,r){"use strict";r.d(e,"fb",function(){return os}),r.d(e,"gb",function(){return as}),r.d(e,"hb",function(){return ss}),r.d(e,"ib",function(){return ls}),r.d(e,"eb",function(){return ia}),r.d(e,"db",function(){return Xo}),r.d(e,"g",function(){return Wa}),r.d(e,"P",function(){return ja}),r.d(e,"w",function(){return Va}),r.d(e,"Q",function(){return Te}),r.d(e,"T",function(){return Se}),r.d(e,"c",function(){return na}),r.d(e,"A",function(){return aa}),r.d(e,"z",function(){return sa}),r.d(e,"b",function(){return la}),r.d(e,"d",function(){return ea}),r.d(e,"e",function(){return ra}),r.d(e,"S",function(){return es}),r.d(e,"K",function(){return Ra}),r.d(e,"V",function(){return La}),r.d(e,"s",function(){return is}),r.d(e,"f",function(){return us}),r.d(e,"m",function(){return Yo}),r.d(e,"l",function(){return we}),r.d(e,"E",function(){return $e}),r.d(e,"F",function(){return Ke}),r.d(e,"a",function(){return X}),r.d(e,"N",function(){return J}),r.d(e,"L",function(){return Nn}),r.d(e,"Db",function(){return y}),r.d(e,"R",function(){return x}),r.d(e,"p",function(){return M}),r.d(e,"Hb",function(){return I}),r.d(e,"o",function(){return k}),r.d(e,"n",function(){return c}),r.d(e,"y",function(){return h}),r.d(e,"G",function(){return d}),r.d(e,"x",function(){return Sa}),r.d(e,"B",function(){return Ln}),r.d(e,"C",function(){return Dn}),r.d(e,"D",function(){return Mn}),r.d(e,"i",function(){return ma}),r.d(e,"j",function(){return Cn}),r.d(e,"k",function(){return Pn}),r.d(e,"t",function(){return In}),r.d(e,"v",function(){return An}),r.d(e,"u",function(){return ta}),r.d(e,"H",function(){return Ka}),r.d(e,"I",function(){return Za}),r.d(e,"J",function(){return ri}),r.d(e,"M",function(){return ii}),r.d(e,"h",function(){return Xn}),r.d(e,"q",function(){return Kn}),r.d(e,"r",function(){return $n}),r.d(e,"O",function(){return fn}),r.d(e,"U",function(){return ns}),r.d(e,"pb",function(){return mn}),r.d(e,"Y",function(){return ua}),r.d(e,"W",function(){return _n}),r.d(e,"X",function(){return Sn}),r.d(e,"Z",function(){return Ze}),r.d(e,"ab",function(){return Je}),r.d(e,"bb",function(){return Pe}),r.d(e,"ob",function(){return C}),r.d(e,"sb",function(){return pn}),r.d(e,"yb",function(){return v}),r.d(e,"qb",function(){return un}),r.d(e,"rb",function(){return ln}),r.d(e,"Cb",function(){return ut}),r.d(e,"Eb",function(){return rn}),r.d(e,"Gb",function(){return nn}),r.d(e,"Fb",function(){return on}),r.d(e,"cb",function(){return cs}),r.d(e,"jb",function(){return uo}),r.d(e,"kb",function(){return kl}),r.d(e,"lb",function(){return Ei}),r.d(e,"mb",function(){return Mo}),r.d(e,"nb",function(){return hs}),r.d(e,"tb",function(){return to}),r.d(e,"ub",function(){return Ji}),r.d(e,"vb",function(){return xo}),r.d(e,"wb",function(){return Lo}),r.d(e,"xb",function(){return zo}),r.d(e,"zb",function(){return xs}),r.d(e,"Ab",function(){return bi}),r.d(e,"Bb",function(){return Cs});var n=r("XNiG"),i=r("quSY"),o=r("HDdC"),a=r("VRyK"),s=r("w1tV");const l="__parameters__";function u(t,e,r){const n=function(t){return function(...e){if(t){const r=t(...e);for(const t in r)this[t]=r[t]}}}(e);function i(...t){if(this instanceof i)return n.apply(this,t),this;const e=new i(...t);return r.annotation=e,r;function r(t,r,n){const i=t.hasOwnProperty(l)?t[l]:Object.defineProperty(t,l,{value:[]})[l];for(;i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(e),t}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}const c=u("Inject",t=>({token:t})),h=u("Optional"),p=u("Self"),d=u("SkipSelf");var f=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});function m(t){for(let e in t)if(t[e]===m)return e;throw Error("Could not find renamed property on target object.")}function y(t){return{providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function g(t){return t&&t.hasOwnProperty(_)?t[_]:null}const _=m({ngInjectableDef:m});function v(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(v).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const r=e.indexOf("\n");return-1===r?e:e.substring(0,r)}const b=m({__forward_ref__:m});function x(t){return t.__forward_ref__=x,t.toString=function(){return v(this())},t}function w(t){const e=t;return"function"==typeof e&&e.hasOwnProperty(b)&&e.__forward_ref__===x?e():t}function E(){const t="undefined"!=typeof globalThis&&globalThis,e="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,n="undefined"!=typeof global&&global;return t||n||e||r}const C=E();let S,T=void 0;function A(t){const e=T;return T=t,e}function I(t,e=f.Default){return(S||function(t,e=f.Default){if(void 0===T)throw new Error("inject() must be called from an injection context");return null===T?function(t,e,r){const n=g(t);if(n&&"root"==n.providedIn)return void 0===n.value?n.value=n.factory():n.value;if(r&f.Optional)return null;throw new Error(`Injector: NOT_FOUND [${v(t)}]`)}(t,0,e):T.get(t,e&f.Optional?null:void 0,e)})(t,e)}class k{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ngInjectableDef=y({providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const P="__source",O=new Object,R=new k("INJECTOR",-1);class D{get(t,e=O){if(e===O){const e=new Error(`NullInjectorError: No provider for ${v(t)}!`);throw e.name="NullInjectorError",e}return e}}const M=(()=>{class t{static create(t,e){return Array.isArray(t)?new H(t,e):new H(t.providers,t.parent,t.name||null)}}return t.THROW_IF_NOT_FOUND=O,t.NULL=new D,t.ngInjectableDef=y({providedIn:"any",factory:()=>I(R)}),t.__NG_ELEMENT_ID__=-1,t})(),L=function(t){return t},z=[],N=L,F=function(){return Array.prototype.slice.call(arguments)},B=m({provide:String,useValue:m}),V="ngTokenPath",j="ngTempTokenPath",U=/\n/gm,q="\u0275";class H{constructor(t,e=M.NULL,r=null){this.parent=e,this.source=r;const n=this._records=new Map;n.set(M,{token:M,fn:L,deps:z,value:this,useNew:!1}),n.set(R,{token:R,fn:L,deps:z,value:this,useNew:!1}),function t(e,r){if(r)if((r=w(r))instanceof Array)for(let n=0;n<r.length;n++)t(e,r[n]);else{if("function"==typeof r)throw Z("Function/Class not supported",r);if(!r||"object"!=typeof r||!r.provide)throw Z("Unexpected provider",r);{let t=w(r.provide);const n=function(t){const e=function(t){let e=z;const r=t.deps;if(r&&r.length){e=[];for(let t=0;t<r.length;t++){let n=6,i=w(r[t]);if(i instanceof Array)for(let t=0,e=i;t<e.length;t++){const r=e[t];r instanceof h||r==h?n|=1:r instanceof d||r==d?n&=-3:r instanceof p||r==p?n&=-5:i=r instanceof c?r.token:w(r)}e.push({token:i,options:n})}}else if(t.useExisting)e=[{token:w(t.useExisting),options:6}];else if(!(r||B in t))throw Z("'deps' required",t);return e}(t);let r=L,n=z,i=!1,o=w(t.provide);if(B in t)n=t.useValue;else if(t.useFactory)r=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,r=w(t.useClass);else{if("function"!=typeof o)throw Z("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,r=o}return{deps:e,fn:r,useNew:i,value:n}}(r);if(!0===r.multi){let n=e.get(t);if(n){if(n.fn!==F)throw W(t)}else e.set(t,n={token:r.provide,deps:[],useNew:!1,fn:F,value:z});n.deps.push({token:t=r,options:6})}const i=e.get(t);if(i&&i.fn==F)throw W(t);e.set(t,n)}}}(n,t)}get(t,e,r=f.Default){const n=this._records.get(t);try{return function t(e,r,n,i,o,a){try{return function(e,r,n,i,o,a){let s;if(!r||a&f.SkipSelf)a&f.Self||(s=i.get(e,o,f.Default));else{if((s=r.value)==N)throw Error(q+"Circular dependency");if(s===z){r.value=N;let e=void 0,o=r.useNew,a=r.fn,l=r.deps,u=z;if(l.length){u=[];for(let e=0;e<l.length;e++){const r=l[e],o=r.options,a=2&o?n.get(r.token):void 0;u.push(t(r.token,a,n,a||4&o?i:M.NULL,1&o?null:M.THROW_IF_NOT_FOUND,f.Default))}}r.value=s=o?new a(...u):a.apply(e,u)}}return s}(e,r,n,i,o,a)}catch(s){throw s instanceof Error||(s=new Error(s)),(s[j]=s[j]||[]).unshift(e),r&&r.value==N&&(r.value=z),s}}(t,n,this._records,this.parent,e,r)}catch(i){return function(t,e,r,n){const i=t[j];throw e[P]&&i.unshift(e[P]),t.message=G("\n"+t.message,i,"StaticInjectorError",n),t[V]=i,t[j]=null,t}(i,t,0,this.source)}}toString(){const t=[];return this._records.forEach((e,r)=>t.push(v(r))),`StaticInjector[${t.join(", ")}]`}}function W(t){return Z("Cannot mix multi providers and regular providers",t)}function G(t,e,r,n=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==q?t.substr(2):t;let i=v(e);if(e instanceof Array)i=e.map(v).join(" -> ");else if("object"==typeof e){let t=[];for(let r in e)if(e.hasOwnProperty(r)){let n=e[r];t.push(r+":"+("string"==typeof n?JSON.stringify(n):v(n)))}i=`{${t.join(", ")}}`}return`${r}${n?"("+n+")":""}[${i}]: ${t.replace(U,"\n  ")}`}function Z(t,e){return new Error(G(t,e,"StaticInjectorError"))}const Q="ngDebugContext",K="ngOriginalError",$="ngErrorLogger",X=new k("AnalyzeForEntryComponents"),Y=function(){var t={OnPush:0,Default:1};return t[t.OnPush]="OnPush",t[t.Default]="Default",t}(),J=function(){var t={Emulated:0,Native:1,None:2,ShadowDom:3};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t[t.ShadowDom]="ShadowDom",t}(),tt={},et=[],rt=m({ngComponentDef:m}),nt=m({ngDirectiveDef:m}),it=m({ngPipeDef:m});let ot=0;function at(t){return function(t){return t[rt]||null}(t)||function(t){return t[nt]||null}(t)}function st(t){return function(t){return t[it]||null}(t)}function lt(t,e){if(null==t)return tt;const r={};for(const n in t)if(t.hasOwnProperty(n)){let i=t[n],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),r[i]=n,e&&(e[i]=o)}return r}const ut=function(t){const e=t.type,r=e.prototype,n={},i={type:e,providersResolver:null,consts:t.consts,vars:t.vars,factory:t.factory,template:t.template||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onChanges:null,onInit:r.ngOnInit||null,doCheck:r.ngDoCheck||null,afterContentInit:r.ngAfterContentInit||null,afterContentChecked:r.ngAfterContentChecked||null,afterViewInit:r.ngAfterViewInit||null,afterViewChecked:r.ngAfterViewChecked||null,onDestroy:r.ngOnDestroy||null,onPush:t.changeDetection===Y.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||J.Emulated,id:"c",styles:t.styles||et,_:null,setInput:null,schemas:t.schemas||null};return i._=""+{toString:()=>{const r=t.directives,o=t.features,a=t.pipes;i.id+=ot++,i.inputs=lt(t.inputs,n),i.outputs=lt(t.outputs),o&&o.forEach(t=>t(i)),i.directiveDefs=r?()=>("function"==typeof r?r():r).map(at):null,i.pipeDefs=a?()=>("function"==typeof a?a():a).map(st):null,e.hasOwnProperty(_)||(e[_]=y({factory:t.factory}))}},i},ct=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(C))(),ht=0,pt=1,dt=2,ft=3,mt=4,yt=6,gt=7,_t=9,vt=11,bt=12,xt=14,wt=18,Et=20,Ct=1,St=2,Tt=8,At="__ngContext__";function It(t){for(;Array.isArray(t);)t=t[ht];return t}function kt(t){return Array.isArray(t)&&"object"==typeof t[Ct]}function Pt(t,e){return e[pt].data[t+Et]}function Ot(t){const e=function(t){return t[At]}(t);return e?Array.isArray(e)?e:e.lView:null}function Rt(t){t[wt]=0}const Dt=9;function Mt(t,e,r,n,i,o){if(n)return;const a=(3&t[dt])===i?e:r;a&&function(t,e,r,n){const i=null!=n?n:-1;let o=0;for(let a=void 0!==n?65535&t[wt]:0;a<e.length;a++)if("number"==typeof e[a+1]){if(o=e[a],null!=n&&o>=n)break}else e[a]<0&&(t[wt]+=65536),(o<i||-1==i)&&(Lt(t,r,e,a),t[wt]=(4294901760&t[wt])+a+2),a++}(t,a,i,o),null==o&&(3&t[dt])===i&&3!==i&&(t[dt]&=1023,t[dt]+=1)}function Lt(t,e,r,n){const i=r[n]<0,o=r[n+1],a=t[i?-r[n]:r[n]];i?t[dt]>>10<t[wt]>>16&&(3&t[dt])===e&&(t[dt]+=1024,o.call(a)):o.call(a)}let zt=null;function Nt(t){zt=t}function Ft(){return Ut}const Bt=1;let Vt,jt,Ut,qt=Bt,Ht=0,Wt=0;function Gt(t=null){ae!==t&&(le(null==t?-1:t),qt=Bt,Ht=0,Wt=0)}function Zt(){return Vt}function Qt(t){Vt=t}function Kt(t){jt=t}function $t(t=Ut){return 4==(4&t[dt])}let Xt=null,Yt=!1;function Jt(){return Yt}let te=-1;function ee(t){te=t}let re=0;function ne(t){re=t}function ie(t,e){const r=Ut;return t&&(te=t[pt].bindingStartIndex),Vt=e,jt=!0,Ut=Xt=t,r}function oe(t){const e=Ut[pt];if($t(Ut))Ut[dt]&=-5;else try{Rt(Ut),Mt(Ut,e.viewHooks,e.viewCheckHooks,Yt,2,void 0)}finally{Ut[dt]&=-73,Ut[gt]=e.bindingStartIndex}Nt(null),ie(t,null)}let ae=-1;function se(){return ae}function le(t){ae=t,Nt(null)}let ue=null;const ce=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}();function he(t){return!!t.listen}class pe{constructor(){this._players=[]}flushPlayers(){for(let t=0;t<this._players.length;t++){const e=this._players[t];e.parent||0!==e.state||e.play()}this._players.length=0}queuePlayer(t){this._players.push(t)}}const de=0;function fe(t,e,r,n){const i=[t||null,0,[],r||[null,null],n||[null,null],[0,0],[0],[0],null,null];return me(i,de),i}function me(t,e,r=-1,n){const i=t[2],o=2*e,a=o+2;for(let l=i.length;l<a;l+=2)i.push(-1,null);const s=o+0;r>=0&&-1===i[s]&&(i[s]=r,i[o+1]=n||null)}function ye(t,e,r,n,i,o){return o=o||r,i?t[i]=n:t.push(n),!!n&&(n.addEventListener(200,()=>{const e=t.indexOf(n);e&&(e<t[0]?t[e]=null:t.splice(e,1)),n.destroy()}),(e.playerHandler||(e.playerHandler=new pe)).queuePlayer(n,o),!0)}function ge(t){const e=t[ft];return r=e,Array.isArray(r)&&!0===r[Ct]?e[ft]:e;var r}function _e(t){return function(t){let e=kt(t)?t:Ot(t);for(;e&&!(512&e[dt]);)e=ge(e);return e}(t)[_t]}function ve(t){return t[Q]}function be(t){return t[K]}function xe(t,...e){t.error(...e)}class we{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),r=this._findContext(t),n=function(t){return t[$]||xe}(t);n(this._console,"ERROR",t),e&&n(this._console,"ORIGINAL ERROR",e),r&&n(this._console,"ERROR CONTEXT",r)}_findContext(t){return t?ve(t)?ve(t):this._findContext(be(t)):null}_findOriginalError(t){let e=be(t);for(;e&&be(e);)e=be(e);return e}}let Ee=!0,Ce=!1;function Se(){return Ce=!0,Ee}function Te(){if(Ce)throw new Error("Cannot enable prod mode after platform setup.");Ee=!1}class Ae{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t),this.inertBodyElement=this.inertDocument.createElement("body"),t.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(n){return null}const e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);const r=e.response.body;return r.removeChild(r.firstChild),r}getInertBodyElement_DOMParser(t){t="<body><remove></remove>"+t+"</body>";try{const r=(new window.DOMParser).parseFromString(t,"text/html").body;return r.removeChild(r.firstChild),r}catch(e){return null}}getInertBodyElement_InertDocument(t){const e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}stripCustomNsAttrs(t){const e=t.attributes;for(let n=e.length-1;0<n;n--){const r=e.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||t.removeAttribute(r)}let r=t.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const Ie=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,ke=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Pe(t){return(t=String(t)).match(Ie)||t.match(ke)?t:(Se()&&console.warn(`WARNING: sanitizing unsafe URL value ${t} (see http://g.co/ng/security#xss)`),"unsafe:"+t)}function Oe(t){const e={};for(const r of t.split(","))e[r]=!0;return e}function Re(...t){const e={};for(const r of t)for(const t in r)r.hasOwnProperty(t)&&(e[t]=!0);return e}const De=Oe("area,br,col,hr,img,wbr"),Me=Oe("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Le=Oe("rp,rt"),ze=Re(Le,Me),Ne=Re(De,Re(Me,Oe("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Re(Le,Oe("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ze),Fe=Oe("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Be=Oe("srcset"),Ve=Re(Fe,Be,Oe("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Oe("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),je=Oe("script,style,template");class Ue{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,r=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Ne.hasOwnProperty(e))return this.sanitizedSomething=!0,!je.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const r=t.attributes;for(let i=0;i<r.length;i++){const t=r.item(i),e=t.name,o=e.toLowerCase();if(!Ve.hasOwnProperty(o)){this.sanitizedSomething=!0;continue}let a=t.value;Fe[o]&&(a=Pe(a)),Be[o]&&(n=a,a=(n=String(n)).split(",").map(t=>Pe(t.trim())).join(", ")),this.buf.push(" ",e,'="',We(a),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Ne.hasOwnProperty(e)&&!De.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(We(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const qe=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,He=/([^\#-~ |!])/g;function We(t){return t.replace(/&/g,"&amp;").replace(qe,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(He,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Ge;function Ze(t,e){let r=null;try{Ge=Ge||new Ae(t);let n=e?String(e):"";r=Ge.getInertBodyElement(n);let i=5,o=n;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,n=o,o=r.innerHTML,r=Ge.getInertBodyElement(n)}while(n!==o);const a=new Ue,s=a.sanitizeChildren(Qe(r)||r);return Se()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(r){const t=Qe(r)||r;for(;t.firstChild;)t.removeChild(t.firstChild)}}}function Qe(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}const Ke=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}();class $e{}const Xe=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Ye=/^url\(([^)]+)\)$/;function Je(t){if(!(t=String(t).trim()))return"";const e=t.match(Ye);return e&&Pe(e[1])===e[1]||t.match(Xe)&&function(t){let e=!0,r=!0;for(let n=0;n<t.length;n++){const i=t.charAt(n);"'"===i&&r?e=!e:'"'===i&&e&&(r=!r)}return e&&r}(t)?t:(Se()&&console.warn(`WARNING: sanitizing unsafe style value ${t} (see http://g.co/ng/security#xss).`),"unsafe")}const tr=/([A-Z])/g;function er(t){try{return null!=t?t.toString().slice(0,30):t}catch(e){return"[ERROR] Exception while trying to serialize the value"}}const rr={};class nr{constructor(t,e){this.fn=t,this.value=e}}function ir(t,e,r,n){for(let i=r;i<n;i+=4)if(Ir(t,i)===e)return i;return-1}function or(t,e,r,n=0){r=r||null;const i=qr(t,!0,n,e=e||null),o=qr(t,!1,n,r);if(i&&o)return;e=e===rr?Ur(t,!0,n):e,r=r===rr?Ur(t,!1,n):r;const a=t[0],s=e instanceof nr?new Nr(e,a,1):null,l=r instanceof nr?new Nr(r,a,2):null,u=s?e.value:e,c=l?r.value:r;let h=et,p=!1,d=!1;const f=s?1:0;br(t,s,1)&&(xr(t,s,1),d=!0);const m=l?3:0;br(t,l,3)&&(xr(t,l,3),d=!0),i||("string"==typeof u?(h=u.split(/\s+/),p=!0):h=u?Object.keys(u):et);const y=gr(t);let g=function(t){return t[6][2]}(t),_=t.length;if(!o){const e=ar(t,n,m,y,g,c?Object.keys(c):et,c||tt,r,!1);e&&(g+=4*e,_+=4*e)}if(!i){const r=u||tt;ar(t,n,f,g,_,h,p||r,e,!0)}d&&Pr(t,!0)}function ar(t,e,r,n,i,o,a,s,l){let u=!1;const c=1+4*e,h=t[l?6:7],p=h[c+1],d=h[c+3];let f=1===h[c+0]||!(h[c+2]||!s),m=0,y=0;const g=!0===a;let _=n,v=o.length;for(;_<p;){const n=Ir(t,_);if(v)for(let i=0;i<o.length;i++){const s=o[i],c=s?l?s:Hr(s):null;if(c&&n===c){const n=Ar(t,_),s=Fr(t,_),l=!!g||a[c],h=Tr(t,_);zr(h,n,l)&&jr(n,l,s,e)&&(vr(t,_,l),wr(t,_,r,e),Lr(t,h,l)&&(ur(t,_,!0),u=!0)),o[i]=null,v--;break}}_+=4}if(v){const n=l?null:Vr(t,e);t:for(let s=0;s<o.length;s++){const c=o[s];if(!c)continue;const h=!!g||a[c],d=l?c:Hr(c),v=_>=p;for(let n=_;n<i;n+=4)if(Ir(t,n)===d){const i=Fr(t,n),o=Er(t,n),a=Ar(t,n),s=Tr(t,n);jr(a,h,i,e)&&(v&&(Or(t,_,n),m++),zr(s,a,h)&&((null===h||void 0===h&&h!==a)&&(f=!0),vr(t,_,h),(null!==a||Lr(t,s,h))&&(ur(t,_,!0),u=!0)),i===e&&r===o||wr(t,_,r,e)),_+=4;continue t}null!=h&&(f=!0,m++,Rr(t,v?_:p+4*y,l,d,1|Mr(t,d,l,n),h,e,r),y++,i+=4,_+=4,u=!0)}}for(;_<i;){f=!0;const n=Ar(t,_),i=Tr(t,_);Fr(t,_),null!=n&&(f=!0),zr(i,n,null)&&(vr(t,_,null),Lr(t,i,n)&&(ur(t,_,!0),u=!0),wr(t,_,r,e)),_+=4}return function(t,e,r,n,i,o,a,s){const l=t[r?6:7],u=1+4*e;if(s){const t=i+4*a;for(let e=u+4;e<l.length;e+=4)l[e+1]=t,l[e+0]=1}l[u+0]=0,l[u+1]=i,l[u+2]=n,l[u+3]=a;let c=a;for(let h=1;h<u;h+=4)c+=l[h+3];if(!r){const e=t[6],r=o-e[2];for(let t=1;t<e.length;t+=4)e[t+1]+=r}l[0]=c}(t,e,l,s,p,i,m,f=f||d!==m),u&&kr(t,!0),y}function sr(t,e,r,n,i,o,a){r=i&&r?i(e,r):r,o||a?(o&&o.setValue(e,r),a&&a.setValue(e,r)):r?(r=r.toString(),he(n)?n.setStyle(t,e,r,ce.DashCase):t.style.setProperty(e,r)):he(n)?n.removeStyle(t,e,ce.DashCase):t.style.removeProperty(e)}function lr(t,e,r,n,i,o){i||o?(i&&i.setValue(e,r),o&&o.setValue(e,r)):""!==e&&(r?he(n)?n.addClass(t,e):t.classList.add(e):he(n)?n.removeClass(t,e):t.classList.remove(e))}function ur(t,e,r){const n=e>=10?e+0:e;r?t[n]|=1:t[n]&=-2}function cr(t,e){return 1==(1&t[e>=10?e+0:e])}function hr(t,e){return 2==(2&t[e>=10?e+0:e])}function pr(t,e){return 4==(4&t[e>=10?e+0:e])}function dr(t,e,r){return 31&t|e<<5|r<<19}function fr(t,e){const r=mr(e);return(2&e?t[4]:t[3])[r]}function mr(t){return t>>5&16383}function yr(t){const e=t>>19&16383;return e>=10?e:-1}function gr(t){return t[7][2]}function _r(t,e,r){t[e+1]=r}function vr(t,e,r){t[e+2]=r}function br(t,e,r){const n=t[9];if(e){if(!n||0===r)return!0}else if(!n)return!1;return n[r]!==e}function xr(t,e,r){let n=t[9]||(t[9]=[5,null,null,null,null]);return r>0?n[r]=e:(n.splice(r=n[0],0,e,null),n[0]+=2),r}function wr(t,e,r,n){const i=function(t,e){return r<<16|t}(n);t[e+3]=i}function Er(t,e){return t[e+3]>>16&65535}function Cr(t,e){const r=Er(t,e);if(r){const e=t[9];if(e)return e[r]}return null}function Sr(t,e,r){t[1===e?e:e+0]=r}function Tr(t,e){return t[1===e?e:e+0]}function Ar(t,e){return t[e+2]}function Ir(t,e){return t[e+1]}function kr(t,e){ur(t,1,e)}function Pr(t,e){e?t[1]|=8:t[1]&=-9}function Or(t,e,r){if(e===r)return;const n=Ar(t,e),i=Ir(t,e),o=Tr(t,e),a=Er(t,e),s=Fr(t,e);let l=o,u=Tr(t,r);const c=yr(l);if(c>=0){const e=Tr(t,c);Sr(t,c,dr(e,mr(e),r))}const h=yr(u);if(h>=0){const r=Tr(t,h);Sr(t,h,dr(r,mr(r),e))}vr(t,e,Ar(t,r)),_r(t,e,Ir(t,r)),Sr(t,e,Tr(t,r)),wr(t,e,Er(t,r),Fr(t,r)),vr(t,r,n),_r(t,r,i),Sr(t,r,o),wr(t,r,a,s)}function Rr(t,e,r,n,i,o,a,s){const l=e<t.length;t.splice(e,0,1|i|(r?2:0),n,o,0),wr(t,e,s,a),l&&function(t,r){for(let n=e+4;n<t.length;n+=4){const e=yr(Tr(t,n));if(e>0){const r=mr(Tr(t,e));Sr(t,e,dr((cr(t,e)?1:0)|(hr(t,e)?2:0)|(pr(t,e)?4:0),r,n))}}}(t)}function Dr(t,e){return null!==t}function Mr(t,e,r,n){let i,o=n&&n(e)?4:0;return r?(o|=2,i=Br(t[4],e)):i=Br(t[3],e),dr(o,i=i>0?i+1:0,0)}function Lr(t,e,r){const n=fr(t,e);return!n||zr(e,n,r)}function zr(t,e,r){return!(2&t)&&e&&r&&4&t?e.toString()!==r.toString():e!==r}class Nr{constructor(t,e,r){this._element=e,this._type=r,this._values={},this._dirty=!1,this._factory=t}setValue(t,e){this._values[t]!==e&&(this._values[t]=e,this._dirty=!0)}buildPlayer(t,e){if(this._dirty){const r=this._factory.fn(this._element,this._type,this._values,e,t||null);return this._values={},this._dirty=!1,r}}}function Fr(t,e){return 65535&t[e+3]}function Br(t,e){for(let r=2;r<t.length;r+=3)if(t[r]===e)return r;return-1}function Vr(t,e){const r=t[2];return r[2*e+1]||r[1]||null}function jr(t,e,r,n){return null==t||(null!=e?n<=r:r===n)}function Ur(t,e,r){return t[e?6:7][1+4*r+2]||null}function qr(t,e,r,n){return!t[e?6:7][1+4*r+0]&&(n===rr||Ur(t,e,r)===n)}function Hr(t){return t.replace(/[a-z][A-Z]/g,t=>`${t.charAt(0)}-${t.charAt(1).toLowerCase()}`)}function Wr(t,e,r,n,i=0){const o=t[r?6:7];if(e>0){const t=1+4*e;for(;o.length<t;)o.push(0,n,null,0)}o.push(0,n,null,i)}const Gr=(()=>Promise.resolve(null))();function Zr(t){const e=t[pt],r=$t(t);if(e.firstTemplatePass=!1,t[gt]=e.bindingStartIndex,!r){const r=Jt();(function(e,r,n,i){n||Mt(t,r.preOrderHooks,r.preOrderCheckHooks,n,0,null)})(0,e,r),function(t){for(let e=t[xt];null!==e;e=e[mt])if(e.length<Et&&-1===e[St]){const t=e;for(let e=0;e<t[Tt].length;e++){const r=t[Tt][e];Kr(r,r[pt],r[_t])}}}(t),Qr(e,t),Rt(t),Mt(t,e.contentHooks,e.contentCheckHooks,r,1,void 0),function(t,e){const r=se();try{if(t.expandoInstructions){let r=e[gt]=t.expandoStartIndex;ee(r);let n=-1,i=-1;for(let o=0;o<t.expandoInstructions.length;o++){const a=t.expandoInstructions[o];if("number"==typeof a){if(a<=0){Gt(i=-a);const e=t.expandoInstructions[++o];n=r+=Dt+e}else r+=a;ee(r)}else null!==a&&(e[gt]=r,a(2,It(e[n]),i),qt+=1+Wt,Ht=0,Wt=0),n++}}}finally{Gt(r)}}(e,t)}r&&e.staticContentQueries&&Qr(e,t),function(t){if(null!=t)for(let e=0;e<t.length;e++)Jr(t[e])}(e.components)}function Qr(t,e){if(null!=t.contentQueries){ne(0);for(let r=0;r<t.contentQueries.length;r++){const n=t.contentQueries[r];t.data[n].contentQueries(2,e[n],n)}}}function Kr(t,e,r){const n=jt,i=Zt();let o;if(512&t[dt])tn(_e(t));else try{Kt(!0),Qt(null),o=ie(t,t[yt]),Rt(t),Xr(e.template,Yr(t),r),t[pt].firstTemplatePass=!1,Zr(t)}finally{oe(o),Kt(n),Qt(i)}}function $r(t,e,r){const n=t[vt],i=ie(t,t[yt]),o=!Jt(),a=$t(t);try{o&&!a&&n.begin&&n.begin(),a&&(r&&Xr(r,1,e),Zr(t),t[dt]&=-5),Rt(t),r&&Xr(r,2,e),Zr(t)}finally{o&&!a&&n.end&&n.end(),oe(i)}}function Xr(t,e,r){ue=null;const n=se();try{Gt(null),t(e,r)}finally{le(n)}}function Yr(t){return $t(t)?1:2}function Jr(t){const e=Ft(),r=function(r,n){const i=e[t];return kt(i)?i:i[ht]}();(128==(128&r[dt])||$t(e))&&80&r[dt]&&(function(t){const e=t[pt];for(let r=t.length;r<e.blueprint.length;r++)t[r]=e.blueprint[r]}(r),function(t,e){const r=t[pt],n=ie(t,t[yt]),i=r.template,o=$t(t);try{Rt(t),o&&en(1,r,e),Xr(i,Yr(t),e),Zr(t),o&&!r.staticViewQueries||en(2,r,e)}finally{oe(n)}}(r,r[_t]))}function tn(t){for(let e=0;e<t.components.length;e++){const r=t.components[e];$r(Ot(r),r)}}function en(t,e,r){const n=e.viewQuery;n&&(ne(e.viewQueryStartIndex),n(t,r))}function rn(t,e,r){const n=Zt();n.stylingTemplate||(n.stylingTemplate=fe());const i=an();me(n.stylingTemplate,i),(n.onElementCreationFns=n.onElementCreationFns||[]).push(()=>{(function(t,e,r,n,i){!function(t,e,r,n,i){if(16&t[1])return;if(!function(t,e,r,n){const i=t[2],o=2*e;return!(o<i.length&&i[o+0]>=0||(me(t,e,t[5].length,n),0))}(t,e,0,i))return;n&&(n=function(t){const e=[];for(let r=0;r<t.length;r++)e.push(Hr(t[r]));return e}(n));const o=t[5],a=o[1],s=o[0],l=t[6],u=t[7],c=4*s;let h=10+c,p=h+4*a,d=p+c;const f=o.length;o.push(n?n.length:0,r?r.length:0);let m=0;const y=[];if(n&&n.length)for(let O=0;O<n.length;O++){const e=n[O];let r=ir(t,e,10,h);-1==r&&(r=h+m,m+=4,y.push(e)),o.push(r)}const g=[];if(r&&r.length)for(let O=0;O<r.length;O++){const e=r[O];let n=ir(t,e,h,p);-1==n?(n=p+m,m+=4,g.push(e)):n+=4*y.length,o.push(n)}let _=2;if(y.length)for(;_<f;){const t=o[_+0],e=o[_+1];if(e){const r=_+2+t;for(let t=r;t<r+e;t++)o[t]+=4*y.length}_+=2+(t+e)}const v=g.length+y.length;for(let O=10;O<t.length;O+=4){const e=O>=p,r=O>=(e?d:h),n=Tr(t,O),i=mr(n);let o=yr(n);Sr(t,O,dr(n,i,o+=e?r?4*y.length:0:4*v+4*(r?y.length:0)))}for(let O=0;O<4*y.length;O++)t.splice(d,0,null),t.splice(h,0,null),h++,p++,d+=2;for(let O=0;O<4*g.length;O++)t.splice(p,0,null),t.push(null),p++,d++;const b=t[4],x=t[3];for(let O=0;O<v;O++){const r=O>=y.length,n=r?O-y.length:O,o=r?g[n]:y[n];let l,u;r?(l=d+4*(a+n),u=h+4*(a+n)):(l=p+4*(s+n),u=10+4*(s+n));let c=r?b:x,f=Br(c,o);-1===f?(E=c,C=o,S=!r&&null,T=e,null===(w=null)&&(w=E.length,E.push(null,null,null),E[w+0]=C),E[w+1]=S,E[w+2]=T,f=w+1):f+=1;const m=Mr(t,o,r,i||null);Sr(t,u,dr(m,f,l)),_r(t,u,o),vr(t,u,null),wr(t,u,0,e),Sr(t,l,dr(m,f,u)),_r(t,l,o),vr(t,l,null),wr(t,l,0,e)}var w,E,C,S,T;o[1]=a+g.length,o[0]=s+y.length,l[0]+=g.length,u[0]+=y.length;const A=4*y.length,I=4*g.length,k=u.length;Wr(t,e,!1,p+4*s,y.length);for(let O=1;O<k;O+=4)u[O+1]+=I+A;const P=l.length;Wr(t,e,!0,d+4*a,g.length);for(let O=1;O<P;O+=4)l[O+1]+=2*A+I;Sr(t,1,dr(0,0,p))}(t.stylingTemplate,i,e,r,n)})(n,t,e,r,i),function(t,e){let r=t[8];r||(r=t[8]=[de]),r[0]=e}(n.stylingTemplate,i)})}function nn(t,e){const r=an(),n=sn(se(),Ft());!function(t,e,r,i){const o=n[8],a=function(t,e){for(let r=1;r<t.length;r+=3)if(t[r+0]>e)return r;return t.length}(o,e);o.splice(a,0,e,r,i)}(0,r,or,[n,t,e,r])}function on(){!function(t,e){const r=Ft(),n=3===Pt(e,r).type?r[bt]:null,i=0!=(8&r[dt]);(function(t,e,r,n,i,o,a=0){let s=0;if(function(t,e){const r=t[8];return!r||r[0]===e}(t,a)&&(function(t){const e=t[8];if(e){for(let t=1;t<e.length;t+=3)e[t+1].apply(this,e[t+2]);e.length=1}}(t),function(t){return cr(t,1)}(t))){const i=t[0],o=8&t[1],a=gr(t);for(let r=10;r<t.length;r+=4)if(cr(t,r)){const o=Tr(t,r),s=Fr(t,r),l=Ir(t,r),u=Ar(t,r),c=4&o?Vr(t,s):null,h=Cr(t,r),p=!!(2&o);let d=u;r<a&&!Dr(d)&&(d=Ar(t,yr(o))),Dr(d)||(d=fr(t,o)),e&&(!n||d)&&(p?lr(i,l,!!d,e,null,h):sr(i,l,d,e,c,null,h)),ur(t,r,!1)}if(o){const e=Array.isArray(r)?_e(r):r,o=t[9],a=o[0];for(let t=1;t<a;t+=2){const r=o[t],a=t+1,l=o[a];if(r){const t=r.buildPlayer(l,n);void 0!==t&&(null!=t&&ye(o,e,i,t,a)&&s++,l&&l.destroy())}else l&&l.destroy()}Pr(t,!1)}kr(t,!1)}return s})(sn(e,r),n,r,i,0,0,t)>0&&function(t,e){const r=0===t.flags;if(t.flags|=2,r&&t.clean==Gr){let e;t.clean=new Promise(t=>e=t),t.scheduler(()=>{if(1&t.flags&&(t.flags&=-2,tn(t)),2&t.flags){t.flags&=-3;const e=t.playerHandler;e&&e.flushPlayers()}t.clean=Gr,e(null)})}}(_e(r)),Nt(null)}(an(),se())}function an(){return qt+Ht}function sn(t,e){let r=zt;return r||Nt(r=function(t,e){let r=t,n=e[r],i=e;for(;Array.isArray(n);)i=n,n=n[ht];if(o=i,Array.isArray(o)&&"number"==typeof o[Ct])return i;{const o=Pt(t-Et,e).stylingTemplate;return i!==e&&(r=ht),i[r]=o?function(t,e){const r=e.slice();for(let n=0;n<10;n++){const t=e[n];Array.isArray(t)&&(r[n]=t.slice())}return r[0]=t,r[1]|=16,r}(n,o):fe(n)}var o}(t+Et,e)),r}function ln(t){return!!t&&"function"==typeof t.then}function un(t){return!!t&&"function"==typeof t.subscribe}let cn=null;function hn(){if(!cn){const t=C.Symbol;if(t&&t.iterator)cn=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const r=t[e];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(cn=r)}}}return cn}function pn(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function dn(t,e){const r=mn(t),n=mn(e);if(r&&n)return function(t,e,r){const n=t[hn()](),i=e[hn()]();for(;;){const t=n.next(),e=i.next();if(t.done&&e.done)return!0;if(t.done||e.done)return!1;if(!r(t.value,e.value))return!1}}(t,e,dn);{const i=t&&("object"==typeof t||"function"==typeof t),o=e&&("object"==typeof e||"function"==typeof e);return!(r||!i||n||!o)||pn(t,e)}}class fn{constructor(t){this.wrapped=t}static wrap(t){return new fn(t)}static unwrap(t){return fn.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof fn}}function mn(t){return!!yn(t)&&(Array.isArray(t)||!(t instanceof Map)&&hn()in t)}function yn(t){return null!==t&&("function"==typeof t||"object"==typeof t)}class gn{constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}const _n=new k("The presence of this token marks an injector as being the root injector.");class vn{}class bn{}function xn(t){const e=Error(`No component factory found for ${v(t)}. Did you add it to @NgModule.entryComponents?`);return e[wn]=t,e}const wn="ngComponent";class En{resolveComponentFactory(t){throw xn(t)}}const Cn=(()=>{class t{}return t.NULL=new En,t})();class Sn{constructor(t,e,r){this._parent=e,this._ngModule=r,this._factories=new Map;for(let n=0;n<t.length;n++){const e=t[n];this._factories.set(e.componentType,e)}}resolveComponentFactory(t){let e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw xn(t);return new Tn(e,this._ngModule)}}class Tn extends bn{constructor(t,e){super(),this.factory=t,this.ngModule=e,this.selector=t.selector,this.componentType=t.componentType,this.ngContentSelectors=t.ngContentSelectors,this.inputs=t.inputs,this.outputs=t.outputs}create(t,e,r,n){return this.factory.create(t,e,r,n||this.ngModule)}}class An{}class In{}function kn(...t){}const Pn=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=(()=>On(t)),t})(),On=kn;class Rn{}class Dn{}const Mn=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}(),Ln=(()=>{class t{}return t.__NG_ELEMENT_ID__=(()=>zn()),t})(),zn=kn;class Nn{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Fn=new Nn("8.0.1");class Bn{constructor(){}supports(t){return mn(t)}create(t){return new jn(t)}}const Vn=(t,e)=>e;class jn{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Vn}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,r=this._removalsHead,n=0,i=null;for(;e||r;){const o=!r||e&&e.currentIndex<Wn(r,n,i)?e:r,a=Wn(o,n,i),s=o.currentIndex;if(o===r)n--,r=r._nextRemoved;else if(e=e._next,null==o.previousIndex)n++;else{i||(i=[]);const t=a-n,e=s-n;if(t!=e){for(let r=0;r<t;r++){const n=r<i.length?i[r]:i[r]=0,o=n+r;e<=o&&o<t&&(i[r]=n+1)}i[o.previousIndex]=e-t}}a!==s&&t(o,a,s)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!mn(t))throw new Error(`Error trying to diff '${v(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,r,n,i=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=this._trackByFn(e,r=t[e]),null!==i&&pn(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,r,n,e)),pn(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,n,e),o=!0),i=i._next}else e=0,function(t,e){if(Array.isArray(t))for(let r=0;r<t.length;r++)e(t[r]);else{const r=t[hn()]();let n;for(;!(n=r.next()).done;)e(n.value)}}(t,t=>{n=this._trackByFn(e,t),null!==i&&pn(i.trackById,n)?(o&&(i=this._verifyReinsertion(i,t,n,e)),pn(i.item,t)||this._addIdentityChange(i,t)):(i=this._mismatch(i,t,n,e),o=!0),i=i._next,e++}),this.length=e;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,r,n){let i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,n))?(pn(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,n)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(pn(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,n)):t=this._addAfter(new Un(e,r),i,n),t}_verifyReinsertion(t,e,r,n){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?t=this._reinsertAfter(i,t._prev,n):t.currentIndex!=n&&(t.currentIndex=n,this._addToMoves(t,n)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const n=t._prevRemoved,i=t._nextRemoved;return null===n?this._removalsHead=i:n._nextRemoved=i,null===i?this._removalsTail=n:i._prevRemoved=n,this._insertAfter(t,e,r),this._addToMoves(t,r),t}_moveAfter(t,e,r){return this._unlink(t),this._insertAfter(t,e,r),this._addToMoves(t,r),t}_addAfter(t,e,r){return this._insertAfter(t,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,r){const n=null===e?this._itHead:e._next;return t._next=n,t._prev=e,null===n?this._itTail=t:n._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Hn),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,r=t._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,t}_addToMoves(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Hn),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Un{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class qn{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&pn(r.trackById,t))return r;return null}remove(t){const e=t._prevDup,r=t._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class Hn{constructor(){this.map=new Map}put(t){const e=t.trackById;let r=this.map.get(e);r||(r=new qn,this.map.set(e,r)),r.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Wn(t,e,r){const n=t.previousIndex;if(null===n)return n;let i=0;return r&&n<r.length&&(i=r[n]),n+e+i}class Gn{constructor(){}supports(t){return t instanceof Map||yn(t)}create(){return new Zn}}class Zn{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||yn(t)))throw new Error(`Error trying to diff '${v(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const n=this._getOrCreateRecordForKey(r,t);e=this._insertBeforeOrAppend(e,n)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const r=t._prev;return e._next=t,e._prev=r,t._prev=e,r&&(r._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const n=r._prev,i=r._next;return n&&(n._next=i),i&&(i._prev=n),r._next=null,r._prev=null,r}const r=new Qn(t);return this._records.set(t,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){pn(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(r=>e(t[r],r))}}class Qn{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}const Kn=(()=>{class t{constructor(t){this.factories=t}static create(e,r){if(null!=r){const t=r.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>{if(!r)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,r)},deps:[[t,new d,new h]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${r=t,r.name||typeof r}'`);var r}}return t.ngInjectableDef=y({providedIn:"root",factory:()=>new t([new Bn])}),t})(),$n=(()=>{class t{constructor(t){this.factories=t}static create(e,r){if(r){const t=r.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>{if(!r)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,r)},deps:[[t,new d,new h]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.ngInjectableDef=y({providedIn:"root",factory:()=>new t([new Gn])}),t})(),Xn=(()=>{class t{}return t.__NG_ELEMENT_ID__=(()=>Yn()),t})(),Yn=(...t)=>{},Jn=[new Gn],ti=new Kn([new Bn]),ei=new $n(Jn),ri=(()=>{class t{}return t.__NG_ELEMENT_ID__=(()=>ni(t,Pn)),t})(),ni=kn,ii=(()=>{class t{}return t.__NG_ELEMENT_ID__=(()=>oi(t,Pn)),t})(),oi=kn;function ai(t,e,r,n){let i=`ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '${e}'. Current value: '${r}'.`;return n&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){const r=new Error(t);return si(r,e),r}(i,t)}function si(t,e){t[Q]=e,t[$]=e.logError.bind(e)}function li(t){return new Error(`ViewDestroyedError: Attempt to use a destroyed view: ${t}`)}function ui(t,e,r){const n=t.state,i=1792&n;return i===e?(t.state=-1793&n|r,t.initIndex=-1,!0):i===r}function ci(t,e,r){return(1792&t.state)===e&&t.initIndex<=r&&(t.initIndex=r+1,!0)}function hi(t,e){return t.nodes[e]}function pi(t,e){return t.nodes[e]}function di(t,e){return t.nodes[e]}function fi(t,e){return t.nodes[e]}function mi(t,e){return t.nodes[e]}const yi={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},gi=()=>{},_i=new Map;function vi(t){let e=_i.get(t);return e||(e=v(t)+"_"+_i.size,_i.set(t,e)),e}function bi(t,e,r,n){if(fn.isWrapped(n)){n=fn.unwrap(n);const i=t.def.nodes[e].bindingIndex+r,o=fn.unwrap(t.oldValues[i]);t.oldValues[i]=new fn(o)}return n}const xi="$$undefined",wi="$$empty";function Ei(t){return{id:xi,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}let Ci=0;function Si(t,e,r,n){return!(!(2&t.state)&&pn(t.oldValues[e.bindingIndex+r],n))}function Ti(t,e,r,n){return!!Si(t,e,r,n)&&(t.oldValues[e.bindingIndex+r]=n,!0)}function Ai(t,e,r,n){const i=t.oldValues[e.bindingIndex+r];if(1&t.state||!dn(i,n)){const o=e.bindings[r].name;throw ai(yi.createDebugContext(t,e.nodeIndex),`${o}: ${i}`,`${o}: ${n}`,0!=(1&t.state))}}function Ii(t){let e=t;for(;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function ki(t,e){let r=t;for(;r&&r!==e;)r.state|=64,r=r.viewContainerParent||r.parent}function Pi(t,e,r,n){try{return Ii(33554432&t.def.nodes[e].flags?pi(t,e).componentView:t),yi.handleEvent(t,e,r,n)}catch(i){t.root.errorHandler.handleError(i)}}function Oi(t){return t.parent?pi(t.parent,t.parentNodeDef.nodeIndex):null}function Ri(t){return t.parent?t.parentNodeDef.parent:null}function Di(t,e){switch(201347067&e.flags){case 1:return pi(t,e.nodeIndex).renderElement;case 2:return hi(t,e.nodeIndex).renderText}}function Mi(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Li(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function zi(t){const e={};let r=0;const n={};return t&&t.forEach(([t,i])=>{"number"==typeof t?(e[t]=i,r|=function(t){return 1<<t%32}(t)):n[t]=i}),{matchedQueries:e,references:n,matchedQueryIds:r}}function Ni(t,e){return t.map(t=>{let r,n;return Array.isArray(t)?[n,r]=t:(n=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,P,{value:e,configurable:!0}),{flags:n,token:r,tokenKey:vi(r)}})}function Fi(t,e,r){let n=r.renderParent;return n?0==(1&n.flags)||0==(33554432&n.flags)||n.element.componentRendererType&&n.element.componentRendererType.encapsulation===J.Native?pi(t,r.renderParent.nodeIndex).renderElement:void 0:e}const Bi=new WeakMap;function Vi(t){let e=Bi.get(t);return e||((e=t(()=>gi)).factory=t,Bi.set(t,e)),e}function ji(t,e,r,n,i){3===e&&(r=t.renderer.parentNode(Di(t,t.def.lastRenderRootNode))),Ui(t,e,0,t.def.nodes.length-1,r,n,i)}function Ui(t,e,r,n,i,o,a){for(let s=r;s<=n;s++){const r=t.def.nodes[s];11&r.flags&&Hi(t,r,e,i,o,a),s+=r.childCount}}function qi(t,e,r,n,i,o){let a=t;for(;a&&!Mi(a);)a=a.parent;const s=a.parent,l=Ri(a),u=l.nodeIndex+l.childCount;for(let c=l.nodeIndex+1;c<=u;c++){const t=s.def.nodes[c];t.ngContentIndex===e&&Hi(s,t,r,n,i,o),c+=t.childCount}if(!s.parent){const a=t.root.projectableNodes[e];if(a)for(let e=0;e<a.length;e++)Wi(t,a[e],r,n,i,o)}}function Hi(t,e,r,n,i,o){if(8&e.flags)qi(t,e.ngContent.index,r,n,i,o);else{const a=Di(t,e);if(3===r&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&Wi(t,a,r,n,i,o),32&e.bindingFlags&&Wi(pi(t,e.nodeIndex).componentView,a,r,n,i,o)):Wi(t,a,r,n,i,o),16777216&e.flags){const a=pi(t,e.nodeIndex).viewContainer._embeddedViews;for(let t=0;t<a.length;t++)ji(a[t],r,n,i,o)}1&e.flags&&!e.element.name&&Ui(t,r,e.nodeIndex+1,e.nodeIndex+e.childCount,n,i,o)}}function Wi(t,e,r,n,i,o){const a=t.renderer;switch(r){case 1:a.appendChild(n,e);break;case 2:a.insertBefore(n,e,i);break;case 3:a.removeChild(n,e);break;case 0:o.push(e)}}const Gi=/^:([^:]+):(.+)$/;function Zi(t){if(":"===t[0]){const e=t.match(Gi);return[e[1],e[2]]}return["",t]}function Qi(t){let e=0;for(let r=0;r<t.length;r++)e|=t[r].flags;return e}const Ki=new Object,$i=vi(M),Xi=vi(R),Yi=vi(An);function Ji(t,e,r,n){return r=w(r),{index:-1,deps:Ni(n,v(e)),flags:t,token:e,value:r}}function to(t){const e={},r=[];let n=!1;for(let i=0;i<t.length;i++){const o=t[i];o.token===_n&&!0===o.value&&(n=!0),1073741824&o.flags&&r.push(o.token),o.index=i,e[vi(o.token)]=o}return{factory:null,providersByKey:e,providers:t,modules:r,isRoot:n}}function eo(t,e,r=M.THROW_IF_NOT_FOUND){const n=A(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(r=null),1&e.flags)return t._parent.get(e.token,r);const a=e.tokenKey;switch(a){case $i:case Xi:case Yi:return t}const s=t._def.providersByKey[a];let l;if(s){let e=t._providers[s.index];return void 0===e&&(e=t._providers[s.index]=ro(t,s)),e===Ki?void 0:e}if((l=g(e.token))&&(i=t,null!=(o=l).providedIn&&(function(t,e){return t._def.modules.indexOf(o.providedIn)>-1}(i)||"root"===o.providedIn&&i._def.isRoot))){const r=t._providers.length;return t._def.providers[r]=t._def.providersByKey[e.tokenKey]={flags:5120,value:l.factory,deps:[],index:r,token:e.token},t._providers[r]=Ki,t._providers[r]=ro(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?r:t._parent.get(e.token,r)}finally{A(n)}var i,o}function ro(t,e){let r;switch(201347067&e.flags){case 512:r=function(t,e,r){const n=r.length;switch(n){case 0:return new e;case 1:return new e(eo(t,r[0]));case 2:return new e(eo(t,r[0]),eo(t,r[1]));case 3:return new e(eo(t,r[0]),eo(t,r[1]),eo(t,r[2]));default:const i=new Array(n);for(let e=0;e<n;e++)i[e]=eo(t,r[e]);return new e(...i)}}(t,e.value,e.deps);break;case 1024:r=function(t,e,r){const n=r.length;switch(n){case 0:return e();case 1:return e(eo(t,r[0]));case 2:return e(eo(t,r[0]),eo(t,r[1]));case 3:return e(eo(t,r[0]),eo(t,r[1]),eo(t,r[2]));default:const i=Array(n);for(let e=0;e<n;e++)i[e]=eo(t,r[e]);return e(...i)}}(t,e.value,e.deps);break;case 2048:r=eo(t,e.deps[0]);break;case 256:r=e.value}return r===Ki||null===r||"object"!=typeof r||131072&e.flags||"function"!=typeof r.ngOnDestroy||(e.flags|=131072),void 0===r?Ki:r}function no(t,e){const r=t.viewContainer._embeddedViews;if((null==e||e>=r.length)&&(e=r.length-1),e<0)return null;const n=r[e];return n.viewContainerParent=null,so(r,e),yi.dirtyParentQueries(n),oo(n),n}function io(t,e,r){const n=e?Di(e,e.def.lastRenderRootNode):t.renderElement,i=r.renderer.parentNode(n),o=r.renderer.nextSibling(n);ji(r,2,i,o,void 0)}function oo(t){ji(t,3,null,null,void 0)}function ao(t,e,r){e>=t.length?t.push(r):t.splice(e,0,r)}function so(t,e){e>=t.length-1?t.pop():t.splice(e,1)}const lo=new Object;function uo(t,e,r,n,i,o){return new co(t,e,r,n,i,o)}class co extends bn{constructor(t,e,r,n,i,o){super(),this.selector=t,this.componentType=e,this._inputs=n,this._outputs=i,this.ngContentSelectors=o,this.viewDefFactory=r}get inputs(){const t=[],e=this._inputs;for(let r in e)t.push({propName:r,templateName:e[r]});return t}get outputs(){const t=[];for(let e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t}create(t,e,r,n){if(!n)throw new Error("ngModule should be provided");const i=Vi(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,a=yi.createRootView(t,e||[],r,i,n,lo),s=di(a,o).instance;return r&&a.renderer.setAttribute(pi(a,0).renderElement,"ng-version",Fn.full),new ho(a,new yo(a),s)}}class ho extends vn{constructor(t,e,r){super(),this._view=t,this._viewRef=e,this._component=r,this._elDef=this._view.def.nodes[0],this.hostView=e,this.changeDetectorRef=e,this.instance=r}get location(){return new Pn(pi(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new bo(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){this._viewRef.destroy()}onDestroy(t){this._viewRef.onDestroy(t)}}function po(t,e,r){return new fo(t,e,r)}class fo{constructor(t,e,r){this._view=t,this._elDef=e,this._data=r,this._embeddedViews=[]}get element(){return new Pn(this._data.renderElement)}get injector(){return new bo(this._view,this._elDef)}get parentInjector(){let t=this._view,e=this._elDef.parent;for(;!e&&t;)e=Ri(t),t=t.parent;return t?new bo(t,e):new bo(this._view,null)}clear(){for(let t=this._embeddedViews.length-1;t>=0;t--){const e=no(this._data,t);yi.destroyView(e)}}get(t){const e=this._embeddedViews[t];if(e){const t=new yo(e);return t.attachToViewContainerRef(this),t}return null}get length(){return this._embeddedViews.length}createEmbeddedView(t,e,r){const n=t.createEmbeddedView(e||{});return this.insert(n,r),n}createComponent(t,e,r,n,i){const o=r||this.parentInjector;i||t instanceof Tn||(i=o.get(An));const a=t.create(o,n,void 0,i);return this.insert(a.hostView,e),a}insert(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");const r=t;return function(t,e,r,n){let i=e.viewContainer._embeddedViews;null==r&&(r=i.length),n.viewContainerParent=t,ao(i,r,n),function(t,e){const r=Oi(e);if(!r||r===t||16&e.state)return;e.state|=16;let n=r.template._projectedViews;n||(n=r.template._projectedViews=[]),n.push(e),function(t,r){if(4&r.flags)return;e.parent.def.nodeFlags|=4,r.flags|=4;let n=r.parent;for(;n;)n.childFlags|=4,n=n.parent}(0,e.parentNodeDef)}(e,n),yi.dirtyParentQueries(n),io(e,r>0?i[r-1]:null,n)}(this._view,this._data,e,r._view),r.attachToViewContainerRef(this),t}move(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");const r=this._embeddedViews.indexOf(t._view);return function(t,e,n){const i=t.viewContainer._embeddedViews,o=i[r];so(i,r),null==n&&(n=i.length),ao(i,n,o),yi.dirtyParentQueries(o),oo(o),io(t,n>0?i[n-1]:null,o)}(this._data,0,e),t}indexOf(t){return this._embeddedViews.indexOf(t._view)}remove(t){const e=no(this._data,t);e&&yi.destroyView(e)}detach(t){const e=no(this._data,t);return e?new yo(e):null}}function mo(t){return new yo(t)}class yo{constructor(t){this._view=t,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(t){const e=[];return ji(t,0,void 0,void 0,e),e}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){Ii(this._view)}detach(){this._view.state&=-5}detectChanges(){const t=this._view.root.rendererFactory;t.begin&&t.begin();try{yi.checkAndUpdateView(this._view)}finally{t.end&&t.end()}}checkNoChanges(){yi.checkNoChangesView(this._view)}reattach(){this._view.state|=4}onDestroy(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)}destroy(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),yi.destroyView(this._view)}detachFromAppRef(){this._appRef=null,oo(this._view),yi.dirtyParentQueries(this._view)}attachToAppRef(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}attachToViewContainerRef(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}}function go(t,e){return new _o(t,e)}class _o extends ri{constructor(t,e){super(),this._parentView=t,this._def=e}createEmbeddedView(t){return new yo(yi.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))}get elementRef(){return new Pn(pi(this._parentView,this._def.nodeIndex).renderElement)}}function vo(t,e){return new bo(t,e)}class bo{constructor(t,e){this.view=t,this.elDef=e}get(t,e=M.THROW_IF_NOT_FOUND){return yi.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:vi(t)},e)}}function xo(t,e){const r=t.def.nodes[e];if(1&r.flags){const e=pi(t,r.nodeIndex);return r.element.template?e.template:e.renderElement}if(2&r.flags)return hi(t,r.nodeIndex).renderText;if(20240&r.flags)return di(t,r.nodeIndex).instance;throw new Error(`Illegal state: read nodeValue for node index ${e}`)}function wo(t){return new Eo(t.renderer)}class Eo{constructor(t){this.delegate=t}selectRootElement(t){return this.delegate.selectRootElement(t)}createElement(t,e){const[r,n]=Zi(e),i=this.delegate.createElement(n,r);return t&&this.delegate.appendChild(t,i),i}createViewRoot(t){return t}createTemplateAnchor(t){const e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e}createText(t,e){const r=this.delegate.createText(e);return t&&this.delegate.appendChild(t,r),r}projectNodes(t,e){for(let r=0;r<e.length;r++)this.delegate.appendChild(t,e[r])}attachViewAfter(t,e){const r=this.delegate.parentNode(t),n=this.delegate.nextSibling(t);for(let i=0;i<e.length;i++)this.delegate.insertBefore(r,e[i],n)}detachView(t){for(let e=0;e<t.length;e++){const r=t[e],n=this.delegate.parentNode(r);this.delegate.removeChild(n,r)}}destroyView(t,e){for(let r=0;r<e.length;r++)this.delegate.destroyNode(e[r])}listen(t,e,r){return this.delegate.listen(t,e,r)}listenGlobal(t,e,r){return this.delegate.listen(t,e,r)}setElementProperty(t,e,r){this.delegate.setProperty(t,e,r)}setElementAttribute(t,e,r){const[n,i]=Zi(e);null!=r?this.delegate.setAttribute(t,i,r,n):this.delegate.removeAttribute(t,i,n)}setBindingDebugInfo(t,e,r){}setElementClass(t,e,r){r?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)}setElementStyle(t,e,r){null!=r?this.delegate.setStyle(t,e,r):this.delegate.removeStyle(t,e)}invokeElementMethod(t,e,r){t[e].apply(t,r)}setText(t,e){this.delegate.setValue(t,e)}animate(){throw new Error("Renderer.animate is no longer supported!")}}function Co(t,e,r,n){return new So(t,e,r,n)}class So{constructor(t,e,r,n){this._moduleType=t,this._parent=e,this._bootstrapComponents=r,this._def=n,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){const e=t._def,r=t._providers=new Array(e.providers.length);for(let n=0;n<e.providers.length;n++){const i=e.providers[n];4096&i.flags||void 0===r[n]&&(r[n]=ro(t,i))}}(this)}get(t,e=M.THROW_IF_NOT_FOUND,r=f.Default){let n=0;return r&f.SkipSelf?n|=1:r&f.Self&&(n|=4),eo(this,{token:t,tokenKey:vi(t),flags:n},e)}get instance(){return this.get(this._moduleType)}get componentFactoryResolver(){return this.get(Cn)}destroy(){if(this._destroyed)throw new Error(`The ng module ${v(this.instance.constructor)} has already been destroyed.`);this._destroyed=!0,function(t,e){const r=t._def,n=new Set;for(let i=0;i<r.providers.length;i++)if(131072&r.providers[i].flags){const e=t._providers[i];if(e&&e!==Ki){const t=e.ngOnDestroy;"function"!=typeof t||n.has(e)||(t.apply(e),n.add(e))}}}(this),this._destroyListeners.forEach(t=>t())}onDestroy(t){this._destroyListeners.push(t)}}const To=vi(Rn),Ao=vi(Ln),Io=vi(Pn),ko=vi(ii),Po=vi(ri),Oo=vi(Xn),Ro=vi(M),Do=vi(R);function Mo(t,e,r,n,i,o,a,s){const l=[];if(a)for(let c in a){const[t,e]=a[c];l[t]={flags:8,name:c,nonMinifiedName:e,ns:null,securityContext:null,suffix:null}}const u=[];if(s)for(let c in s)u.push({type:1,propName:c,target:null,eventName:s[c]});return No(t,e|=16384,r,n,i,i,o,l,u)}function Lo(t,e,r){return No(-1,t|=16,null,0,e,e,r)}function zo(t,e,r,n,i){return No(-1,t,e,0,r,n,i)}function No(t,e,r,n,i,o,a,s,l){const{matchedQueries:u,references:c,matchedQueryIds:h}=zi(r);l||(l=[]),s||(s=[]),o=w(o);const p=Ni(a,v(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:u,matchedQueryIds:h,references:c,ngContentIndex:-1,childCount:n,bindings:s,bindingFlags:Qi(s),outputs:l,element:null,provider:{token:i,value:o,deps:p},text:null,query:null,ngContent:null}}function Fo(t,e){return Uo(t,e)}function Bo(t,e){let r=t;for(;r.parent&&!Mi(r);)r=r.parent;return qo(r.parent,Ri(r),!0,e.provider.value,e.provider.deps)}function Vo(t,e){const r=qo(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(let n=0;n<e.outputs.length;n++){const i=e.outputs[n],o=r[i.propName];if(!un(o))throw new Error(`@Output ${i.propName} not initialized in '${r.constructor.name}'.`);{const r=o.subscribe(jo(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+n]=r.unsubscribe.bind(r)}}return r}function jo(t,e,r){return n=>Pi(t,e,r,n)}function Uo(t,e){const r=(8192&e.flags)>0,n=e.provider;switch(201347067&e.flags){case 512:return qo(t,e.parent,r,n.value,n.deps);case 1024:return function(t,e,r,n,i){const o=i.length;switch(o){case 0:return n();case 1:return n(Wo(t,e,r,i[0]));case 2:return n(Wo(t,e,r,i[0]),Wo(t,e,r,i[1]));case 3:return n(Wo(t,e,r,i[0]),Wo(t,e,r,i[1]),Wo(t,e,r,i[2]));default:const a=Array(o);for(let n=0;n<o;n++)a[n]=Wo(t,e,r,i[n]);return n(...a)}}(t,e.parent,r,n.value,n.deps);case 2048:return Wo(t,e.parent,r,n.deps[0]);case 256:return n.value}}function qo(t,e,r,n,i){const o=i.length;switch(o){case 0:return new n;case 1:return new n(Wo(t,e,r,i[0]));case 2:return new n(Wo(t,e,r,i[0]),Wo(t,e,r,i[1]));case 3:return new n(Wo(t,e,r,i[0]),Wo(t,e,r,i[1]),Wo(t,e,r,i[2]));default:const a=new Array(o);for(let n=0;n<o;n++)a[n]=Wo(t,e,r,i[n]);return new n(...a)}}const Ho={};function Wo(t,e,r,n,i=M.THROW_IF_NOT_FOUND){if(8&n.flags)return n.token;const o=t;2&n.flags&&(i=null);const a=n.tokenKey;a===Oo&&(r=!(!e||!e.element.componentView)),e&&1&n.flags&&(r=!1,e=e.parent);let s=t;for(;s;){if(e)switch(a){case To:return wo(Go(s,e,r));case Ao:return Go(s,e,r).renderer;case Io:return new Pn(pi(s,e.nodeIndex).renderElement);case ko:return pi(s,e.nodeIndex).viewContainer;case Po:if(e.element.template)return pi(s,e.nodeIndex).template;break;case Oo:return mo(Go(s,e,r));case Ro:case Do:return vo(s,e);default:const t=(r?e.element.allProviders:e.element.publicProviders)[a];if(t){let e=di(s,t.nodeIndex);return e||(e={instance:Uo(s,t)},s.nodes[t.nodeIndex]=e),e.instance}}r=Mi(s),e=Ri(s),s=s.parent,4&n.flags&&(s=null)}const l=o.root.injector.get(n.token,Ho);return l!==Ho||i===Ho?l:o.root.ngModule.injector.get(n.token,i)}function Go(t,e,r){let n;if(r)n=pi(t,e.nodeIndex).componentView;else for(n=t;n.parent&&!Mi(n);)n=n.parent;return n}function Zo(t,e,r,n,i,o){if(32768&r.flags){const e=pi(t,r.parent.nodeIndex).componentView;2&e.def.flags&&(e.state|=8)}if(e.instance[r.bindings[n].name]=i,524288&r.flags){o=o||{};const e=fn.unwrap(t.oldValues[r.bindingIndex+n]);o[r.bindings[n].nonMinifiedName]=new gn(e,i,0!=(2&t.state))}return t.oldValues[r.bindingIndex+n]=i,o}function Qo(t,e){if(!(t.def.nodeFlags&e))return;const r=t.def.nodes;let n=0;for(let i=0;i<r.length;i++){const o=r[i];let a=o.parent;for(!a&&o.flags&e&&$o(t,i,o.flags&e,n++),0==(o.childFlags&e)&&(i+=o.childCount);a&&1&a.flags&&i===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(n=Ko(t,a,e,n)),a=a.parent}}function Ko(t,e,r,n){for(let i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){const e=t.def.nodes[i];e.flags&r&&$o(t,i,e.flags&r,n++),i+=e.childCount}return n}function $o(t,e,r,n){const i=di(t,e);if(!i)return;const o=i.instance;o&&(yi.setCurrentNode(t,e),1048576&r&&ci(t,512,n)&&o.ngAfterContentInit(),2097152&r&&o.ngAfterContentChecked(),4194304&r&&ci(t,768,n)&&o.ngAfterViewInit(),8388608&r&&o.ngAfterViewChecked(),131072&r&&o.ngOnDestroy())}const Xo=new k("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ct});class Yo extends n.a{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,r){let n,o=t=>null,a=()=>null;t&&"object"==typeof t?(n=this.__isAsync?e=>{setTimeout(()=>t.next(e))}:e=>{t.next(e)},t.error&&(o=this.__isAsync?e=>{setTimeout(()=>t.error(e))}:e=>{t.error(e)}),t.complete&&(a=this.__isAsync?()=>{setTimeout(()=>t.complete())}:()=>{t.complete()})):(n=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)},e&&(o=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)}),r&&(a=this.__isAsync?()=>{setTimeout(()=>r())}:()=>{r()}));const s=super.subscribe(n,o,a);return t instanceof i.a&&t.add(s),s}}class Jo{constructor(){this.dirty=!0,this._results=[],this.changes=new Yo,this.length=0}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}[hn()](){return this._results[hn()]()}toString(){return this._results.toString()}reset(t){this._results=function t(e,r){void 0===r&&(r=e);for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?(r===e&&(r=e.slice(0,n)),t(i,r)):r!==e&&r.push(i)}return r}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class ta{}const ea=new k("Application Initializer"),ra=(()=>(class{constructor(t){this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const e=this.appInits[r]();ln(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}))(),na=new k("AppId");function ia(){return`${oa()}${oa()}${oa()}`}function oa(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const aa=new k("Platform Initializer"),sa=new k("Platform ID"),la=new k("appBootstrapListener"),ua=(()=>(class{log(t){console.log(t)}warn(t){console.warn(t)}}))();function ca(){throw new Error("Runtime compiler is not loaded")}const ha=ca,pa=ca,da=ca,fa=ca,ma=(()=>(class{constructor(){this.compileModuleSync=ha,this.compileModuleAsync=pa,this.compileModuleAndAllComponentsSync=da,this.compileModuleAndAllComponentsAsync=fa}clearCache(){}clearCacheFor(t){}getModuleId(t){}}))();class ya{}let ga,_a;function va(){const t=C.wtf;return!(!t||!(ga=t.trace)||(_a=ga.events,0))}const ba=va(),xa=ba?function(t,e=null){return _a.createScope(t,e)}:(t,e)=>(function(t,e){return null}),wa=ba?function(t,e){return ga.leaveScope(t,e),e}:(t,e)=>e,Ea=(()=>Promise.resolve(0))();function Ca(t){"undefined"==typeof Zone?Ea.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Sa{constructor({enableLongStackTrace:t=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Yo(!1),this.onMicrotaskEmpty=new Yo(!1),this.onStable=new Yo(!1),this.onError=new Yo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");var e;Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,n,i,o,a)=>{try{return ka(e),t.invokeTask(n,i,o,a)}finally{Pa(e)}},onInvoke:(t,r,n,i,o,a,s)=>{try{return ka(e),t.invoke(n,i,o,a,s)}finally{Pa(e)}},onHasTask:(t,r,n,i)=>{t.hasTask(n,i),r===n&&("microTask"==i.change?(e.hasPendingMicrotasks=i.microTask,Ia(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,r,n,i)=>(t.handleError(n,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Sa.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Sa.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,n){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+n,t,Aa,Ta,Ta);try{return i.runTask(o,e,r)}finally{i.cancelTask(o)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}}function Ta(){}const Aa={};function Ia(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ka(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Pa(t){t._nesting--,Ia(t)}class Oa{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Yo,this.onMicrotaskEmpty=new Yo,this.onStable=new Yo,this.onError=new Yo}run(t){return t()}runGuarded(t){return t()}runOutsideAngular(t){return t()}runTask(t){return t()}}const Ra=(()=>(class{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Sa.assertNotInAngularZone(),Ca(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ca(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,r){let n=-1;e&&e>0&&(n=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==n),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:n,updateCb:r})}whenStable(t,e,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,r){return[]}}))(),Da=(()=>{class t{constructor(){this._applications=new Map,Na.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return Na.findTestabilityInTree(this,t,e)}}return t.ctorParameters=(()=>[]),t})();class Ma{addToWindow(t){}findTestabilityInTree(t,e,r){return null}}function La(t){Na=t}let za,Na=new Ma,Fa=function(t){return t instanceof Tn};const Ba=new k("AllowMultipleToken");class Va{constructor(t,e){this.name=t,this.token=e}}function ja(t,e,r=[]){const n=`Platform: ${e}`,i=new k(n);return(e=[])=>{let o=Ua();if(!o||o.injector.get(Ba,!1))if(t)t(r.concat(e).concat({provide:i,useValue:!0}));else{const t=r.concat(e).concat({provide:i,useValue:!0});!function(t){if(za&&!za.destroyed&&!za.injector.get(Ba,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");za=t.get(qa);const e=t.get(aa,null);e&&e.forEach(t=>t())}(M.create({providers:t,name:n}))}return function(t){const e=Ua();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function Ua(){return za&&!za.destroyed?za:null}const qa=(()=>(class{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const r="noop"===(i=e?e.ngZone:void 0)?new Oa:("zone.js"===i?void 0:i)||new Sa({enableLongStackTrace:Se()}),n=[{provide:Sa,useValue:r}];var i;return r.run(()=>{const e=M.create({providers:n,parent:this.injector,name:t.moduleType.name}),i=t.create(e),o=i.injector.get(we,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>Ga(this._modules,i)),r.runOutsideAngular(()=>r.onError.subscribe({next:t=>{o.handleError(t)}})),function(t,e,r){try{const i=r();return ln(i)?i.catch(r=>{throw e.runOutsideAngular(()=>t.handleError(r)),r}):i}catch(n){throw e.runOutsideAngular(()=>t.handleError(n)),n}}(o,r,()=>{const t=i.injector.get(ra);return t.runInitializers(),t.donePromise.then(()=>(this._moduleDoBootstrap(i),i))})})}bootstrapModule(t,e=[]){const r=Ha({},e);return function(t,e,r){return t.get(ya).createCompiler([e]).compileModuleAsync(r)}(this.injector,r,t).then(t=>this.bootstrapModuleFactory(t,r))}_moduleDoBootstrap(t){const e=t.injector.get(Wa);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${v(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. `+"Please define one of these.");t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}))();function Ha(t,e){return Array.isArray(e)?e.reduce(Ha,t):Object.assign({},t,e)}const Wa=(()=>{class t{constructor(t,e,r,n,i,l){this._zone=t,this._console=e,this._injector=r,this._exceptionHandler=n,this._componentFactoryResolver=i,this._initStatus=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Se(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const u=new o.a(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),c=new o.a(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{Sa.assertNotInAngularZone(),Ca(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const r=this._zone.onUnstable.subscribe(()=>{Sa.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),r.unsubscribe()}});this.isStable=Object(a.a)(u,c.pipe(Object(s.a)()))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let r;r=t instanceof bn?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(r.componentType);const n=Fa(r)?null:this._injector.get(An),i=r.create(M.NULL,[],e||r.selector,n);i.onDestroy(()=>{this._unloadComponent(i)});const o=i.injector.get(Ra,null);return o&&i.injector.get(Da).registerApplication(i.location.nativeElement,o),this._loadComponent(i),Se()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");const e=t._tickScope();try{this._runningTick=!0;for(let t of this._views)t.detectChanges();if(this._enforceNoNewChanges)for(let t of this._views)t.checkNoChanges()}catch(r){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(r))}finally{this._runningTick=!1,wa(e)}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;Ga(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(la,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}_unloadComponent(t){this.detachView(t.hostView),Ga(this.components,t)}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy())}get viewCount(){return this._views.length}}return t._tickScope=xa("ApplicationRef#tick()"),t})();function Ga(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}class Za{}const Qa={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Ka=(()=>(class{constructor(t,e){this._compiler=t,this._config=e||Qa}load(t){return this._compiler instanceof ma?this.loadFactory(t):this.loadAndCompile(t)}loadAndCompile(t){let[e,n]=t.split("#");return void 0===n&&(n="default"),r("zn8P")(e).then(t=>t[n]).then(t=>$a(t,e,n)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,n]=t.split("#"),i="NgFactory";return void 0===n&&(n="default",i=""),r("zn8P")(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[n+i]).then(t=>$a(t,e,n))}}))();function $a(t,e,r){if(!t)throw new Error(`Cannot find '${r}' in '${e}'`);return t}class Xa{constructor(t,e){this.name=t,this.callback=e}}class Ya{constructor(t,e,r){this.listeners=[],this.parent=null,this._debugContext=r,this.nativeNode=t,e&&e instanceof Ja&&e.addChild(this)}get injector(){return this._debugContext.injector}get componentInstance(){return this._debugContext.component}get context(){return this._debugContext.context}get references(){return this._debugContext.references}get providerTokens(){return this._debugContext.providerTokens}}class Ja extends Ya{constructor(t,e,r){super(t,e,r),this.properties={},this.attributes={},this.classes={},this.styles={},this.childNodes=[],this.nativeElement=t}addChild(t){t&&(this.childNodes.push(t),t.parent=this)}removeChild(t){const e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))}insertChildrenAfter(t,e){const r=this.childNodes.indexOf(t);-1!==r&&(this.childNodes.splice(r+1,0,...e),e.forEach(e=>{e.parent&&e.parent.removeChild(e),t.parent=this}))}insertBefore(t,e){const r=this.childNodes.indexOf(t);-1===r?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(r,0,e))}query(t){return this.queryAll(t)[0]||null}queryAll(t){const e=[];return function t(e,r,n){e.childNodes.forEach(e=>{e instanceof Ja&&(r(e)&&n.push(e),t(e,r,n))})}(this,t,e),e}queryAllNodes(t){const e=[];return function t(e,r,n){e instanceof Ja&&e.childNodes.forEach(e=>{r(e)&&n.push(e),e instanceof Ja&&t(e,r,n)})}(this,t,e),e}get children(){return this.childNodes.filter(t=>t instanceof Ja)}triggerEventHandler(t,e){this.listeners.forEach(r=>{r.name==t&&r.callback(e)})}}const ts=new Map,es=function(t){return ts.get(t)||null};function rs(t){ts.set(t.nativeNode,t)}const ns=ja(null,"core",[{provide:sa,useValue:"unknown"},{provide:qa,deps:[M]},{provide:Da,deps:[]},{provide:ua,deps:[]}]),is=new k("LocaleId");function os(){return ti}function as(){return ei}function ss(t){return t||"en-US"}function ls(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}const us=(()=>(class{constructor(t){}}))();function cs(t,e,r,n,i,o){t|=1;const{matchedQueries:a,references:s,matchedQueryIds:l}=zi(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a,matchedQueryIds:l,references:s,ngContentIndex:r,childCount:n,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?Vi(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||gi},provider:null,text:null,query:null,ngContent:null}}function hs(t,e,r,n,i,o,a=[],s,l,u,c,h){u||(u=gi);const{matchedQueries:p,references:d,matchedQueryIds:f}=zi(r);let m=null,y=null;o&&([m,y]=Zi(o)),s=s||[];const g=new Array(s.length);for(let b=0;b<s.length;b++){const[t,e,r]=s[b],[n,i]=Zi(e);let o=void 0,a=void 0;switch(15&t){case 4:a=r;break;case 1:case 8:o=r}g[b]={flags:t,ns:n,name:i,nonMinifiedName:i,securityContext:o,suffix:a}}l=l||[];const _=new Array(l.length);for(let b=0;b<l.length;b++){const[t,e]=l[b];_[b]={type:0,target:t,eventName:e,propName:null}}const v=(a=a||[]).map(([t,e])=>{const[r,n]=Zi(t);return[r,n,e]});return h=function(t){if(t&&t.id===xi){const e=null!=t.encapsulation&&t.encapsulation!==J.None||t.styles.length||Object.keys(t.data).length;t.id=e?`c${Ci++}`:wi}return t&&t.id===wi&&(t=null),t||null}(h),c&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:p,matchedQueryIds:f,references:d,ngContentIndex:n,childCount:i,bindings:g,bindingFlags:Qi(g),outputs:_,element:{ns:m,name:y,attrs:v,template:null,componentProvider:null,componentView:c||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:u||gi},provider:null,text:null,query:null,ngContent:null}}function ps(t,e,r){const n=r.element,i=t.root.selectorOrNode,o=t.renderer;let a;if(t.parent||!i){a=n.name?o.createElement(n.name,n.ns):o.createComment("");const i=Fi(t,e,r);i&&o.appendChild(i,a)}else a=o.selectRootElement(i,!!n.componentRendererType&&n.componentRendererType.encapsulation===J.ShadowDom);if(n.attrs)for(let s=0;s<n.attrs.length;s++){const[t,e,r]=n.attrs[s];o.setAttribute(a,e,r,t)}return a}function ds(t,e,r,n){for(let a=0;a<r.outputs.length;a++){const s=r.outputs[a],l=fs(t,r.nodeIndex,(o=s.eventName,(i=s.target)?`${i}:${o}`:o));let u=s.target,c=t;"component"===s.target&&(u=null,c=e);const h=c.renderer.listen(u||n,s.eventName,l);t.disposables[r.outputIndex+a]=h}var i,o}function fs(t,e,r){return n=>Pi(t,e,r,n)}function ms(t,e,r,n){if(!Ti(t,e,r,n))return!1;const i=e.bindings[r],o=pi(t,e.nodeIndex),a=o.renderElement,s=i.name;switch(15&i.flags){case 1:!function(t,e,r,n,i,o){const a=e.securityContext;let s=a?t.root.sanitizer.sanitize(a,o):o;s=null!=s?s.toString():null;const l=t.renderer;null!=o?l.setAttribute(r,i,s,n):l.removeAttribute(r,i,n)}(t,i,a,i.ns,s,n);break;case 2:!function(t,e,r,n){const i=t.renderer;n?i.addClass(e,r):i.removeClass(e,r)}(t,a,s,n);break;case 4:!function(t,e,r,n,i){let o=t.root.sanitizer.sanitize(Ke.STYLE,i);if(null!=o){o=o.toString();const t=e.suffix;null!=t&&(o+=t)}else o=null;const a=t.renderer;null!=o?a.setStyle(r,n,o):a.removeStyle(r,n)}(t,i,a,s,n);break;case 8:!function(t,e,r,n,i){const o=e.securityContext;let a=o?t.root.sanitizer.sanitize(o,i):i;t.renderer.setProperty(r,n,a)}(33554432&e.flags&&32&i.flags?o.componentView:t,i,a,s,n)}return!0}function ys(t){const e=t.def.nodeMatchedQueries;for(;t.parent&&Li(t);){let r=t.parentNodeDef;t=t.parent;const n=r.nodeIndex+r.childCount;for(let i=0;i<=n;i++){const n=t.def.nodes[i];67108864&n.flags&&536870912&n.flags&&(n.query.filterId&e)===n.query.filterId&&mi(t,i).setDirty(),!(1&n.flags&&i+n.childCount<r.nodeIndex)&&67108864&n.childFlags&&536870912&n.childFlags||(i+=n.childCount)}}if(134217728&t.def.nodeFlags)for(let r=0;r<t.def.nodes.length;r++){const e=t.def.nodes[r];134217728&e.flags&&536870912&e.flags&&mi(t,r).setDirty(),r+=e.childCount}}function gs(t,e){const r=mi(t,e.nodeIndex);if(!r.dirty)return;let n,i=void 0;if(67108864&e.flags){const r=e.parent.parent;i=_s(t,r.nodeIndex,r.nodeIndex+r.childCount,e.query,[]),n=di(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=_s(t,0,t.def.nodes.length-1,e.query,[]),n=t.component);r.reset(i);const o=e.query.bindings;let a=!1;for(let s=0;s<o.length;s++){const t=o[s];let e;switch(t.bindingType){case 0:e=r.first;break;case 1:e=r,a=!0}n[t.propName]=e}a&&r.notifyOnChanges()}function _s(t,e,r,n,i){for(let o=e;o<=r;o++){const e=t.def.nodes[o],r=e.matchedQueries[n.id];if(null!=r&&i.push(vs(t,e,r)),1&e.flags&&e.element.template&&(e.element.template.nodeMatchedQueries&n.filterId)===n.filterId){const r=pi(t,o);if((e.childMatchedQueries&n.filterId)===n.filterId&&(_s(t,o+1,o+e.childCount,n,i),o+=e.childCount),16777216&e.flags){const t=r.viewContainer._embeddedViews;for(let e=0;e<t.length;e++){const o=t[e],a=Oi(o);a&&a===r&&_s(o,0,o.def.nodes.length-1,n,i)}}const a=r.template._projectedViews;if(a)for(let t=0;t<a.length;t++){const e=a[t];_s(e,0,e.def.nodes.length-1,n,i)}}(e.childMatchedQueries&n.filterId)!==n.filterId&&(o+=e.childCount)}return i}function vs(t,e,r){if(null!=r)switch(r){case 1:return pi(t,e.nodeIndex).renderElement;case 0:return new Pn(pi(t,e.nodeIndex).renderElement);case 2:return pi(t,e.nodeIndex).template;case 3:return pi(t,e.nodeIndex).viewContainer;case 4:return di(t,e.nodeIndex).instance}}function bs(t,e,r){const n=Fi(t,e,r);n&&qi(t,r.ngContent.index,1,n,null,void 0)}function xs(t,e,r){const n=new Array(r.length-1);for(let i=1;i<r.length;i++)n[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:r[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:n,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:r[0]},query:null,ngContent:null}}function ws(t,e,r){let n;const i=t.renderer;n=i.createText(r.text.prefix);const o=Fi(t,e,r);return o&&i.appendChild(o,n),{renderText:n}}function Es(t,e){return(null!=t?t.toString():"")+e.suffix}function Cs(t,e,r,n){let i=0,o=0,a=0,s=0,l=0,u=null,c=null,h=!1,p=!1,d=null;for(let f=0;f<e.length;f++){const t=e[f];if(t.nodeIndex=f,t.parent=u,t.bindingIndex=i,t.outputIndex=o,t.renderParent=c,a|=t.flags,l|=t.matchedQueryIds,t.element){const e=t.element;e.publicProviders=u?u.element.publicProviders:Object.create(null),e.allProviders=e.publicProviders,h=!1,p=!1,t.element.template&&(l|=t.element.template.nodeMatchedQueries)}if(Ts(u,t,e.length),i+=t.bindings.length,o+=t.outputs.length,!c&&3&t.flags&&(d=t),20224&t.flags){h||(h=!0,u.element.publicProviders=Object.create(u.element.publicProviders),u.element.allProviders=u.element.publicProviders);const e=0!=(32768&t.flags);0==(8192&t.flags)||e?u.element.publicProviders[vi(t.provider.token)]=t:(p||(p=!0,u.element.allProviders=Object.create(u.element.publicProviders)),u.element.allProviders[vi(t.provider.token)]=t),e&&(u.element.componentProvider=t)}if(u?(u.childFlags|=t.flags,u.directChildFlags|=t.flags,u.childMatchedQueries|=t.matchedQueryIds,t.element&&t.element.template&&(u.childMatchedQueries|=t.element.template.nodeMatchedQueries)):s|=t.flags,t.childCount>0)u=t,Ss(t)||(c=t);else for(;u&&f===u.nodeIndex+u.childCount;){const t=u.parent;t&&(t.childFlags|=u.childFlags,t.childMatchedQueries|=u.childMatchedQueries),c=(u=t)&&Ss(u)?u.renderParent:u}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:l,flags:t,nodes:e,updateDirectives:r||gi,updateRenderer:n||gi,handleEvent:(t,r,n,i)=>e[r].element.handleEvent(t,n,i),bindingCount:i,outputCount:o,lastRenderRootNode:d}}function Ss(t){return 0!=(1&t.flags)&&null===t.element.name}function Ts(t,e,r){const n=e.element&&e.element.template;if(n){if(!n.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(n.lastRenderRootNode&&16777216&n.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${e.nodeIndex}!`)}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${e.nodeIndex}!`);if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${e.nodeIndex}!`);if(134217728&e.flags&&t)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${e.nodeIndex}!`)}if(e.childCount){const n=t?t.nodeIndex+t.childCount:r-1;if(e.nodeIndex<=n&&e.nodeIndex+e.childCount>n)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${e.nodeIndex}!`)}}function As(t,e,r,n){const i=Ps(t.root,t.renderer,t,e,r);return Os(i,t.component,n),Rs(i),i}function Is(t,e,r){const n=Ps(t,t.renderer,null,null,e);return Os(n,r,r),Rs(n),n}function ks(t,e,r,n){const i=e.element.componentRendererType;let o;return o=i?t.root.rendererFactory.createRenderer(n,i):t.root.renderer,Ps(t.root,o,t,e.element.componentProvider,r)}function Ps(t,e,r,n,i){const o=new Array(i.nodes.length),a=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:r,viewContainerParent:null,parentNodeDef:n,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:a,initIndex:-1}}function Os(t,e,r){t.component=e,t.context=r}function Rs(t){let e;Mi(t)&&(e=pi(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);const r=t.def,n=t.nodes;for(let i=0;i<r.nodes.length;i++){const o=r.nodes[i];let a;switch(yi.setCurrentNode(t,i),201347067&o.flags){case 1:const r=ps(t,e,o);let s=void 0;if(33554432&o.flags){const e=Vi(o.element.componentView);s=yi.createComponentView(t,o,e,r)}ds(t,s,o,r),a={renderElement:r,componentView:s,viewContainer:null,template:o.element.template?go(t,o):void 0},16777216&o.flags&&(a.viewContainer=po(t,o,a));break;case 2:a=ws(t,e,o);break;case 512:case 1024:case 2048:case 256:(a=n[i])||4096&o.flags||(a={instance:Fo(t,o)});break;case 16:a={instance:Bo(t,o)};break;case 16384:(a=n[i])||(a={instance:Vo(t,o)}),32768&o.flags&&Os(pi(t,o.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new Jo;break;case 8:bs(t,e,o),a=void 0}n[i]=a}js(t,Vs.CreateViewNodes),Ws(t,201326592,268435456,0)}function Ds(t){zs(t),yi.updateDirectives(t,1),Us(t,Vs.CheckNoChanges),yi.updateRenderer(t,1),js(t,Vs.CheckNoChanges),t.state&=-97}function Ms(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,ui(t,0,256),zs(t),yi.updateDirectives(t,0),Us(t,Vs.CheckAndUpdate),Ws(t,67108864,536870912,0);let e=ui(t,256,512);Qo(t,2097152|(e?1048576:0)),yi.updateRenderer(t,0),js(t,Vs.CheckAndUpdate),Ws(t,134217728,536870912,0),Qo(t,8388608|((e=ui(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,ui(t,768,1024)}function Ls(t,e,r,n,i,o,a,s,l,u,c,h,p){return 0===r?function(t,e,r,n,i,o,a,s,l,u,c,h){switch(201347067&e.flags){case 1:return function(t,e,r,n,i,o,a,s,l,u,c,h){const p=e.bindings.length;let d=!1;return p>0&&ms(t,e,0,r)&&(d=!0),p>1&&ms(t,e,1,n)&&(d=!0),p>2&&ms(t,e,2,i)&&(d=!0),p>3&&ms(t,e,3,o)&&(d=!0),p>4&&ms(t,e,4,a)&&(d=!0),p>5&&ms(t,e,5,s)&&(d=!0),p>6&&ms(t,e,6,l)&&(d=!0),p>7&&ms(t,e,7,u)&&(d=!0),p>8&&ms(t,e,8,c)&&(d=!0),p>9&&ms(t,e,9,h)&&(d=!0),d}(t,e,r,n,i,o,a,s,l,u,c,h);case 2:return function(t,e,r,n,i,o,a,s,l,u,c,h){let p=!1;const d=e.bindings,f=d.length;if(f>0&&Ti(t,e,0,r)&&(p=!0),f>1&&Ti(t,e,1,n)&&(p=!0),f>2&&Ti(t,e,2,i)&&(p=!0),f>3&&Ti(t,e,3,o)&&(p=!0),f>4&&Ti(t,e,4,a)&&(p=!0),f>5&&Ti(t,e,5,s)&&(p=!0),f>6&&Ti(t,e,6,l)&&(p=!0),f>7&&Ti(t,e,7,u)&&(p=!0),f>8&&Ti(t,e,8,c)&&(p=!0),f>9&&Ti(t,e,9,h)&&(p=!0),p){let p=e.text.prefix;f>0&&(p+=Es(r,d[0])),f>1&&(p+=Es(n,d[1])),f>2&&(p+=Es(i,d[2])),f>3&&(p+=Es(o,d[3])),f>4&&(p+=Es(a,d[4])),f>5&&(p+=Es(s,d[5])),f>6&&(p+=Es(l,d[6])),f>7&&(p+=Es(u,d[7])),f>8&&(p+=Es(c,d[8])),f>9&&(p+=Es(h,d[9]));const m=hi(t,e.nodeIndex).renderText;t.renderer.setValue(m,p)}return p}(t,e,r,n,i,o,a,s,l,u,c,h);case 16384:return function(t,e,r,n,i,o,a,s,l,u,c,h){const p=di(t,e.nodeIndex),d=p.instance;let f=!1,m=void 0;const y=e.bindings.length;return y>0&&Si(t,e,0,r)&&(f=!0,m=Zo(t,p,e,0,r,m)),y>1&&Si(t,e,1,n)&&(f=!0,m=Zo(t,p,e,1,n,m)),y>2&&Si(t,e,2,i)&&(f=!0,m=Zo(t,p,e,2,i,m)),y>3&&Si(t,e,3,o)&&(f=!0,m=Zo(t,p,e,3,o,m)),y>4&&Si(t,e,4,a)&&(f=!0,m=Zo(t,p,e,4,a,m)),y>5&&Si(t,e,5,s)&&(f=!0,m=Zo(t,p,e,5,s,m)),y>6&&Si(t,e,6,l)&&(f=!0,m=Zo(t,p,e,6,l,m)),y>7&&Si(t,e,7,u)&&(f=!0,m=Zo(t,p,e,7,u,m)),y>8&&Si(t,e,8,c)&&(f=!0,m=Zo(t,p,e,8,c,m)),y>9&&Si(t,e,9,h)&&(f=!0,m=Zo(t,p,e,9,h,m)),m&&d.ngOnChanges(m),65536&e.flags&&ci(t,256,e.nodeIndex)&&d.ngOnInit(),262144&e.flags&&d.ngDoCheck(),f}(t,e,r,n,i,o,a,s,l,u,c,h);case 32:case 64:case 128:return function(t,e,r,n,i,o,a,s,l,u,c,h){const p=e.bindings;let d=!1;const f=p.length;if(f>0&&Ti(t,e,0,r)&&(d=!0),f>1&&Ti(t,e,1,n)&&(d=!0),f>2&&Ti(t,e,2,i)&&(d=!0),f>3&&Ti(t,e,3,o)&&(d=!0),f>4&&Ti(t,e,4,a)&&(d=!0),f>5&&Ti(t,e,5,s)&&(d=!0),f>6&&Ti(t,e,6,l)&&(d=!0),f>7&&Ti(t,e,7,u)&&(d=!0),f>8&&Ti(t,e,8,c)&&(d=!0),f>9&&Ti(t,e,9,h)&&(d=!0),d){const d=fi(t,e.nodeIndex);let m;switch(201347067&e.flags){case 32:m=new Array(p.length),f>0&&(m[0]=r),f>1&&(m[1]=n),f>2&&(m[2]=i),f>3&&(m[3]=o),f>4&&(m[4]=a),f>5&&(m[5]=s),f>6&&(m[6]=l),f>7&&(m[7]=u),f>8&&(m[8]=c),f>9&&(m[9]=h);break;case 64:m={},f>0&&(m[p[0].name]=r),f>1&&(m[p[1].name]=n),f>2&&(m[p[2].name]=i),f>3&&(m[p[3].name]=o),f>4&&(m[p[4].name]=a),f>5&&(m[p[5].name]=s),f>6&&(m[p[6].name]=l),f>7&&(m[p[7].name]=u),f>8&&(m[p[8].name]=c),f>9&&(m[p[9].name]=h);break;case 128:const t=r;switch(f){case 1:m=t.transform(r);break;case 2:m=t.transform(n);break;case 3:m=t.transform(n,i);break;case 4:m=t.transform(n,i,o);break;case 5:m=t.transform(n,i,o,a);break;case 6:m=t.transform(n,i,o,a,s);break;case 7:m=t.transform(n,i,o,a,s,l);break;case 8:m=t.transform(n,i,o,a,s,l,u);break;case 9:m=t.transform(n,i,o,a,s,l,u,c);break;case 10:m=t.transform(n,i,o,a,s,l,u,c,h)}}d.value=m}return d}(t,e,r,n,i,o,a,s,l,u,c,h);default:throw"unreachable"}}(t,e,n,i,o,a,s,l,u,c,h,p):function(t,e,r){switch(201347067&e.flags){case 1:return function(t,e,r){let n=!1;for(let i=0;i<r.length;i++)ms(t,e,i,r[i])&&(n=!0);return n}(t,e,r);case 2:return function(t,e,r){const n=e.bindings;let i=!1;for(let o=0;o<r.length;o++)Ti(t,e,o,r[o])&&(i=!0);if(i){let i="";for(let t=0;t<r.length;t++)i+=Es(r[t],n[t]);i=e.text.prefix+i;const o=hi(t,e.nodeIndex).renderText;t.renderer.setValue(o,i)}return i}(t,e,r);case 16384:return function(t,e,r){const n=di(t,e.nodeIndex),i=n.instance;let o=!1,a=void 0;for(let s=0;s<r.length;s++)Si(t,e,s,r[s])&&(o=!0,a=Zo(t,n,e,s,r[s],a));return a&&i.ngOnChanges(a),65536&e.flags&&ci(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),o}(t,e,r);case 32:case 64:case 128:return function(t,e,r){const n=e.bindings;let i=!1;for(let o=0;o<r.length;o++)Ti(t,e,o,r[o])&&(i=!0);if(i){const i=fi(t,e.nodeIndex);let o;switch(201347067&e.flags){case 32:o=r;break;case 64:o={};for(let e=0;e<r.length;e++)o[n[e].name]=r[e];break;case 128:const t=r[0],i=r.slice(1);o=t.transform(...i)}i.value=o}return i}(t,e,r);default:throw"unreachable"}}(t,e,n)}function zs(t){const e=t.def;if(4&e.nodeFlags)for(let r=0;r<e.nodes.length;r++){const n=e.nodes[r];if(4&n.flags){const e=pi(t,r).template._projectedViews;if(e)for(let r=0;r<e.length;r++){const n=e[r];n.state|=32,ki(n,t)}}else 0==(4&n.childFlags)&&(r+=n.childCount)}}function Ns(t,e,r,n,i,o,a,s,l,u,c,h,p){return 0===r?function(t,e,r,n,i,o,a,s,l,u,c,h){const p=e.bindings.length;p>0&&Ai(t,e,0,r),p>1&&Ai(t,e,1,n),p>2&&Ai(t,e,2,i),p>3&&Ai(t,e,3,o),p>4&&Ai(t,e,4,a),p>5&&Ai(t,e,5,s),p>6&&Ai(t,e,6,l),p>7&&Ai(t,e,7,u),p>8&&Ai(t,e,8,c),p>9&&Ai(t,e,9,h)}(t,e,n,i,o,a,s,l,u,c,h,p):function(t,e,r){for(let n=0;n<r.length;n++)Ai(t,e,n,r[n])}(t,e,n),!1}function Fs(t,e){if(mi(t,e.nodeIndex).dirty)throw ai(yi.createDebugContext(t,e.nodeIndex),`Query ${e.query.id} not dirty`,`Query ${e.query.id} dirty`,0!=(1&t.state))}function Bs(t){if(!(128&t.state)){if(Us(t,Vs.Destroy),js(t,Vs.Destroy),Qo(t,131072),t.disposables)for(let e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(!(16&t.state))return;const e=Oi(t);if(e){const r=e.template._projectedViews;r&&(so(r,r.indexOf(t)),yi.dirtyParentQueries(t))}}(t),t.renderer.destroyNode&&function(t){const e=t.def.nodes.length;for(let r=0;r<e;r++){const e=t.def.nodes[r];1&e.flags?t.renderer.destroyNode(pi(t,r).renderElement):2&e.flags?t.renderer.destroyNode(hi(t,r).renderText):(67108864&e.flags||134217728&e.flags)&&mi(t,r).destroy()}}(t),Mi(t)&&t.renderer.destroy(),t.state|=128}}const Vs=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function js(t,e){const r=t.def;if(33554432&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];33554432&i.flags?qs(pi(t,n).componentView,e):0==(33554432&i.childFlags)&&(n+=i.childCount)}}function Us(t,e){const r=t.def;if(16777216&r.nodeFlags)for(let n=0;n<r.nodes.length;n++){const i=r.nodes[n];if(16777216&i.flags){const r=pi(t,n).viewContainer._embeddedViews;for(let t=0;t<r.length;t++)qs(r[t],e)}else 0==(16777216&i.childFlags)&&(n+=i.childCount)}}function qs(t,e){const r=t.state;switch(e){case Vs.CheckNoChanges:0==(128&r)&&(12==(12&r)?Ds(t):64&r&&Hs(t,Vs.CheckNoChangesProjectedViews));break;case Vs.CheckNoChangesProjectedViews:0==(128&r)&&(32&r?Ds(t):64&r&&Hs(t,e));break;case Vs.CheckAndUpdate:0==(128&r)&&(12==(12&r)?Ms(t):64&r&&Hs(t,Vs.CheckAndUpdateProjectedViews));break;case Vs.CheckAndUpdateProjectedViews:0==(128&r)&&(32&r?Ms(t):64&r&&Hs(t,e));break;case Vs.Destroy:Bs(t);break;case Vs.CreateViewNodes:Rs(t)}}function Hs(t,e){Us(t,e),js(t,e)}function Ws(t,e,r,n){if(!(t.def.nodeFlags&e&&t.def.nodeFlags&r))return;const i=t.def.nodes.length;for(let o=0;o<i;o++){const i=t.def.nodes[o];if(i.flags&e&&i.flags&r)switch(yi.setCurrentNode(t,i.nodeIndex),n){case 0:gs(t,i);break;case 1:Fs(t,i)}i.childFlags&e&&i.childFlags&r||(o+=i.childCount)}}let Gs=!1;function Zs(t,e,r,n,i,o){const a=i.injector.get(Dn);return Is(Ks(t,i,a,e,r),n,o)}function Qs(t,e,r,n,i,o){const a=i.injector.get(Dn),s=Ks(t,i,new Al(a),e,r),l=ol(n);return Sl(hl.create,Is,null,[s,l,o])}function Ks(t,e,r,n,i){const o=e.injector.get($e),a=e.injector.get(we),s=r.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:n,selectorOrNode:i,sanitizer:o,rendererFactory:r,renderer:s,errorHandler:a}}function $s(t,e,r,n){const i=ol(r);return Sl(hl.create,As,null,[t,e,i,n])}function Xs(t,e,r,n){return r=el.get(e.element.componentProvider.provider.token)||ol(r),Sl(hl.create,ks,null,[t,e,r,n])}function Ys(t,e,r,n){return Co(t,e,r,function(t){const{hasOverrides:e,hasDeprecatedOverrides:r}=function(t){let e=!1,r=!1;return 0===Js.size?{hasOverrides:e,hasDeprecatedOverrides:r}:(t.providers.forEach(t=>{const n=Js.get(t.token);3840&t.flags&&n&&(e=!0,r=r||n.deprecatedBehavior)}),t.modules.forEach(t=>{tl.forEach((n,i)=>{g(i).providedIn===t&&(e=!0,r=r||n.deprecatedBehavior)})}),{hasOverrides:e,hasDeprecatedOverrides:r})}(t);return e?(function(t){for(let e=0;e<t.providers.length;e++){const n=t.providers[e];r&&(n.flags|=4096);const i=Js.get(n.token);i&&(n.flags=-3841&n.flags|i.flags,n.deps=Ni(i.deps),n.value=i.value)}if(tl.size>0){let e=new Set(t.modules);tl.forEach((n,i)=>{if(e.has(g(i).providedIn)){let e={token:i,flags:n.flags|(r?4096:0),deps:Ni(n.deps),value:n.value,index:t.providers.length};t.providers.push(e),t.providersByKey[vi(i)]=e}})}}(t=t.factory(()=>gi)),t):t}(n))}const Js=new Map,tl=new Map,el=new Map;function rl(t){let e;Js.set(t.token,t),"function"==typeof t.token&&(e=g(t.token))&&"function"==typeof e.providedIn&&tl.set(t.token,t)}function nl(t,e){const r=Vi(e.viewDefFactory),n=Vi(r.nodes[0].element.componentView);el.set(t,n)}function il(){Js.clear(),tl.clear(),el.clear()}function ol(t){if(0===Js.size)return t;const e=function(t){const e=[];let r=null;for(let n=0;n<t.nodes.length;n++){const i=t.nodes[n];1&i.flags&&(r=i),r&&3840&i.flags&&Js.has(i.provider.token)&&(e.push(r.nodeIndex),r=null)}return e}(t);if(0===e.length)return t;t=t.factory(()=>gi);for(let n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(let r=e+1;r<t.nodes.length;r++){const e=t.nodes[r];if(1&e.flags)return;if(3840&e.flags){const t=e.provider,r=Js.get(t.token);r&&(e.flags=-3841&e.flags|r.flags,t.deps=Ni(r.deps),t.value=r.value)}}}}function al(t,e,r,n,i,o,a,s,l,u,c,h,p){const d=t.def.nodes[e];return Ls(t,d,r,n,i,o,a,s,l,u,c,h,p),224&d.flags?fi(t,e).value:void 0}function sl(t,e,r,n,i,o,a,s,l,u,c,h,p){const d=t.def.nodes[e];return Ns(t,d,r,n,i,o,a,s,l,u,c,h,p),224&d.flags?fi(t,e).value:void 0}function ll(t){return Sl(hl.detectChanges,Ms,null,[t])}function ul(t){return Sl(hl.checkNoChanges,Ds,null,[t])}function cl(t){return Sl(hl.destroy,Bs,null,[t])}const hl=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();let pl,dl,fl;function ml(t,e){dl=t,fl=e}function yl(t,e,r,n){return ml(t,e),Sl(hl.handleEvent,t.def.handleEvent,null,[t,e,r,n])}function gl(t,e){if(128&t.state)throw li(hl[pl]);return ml(t,xl(t,0)),t.def.updateDirectives(function(t,r,n,...i){const o=t.def.nodes[r];return 0===e?vl(t,o,n,i):bl(t,o,n,i),16384&o.flags&&ml(t,xl(t,r)),224&o.flags?fi(t,o.nodeIndex).value:void 0},t)}function _l(t,e){if(128&t.state)throw li(hl[pl]);return ml(t,wl(t,0)),t.def.updateRenderer(function(t,r,n,...i){const o=t.def.nodes[r];return 0===e?vl(t,o,n,i):bl(t,o,n,i),3&o.flags&&ml(t,wl(t,r)),224&o.flags?fi(t,o.nodeIndex).value:void 0},t)}function vl(t,e,r,n){if(Ls(t,e,r,...n)){const a=1===r?n[0]:n;if(16384&e.flags){const r={};for(let t=0;t<e.bindings.length;t++){const n=e.bindings[t],s=a[t];8&n.flags&&(r[(i=n.nonMinifiedName,o=void 0,o=i.replace(/[$@]/g,"_"),`ng-reflect-${i=o.replace(tr,(...t)=>"-"+t[1].toLowerCase())}`)]=er(s))}const n=e.parent,s=pi(t,n.nodeIndex).renderElement;if(n.element.name)for(let e in r){const n=r[e];null!=n?t.renderer.setAttribute(s,e,n):t.renderer.removeAttribute(s,e)}else t.renderer.setValue(s,`bindings=${JSON.stringify(r,null,2)}`)}}var i,o}function bl(t,e,r,n){Ns(t,e,r,...n)}function xl(t,e){for(let r=e;r<t.def.nodes.length;r++){const e=t.def.nodes[r];if(16384&e.flags&&e.bindings&&e.bindings.length)return r}return null}function wl(t,e){for(let r=e;r<t.def.nodes.length;r++){const e=t.def.nodes[r];if(3&e.flags&&e.bindings&&e.bindings.length)return r}return null}class El{constructor(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];let r=this.nodeDef,n=t;for(;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&n;)r=Ri(n),n=n.parent;this.elDef=r,this.elView=n}get elOrCompView(){return pi(this.elView,this.elDef.nodeIndex).componentView||this.view}get injector(){return vo(this.elView,this.elDef)}get component(){return this.elOrCompView.component}get context(){return this.elOrCompView.context}get providerTokens(){const t=[];if(this.elDef)for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const r=this.elView.def.nodes[e];20224&r.flags&&t.push(r.provider.token),e+=r.childCount}return t}get references(){const t={};if(this.elDef){Cl(this.elView,this.elDef,t);for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const r=this.elView.def.nodes[e];20224&r.flags&&Cl(this.elView,r,t),e+=r.childCount}}return t}get componentRenderElement(){const t=function(t){for(;t&&!Mi(t);)t=t.parent;return t.parent?pi(t.parent,Ri(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0}get renderNode(){return 2&this.nodeDef.flags?Di(this.view,this.nodeDef):Di(this.elView,this.elDef)}logError(t,...e){let r,n;2&this.nodeDef.flags?(r=this.view.def,n=this.nodeDef.nodeIndex):(r=this.elView.def,n=this.elDef.nodeIndex);const i=function(t,e){let r=-1;for(let n=0;n<=e;n++)3&t.nodes[n].flags&&r++;return r}(r,n);let o=-1;r.factory(()=>++o===i?t.error.bind(t,...e):gi),o<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error(...e))}}function Cl(t,e,r){for(let n in e.references)r[n]=vs(t,e,e.references[n])}function Sl(t,e,r,n){const i=pl,o=dl,a=fl;try{pl=t;const l=e.apply(r,n);return dl=o,fl=a,pl=i,l}catch(s){if(ve(s)||!dl)throw s;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),si(t,e),t}(s,Tl())}}function Tl(){return dl?new El(dl,fl):null}class Al{constructor(t){this.delegate=t}createRenderer(t,e){return new Il(this.delegate.createRenderer(t,e))}begin(){this.delegate.begin&&this.delegate.begin()}end(){this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}class Il{constructor(t){this.delegate=t,this.debugContextFactory=Tl,this.data=this.delegate.data}createDebugContext(t){return this.debugContextFactory(t)}destroyNode(t){!function(t){ts.delete(t.nativeNode)}(es(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)}destroy(){this.delegate.destroy()}createElement(t,e){const r=this.delegate.createElement(t,e),n=this.createDebugContext(r);if(n){const e=new Ja(r,null,n);e.name=t,rs(e)}return r}createComment(t){const e=this.delegate.createComment(t),r=this.createDebugContext(e);return r&&rs(new Ya(e,null,r)),e}createText(t){const e=this.delegate.createText(t),r=this.createDebugContext(e);return r&&rs(new Ya(e,null,r)),e}appendChild(t,e){const r=es(t),n=es(e);r&&n&&r instanceof Ja&&r.addChild(n),this.delegate.appendChild(t,e)}insertBefore(t,e,r){const n=es(t),i=es(e),o=es(r);n&&i&&n instanceof Ja&&n.insertBefore(o,i),this.delegate.insertBefore(t,e,r)}removeChild(t,e){const r=es(t),n=es(e);r&&n&&r instanceof Ja&&r.removeChild(n),this.delegate.removeChild(t,e)}selectRootElement(t,e){const r=this.delegate.selectRootElement(t,e),n=Tl();return n&&rs(new Ja(r,null,n)),r}setAttribute(t,e,r,n){const i=es(t);i&&i instanceof Ja&&(i.attributes[n?n+":"+e:e]=r),this.delegate.setAttribute(t,e,r,n)}removeAttribute(t,e,r){const n=es(t);n&&n instanceof Ja&&(n.attributes[r?r+":"+e:e]=null),this.delegate.removeAttribute(t,e,r)}addClass(t,e){const r=es(t);r&&r instanceof Ja&&(r.classes[e]=!0),this.delegate.addClass(t,e)}removeClass(t,e){const r=es(t);r&&r instanceof Ja&&(r.classes[e]=!1),this.delegate.removeClass(t,e)}setStyle(t,e,r,n){const i=es(t);i&&i instanceof Ja&&(i.styles[e]=r),this.delegate.setStyle(t,e,r,n)}removeStyle(t,e,r){const n=es(t);n&&n instanceof Ja&&(n.styles[e]=null),this.delegate.removeStyle(t,e,r)}setProperty(t,e,r){const n=es(t);n&&n instanceof Ja&&(n.properties[e]=r),this.delegate.setProperty(t,e,r)}listen(t,e,r){if("string"!=typeof t){const n=es(t);n&&n.listeners.push(new Xa(e,r))}return this.delegate.listen(t,e,r)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setValue(t,e){return this.delegate.setValue(t,e)}}function kl(t,e,r){return new Pl(t,e,r)}class Pl extends In{constructor(t,e,r){super(),this.moduleType=t,this._bootstrapComponents=e,this._ngModuleDefFactory=r}create(t){!function(){if(Gs)return;Gs=!0;const t=Se()?{setCurrentNode:ml,createRootView:Qs,createEmbeddedView:$s,createComponentView:Xs,createNgModuleRef:Ys,overrideProvider:rl,overrideComponentView:nl,clearOverrides:il,checkAndUpdateView:ll,checkNoChangesView:ul,destroyView:cl,createDebugContext:(t,e)=>new El(t,e),handleEvent:yl,updateDirectives:gl,updateRenderer:_l}:{setCurrentNode:()=>{},createRootView:Zs,createEmbeddedView:As,createComponentView:ks,createNgModuleRef:Co,overrideProvider:gi,overrideComponentView:gi,clearOverrides:gi,checkAndUpdateView:Ms,checkNoChangesView:Ds,destroyView:Bs,createDebugContext:(t,e)=>new El(t,e),handleEvent:(t,e,r,n)=>t.def.handleEvent(t,e,r,n),updateDirectives:(t,e)=>t.def.updateDirectives(0===e?al:sl,t),updateRenderer:(t,e)=>t.def.updateRenderer(0===e?al:sl,t)};yi.setCurrentNode=t.setCurrentNode,yi.createRootView=t.createRootView,yi.createEmbeddedView=t.createEmbeddedView,yi.createComponentView=t.createComponentView,yi.createNgModuleRef=t.createNgModuleRef,yi.overrideProvider=t.overrideProvider,yi.overrideComponentView=t.overrideComponentView,yi.clearOverrides=t.clearOverrides,yi.checkAndUpdateView=t.checkAndUpdateView,yi.checkNoChangesView=t.checkNoChangesView,yi.destroyView=t.destroyView,yi.resolveDep=Wo,yi.createDebugContext=t.createDebugContext,yi.handleEvent=t.handleEvent,yi.updateDirectives=t.updateDirectives,yi.updateRenderer=t.updateRenderer,yi.dirtyParentQueries=ys}();const e=function(t){const e=Array.from(t.providers),r=Array.from(t.modules),n={};for(const i in t.providersByKey)n[i]=t.providersByKey[i];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:r,providersByKey:n}}(Vi(this._ngModuleDefFactory));return yi.createNgModuleRef(this.moduleType,t||M.NULL,this._bootstrapComponents,e)}}},"9ppp":function(t,e,r){"use strict";function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}r.d(e,"a",function(){return i}),n.prototype=Object.create(Error.prototype);const i=n},CRDf:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("kJWO");const i=t=>e=>{const r=t[n.a]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}},Cfvw:function(t,e,r){"use strict";var n=r("HDdC"),i=r("c2HN"),o=r("I55L"),a=r("kJWO"),s=r("Lhse"),l=r("yCtX"),u=r("quSY"),c=r("a7t3"),h=r("pLzU"),p=r("CRDf"),d=r("SeVD");function f(t,e){if(!e)return t instanceof n.a?t:new n.a(Object(d.a)(t));if(null!=t){if(function(t){return t&&"function"==typeof t[a.a]}(t))return function(t,e){return new n.a(e?r=>{const n=new u.a;return n.add(e.schedule(()=>{const i=t[a.a]();n.add(i.subscribe({next(t){n.add(e.schedule(()=>r.next(t)))},error(t){n.add(e.schedule(()=>r.error(t)))},complete(){n.add(e.schedule(()=>r.complete()))}}))})),n}:Object(p.a)(t))}(t,e);if(Object(i.a)(t))return function(t,e){return new n.a(e?r=>{const n=new u.a;return n.add(e.schedule(()=>t.then(t=>{n.add(e.schedule(()=>{r.next(t),n.add(e.schedule(()=>r.complete()))}))},t=>{n.add(e.schedule(()=>r.error(t)))}))),n}:Object(c.a)(t))}(t,e);if(Object(o.a)(t))return Object(l.a)(t,e);if(function(t){return t&&"function"==typeof t[s.a]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new n.a(e?r=>{const n=new u.a;let i;return n.add(()=>{i&&"function"==typeof i.return&&i.return()}),n.add(e.schedule(()=>{i=t[s.a](),n.add(e.schedule(function(){if(r.closed)return;let t,e;try{const o=i.next();t=o.value,e=o.done}catch(n){return void r.error(n)}e?r.complete():(r.next(t),this.schedule())}))})),n}:Object(h.a)(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}r.d(e,"a",function(){return f})},DH7j:function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=Array.isArray||(t=>t&&"number"==typeof t.length)},EY2u:function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return o});var n=r("HDdC");const i=new n.a(t=>t.complete());function o(t){return t?function(t){return new n.a(e=>t.schedule(()=>e.complete()))}(t):i}},GIw4:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("kDjp");function i(t){return(Object(n.c)(t)||0===t.length)&&(t=["child_added","child_removed","child_changed","child_moved"]),t}},HDdC:function(t,e,r){"use strict";var n=r("7o/Q"),i=r("2QA8"),o=r("gRHU"),a=r("kJWO"),s=r("mCNh"),l=r("2fFW");r.d(e,"a",function(){return u});const u=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(t,e,r){const{operator:a}=this,s=function(t,e,r){if(t){if(t instanceof n.a)return t;if(t[i.a])return t[i.a]()}return t||e||r?new n.a(t,e,r):new n.a(o.a)}(t,e,r);if(s.add(a?a.call(s,this.source):this.source||l.a.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),l.a.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s}_trySubscribe(t){try{return this._subscribe(t)}catch(e){l.a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:r,isStopped:i}=t;if(e||i)return!1;t=r&&r instanceof n.a?r:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=c(e))((e,r)=>{let n;n=this.subscribe(e=>{try{t(e)}catch(i){r(i),n&&n.unsubscribe()}},r,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[a.a](){return this}pipe(...t){return 0===t.length?this:Object(s.b)(t)(this)}toPromise(t){return new(t=c(t))((t,e)=>{let r;this.subscribe(t=>r=t,t=>e(t),()=>t(r))})}}return t.create=(e=>new t(e)),t})();function c(t){if(t||(t=l.a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},I1TF:function(t,e,r){"use strict";var n=r("sDu7"),i=r("WEwH"),o=r("b/LO"),a=r("kDjp");function s(t,e){return function(r,n){return Object(a.a)(r,{stringCase:()=>t.child(r)[e](n),firebaseCase:()=>r[e](n),snapshotCase:()=>r.ref[e](n)})}}var l=r("lJxs");function u(t,e){return{query:t,update:s(t.ref,"update"),set:s(t.ref,"set"),push:e=>t.ref.push(e),remove:(r=t.ref,function(t){return t?Object(a.a)(t,{stringCase:()=>r.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):r.remove()}),snapshotChanges(r){const i=Object(n.a)(t,r);return e.scheduler.keepUnstableUntilFirst(e.scheduler.runOutsideAngular(i))},stateChanges(r){const n=Object(i.a)(t,r);return e.scheduler.keepUnstableUntilFirst(e.scheduler.runOutsideAngular(n))},auditTrail(r){const n=Object(o.a)(t,r);return e.scheduler.keepUnstableUntilFirst(e.scheduler.runOutsideAngular(n))},valueChanges(r){const i=Object(n.a)(t,r);return e.scheduler.keepUnstableUntilFirst(e.scheduler.runOutsideAngular(i)).pipe(Object(l.a)(t=>t.map(t=>t.payload.val())))}};var r}r.d(e,"a",function(){return u})},I55L:function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>t&&"number"==typeof t.length&&"function"!=typeof t},IjjT:function(t,e,r){"use strict";const n=(()=>{class t{constructor(e,r=t.now){this.SchedulerAction=e,this.now=r}schedule(t,e=0,r){return new this.SchedulerAction(this,t).schedule(r,e)}}return t.now=(()=>Date.now()),t})();r.d(e,"a",function(){return i});class i extends n{constructor(t,e=n.now){super(t,()=>i.delegate&&i.delegate!==this?i.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,r){return i.delegate&&i.delegate!==this?i.delegate.schedule(t,e,r):super.schedule(t,e,r)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}}},Kqap:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("7o/Q");function i(t,e){let r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new o(t,e,r))}}class o{constructor(t,e,r=!1){this.accumulator=t,this.seed=e,this.hasSeed=r}call(t,e){return e.subscribe(new a(t,this.accumulator,this.seed,this.hasSeed))}}class a extends n.a{constructor(t,e,r,n){super(t),this.accumulator=e,this._seed=r,this.hasSeed=n,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let r;try{r=this.accumulator(this.seed,t,e)}catch(n){this.destination.error(n)}this.seed=r,this.destination.next(r)}}},KqfI:function(t,e,r){"use strict";function n(){}r.d(e,"a",function(){return n})},LRne:function(t,e,r){"use strict";r.d(e,"a",function(){return s});var n=r("z+Ro"),i=r("yCtX"),o=r("EY2u"),a=r("XUOw");function s(...t){let e=t[t.length-1];switch(Object(n.a)(e)?t.pop():e=void 0,t.length){case 0:return Object(o.b)(e);case 1:return e?Object(i.a)(t,e):Object(a.a)(t[0]);default:return Object(i.a)(t,e)}}},Lhse:function(t,e,r){"use strict";function n(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}r.d(e,"a",function(){return i});const i=n()},NJ4a:function(t,e,r){"use strict";function n(t){setTimeout(()=>{throw t})}r.d(e,"a",function(){return n})},NSPt:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i,o,a,s,l,u,c,h,p,d,f,m=(n=r("wj3C"))&&"object"==typeof n&&"default"in n?n.default:n,y=r("mAIw"),g=r("zVF4"),_=r("q/0M"),v=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),g.stringify(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:g.jsonEval(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),b=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return g.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),x=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new v(e)}}catch(r){}return new b},w=x("localStorage"),E=x("sessionStorage"),C=new _.Logger("@firebase/database"),S=(i=1,function(){return i++}),T=function(t){var e=g.stringToByteArray(t),r=new g.Sha1;r.update(e);var n=r.digest();return g.base64.encodeByteArray(n)},A=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r="",n=0;n<t.length;n++)Array.isArray(t[n])||t[n]&&"object"==typeof t[n]&&"number"==typeof t[n].length?r+=A.apply(null,t[n]):r+="object"==typeof t[n]?g.stringify(t[n]):t[n],r+=" ";return r},I=null,k=!0,P=function(t,e){g.assert(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(C.logLevel=_.LogLevel.VERBOSE,I=C.log.bind(C),e&&E.set("logging_enabled",!0)):"function"==typeof t?I=t:(I=null,E.remove("logging_enabled"))},O=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===k&&(k=!1,null===I&&!0===E.get("logging_enabled")&&P(!0)),I){var r=A.apply(null,t);I(r)}},R=function(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];O.apply(void 0,[t].concat(e))}},D=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r="FIREBASE INTERNAL ERROR: "+A.apply(void 0,t);C.error(r)},M=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r="FIREBASE FATAL ERROR: "+A.apply(void 0,t);throw C.error(r),new Error(r)},L=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r="FIREBASE WARNING: "+A.apply(void 0,t);C.warn(r)},z=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},N="[MIN_NAME]",F="[MAX_NAME]",B=function(t,e){if(t===e)return 0;if(t===N||e===F)return-1;if(e===N||t===F)return 1;var r=Z(t),n=Z(e);return null!==r?null!==n?r-n==0?t.length-e.length:r-n:-1:null!==n?1:t<e?-1:1},V=function(t,e){return t===e?0:t<e?-1:1},j=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+g.stringify(e))},U=function(t){if("object"!=typeof t||null===t)return g.stringify(t);var e=[];for(var r in t)e.push(r);e.sort();for(var n="{",i=0;i<e.length;i++)0!==i&&(n+=","),n+=g.stringify(e[i]),n+=":",n+=U(t[e[i]]);return n+"}"},q=function(t,e){var r=t.length;if(r<=e)return[t];for(var n=[],i=0;i<r;i+=e)n.push(t.substring(i,i+e>r?r:i+e));return n},H=function(t,e){if(Array.isArray(t))for(var r=0;r<t.length;++r)e(r,t[r]);else g.forEach(t,function(t,r){return e(r,t)})},W=function(t){var e,r,n,i,o,a,s;for(g.assert(!z(t),"Invalid JSON number"),0===t?(r=0,n=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(r=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,n=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(r=0,n=Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(e?1:0),a.reverse(),s=a.join("");var l="";for(o=0;o<64;o+=8){var u=parseInt(s.substr(o,8),2).toString(16);1===u.length&&(u="0"+u),l+=u}return l.toLowerCase()},G=new RegExp("^-?\\d{1,10}$"),Z=function(t){if(G.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Q=function(t){try{t()}catch(e){setTimeout(function(){throw L("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},K=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},$=function(t,e){var r=setTimeout(t,e);return"object"==typeof r&&r.unref&&r.unref(),r},X=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var r=0,n=0;n<this.pieces_.length;n++)this.pieces_[n].length>0&&(this.pieces_[r]=this.pieces_[n],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],r=this.pieceNum_;r<this.pieces_.length-1;r++)e.push(this.pieces_[r]);return new t(e,0)},t.prototype.child=function(e){for(var r=[],n=this.pieceNum_;n<this.pieces_.length;n++)r.push(this.pieces_[n]);if(e instanceof t)for(n=e.pieceNum_;n<e.pieces_.length;n++)r.push(e.pieces_[n]);else{var i=e.split("/");for(n=0;n<i.length;n++)i[n].length>0&&r.push(i[n])}return new t(r,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,r){var n=e.getFront(),i=r.getFront();if(null===n)return r;if(n===i)return t.relativePath(e.popFront(),r.popFront());throw new Error("INTERNAL ERROR: innerPath ("+r+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var r=t.slice(),n=e.slice(),i=0;i<r.length&&i<n.length;i++){var o=B(r[i],n[i]);if(0!==o)return o}return r.length===n.length?0:r.length<n.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,r=t.pieceNum_;e<=this.pieces_.length;e++,r++)if(this.pieces_[e]!==t.pieces_[r])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,r=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[r])return!1;++e,++r}return!0},t}(),Y=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=g.stringLength(this.parts_[r]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=g.stringLength(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=g.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),J="long_polling",tt=function(){function t(t,e,r,n,i){void 0===i&&(i=""),this.secure=e,this.namespace=r,this.webSocketOnly=n,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=w.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&w.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var r;if(g.assert("string"==typeof t,"typeof type must == string"),g.assert("object"==typeof e,"typeof params must == object"),"websocket"===t)r=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==J)throw new Error("Unknown connection type: "+t);r=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var n=[];return g.forEach(e,function(t,e){n.push(t+"="+e)}),r+n.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}(),et=function(t){var e=rt(t),r=e.subdomain;return"firebase"===e.domain&&M(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!=r||"localhost"===e.domain||M("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&L("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new tt(e.host,e.secure,r,"ws"===e.scheme||"wss"===e.scheme),path:new X(e.pathString)}},rt=function(t){var e="",r="",n="",i="",o=!0,a="https",s=443;if("string"==typeof t){var l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));var u=t.indexOf("/");-1===u&&(u=t.length);var c=t.indexOf("?");-1===c&&(c=t.length),e=t.substring(0,Math.min(u,c)),u<c&&(i=function(e){for(var r="",n=t.substring(u,c).split("/"),i=0;i<n.length;i++)if(n[i].length>0){var o=n[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch(a){}r+="/"+o}return r}());var h=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var r=0,n=t.split("&");r<n.length;r++){var i=n[r];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):L("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,c)));(l=e.indexOf(":"))>=0?(o="https"===a||"wss"===a,s=parseInt(e.substring(l+1),10)):l=t.length;var p=e.split(".");3===p.length?(r=p[1],n=p[0].toLowerCase()):2===p.length?r=p[0]:"localhost"===p[0].slice(0,l).toLowerCase()&&(r="localhost"),""===n&&"ns"in h&&(n=h.ns)}return{host:e,port:s,domain:r,subdomain:n,secure:o,scheme:a,pathString:i}},nt=/[\[\].#$\/\u0000-\u001F\u007F]/,it=/[\[\].#$\u0000-\u001F\u007F]/,ot=function(t){return"string"==typeof t&&0!==t.length&&!nt.test(t)},at=function(t){return"string"==typeof t&&0!==t.length&&!it.test(t)},st=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!z(t)||t&&"object"==typeof t&&g.contains(t,".sv")},lt=function(t,e,r,n,i){i&&void 0===r||ut(g.errorPrefix(t,e,i),r,n)},ut=function(t,e,r){var n=r instanceof X?new Y(r,t):r;if(void 0===e)throw new Error(t+"contains undefined "+n.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+n.toErrorString()+" with contents = "+e.toString());if(z(e))throw new Error(t+"contains "+e.toString()+" "+n.toErrorString());if("string"==typeof e&&e.length>10485760/3&&g.stringLength(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+n.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(g.forEach(e,function(e,r){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!ot(e)))throw new Error(t+" contains an invalid key ("+e+") "+n.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');n.push(e),ut(t,r,n),n.pop()}),i&&o)throw new Error(t+' contains ".value" child '+n.toErrorString()+" in addition to actual children.")}},ct=function(t,e,r,n,i){if(!i||void 0!==r){var o=g.errorPrefix(t,e,i);if(!r||"object"!=typeof r||Array.isArray(r))throw new Error(o+" must be an object containing the children to replace.");var a=[];g.forEach(r,function(t,e){var r=new X(t);if(ut(o,e,n.child(r)),".priority"===r.getBack()&&!st(e))throw new Error(o+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(r)}),function(t,e){var r,n;for(r=0;r<e.length;r++)for(var i=(n=e[r]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ot(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(X.comparePaths);var a=null;for(r=0;r<e.length;r++){if(n=e[r],null!==a&&a.contains(n))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+n.toString());a=n}}(o,a)}},ht=function(t,e,r,n){if(!n||void 0!==r){if(z(r))throw new Error(g.errorPrefix(t,e,n)+"is "+r.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!st(r))throw new Error(g.errorPrefix(t,e,n)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},pt=function(t,e,r,n){if(!n||void 0!==r)switch(r){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(g.errorPrefix(t,e,n)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},dt=function(t,e,r,n){if(!(n&&void 0===r||ot(r)))throw new Error(g.errorPrefix(t,e,n)+'was an invalid key = "'+r+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ft=function(t,e,r,n){if(!(n&&void 0===r||at(r)))throw new Error(g.errorPrefix(t,e,n)+'was an invalid path = "'+r+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},mt=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},yt=function(t,e,r){var n=r.path.toString();if("string"!=typeof r.repoInfo.host||0===r.repoInfo.host.length||!ot(r.repoInfo.namespace)&&"localhost"!==r.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),at(t)}(n))throw new Error(g.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},gt=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){g.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),g.validateCallback("OnDisconnect.cancel",1,t,!0);var e=new g.Deferred;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){g.validateArgCount("OnDisconnect.remove",0,1,arguments.length),mt("OnDisconnect.remove",this.path_),g.validateCallback("OnDisconnect.remove",1,t,!0);var e=new g.Deferred;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){g.validateArgCount("OnDisconnect.set",1,2,arguments.length),mt("OnDisconnect.set",this.path_),lt("OnDisconnect.set",1,t,this.path_,!1),g.validateCallback("OnDisconnect.set",2,e,!0);var r=new g.Deferred;return this.repo_.onDisconnectSet(this.path_,t,r.wrapCallback(e)),r.promise},t.prototype.setWithPriority=function(t,e,r){g.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),mt("OnDisconnect.setWithPriority",this.path_),lt("OnDisconnect.setWithPriority",1,t,this.path_,!1),ht("OnDisconnect.setWithPriority",2,e,!1),g.validateCallback("OnDisconnect.setWithPriority",3,r,!0);var n=new g.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,n.wrapCallback(r)),n.promise},t.prototype.update=function(t,e){if(g.validateArgCount("OnDisconnect.update",1,2,arguments.length),mt("OnDisconnect.update",this.path_),Array.isArray(t)){for(var r={},n=0;n<t.length;++n)r[""+n]=t[n];t=r,L("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("OnDisconnect.update",1,t,this.path_,!1),g.validateCallback("OnDisconnect.update",2,e,!0);var i=new g.Deferred;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),_t=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return g.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),vt=(o="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",a=0,s=[],function(t){var e,r=t===a;a=t;var n=new Array(8);for(e=7;e>=0;e--)n[e]=o.charAt(t%64),t=Math.floor(t/64);g.assert(0===t,"Cannot push at time == 0");var i=n.join("");if(r){for(e=11;e>=0&&63===s[e];e--)s[e]=0;s[e]++}else for(e=0;e<12;e++)s[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=o.charAt(s[e]);return g.assert(20===i.length,"nextPushId: Length should be 20."),i}),bt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,r){return new t(e,r)},t}(),xt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var r=new bt(N,t),n=new bt(N,e);return 0!==this.compare(r,n)},t.prototype.minPost=function(){return bt.MIN},t}(),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y.__extends(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return l},set:function(t){l=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return B(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw g.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return bt.MIN},e.prototype.maxPost=function(){return new bt(F,l)},e.prototype.makePost=function(t,e){return g.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new bt(t,l)},e.prototype.toString=function(){return".key"},e}(xt),Et=new wt,Ct=function(t){return"number"==typeof t?"number:"+W(t):"string:"+t},St=function(t){if(t.isLeafNode()){var e=t.val();g.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&g.contains(e,".sv"),"Priority must be a string or number.")}else g.assert(t===u||t.isEmpty(),"priority of unexpected type.");g.assert(t===u||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Tt=function(){function t(e,r){void 0===r&&(r=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=r,this.lazyHash_=null,g.assert(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),St(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return c},set:function(t){c=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,r){return".priority"===e?this.updatePriority(r):r.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,r).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,r){var n=e.getFront();return null===n?r:r.isEmpty()&&".priority"!==n?this:(g.assert(".priority"!==n||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),r)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ct(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?W(this.value_):this.value_,this.lazyHash_=T(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(g.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var r=typeof e.value_,n=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(r),o=t.VALUE_TYPE_ORDER.indexOf(n);return g.assert(i>=0,"Unknown leaf type: "+r),g.assert(o>=0,"Unknown leaf type: "+n),i===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){return t===this||!!t.isLeafNode()&&this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),At=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y.__extends(e,t),e.prototype.compare=function(t,e){var r=t.node.getPriority(),n=e.node.getPriority(),i=r.compareTo(n);return 0===i?B(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return bt.MIN},e.prototype.maxPost=function(){return new bt(F,new Tt("[PRIORITY-POST]",p))},e.prototype.makePost=function(t,e){var r=h(t);return new bt(e,new Tt("[PRIORITY-POST]",r))},e.prototype.toString=function(){return".priority"},e}(xt)),It=function(){function t(t,e,r,n,i){void 0===i&&(i=null),this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?r(t.key,e):1,n&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),kt=function(){function t(e,r,n,i,o){this.key=e,this.value=r,this.color=null!=n?n:t.RED,this.left=null!=i?i:Ot.EMPTY_NODE,this.right=null!=o?o:Ot.EMPTY_NODE}return t.prototype.copy=function(e,r,n,i,o){return new t(null!=e?e:this.key,null!=r?r:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,r){var n,i;return(i=(n=r(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,r),null):0===n?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Ot.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var r,n;if(e(t,(r=this).key)<0)r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()||(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),r.right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()||(r=r.moveRedRight_()),0===e(t,r.key)){if(r.right.isEmpty())return Ot.EMPTY_NODE;n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Pt=function(){function t(){}return t.prototype.copy=function(t,e,r,n,i){return this},t.prototype.insert=function(t,e,r){return new kt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Ot=function(){function t(e,r){void 0===r&&(r=t.EMPTY_NODE),this.comparator_=e,this.root_=r}return t.prototype.insert=function(e,r){return new t(this.comparator_,this.root_.insert(e,r,this.comparator_).copy(null,null,kt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,kt.BLACK,null,null))},t.prototype.get=function(t){for(var e,r=this.root_;!r.isEmpty();){if(0===(e=this.comparator_(t,r.key)))return r.value;e<0?r=r.left:e>0&&(r=r.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,r=this.root_,n=null;!r.isEmpty();){if(0===(e=this.comparator_(t,r.key))){if(r.left.isEmpty())return n?n.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}e<0?r=r.left:e>0&&(n=r,r=r.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new It(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new It(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new It(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new It(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Pt,t}(),Rt=Math.log(2),Dt=function(){function t(t){this.count=parseInt(Math.log(t+1)/Rt,10),this.current_=this.count-1;var e=parseInt(Array(this.count+1).join("1"),2);this.bits_=t+1&e}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Mt=function(t,e,r,n){t.sort(e);var i=function(e,n){var o,a,s=n-e;if(0==s)return null;if(1==s)return o=t[e],a=r?r(o):o,new kt(a,o.node,kt.BLACK,null,null);var l=parseInt(s/2,10)+e,u=i(e,l),c=i(l+1,n);return o=t[l],a=r?r(o):o,new kt(a,o.node,kt.BLACK,u,c)},o=function(e){for(var n=null,o=null,a=t.length,s=function(e,n){var o=a-e,s=a;a-=e;var u=i(o+1,s),c=t[o],h=r?r(c):c;l(new kt(h,c.node,n,null,u))},l=function(t){n?(n.left=t,n=t):(o=t,n=t)},u=0;u<e.count;++u){var c=e.nextBitIsOne(),h=Math.pow(2,e.count-(u+1));c?s(h,kt.BLACK):(s(h,kt.BLACK),s(h,kt.RED))}return o}(new Dt(t.length));return new Ot(n||e,o)},Lt={},zt=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return g.assert(Lt&&At,"ChildrenNode.ts has not been loaded"),d=d||new t({".priority":Lt},{".priority":At})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=g.safeGet(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===Lt?null:e},t.prototype.hasIndex=function(t){return g.contains(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,r){g.assert(e!==Et,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,i=[],o=!1,a=r.getIterator(bt.Wrap),s=a.getNext();s;)o=o||e.isDefinedOn(s.node),i.push(s),s=a.getNext();n=o?Mt(i,e.getCompare()):Lt;var l=e.toString(),u=g.clone(this.indexSet_);u[l]=e;var c=g.clone(this.indexes_);return c[l]=n,new t(c,u)},t.prototype.addToIndexes=function(e,r){var n=this;return new t(g.map(this.indexes_,function(t,i){var o=g.safeGet(n.indexSet_,i);if(g.assert(o,"Missing index implementation for "+i),t===Lt){if(o.isDefinedOn(e.node)){for(var a=[],s=r.getIterator(bt.Wrap),l=s.getNext();l;)l.name!=e.name&&a.push(l),l=s.getNext();return a.push(e),Mt(a,o.getCompare())}return Lt}var u=r.get(e.name),c=t;return u&&(c=c.remove(new bt(e.name,u))),c.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,r){return new t(g.map(this.indexes_,function(t){if(t===Lt)return t;var n=r.get(e.name);return n?t.remove(new bt(e.name,n)):t}),this.indexSet_)},t}();function Nt(t,e){return B(t.name,e.name)}function Ft(t,e){return B(t,e)}var Bt=function(){function t(t,e,r){this.children_=t,this.priorityNode_=e,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&St(this.priorityNode_),this.children_.isEmpty()&&g.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return f||(f=new t(new Ot(Ft),null,zt.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||f},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?f:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,r){if(g.assert(r,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(r);var n,i=new bt(e,r),o=void 0,a=void 0;return r.isEmpty()?(o=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(e,r),a=this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?f:this.priorityNode_,new t(o,n,a)},t.prototype.updateChild=function(t,e){var r=t.getFront();if(null===r)return e;g.assert(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var n=this.getImmediateChild(r).updateChild(t.popFront(),e);return this.updateImmediateChild(r,n)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var r={},n=0,i=0,o=!0;if(this.forEachChild(At,function(a,s){r[a]=s.val(e),n++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!e&&o&&i<2*n){var a=[];for(var s in r)a[s]=r[s];return a}return e&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Ct(this.getPriority().val())+":"),this.forEachChild(At,function(e,r){var n=r.hash();""!==n&&(t+=":"+e+":"+n)}),this.lazyHash_=""===t?"":T(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,r){var n=this.resolveIndex_(r);if(n){var i=n.getPredecessorKey(new bt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var r=e.minKey();return r&&r.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new bt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var r=e.maxKey();return r&&r.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new bt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var r=this.resolveIndex_(t);return r?r.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var r=this.resolveIndex_(e);if(r)return r.getIteratorFrom(t,function(t){return t});for(var n=this.children_.getIteratorFrom(t.name,bt.Wrap),i=n.peek();null!=i&&e.compare(i,t)<0;)n.getNext(),i=n.peek();return n},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var r=this.resolveIndex_(e);if(r)return r.getReverseIteratorFrom(t,function(t){return t});for(var n=this.children_.getReverseIteratorFrom(t.name,bt.Wrap),i=n.peek();null!=i&&e.compare(i,t)>0;)n.getNext(),i=n.peek();return n},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Vt?-1:0},t.prototype.withIndex=function(e){if(e===Et||this.indexMap_.hasIndex(e))return this;var r=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,r)},t.prototype.isIndexed=function(t){return t===Et||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var r=this.getIterator(At),n=e.getIterator(At),i=r.getNext(),o=n.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=n.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===Et?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Vt=new(function(t){function e(){return t.call(this,new Ot(Ft),Bt.EMPTY_NODE,zt.Default)||this}return y.__extends(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Bt.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Bt));Object.defineProperties(bt,{MIN:{value:new bt(N,Bt.EMPTY_NODE)},MAX:{value:new bt(F,Vt)}}),wt.__EMPTY_NODE=Bt.EMPTY_NODE,Tt.__childrenNodeConstructor=Bt,u=Vt,p=Vt;var jt=!0;function Ut(t,e){if(void 0===e&&(e=null),null===t)return Bt.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),g.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Tt(t,Ut(e));if(t instanceof Array||!jt){var r=Bt.EMPTY_NODE,n=t;return g.forEach(n,function(t,e){if(g.contains(n,t)&&"."!==t.substring(0,1)){var i=Ut(e);!i.isLeafNode()&&i.isEmpty()||(r=r.updateImmediateChild(t,i))}}),r.updatePriority(Ut(e))}var i=[],o=!1,a=t;if(g.forEach(a,function(t,e){if("string"!=typeof t||"."!==t.substring(0,1)){var r=Ut(a[t]);r.isEmpty()||(o=o||!r.getPriority().isEmpty(),i.push(new bt(t,r)))}}),0==i.length)return Bt.EMPTY_NODE;var s=Mt(i,Nt,function(t){return t.name},Ft);if(o){var l=Mt(i,At.getCompare());return new Bt(s,Ut(e),new zt({".priority":l},{".priority":At}))}return new Bt(s,Ut(e),zt.Default)}h=Ut;var qt,Ht,Wt,Gt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return y.__extends(e,t),e.prototype.compare=function(t,e){var r=t.node.compareTo(e.node);return 0===r?B(t.name,e.name):r},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return bt.MIN},e.prototype.maxPost=function(){return bt.MAX},e.prototype.makePost=function(t,e){var r=Ut(t);return new bt(e,r)},e.prototype.toString=function(){return".value"},e}(xt)),Zt=function(t){function e(e){var r=t.call(this)||this;return r.indexPath_=e,g.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),r}return y.__extends(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var r=this.extractChild(t.node),n=this.extractChild(e.node),i=r.compareTo(n);return 0===i?B(t.name,e.name):i},e.prototype.makePost=function(t,e){var r=Ut(t),n=Bt.EMPTY_NODE.updateChild(this.indexPath_,r);return new bt(e,n)},e.prototype.maxPost=function(){var t=Bt.EMPTY_NODE.updateChild(this.indexPath_,Vt);return new bt(F,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(xt),Qt=function(){function t(t,e,r){this.node_=t,this.ref_=e,this.index_=r}return t.prototype.val=function(){return g.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return g.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return g.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return g.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){g.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),ft("DataSnapshot.child",1,e,!1);var r=new X(e),n=this.ref_.child(r);return new t(this.node_.getChild(r),n,At)},t.prototype.hasChild=function(t){g.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),ft("DataSnapshot.hasChild",1,t,!1);var e=new X(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return g.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var r=this;return g.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),g.validateCallback("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(n,i){return e(new t(i,r.ref_.child(n),At))})},t.prototype.hasChildren=function(){return g.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return g.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return g.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Kt=function(){function t(t,e,r,n){this.eventType=t,this.eventRegistration=e,this.snapshot=r,this.prevName=n}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+g.stringify(this.snapshot.exportVal())},t}(),$t=function(){function t(t,e,r){this.eventRegistration=t,this.error=e,this.path=r}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Xt=function(){function t(t,e,r){this.callback_=t,this.cancelCallback_=e,this.context_=r}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var r=e.getQueryParams().getIndex();return new Kt("value",this,new Qt(t.snapshotNode,e.getRef(),r))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){g.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(e,t.error)}}var n=this.callback_;return function(){n.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new $t(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Yt=function(){function t(t,e,r){this.callbacks_=t,this.cancelCallback_=e,this.context_=r}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return g.contains(this.callbacks_,e="children_removed"===e?"child_removed":e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new $t(this,t,e):null},t.prototype.createEvent=function(t,e){g.assert(null!=t.childName,"Child events should have a childName.");var r=e.getRef().child(t.childName),n=e.getQueryParams().getIndex();return new Kt(t.type,this,new Qt(t.snapshotNode,r,n),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){g.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(e,t.error)}}var n=this.callbacks_[t.eventType];return function(){n.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var r=g.getCount(e.callbacks_);if(r===g.getCount(this.callbacks_)){if(1===r){var n=g.getAnyKey(e.callbacks_),i=g.getAnyKey(this.callbacks_);return!(i!==n||e.callbacks_[n]&&this.callbacks_[i]&&e.callbacks_[n]!==this.callbacks_[i])}return g.every(this.callbacks_,function(t,r){return e.callbacks_[t]===r})}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Jt=function(){function t(t,e,r,n){this.repo=t,this.path=e,this.queryParams_=r,this.orderByCalled_=n}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return g.assert(qt,"Reference.ts has not been loaded"),qt},set:function(t){qt=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,r=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(r=t.getIndexEndValue()),t.getIndex()===Et){var n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=N)throw new Error(n);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=F)throw new Error(n);if("string"!=typeof r)throw new Error(i)}}else if(t.getIndex()===At){if(null!=e&&!st(e)||null!=r&&!st(r))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(g.assert(t.getIndex()instanceof Zt||t.getIndex()===Gt,"unknown index type."),null!=e&&"object"==typeof e||null!=r&&"object"==typeof r)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return g.validateArgCount("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,r,n,i){g.validateArgCount("Query.on",2,4,arguments.length),pt("Query.on",1,e,!1),g.validateCallback("Query.on",2,r,!1);var o=t.getCancelAndContextArgs_("Query.on",n,i);if("value"===e)this.onValueEvent(r,o.cancel,o.context);else{var a={};a[e]=r,this.onChildEvent(a,o.cancel,o.context)}return r},t.prototype.onValueEvent=function(t,e,r){var n=new Xt(t,e||null,r||null);this.repo.addEventCallbackForQuery(this,n)},t.prototype.onChildEvent=function(t,e,r){var n=new Yt(t,e,r);this.repo.addEventCallbackForQuery(this,n)},t.prototype.off=function(t,e,r){g.validateArgCount("Query.off",0,3,arguments.length),pt("Query.off",1,t,!0),g.validateCallback("Query.off",2,e,!0),g.validateContextObject("Query.off",3,r,!0);var n=null,i=null;"value"===t?n=new Xt(e||null,null,r||null):t&&(e&&((i={})[t]=e),n=new Yt(i,null,r||null)),this.repo.removeEventCallbackForQuery(this,n)},t.prototype.once=function(e,r,n,i){var o=this;g.validateArgCount("Query.once",1,4,arguments.length),pt("Query.once",1,e,!1),g.validateCallback("Query.once",2,r,!0);var a=t.getCancelAndContextArgs_("Query.once",n,i),s=!0,l=new g.Deferred;l.promise.catch(function(){});var u=function(t){s&&(s=!1,o.off(e,u),r&&r.bind(a.context)(t),l.resolve(t))};return this.on(e,u,function(t){o.off(e,u),a.cancel&&a.cancel.bind(a.context)(t),l.reject(t)}),l.promise},t.prototype.limitToFirst=function(e){if(g.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(g.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(g.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ft("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var r=new X(e);if(r.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Zt(r),i=this.queryParams_.orderBy(n);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){g.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(Et);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){g.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(At);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){g.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Gt);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,r){void 0===e&&(e=null),g.validateArgCount("Query.startAt",0,2,arguments.length),lt("Query.startAt",1,e,this.path,!0),dt("Query.startAt",2,r,!0);var n=this.queryParams_.startAt(e,r);if(t.validateLimit_(n),t.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,r=null),new t(this.repo,this.path,n,this.orderByCalled_)},t.prototype.endAt=function(e,r){void 0===e&&(e=null),g.validateArgCount("Query.endAt",0,2,arguments.length),lt("Query.endAt",1,e,this.path,!0),dt("Query.endAt",2,r,!0);var n=this.queryParams_.endAt(e,r);if(t.validateLimit_(n),t.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,n,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(g.validateArgCount("Query.equalTo",1,2,arguments.length),lt("Query.equalTo",1,t,this.path,!1),dt("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return g.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return g.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=U(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(g.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof t))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var r=this.repo===e.repo,n=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return r&&n&&i},t.getCancelAndContextArgs_=function(t,e,r){var n={cancel:null,context:null};if(e&&r)n.cancel=e,g.validateCallback(t,3,n.cancel,!0),n.context=r,g.validateContextObject(t,4,n.context,!0);else if(e)if("object"==typeof e&&null!==e)n.context=e;else{if("function"!=typeof e)throw new Error(g.errorPrefix(t,3,!0)+" must either be a cancel callback or a context object.");n.cancel=e}return n},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),te=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return g.contains(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return g.isEmpty(this.set)},t.prototype.count=function(){return g.getCount(this.set)},t.prototype.each=function(t){g.forEach(this.set,function(e,r){return t(e,r)})},t.prototype.keys=function(){var t=[];return g.forEach(this.set,function(e){t.push(e)}),t},t}(),ee=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,r){if(e.isEmpty())this.value_=r,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,r);else{null==this.children_&&(this.children_=new te);var n=e.getFront();this.children_.contains(n)||this.children_.add(n,new t);var i=this.children_.get(n);e=e.popFront(),i.remember(e,r)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var r=this;return e.forEachChild(At,function(t,e){r.remember(new X(t),e)}),this.forget(t)}if(null!==this.children_){var n=t.getFront();return t=t.popFront(),this.children_.contains(n)&&this.children_.get(n).forget(t)&&this.children_.remove(n),!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(r,n){var i=new X(t.toString()+"/"+r);n.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,r){t(e,r)})},t}(),re=function(t,e){return t&&"object"==typeof t?(g.assert(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},ne=function(t,e){var r,n=t.getPriority().val(),i=re(n,e);if(t.isLeafNode()){var o=t,a=re(o.getValue(),e);return a!==o.getValue()||i!==o.getPriority().val()?new Tt(a,Ut(i)):t}var s=t;return r=s,i!==s.getPriority().val()&&(r=r.updatePriority(new Tt(i))),s.forEachChild(At,function(t,n){var i=ne(n,e);i!==n&&(r=r.updateImmediateChild(t,i))}),r},ie=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}({}),oe=function(){function t(t,e,r,n){this.fromUser=t,this.fromServer=e,this.queryId=r,this.tagged=n,g.assert(!n||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ae=function(){function t(t,e,r){this.path=t,this.affectedTree=e,this.revert=r,this.type=ie.ACK_USER_WRITE,this.source=oe.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return g.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var r=this.affectedTree.subtree(new X(e));return new t(X.Empty,r,this.revert)}return g.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),se=function(){return Ht||(Ht=new Ot(V)),Ht},le=function(){function t(t,e){void 0===e&&(e=se()),this.value=t,this.children=e}return t.fromObject=function(e){var r=t.Empty;return g.forEach(e,function(t,e){r=r.set(new X(t),e)}),r},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:X.Empty,value:this.value};if(t.isEmpty())return null;var r=t.getFront(),n=this.children.get(r);if(null!==n){var i=n.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new X(r).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var r=e.getFront(),n=this.children.get(r);return null!==n?n.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,r){if(e.isEmpty())return new t(r,this.children);var n=e.getFront(),i=(this.children.get(n)||t.Empty).set(e.popFront(),r),o=this.children.insert(n,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var r=e.getFront(),n=this.children.get(r);if(n){var i=n.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),r=this.children.get(e);return r?r.get(t.popFront()):null},t.prototype.setTree=function(e,r){if(e.isEmpty())return r;var n,i=e.getFront(),o=(this.children.get(i)||t.Empty).setTree(e.popFront(),r);return n=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,n)},t.prototype.fold=function(t){return this.fold_(X.Empty,t)},t.prototype.fold_=function(t,e){var r={};return this.children.inorderTraversal(function(n,i){r[n]=i.fold_(t.child(n),e)}),e(t,this.value,r)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,X.Empty,e)},t.prototype.findOnPath_=function(t,e,r){var n=!!this.value&&r(e,this.value);if(n)return n;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),r):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,X.Empty,e)},t.prototype.foreachOnPath_=function(e,r,n){if(e.isEmpty())return this;this.value&&n(r,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),r.child(i),n):t.Empty},t.prototype.foreach=function(t){this.foreach_(X.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(r,n){n.foreach_(t.child(r),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,r){r.value&&t(e,r.value)})},t.Empty=new t(null),t}(),ue=function(){function t(t,e){this.source=t,this.path=e,this.type=ie.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,X.Empty):new t(this.source,this.path.popFront())},t}(),ce=function(){function t(t,e,r){this.source=t,this.path=e,this.snap=r,this.type=ie.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,X.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),he=function(){function t(t,e,r){this.source=t,this.path=e,this.children=r,this.type=ie.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var r=this.children.subtree(new X(e));return r.isEmpty()?null:r.value?new ce(this.source,X.Empty,r.value):new t(this.source,X.Empty,r)}return g.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),pe=function(){function t(t,e,r){this.node_=t,this.fullyInitialized_=e,this.filtered_=r}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),de=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,r,n){return new t(new pe(e,r,n),this.serverCache_)},t.prototype.updateServerSnap=function(e,r,n){return new t(this.eventCache_,new pe(e,r,n))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new pe(Bt.EMPTY_NODE,!1,!1),new pe(Bt.EMPTY_NODE,!1,!1)),t}(),fe=function(){function t(t,e,r,n,i){this.type=t,this.snapshotNode=e,this.childName=r,this.oldSnap=n,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,r){return new t(t.CHILD_ADDED,r,e)},t.childRemovedChange=function(e,r){return new t(t.CHILD_REMOVED,r,e)},t.childChangedChange=function(e,r,n){return new t(t.CHILD_CHANGED,r,e,n)},t.childMovedChange=function(e,r){return new t(t.CHILD_MOVED,r,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),me=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,r,n,i,o){g.assert(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(n).equals(r.getChild(n))&&a.isEmpty()==r.isEmpty()?t:(null!=o&&(r.isEmpty()?t.hasChild(e)?o.trackChildChange(fe.childRemovedChange(e,a)):g.assert(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(fe.childAddedChange(e,r)):o.trackChildChange(fe.childChangedChange(e,r,a))),t.isLeafNode()&&r.isEmpty()?t:t.updateImmediateChild(e,r).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,r){return null!=r&&(t.isLeafNode()||t.forEachChild(At,function(t,n){e.hasChild(t)||r.trackChildChange(fe.childRemovedChange(t,n))}),e.isLeafNode()||e.forEachChild(At,function(e,n){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(n)||r.trackChildChange(fe.childChangedChange(e,n,i))}else r.trackChildChange(fe.childAddedChange(e,n))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Bt.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),ye=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,r=t.childName;g.assert(e==fe.CHILD_ADDED||e==fe.CHILD_CHANGED||e==fe.CHILD_REMOVED,"Only child changes supported for tracking"),g.assert(".priority"!==r,"Only non-priority child changes can be tracked.");var n=g.safeGet(this.changeMap_,r);if(n){var i=n.type;if(e==fe.CHILD_ADDED&&i==fe.CHILD_REMOVED)this.changeMap_[r]=fe.childChangedChange(r,t.snapshotNode,n.snapshotNode);else if(e==fe.CHILD_REMOVED&&i==fe.CHILD_ADDED)delete this.changeMap_[r];else if(e==fe.CHILD_REMOVED&&i==fe.CHILD_CHANGED)this.changeMap_[r]=fe.childRemovedChange(r,n.oldSnap);else if(e==fe.CHILD_CHANGED&&i==fe.CHILD_ADDED)this.changeMap_[r]=fe.childAddedChange(r,t.snapshotNode);else{if(e!=fe.CHILD_CHANGED||i!=fe.CHILD_CHANGED)throw g.assertionError("Illegal combination of changes: "+t+" occurred after "+n);this.changeMap_[r]=fe.childChangedChange(r,t.snapshotNode,n.oldSnap)}}else this.changeMap_[r]=t},t.prototype.getChanges=function(){return g.getValues(this.changeMap_)},t}(),ge=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,r){return null},t}()),_e=function(){function t(t,e,r){void 0===r&&(r=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=r}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var r=null!=this.optCompleteServerCache_?new pe(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,r)},t.prototype.getChildAfterChild=function(t,e,r){var n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(n,e,1,r,t);return 0===i.length?null:i[0]},t}(),ve=function(){return function(t,e){this.viewCache=t,this.changes=e}}(),be=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){g.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),g.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,r,n,i){var o,a,s=new ye;if(r.type===ie.OVERWRITE){var l=r;l.source.fromUser?o=this.applyUserOverwrite_(e,l.path,l.snap,n,i,s):(g.assert(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.getServerCache().isFiltered()&&!l.path.isEmpty(),o=this.applyServerOverwrite_(e,l.path,l.snap,n,i,a,s))}else if(r.type===ie.MERGE){var u=r;u.source.fromUser?o=this.applyUserMerge_(e,u.path,u.children,n,i,s):(g.assert(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,u.path,u.children,n,i,a,s))}else if(r.type===ie.ACK_USER_WRITE){var c=r;o=c.revert?this.revertUserWrite_(e,c.path,n,i,s):this.ackUserWrite_(e,c.path,c.affectedTree,n,i,s)}else{if(r.type!==ie.LISTEN_COMPLETE)throw g.assertionError("Unknown operation type: "+r.type);o=this.listenComplete_(e,r.path,n,s)}var h=s.getChanges();return t.maybeAddValueEvent_(e,o,h),new ve(o,h)},t.maybeAddValueEvent_=function(t,e,r){var n=e.getEventCache();if(n.isFullyInitialized()){var i=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=t.getCompleteEventSnap();(r.length>0||!t.getEventCache().isFullyInitialized()||i&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&r.push(fe.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,r,n,i){var o=t.getEventCache();if(null!=r.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(g.assert(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var l=t.getCompleteServerSnap(),u=r.calcCompleteEventChildren(l instanceof Bt?l:Bt.EMPTY_NODE);a=this.filter_.updateFullNode(t.getEventCache().getNode(),u,i)}else{var c=r.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),c,i)}else{var h=e.getFront();if(".priority"==h){g.assert(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=r.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var f=e.popFront(),m=void 0;if(o.isCompleteForChild(h)){s=t.getServerCache().getNode();var y=r.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=y?o.getNode().getImmediateChild(h).updateChild(f,y):o.getNode().getImmediateChild(h)}else m=r.calcCompleteChild(h,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),h,m,f,n,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,r,n,i,o,a){var s,l=t.getServerCache(),u=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(e,r);s=u.updateFullNode(l.getNode(),c,null)}else{var h=e.getFront();if(!l.isCompleteForPath(e)&&e.getLength()>1)return t;var p=e.popFront(),d=l.getNode().getImmediateChild(h).updateChild(p,r);s=".priority"==h?u.updatePriority(l.getNode(),d):u.updateChild(l.getNode(),h,d,p,ge,null)}var f=t.updateServerSnap(s,l.isFullyInitialized()||e.isEmpty(),u.filtersNodes()),m=new _e(n,f,i);return this.generateEventCacheAfterServerEvent_(f,e,n,m,a)},t.prototype.applyUserOverwrite_=function(t,e,r,n,i,o){var a,s,l=t.getEventCache(),u=new _e(n,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),r,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var c=e.getFront();if(".priority"===c)s=this.filter_.updatePriority(t.getEventCache().getNode(),r),a=t.updateEventSnap(s,l.isFullyInitialized(),l.isFiltered());else{var h=e.popFront(),p=l.getNode().getImmediateChild(c),d=void 0;if(h.isEmpty())d=r;else{var f=u.getCompleteChild(c);d=null!=f?".priority"===h.getBack()&&f.getChild(h.parent()).isEmpty()?f:f.updateChild(h,r):Bt.EMPTY_NODE}if(p.equals(d))a=t;else{var m=this.filter_.updateChild(l.getNode(),c,d,h,u,o);a=t.updateEventSnap(m,l.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,r,n,i,o,a){var s=this,l=e;return n.foreach(function(n,u){var c=r.child(n);t.cacheHasChild_(e,c.getFront())&&(l=s.applyUserOverwrite_(l,c,u,i,o,a))}),n.foreach(function(n,u){var c=r.child(n);t.cacheHasChild_(e,c.getFront())||(l=s.applyUserOverwrite_(l,c,u,i,o,a))}),l},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,r){t=t.updateChild(e,r)}),t},t.prototype.applyServerMerge_=function(t,e,r,n,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var l,u=t;l=e.isEmpty()?r:le.Empty.setTree(e,r);var c=t.getServerCache().getNode();return l.children.inorderTraversal(function(e,r){if(c.hasChild(e)){var l=t.getServerCache().getNode().getImmediateChild(e),h=s.applyMerge_(l,r);u=s.applyServerOverwrite_(u,new X(e),h,n,i,o,a)}}),l.children.inorderTraversal(function(e,r){var l=!t.getServerCache().isCompleteForChild(e)&&null==r.value;if(!c.hasChild(e)&&!l){var h=t.getServerCache().getNode().getImmediateChild(e),p=s.applyMerge_(h,r);u=s.applyServerOverwrite_(u,new X(e),p,n,i,o,a)}}),u},t.prototype.ackUserWrite_=function(t,e,r,n,i,o){if(null!=n.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=r.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),n,i,a,o);if(e.isEmpty()){var l=le.Empty;return s.getNode().forEachChild(Et,function(t,e){l=l.set(new X(t),e)}),this.applyServerMerge_(t,e,l,n,i,a,o)}return t}var u=le.Empty;return r.foreach(function(t,r){var n=e.child(t);s.isCompleteForPath(n)&&(u=u.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,e,u,n,i,a,o)},t.prototype.listenComplete_=function(t,e,r,n){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,r,ge,n)},t.prototype.revertUserWrite_=function(t,e,r,n,i){var o;if(null!=r.shadowingWrite(e))return t;var a=new _e(r,t,n),s=t.getEventCache().getNode(),l=void 0;if(e.isEmpty()||".priority"===e.getFront()){var u=void 0;if(t.getServerCache().isFullyInitialized())u=r.calcCompleteEventCache(t.getCompleteServerSnap());else{var c=t.getServerCache().getNode();g.assert(c instanceof Bt,"serverChildren would be complete if leaf node"),u=r.calcCompleteEventChildren(c)}l=this.filter_.updateFullNode(s,u=u,i)}else{var h=e.getFront(),p=r.calcCompleteChild(h,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(h)&&(p=s.getImmediateChild(h)),(l=null!=p?this.filter_.updateChild(s,h,p,e.popFront(),a,i):t.getEventCache().getNode().hasChild(h)?this.filter_.updateChild(s,h,Bt.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=r.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(l=this.filter_.updateFullNode(l,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=r.shadowingWrite(X.Empty),t.updateEventSnap(l,o,this.filter_.filtersNodes())},t}(),xe=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,r){var n=this,i=[],o=[];return t.forEach(function(t){t.type===fe.CHILD_CHANGED&&n.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(fe.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,fe.CHILD_REMOVED,t,r,e),this.generateEventsForType_(i,fe.CHILD_ADDED,t,r,e),this.generateEventsForType_(i,fe.CHILD_MOVED,o,r,e),this.generateEventsForType_(i,fe.CHILD_CHANGED,t,r,e),this.generateEventsForType_(i,fe.VALUE,t,r,e),i},t.prototype.generateEventsForType_=function(t,e,r,n,i){var o=this,a=r.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var r=o.materializeSingleChange_(e,i);n.forEach(function(n){n.respondsTo(e.type)&&t.push(n.createEvent(r,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw g.assertionError("Should only compare child_ events.");var r=new bt(t.childName,t.snapshotNode),n=new bt(e.childName,e.snapshotNode);return this.index_.compare(r,n)},t}(),we=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var r=this.query_.getQueryParams(),n=new me(r.getIndex()),i=r.getNodeFilter();this.processor_=new be(i);var o=e.getServerCache(),a=e.getEventCache(),s=n.updateFullNode(Bt.EMPTY_NODE,o.getNode(),null),l=i.updateFullNode(Bt.EMPTY_NODE,a.getNode(),null),u=new pe(s,o.isFullyInitialized(),n.filtersNodes()),c=new pe(l,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new de(c,u),this.eventGenerator_=new xe(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var r=[];if(e){g.assert(null==t,"A cancel should cancel all event registrations.");var n=this.query_.path;this.eventRegistrations_.forEach(function(t){var i=t.createCancelEvent(e=e,n);i&&r.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return r},t.prototype.applyOperation=function(t,e,r){t.type===ie.MERGE&&null!==t.source.queryId&&(g.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),g.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var n=this.viewCache_,i=this.processor_.applyOperation(n,t,e,r);return this.processor_.assertIndexed(i.viewCache),g.assert(i.viewCache.getServerCache().isFullyInitialized()||!n.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),r=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(At,function(t,e){r.push(fe.childAddedChange(t,e))}),e.isFullyInitialized()&&r.push(fe.valueChange(e.getNode())),this.generateEventsForChanges_(r,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,r){return this.eventGenerator_.generateEventsForChanges(t,e,r?[r]:this.eventRegistrations_)},t}(),Ee=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return g.assert(Wt,"Reference.ts has not been loaded"),Wt},set:function(t){g.assert(!Wt,"__referenceConstructor has already been defined"),Wt=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return g.isEmpty(this.views_)},t.prototype.applyOperation=function(t,e,r){var n=t.source.queryId;if(null!==n){var i=g.safeGet(this.views_,n);return g.assert(null!=i,"SyncTree gave us an op for an invalid query."),i.applyOperation(t,e,r)}var o=[];return g.forEach(this.views_,function(n,i){o=o.concat(i.applyOperation(t,e,r))}),o},t.prototype.addEventRegistration=function(t,e,r,n,i){var o=t.queryIdentifier(),a=g.safeGet(this.views_,o);if(!a){var s=r.calcCompleteEventCache(i?n:null),l=!1;s?l=!0:n instanceof Bt?(s=r.calcCompleteEventChildren(n),l=!1):(s=Bt.EMPTY_NODE,l=!1);var u=new de(new pe(s,l,!1),new pe(n,i,!1));a=new we(t,u),this.views_[o]=a}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,r,n){var i=e.queryIdentifier(),o=[],a=[],s=this.hasCompleteView();if("default"===i){var l=this;g.forEach(this.views_,function(t,e){a=a.concat(e.removeEventRegistration(r,n)),e.isEmpty()&&(delete l.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var u=g.safeGet(this.views_,i);u&&(a=a.concat(u.removeEventRegistration(r,n)),u.isEmpty()&&(delete this.views_[i],u.getQuery().getQueryParams().loadsAllData()||o.push(u.getQuery())))}return s&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:a}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return g.forEach(this.views_,function(r,n){e=e||n.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return g.safeGet(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){return g.findValue(this.views_,function(t){return t.getQuery().getQueryParams().loadsAllData()})||null},t}(),Ce=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,r){if(e.isEmpty())return new t(new le(r));var n=this.writeTree_.findRootMostValueAndPath(e);if(null!=n){var i=n.path,o=n.value,a=X.relativePath(i,e);return o=o.updateChild(a,r),new t(this.writeTree_.set(i,o))}var s=new le(r);return new t(this.writeTree_.setTree(e,s))},t.prototype.addWrites=function(t,e){var r=this;return g.forEach(e,function(e,n){r=r.addWrite(t.child(e),n)}),r},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,le.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(X.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(At,function(e,r){t.push(new bt(e,r))}):this.writeTree_.children.inorderTraversal(function(e,r){null!=r.value&&t.push(new bt(e,r.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var r=this.getCompleteNode(e);return new t(null!=r?new le(r):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(X.Empty,this.writeTree_,e)},t.Empty=new t(new le(null)),t.applySubtreeWrite_=function(e,r,n){if(null!=r.value)return n.updateChild(e,r.value);var i=null;return r.children.inorderTraversal(function(r,o){".priority"===r?(g.assert(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):n=t.applySubtreeWrite_(e.child(r),o,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(e.child(".priority"),i)),n},t}(),Se=function(){function t(){this.visibleWrites_=Ce.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Te(t,this)},t.prototype.addOverwrite=function(t,e,r,n){g.assert(r>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===n&&(n=!0),this.allWrites_.push({path:t,snap:e,writeId:r,visible:n}),n&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=r},t.prototype.addMerge=function(t,e,r){g.assert(r>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:r,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=r},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var r=this.allWrites_[e];if(r.writeId===t)return r}return null},t.prototype.removeWrite=function(t){var e=this,r=this.allWrites_.findIndex(function(e){return e.writeId===t});g.assert(r>=0,"removeWrite called with nonexistent writeId.");var n=this.allWrites_[r];this.allWrites_.splice(r,1);for(var i=n.visible,o=!1,a=this.allWrites_.length-1;i&&a>=0;){var s=this.allWrites_[a];s.visible&&(a>=r&&this.recordContainsPath_(s,n.path)?i=!1:n.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?(this.resetTree_(),!0):(n.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(n.path):g.forEach(n.children,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(n.path.child(t))}),!0))},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,r,n,i){if(n||i){var o=this.visibleWrites_.childCompoundWrite(e);return!i&&o.isEmpty()?r:i||null!=r||o.hasCompleteWrite(X.Empty)?t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e).apply(r||Bt.EMPTY_NODE):null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);return s.isEmpty()?r:null!=r||s.hasCompleteWrite(X.Empty)?s.apply(r||Bt.EMPTY_NODE):null},t.prototype.calcCompleteEventChildren=function(t,e){var r=Bt.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(At,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(At,function(t,e){var n=i.childCompoundWrite(new X(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,r,n){g.assert(r||n,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?n.getChild(e):o.apply(n.getChild(e))},t.prototype.calcCompleteChild=function(t,e,r){var n=t.child(e),i=this.visibleWrites_.getCompleteNode(n);return null!=i?i:r.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(n).apply(r.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,r,n,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),l=s.getCompleteNode(X.Empty);if(null!=l)a=l;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var u=[],c=o.getCompare(),h=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),p=h.getNext();p&&u.length<n;)0!==c(p,r)&&u.push(p),p=h.getNext();return u},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!g.findKey(t.children,function(r,n){return t.path.child(n).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,X.Empty),this.lastWriteId_=this.allWrites_.length>0?this.allWrites_[this.allWrites_.length-1].writeId:-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,r){for(var n=Ce.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)r.contains(a)?(s=X.relativePath(r,a),n=n.addWrite(s,o.snap)):a.contains(r)&&(s=X.relativePath(a,r),n=n.addWrite(X.Empty,o.snap.getChild(s)));else{if(!o.children)throw g.assertionError("WriteRecord should have .snap or .children");if(r.contains(a))s=X.relativePath(r,a),n=n.addWrites(s,o.children);else if(a.contains(r))if((s=X.relativePath(a,r)).isEmpty())n=n.addWrites(X.Empty,o.children);else{var l=g.safeGet(o.children,s.getFront());if(l){var u=l.getChild(s.popFront());n=n.addWrite(X.Empty,u)}}}}}return n},t}(),Te=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,r){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,r)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,r){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,r)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,r,n,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,r,n,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),Ae=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=le.Empty,this.pendingWriteTree_=new Se,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,r,n){return this.pendingWriteTree_.addOverwrite(t,e,r,n),n?this.applyOperationToSyncPoints_(new ce(oe.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,r){this.pendingWriteTree_.addMerge(t,e,r);var n=le.fromObject(e);return this.applyOperationToSyncPoints_(new he(oe.User,t,n))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var r=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var n=le.Empty;return null!=r.snap?n=n.set(X.Empty,!0):g.forEach(r.children,function(t,e){n=n.set(new X(t),e)}),this.applyOperationToSyncPoints_(new ae(r.path,n,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new ce(oe.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var r=le.fromObject(e);return this.applyOperationToSyncPoints_(new he(oe.Server,t,r))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ue(oe.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,r,n){var i=this.queryKeyForTag_(n);if(null!=i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,l=X.relativePath(a,e),u=new ce(oe.forServerTaggedQuery(s),l,r);return this.applyTaggedOperation_(a,u)}return[]},t.prototype.applyTaggedQueryMerge=function(e,r,n){var i=this.queryKeyForTag_(n);if(i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,l=X.relativePath(a,e),u=le.fromObject(r),c=new he(oe.forServerTaggedQuery(s),l,u);return this.applyTaggedOperation_(a,c)}return[]},t.prototype.applyTaggedListenComplete=function(e,r){var n=this.queryKeyForTag_(r);if(n){var i=t.parseQueryKey_(n),o=i.path,a=i.queryId,s=X.relativePath(o,e),l=new ue(oe.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,l)}return[]},t.prototype.addEventRegistration=function(e,r){var n=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(n,function(t,e){var r=X.relativePath(t,n);i=i||e.getCompleteServerCache(r),o=o||e.hasCompleteView()});var a,s=this.syncPointTree_.get(n);s?(o=o||s.hasCompleteView(),i=i||s.getCompleteServerCache(X.Empty)):(s=new Ee,this.syncPointTree_=this.syncPointTree_.set(n,s)),null!=i?a=!0:(a=!1,i=Bt.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild(function(t,e){var r=e.getCompleteServerCache(X.Empty);r&&(i=i.updateImmediateChild(t,r))}));var l=s.viewExistsForQuery(e);if(!l&&!e.getQueryParams().loadsAllData()){var u=t.makeQueryKey_(e);g.assert(!(u in this.queryToTagMap_),"View does not exist, but we have a tag");var c=t.getNextQueryTag_();this.queryToTagMap_[u]=c,this.tagToQueryMap_["_"+c]=u}var h=this.pendingWriteTree_.childWrites(n),p=s.addEventRegistration(e,r,h,i,a);if(!l&&!o){var d=s.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,r,n){var i=this,o=e.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var l=a.removeEventRegistration(e,r,n);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var u=l.removed;s=l.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(c&&!h){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var m=d[f],y=m.getQuery(),g=this.createListenerForView_(m);this.listenProvider_.startListening(t.queryForListening_(y),this.tagForQuery_(y),g.hashFn,g.onComplete)}}!h&&u.length>0&&!n&&(c?this.listenProvider_.stopListening(t.queryForListening_(e),null):u.forEach(function(e){var r=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),r)})),this.removeTags_(u)}return s},t.prototype.calcCompleteEventCache=function(t,e){var r=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(t,function(e,r){var n=X.relativePath(e,t),i=r.getCompleteServerCache(n);if(i)return i});return r.calcCompleteEventCache(t,n,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,r){if(e&&e.hasCompleteView())return[e.getCompleteView()];var n=[];return e&&(n=e.getQueryViews()),g.forEach(r,function(t,e){n=n.concat(e)}),n})},t.prototype.removeTags_=function(e){for(var r=0;r<e.length;++r){var n=e[r];if(!n.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(n),o=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+o]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,r){var n=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(r),a=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),s=this.syncPointTree_.subtree(n);if(i)g.assert(!s.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var l=s.fold(function(t,e,r){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var n=[];return e&&(n=n.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),g.forEach(r,function(t,e){n=n.concat(e)}),n}),u=0;u<l.length;++u){var c=l[u];this.listenProvider_.stopListening(t.queryForListening_(c),this.tagForQuery_(c))}return a},t.prototype.createListenerForView_=function(t){var e=this,r=t.getQuery(),n=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||Bt.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return n?e.applyTaggedListenComplete(r.path,n):e.applyListenComplete(r.path);var i=function(t,e){var r="Unknown Error";"too_big"===t?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?r="Client doesn't have permission to access the desired data.":"unavailable"==t&&(r="The service is unavailable");var n=new Error(t+" at "+e.path.toString()+": "+r);return n.code=t.toUpperCase(),n}(t,r);return e.removeEventRegistration(r,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return g.assert(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new X(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var r=t.makeQueryKey_(e);return g.safeGet(this.queryToTagMap_,r)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var r=this.syncPointTree_.get(t);g.assert(r,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(t);return r.applyOperation(e,n,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(X.Empty))},t.prototype.applyOperationHelper_=function(t,e,r,n){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,r,n);var i=e.get(X.Empty);null==r&&null!=i&&(r=i.getCompleteServerCache(X.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),l=e.children.get(a);if(l&&s){var u=r?r.getImmediateChild(a):null,c=n.child(a);o=o.concat(this.applyOperationHelper_(s,l,u,c))}return i&&(o=o.concat(i.applyOperation(t,n,r))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,r,n){var i=this,o=e.get(X.Empty);null==r&&null!=o&&(r=o.getCompleteServerCache(X.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=r?r.getImmediateChild(e):null,l=n.child(e),u=t.operationForChild(e);u&&(a=a.concat(i.applyOperationDescendantsHelper_(u,o,s,l)))}),o&&(a=a.concat(o.applyOperation(t,n,r))),a},t.nextQueryTag_=1,t}(),Ie=function(){function t(){this.rootNode_=Bt.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),ke=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(O("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';L(t+="credential"in this.app_.options?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},t}(),Pe=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),g.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return g.deepCopy(this.counters_)},t}(),Oe=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Pe),this.collections_[e]},t.getOrCreateReporter=function(t,e){var r=t.toString();return this.reporters_[r]||(this.reporters_[r]=e()),this.reporters_[r]},t.collections_={},t.reporters_={},t}(),Re=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=g.clone(t);return this.last_&&g.forEach(this.last_,function(t,r){e[t]=e[t]-r}),this.last_=t,e},t}(),De=1e4,Me=3e4,Le=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Re(t);var r=De+(Me-De)*Math.random();$(this.reportStats_.bind(this),Math.floor(r))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),r={},n=!1;g.forEach(e,function(e,i){i>0&&g.contains(t.statsToReport_,e)&&(r[e]=i,n=!0)}),n&&this.server_.reportStats(r),$(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),ze=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,r=0;r<t.length;r++){var n=t[r],i=n.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Ne(i)),e.add(n)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,r=0;r<this.eventLists_.length;r++){var n=this.eventLists_[r];n&&(t(n.getPath())?(this.eventLists_[r].raise(),this.eventLists_[r]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Ne=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var r=e.getEventRunner();I&&O("event: "+e.toString()),Q(r)}}},t.prototype.getPath=function(){return this.path_},t}(),Fe=function(){function t(t){this.allowedEvents_=t,this.listeners_={},g.assert(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(Array.isArray(this.listeners_[t]))for(var n=this.listeners_[t].slice(),i=0;i<n.length;i++)n[i].callback.apply(n[i].context,e)},t.prototype.on=function(t,e,r){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:r});var n=this.getInitialEvent(t);n&&e.apply(r,n)},t.prototype.off=function(t,e,r){this.validateEventType_(t);for(var n=this.listeners_[t]||[],i=0;i<n.length;i++)if(n[i].callback===e&&(!r||r===n[i].context))return void n.splice(i,1)},t.prototype.validateEventType_=function(t){g.assert(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),Be=function(t){function e(){var e,r,n=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(r="visibilitychange",e="hidden"):void 0!==document.mozHidden?(r="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(r="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(r="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,r&&document.addEventListener(r,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}return y.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return g.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Fe),Ve=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||g.isMobileCordova()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return y.__extends(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return g.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Fe),je=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Q(function(){r.onMessage_(t[e])})},n=0;n<t.length;++n)e(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},t}(),Ue="pLPCommand",qe="pRTLPCB",He=function(){function t(t,e,r,n){this.connId=t,this.repoInfo=e,this.transportSessionId=r,this.lastSessionId=n,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=R(t),this.stats_=Oe.getCollection(e),this.urlFn=function(t){return e.connectionURL(J,t)}}return t.prototype.open=function(t,e){var r=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new je(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){r.log_("Timed out trying to connect."),r.onClosed_(),r.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(g.isNodeSdk()||"complete"===document.readyState)t();else{var e=!1,r=function(){document.body?e||(e=!0,t()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}}(function(){if(!r.isClosed_){r.scriptTagHolder=new We(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],i=t[1],o=t[2];if(r.incrementIncomingBytes_(t),r.scriptTagHolder)if(r.connectTimeoutTimer_&&(clearTimeout(r.connectTimeoutTimer_),r.connectTimeoutTimer_=null),r.everConnected_=!0,"start"==n)r.id=i,r.password=o;else{if("close"!==n)throw new Error("Unrecognized command received: "+n);i?(r.scriptTagHolder.sendNewPolls=!1,r.myPacketOrderer.closeAfter(i,function(){r.onClosed_()})):r.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],i=t[1];r.incrementIncomingBytes_(t),r.myPacketOrderer.handleResponse(n,i)},function(){r.onClosed_()},r.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),r.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=r.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",r.transportSessionId&&(t.s=r.transportSessionId),r.lastSessionId&&(t.ls=r.lastSessionId),!g.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=r.urlFn(t);r.log_("Connecting via long-poll to "+e),r.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!g.isNodeSdk()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=g.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var r=g.base64Encode(e),n=q(r,1840),i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!g.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var r={dframe:"t"};r.id=t,r.pw=e,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=g.stringify(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),We=function(){function t(e,r,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new te,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,g.isNodeSdk())this.commandCB=e,this.onMessageCB=r;else{this.uniqueCallbackIdentifier=S(),window[Ue+this.uniqueCallbackIdentifier]=e,window[qe+this.uniqueCallbackIdentifier]=r,this.myIFrame=t.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(s){O("frame writing exception"),s.stack&&O(s.stack),O(s)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||O("No IE domain setting required")}catch(r){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),g.isNodeSdk()&&this.myID){var r={disconn:"t"};r.id=this.myID,r.pw=this.myPW;var n=this.urlFn(r);t.nodeRestRequest(n)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),r="",n=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+r.length<=1870;){var i=this.pendingSegs.shift();r=r+"&seg"+n+"="+i.seg+"&ts"+n+"="+i.ts+"&d"+n+"="+i.d,n++}return this.addLongPollTag_(e+=r,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,r){this.pendingSegs.push({seg:t,ts:e,d:r}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var r=this;this.outstandingRequests.add(e,1);var n=function(){r.outstandingRequests.remove(e),r.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),n()})},t.prototype.addTag=function(t,e){var r=this;g.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!r.sendNewPolls)return;var n=r.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){var t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=function(){O("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(n)}catch(i){}},Math.floor(1))},t}(),Ge=null;"undefined"!=typeof MozWebSocket?Ge=MozWebSocket:"undefined"!=typeof WebSocket&&(Ge=WebSocket);var Ze=function(){function t(e,r,n,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=R(this.connId),this.stats_=Oe.getCollection(r),this.connURL=t.connectionURL_(r,n,i)}return t.connectionURL_=function(t,e,r){var n={v:"5"};return!g.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(n.r="f"),e&&(n.s=e),r&&(n.ls=r),t.connectionURL("websocket",n)},t.prototype.open=function(t,e){var r=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{if(g.isNodeSdk()){var n={headers:{"User-Agent":"Firebase/5/"+m.SDK_VERSION+"/"+process.platform+"/"+(g.CONSTANTS.NODE_ADMIN?"AdminNode":"Node")}},i=process.env,o=0==this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;o&&(n.proxy={origin:o}),this.mySock=new Ge(this.connURL,[],n)}else this.mySock=new Ge(this.connURL)}catch(s){this.log_("Error instantiating WebSocket.");var a=s.message||s.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(t){r.handleIncomingFrame(t)},this.mySock.onerror=function(t){r.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&r.log_(e),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var r=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&null!==Ge&&!t.forceDisallow_},t.previouslyFailed=function(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){w.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var r=g.jsonEval(e);this.onMessage(r)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(g.assert(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var r=this.extractFrameCount_(e);null!==r&&this.appendFrame_(r)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=g.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var r=q(e,16384);r.length>1&&this.sendString_(String(r.length));for(var n=0;n<r.length;n++)this.sendString_(r[n])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Qe=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[He,Ze]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var r=Ze&&Ze.isAvailable(),n=r&&!Ze.previouslyFailed();if(e.webSocketOnly&&(r||L("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Ze];else{var i=this.transports_=[];H(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Ke=function(){function t(t,e,r,n,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=r,this.onReady_=n,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=R("c:"+this.id+":"),this.transportManager_=new Qe(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var r=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(r,n)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=$(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(r){t===e.conn_?e.onConnectionLost_(r):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(r){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(r):t===e.secondaryConn_?e.onSecondaryMessageReceived_(r):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){this.sendData_({t:"d",d:t})},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=j("t",t),r=j("d",t);if("c"==e)this.onSecondaryControl_(r);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(r)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=j("t",t),r=j("d",t);"c"==e?this.onControl_(r):"d"==e&&this.onDataMessage_(r)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=j("t",t);if("d"in t){var r=t.d;if("h"===e)this.onHandshake_(r);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(r):"r"===e?this.onReset_(r):"e"===e?D("Server Error: "+r):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):D("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,r=t.v,n=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(n),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==r&&L("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var r=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,n),$(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var r=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$(function(){r.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),$e=function(){function t(){}return t.prototype.put=function(t,e,r,n){},t.prototype.merge=function(t,e,r,n){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,r){},t.prototype.onDisconnectMerge=function(t,e,r){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Xe=1e3,Ye=3e5,Je=function(t){function e(r,n,i,o,a,s){var l=t.call(this)||this;if(l.repoInfo_=r,l.onDataUpdate_=n,l.onConnectStatus_=i,l.onServerInfoUpdate_=o,l.authTokenProvider_=a,l.authOverride_=s,l.id=e.nextPersistentConnectionId_++,l.log_=R("p:"+l.id+":"),l.interruptReasons_={},l.listens_={},l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=Xe,l.maxReconnectDelay_=Ye,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,s&&!g.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Be.getInstance().on("visible",l.onVisible_,l),-1===r.host.indexOf("fblocal")&&Ve.getInstance().on("online",l.onOnline_,l),l}return y.__extends(e,t),e.prototype.sendRequest=function(t,e,r){var n=++this.requestNumber_,i={r:n,a:t,b:e};this.log_(g.stringify(i)),g.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[n]=r)},e.prototype.listen=function(t,e,r,n){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},g.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),g.assert(!this.listens_[o][i],"listen() called twice for same path/queryId.");var a={onComplete:n,hashFn:e,query:t,tag:r};this.listens_[o][i]=a,this.connected_&&this.sendListen_(a)},e.prototype.sendListen_=function(t){var r=this,n=t.query,i=n.path.toString(),o=n.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};t.tag&&(a.q=n.queryObject(),a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,l=a.s;e.warnOnListenWarnings_(s,n),(r.listens_[i]&&r.listens_[i][o])===t&&(r.log_("listen response",a),"ok"!==l&&r.removeListen_(i,o),t.onComplete&&t.onComplete(l,s))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&g.contains(t,"w")){var r=g.safeGet(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){var n='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();L("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+n+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||g.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,r=g.isValidFormat(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(r,n,function(r){var n=r.s,i=r.d||"error";t.authToken_===e&&("ok"===n?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(n,i))})}},e.prototype.unlisten=function(t,e){var r=t.path.toString(),n=t.queryIdentifier();this.log_("Unlisten called for "+r+" "+n),g.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,n)&&this.connected_&&this.sendUnlisten_(r,n,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,r,n){this.log_("Unlisten on "+t+" for "+e);var i={p:t};n&&(i.q=r,i.t=n),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,r){this.connected_?this.sendOnDisconnect_("o",t,e,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:r})},e.prototype.onDisconnectMerge=function(t,e,r){this.connected_?this.sendOnDisconnect_("om",t,e,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:r})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,r,n){var i={p:e,d:r};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){n&&setTimeout(function(){n(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,r,n){this.putInternal("p",t,e,r,n)},e.prototype.merge=function(t,e,r,n){this.putInternal("m",t,e,r,n)},e.prototype.putInternal=function(t,e,r,n,i){var o={p:e,d:r};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:n}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,r=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,n,function(n){e.log_(r+" response",n),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(n.s,n.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,function(t){"ok"!==t.s&&e.log_("reportStats","Error sending stats: "+t.d)})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+g.stringify(t));var e=t.r,r=this.requestCBHash_[e];r&&(delete this.requestCBHash_[e],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):D("Unrecognized action received from server: "+g.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;g.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Xe),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,l=null,u=function(){l?l.close():(s=!0,n())};this.realtime_={close:u,sendRequest:function(t){g.assert(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then(function(e){s?O("getToken() completed but was canceled"):(O("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,l=new Ke(i,o.repoInfo_,t,r,n,function(t){L(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||(g.CONSTANTS.NODE_ADMIN&&L(t),u())})}},e.prototype.interrupt=function(t){O("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){O("Resuming connection for reason: "+t),delete this.interruptReasons_[t],g.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=Xe,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var r;r=e?e.map(function(t){return U(t)}).join("$"):"default";var n=this.removeListen_(t,r);n&&n.onComplete&&n.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var r,n=new X(t).toString();return void 0!==this.listens_[n]?(r=this.listens_[n][e],delete this.listens_[n][e],0===g.getCount(this.listens_[n])&&delete this.listens_[n]):r=void 0,r},e.prototype.onAuthRevoked_=function(t,e){O("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t=this;this.tryAuth(),g.forEach(this.listens_,function(e,r){g.forEach(r,function(e,r){t.sendListen_(r)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var r=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(r.action,r.pathString,r.data,r.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";g.CONSTANTS.NODE_ADMIN?e="admin_node":g.CONSTANTS.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+m.SDK_VERSION.replace(/\./g,"-")]=1,g.isMobileCordova()?t["framework.cordova"]=1:g.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Ve.getInstance().currentlyOnline();return g.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}($e),tr=function(t){function e(e,r,n){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=r,i.authTokenProvider_=n,i.log_=R("p:rest:"),i.listens_={},i}return y.__extends(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(g.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,r,n,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=e.getListenId_(t,n),l={};this.listens_[s]=l;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",u,function(t,e){var r=e;404===t&&(r=null,t=null),null===t&&o.onDataUpdate_(a,r,!1,n),g.safeGet(o.listens_,s)===l&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,r){var n=e.getListenId_(t,r);delete this.listens_[n]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,r){var n=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(n.repoInfo_.secure?"https://":"http://")+n.repoInfo_.host+t+"?ns="+n.repoInfo_.namespace+g.querystring(e);n.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(r&&4===s.readyState){n.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(s.status>=200&&s.status<300){try{t=g.jsonEval(s.responseText)}catch(e){L("Failed to parse JSON response for "+a+": "+s.responseText)}r(null,t)}else 401!==s.status&&404!==s.status&&L("Got unsuccessful REST response for "+a+" Status: "+s.status),r(s.status);r=null}},s.open("GET",a,!0),s.send()})},e}($e),er=function(){function t(t,e,r){var n=this;this.repoInfo_=t,this.app=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ze,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ee,this.persistentConnection_=null;var i=new ke(r);if(this.stats_=Oe.getCollection(t),e||K())this.server_=new tr(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=r.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{g.stringify(o)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}this.persistentConnection_=new Je(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){n.server_.refreshAuthToken(t)}),this.statsReporter_=Oe.getOrCreateReporter(t,function(){return new Le(n.stats_,n.server_)}),this.transactions_init_(),this.infoData_=new Ie,this.infoSyncTree_=new Ae({startListening:function(t,e,r,i){var o=[],a=n.infoData_.getNode(t.path);return a.isEmpty()||(o=n.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ae({startListening:function(t,e,r,i){return n.server_.listen(t,r,e,function(e,r){var o=i(e,r);n.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){n.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new X(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,r,n){this.dataUpdateCount++;var i=new X(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(n)if(r){var a=g.map(e,function(t){return Ut(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,n)}else{var s=Ut(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,n)}else if(r){var l=g.map(e,function(t){return Ut(t)});o=this.serverSyncTree_.applyServerMerge(i,l)}else{var u=Ut(e);o=this.serverSyncTree_.applyServerOverwrite(i,u)}var c=i;o.length>0&&(c=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(c,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;H(t,function(t,r){e.updateInfo_(r,t)})},t.prototype.updateInfo_=function(t,e){var r=new X("/.info/"+t),n=Ut(e);this.infoData_.updateSnapshot(r,n);var i=this.infoSyncTree_.applyServerOverwrite(r,n);this.eventQueue_.raiseEventsForChangedPath(r,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,r,n){var i=this;this.log_("set",{path:t.toString(),value:e,priority:r});var o=this.generateServerValues(),a=Ut(e,r),s=ne(a,o),l=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserOverwrite(t,s,l,!0);this.eventQueue_.queueEvents(u),this.server_.put(t.toString(),a.val(!0),function(e,r){var o="ok"===e;o||L("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(l,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(n,e,r)});var c=this.abortTransactions_(t);this.rerunTransactions_(c),this.eventQueue_.raiseEventsForChangedPath(c,[])},t.prototype.update=function(t,e,r){var n=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(g.forEach(e,function(t,e){i=!1;var r=Ut(e);a[t]=ne(r,o)}),i)O("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(r,"ok");else{var s=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(l),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||L("update at "+t+" failed: "+e);var a=n.serverSyncTree_.ackUserWrite(s,!o),l=a.length>0?n.rerunTransactions_(t):t;n.eventQueue_.raiseEventsForChangedPath(l,a),n.callOnCompleteCallback(r,e,i)}),g.forEach(e,function(e){var r=n.abortTransactions_(t.child(e));n.rerunTransactions_(r)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),r=function(t,e){var r=new ee;return t.forEachTree(new X(""),function(t,n){r.remember(t,ne(n,e))}),r}(this.onDisconnect_,e),n=[];r.forEachTree(X.Empty,function(e,r){n=n.concat(t.serverSyncTree_.applyServerOverwrite(e,r));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new ee,this.eventQueue_.raiseEventsForChangedPath(X.Empty,n)},t.prototype.onDisconnectCancel=function(t,e){var r=this;this.server_.onDisconnectCancel(t.toString(),function(n,i){"ok"===n&&r.onDisconnect_.forget(t),r.callOnCompleteCallback(e,n,i)})},t.prototype.onDisconnectSet=function(t,e,r){var n=this,i=Ut(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&n.onDisconnect_.remember(t,i),n.callOnCompleteCallback(r,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,r,n){var i=this,o=Ut(e,r);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,r){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(n,e,r)})},t.prototype.onDisconnectUpdate=function(t,e,r){var n=this;if(g.isEmpty(e))return O("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(r,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&g.forEach(e,function(e,r){var i=Ut(r);n.onDisconnect_.remember(t.child(e),i)}),n.callOnCompleteCallback(r,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var r;r=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,r)},t.prototype.removeEventCallbackForQuery=function(t,e){var r;r=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,r)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new Re(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var r=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);g.forEach(e,function(t,e){for(var n=t.length;n<r+2;n++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r="";this.persistentConnection_&&(r=this.persistentConnection_.id+":"),O.apply(void 0,[r].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,r){t&&Q(function(){if("ok"==e)t(null);else{var n=(e||"error").toUpperCase(),i=n;r&&(i+=": "+r);var o=new Error(i);o.code=n,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new hr(this))},enumerable:!0,configurable:!0}),t}(),rr=function(){function t(e){this.indexedFilter_=new me(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,r,n,i,o){return this.matches(new bt(e,r))||(r=Bt.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,r,n,i,o)},t.prototype.updateFullNode=function(t,e,r){e.isLeafNode()&&(e=Bt.EMPTY_NODE);var n=e.withIndex(this.index_);n=n.updatePriority(Bt.EMPTY_NODE);var i=this;return e.forEachChild(At,function(t,e){i.matches(new bt(t,e))||(n=n.updateImmediateChild(t,Bt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,n,r)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),nr=function(){function t(t){this.rangedFilter_=new rr(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,r,n,i,o){return this.rangedFilter_.matches(new bt(e,r))||(r=Bt.EMPTY_NODE),t.getImmediateChild(e).equals(r)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,r,n,i,o):this.fullLimitUpdateChild_(t,e,r,i,o)},t.prototype.updateFullNode=function(t,e,r){var n;if(e.isLeafNode()||e.isEmpty())n=Bt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){n=Bt.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;n=n.updateImmediateChild(a.name,a.node),o++}}else{n=(n=e.withIndex(this.index_)).updatePriority(Bt.EMPTY_NODE);var s=void 0,l=void 0,u=void 0;if(i=void 0,this.reverse_){i=n.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();u=function(t,e){return c(e,t)}}else i=n.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();)a=i.getNext(),!h&&u(s,a)<=0&&(h=!0),h&&o<this.limit_&&u(a,l)<=0?o++:n=n.updateImmediateChild(a.name,Bt.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,n,r)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,r,n,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;g.assert(s.numChildren()==this.limit_,"");var l=new bt(e,r),u=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),c=this.rangedFilter_.matches(l);if(s.hasChild(e)){for(var h=s.getImmediateChild(e),p=n.getChildAfterChild(this.index_,u,this.reverse_);null!=p&&(p.name==e||s.hasChild(p.name));)p=n.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:o(p,l);if(c&&!r.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(fe.childChangedChange(e,r,h)),s.updateImmediateChild(e,r);null!=i&&i.trackChildChange(fe.childRemovedChange(e,h));var f=s.updateImmediateChild(e,Bt.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(fe.childAddedChange(p.name,p.node)),f.updateImmediateChild(p.name,p.node)):f}return r.isEmpty()?t:c&&o(u,l)>=0?(null!=i&&(i.trackChildChange(fe.childRemovedChange(u.name,u.node)),i.trackChildChange(fe.childAddedChange(e,r))),s.updateImmediateChild(e,r).updateImmediateChild(u.name,Bt.EMPTY_NODE)):t},t}(),ir=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=At}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return g.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return g.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:N},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return g.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return g.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:F},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return g.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var r=this.copy_();return r.limitSet_=!0,r.limit_=e,r.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,r},t.prototype.limitToLast=function(e){var r=this.copy_();return r.limitSet_=!0,r.limit_=e,r.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,r},t.prototype.startAt=function(t,e){var r=this.copy_();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=e?(r.startNameSet_=!0,r.indexStartName_=e):(r.startNameSet_=!1,r.indexStartName_=""),r},t.prototype.endAt=function(t,e){var r=this.copy_();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==e?(r.endNameSet_=!0,r.indexEndName_=e):(r.endNameSet_=!1,r.indexEndName_=""),r},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,r={};if(this.startSet_&&(r[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(r[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(r[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(r[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){r[e.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),r[e.VIEW_FROM]=n}return this.index_!==At&&(r[e.INDEX]=this.index_.toString()),r},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==At},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new me(this.getIndex()):this.hasLimit()?new nr(this):new rr(this)},t.prototype.toRestQueryStringParameters=function(){var e,r=t.REST_QUERY_CONSTANTS_,n={};return this.isDefault()?n:(this.index_===At?e=r.PRIORITY_INDEX:this.index_===Gt?e=r.VALUE_INDEX:this.index_===Et?e=r.KEY_INDEX:(g.assert(this.index_ instanceof Zt,"Unrecognized index type!"),e=this.index_.toString()),n[r.ORDER_BY]=g.stringify(e),this.startSet_&&(n[r.START_AT]=g.stringify(this.indexStartValue_),this.startNameSet_&&(n[r.START_AT]+=","+g.stringify(this.indexStartName_))),this.endSet_&&(n[r.END_AT]=g.stringify(this.indexEndValue_),this.endNameSet_&&(n[r.END_AT]+=","+g.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[r.LIMIT_TO_FIRST]=this.limit_:n[r.LIMIT_TO_LAST]=this.limit_),n)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),or=function(t){function e(e,r){if(!(e instanceof er))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,r,ir.DEFAULT,!1)||this}return y.__extends(e,t),e.prototype.getKey=function(){return g.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return g.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof X||(null===this.path.getFront()?function(t,e,r,n){r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),ft("Reference.child",1,r,!1)}(0,0,t):ft("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){g.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){g.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){g.validateArgCount("Reference.set",1,2,arguments.length),mt("Reference.set",this.path),lt("Reference.set",1,t,this.path,!1),g.validateCallback("Reference.set",2,e,!0);var r=new g.Deferred;return this.repo.setWithPriority(this.path,t,null,r.wrapCallback(e)),r.promise},e.prototype.update=function(t,e){if(g.validateArgCount("Reference.update",1,2,arguments.length),mt("Reference.update",this.path),Array.isArray(t)){for(var r={},n=0;n<t.length;++n)r[""+n]=t[n];t=r,L("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("Reference.update",1,t,this.path,!1),g.validateCallback("Reference.update",2,e,!0);var i=new g.Deferred;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,r){if(g.validateArgCount("Reference.setWithPriority",2,3,arguments.length),mt("Reference.setWithPriority",this.path),lt("Reference.setWithPriority",1,t,this.path,!1),ht("Reference.setWithPriority",2,e,!1),g.validateCallback("Reference.setWithPriority",3,r,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var n=new g.Deferred;return this.repo.setWithPriority(this.path,t,e,n.wrapCallback(r)),n.promise},e.prototype.remove=function(t){return g.validateArgCount("Reference.remove",0,1,arguments.length),mt("Reference.remove",this.path),g.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,r){if(g.validateArgCount("Reference.transaction",1,3,arguments.length),mt("Reference.transaction",this.path),g.validateCallback("Reference.transaction",1,t,!1),g.validateCallback("Reference.transaction",2,e,!0),function(t,e,n,i){if(void 0!==r&&"boolean"!=typeof r)throw new Error(g.errorPrefix("Reference.transaction",3,!0)+"must be a boolean.")}(),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===r&&(r=!0);var n=new g.Deferred;return"function"==typeof e&&n.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,r,i){t?n.reject(t):n.resolve(new _t(r,i)),"function"==typeof e&&e(t,r,i)},r),n.promise},e.prototype.setPriority=function(t,e){g.validateArgCount("Reference.setPriority",1,2,arguments.length),mt("Reference.setPriority",this.path),ht("Reference.setPriority",1,t,!1),g.validateCallback("Reference.setPriority",2,e,!0);var r=new g.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,r.wrapCallback(e)),r.promise},e.prototype.push=function(t,e){g.validateArgCount("Reference.push",0,2,arguments.length),mt("Reference.push",this.path),lt("Reference.push",1,t,this.path,!0),g.validateCallback("Reference.push",2,e,!0);var r,n=this.repo.serverTime(),i=vt(n),o=this.child(i),a=this.child(i);return r=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=r.then.bind(r),o.catch=r.then.bind(r,void 0),"function"==typeof e&&r.catch(function(){}),o},e.prototype.onDisconnect=function(){return mt("Reference.onDisconnect",this.path),new gt(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Jt);Jt.__referenceConstructor=or,Ee.__referenceConstructor=or;var ar=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),sr=function(){function t(t,e,r){void 0===t&&(t=""),void 0===e&&(e=null),void 0===r&&(r=new ar),this.name_=t,this.parent_=e,this.node_=r}return t.prototype.subTree=function(e){for(var r,n=e instanceof X?e:new X(e),i=this;null!==(r=n.getFront());)i=new t(r,i,g.safeGet(i.node_.children,r)||new ar),n=n.popFront();return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){g.assert(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var r=this;g.forEach(this.node_.children,function(n,i){e(new t(n,r,i))})},t.prototype.forEachDescendant=function(t,e,r){e&&!r&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,r)}),e&&r&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var r=e?this:this.parent();null!==r;){if(t(r))return!0;r=r.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new X(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var r=e.isEmpty(),n=g.contains(this.node_.children,t);r&&n?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):r||n||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}(),lr=function(t){return t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT",t}({});er.MAX_TRANSACTION_RETRIES_=25,er.prototype.transactions_init_=function(){this.transactionQueueTree_=new sr},er.prototype.startTransaction=function(t,e,r,n){this.log_("transaction on "+t);var i=function(){},o=new or(this,t);o.on("value",i);var a={path:t,update:e,onComplete:r,status:null,order:S(),applyLocally:n,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var l=a.update(s.val());if(void 0===l){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var u=new Qt(a.currentInputSnapshot,new or(this,a.path),At);a.onComplete(null,!1,u)}}else{ut("transaction failed: Data returned ",l,a.path),a.status=lr.RUN;var c=this.transactionQueueTree_.subTree(t),h=c.getValue()||[];h.push(a),c.setValue(h);var p=void 0;"object"==typeof l&&null!==l&&g.contains(l,".priority")?(p=g.safeGet(l,".priority"),g.assert(st(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(this.serverSyncTree_.calcCompleteEventCache(t)||Bt.EMPTY_NODE).getPriority().val(),p=p;var d=this.generateServerValues(),f=Ut(l,p),m=ne(f,d);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=m,a.currentWriteId=this.getNextWriteId_();var y=this.serverSyncTree_.applyUserOverwrite(t,m,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,y),this.sendReadyTransactions_()}},er.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Bt.EMPTY_NODE},er.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var r=this.buildTransactionQueue_(t);g.assert(r.length>0,"Sending zero length transaction queue"),r.every(function(t){return t.status===lr.RUN})&&this.sendTransactionQueue_(t.path(),r)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},er.prototype.sendTransactionQueue_=function(t,e){for(var r=this,n=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,n),o=i,a=i.hash(),s=0;s<e.length;s++){var l=e[s];g.assert(l.status===lr.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=lr.SENT,l.retryCount++;var u=X.relativePath(t,l.path);o=o.updateChild(u,l.currentOutputSnapshotRaw)}var c=o.val(!0),h=t;this.server_.put(h.toString(),c,function(n){r.log_("transaction put response",{path:h.toString(),status:n});var i=[];if("ok"===n){for(var o=[],a=0;a<e.length;a++){if(e[a].status=lr.COMPLETED,i=i.concat(r.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,l=new or(r,e[a].path),u=new Qt(s,l,At);o.push(e[a].onComplete.bind(null,null,!0,u))}e[a].unwatcher()}for(r.pruneCompletedTransactionsBelowNode_(r.transactionQueueTree_.subTree(t)),r.sendReadyTransactions_(),r.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)Q(o[a])}else{if("datastale"===n)for(a=0;a<e.length;a++)e[a].status=e[a].status===lr.SENT_NEEDS_ABORT?lr.NEEDS_ABORT:lr.RUN;else for(L("transaction at "+h.toString()+" failed: "+n),a=0;a<e.length;a++)e[a].status=lr.NEEDS_ABORT,e[a].abortReason=n;r.rerunTransactions_(t)}},a)},er.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),r=e.path(),n=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(n,r),r},er.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var r=[],n=[],i=t.filter(function(t){return t.status===lr.RUN}).map(function(t){return t.currentWriteId}),o=0;o<t.length;o++){var a=t[o],s=X.relativePath(e,a.path),l=!1,u=void 0;if(g.assert(null!==s,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===lr.NEEDS_ABORT)l=!0,u=a.abortReason,n=n.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===lr.RUN)if(a.retryCount>=er.MAX_TRANSACTION_RETRIES_)l=!0,u="maxretry",n=n.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var c=this.getLatestState_(a.path,i);a.currentInputSnapshot=c;var h=t[o].update(c.val());if(void 0!==h){ut("transaction failed: Data returned ",h,a.path);var p=Ut(h);"object"==typeof h&&null!=h&&g.contains(h,".priority")||(p=p.updatePriority(c.getPriority()));var d=a.currentWriteId,f=this.generateServerValues(),m=ne(p,f);a.currentOutputSnapshotRaw=p,a.currentOutputSnapshotResolved=m,a.currentWriteId=this.getNextWriteId_(),i.splice(i.indexOf(d),1),n=(n=n.concat(this.serverSyncTree_.applyUserOverwrite(a.path,m,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else l=!0,u="nodata",n=n.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,n),n=[],l&&(t[o].status=lr.COMPLETED,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete))if("nodata"===u){var y=new or(this,t[o].path),_=new Qt(t[o].currentInputSnapshot,y,At);r.push(t[o].onComplete.bind(null,null,!1,_))}else r.push(t[o].onComplete.bind(null,new Error(u),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),o=0;o<r.length;o++)Q(r[o]);this.sendReadyTransactions_()}},er.prototype.getAncestorTransactionNode_=function(t){for(var e,r=this.transactionQueueTree_;null!==(e=t.getFront())&&null===r.getValue();)r=r.subTree(e),t=t.popFront();return r},er.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},er.prototype.aggregateTransactionQueuesForNode_=function(t,e){var r=this,n=t.getValue();if(null!==n)for(var i=0;i<n.length;i++)e.push(n[i]);t.forEachChild(function(t){r.aggregateTransactionQueuesForNode_(t,e)})},er.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,r=t.getValue();if(r){for(var n=0,i=0;i<r.length;i++)r[i].status!==lr.COMPLETED&&(r[n]=r[i],n++);r.length=n,t.setValue(r.length>0?r:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},er.prototype.abortTransactions_=function(t){var e=this,r=this.getAncestorTransactionNode_(t).path(),n=this.transactionQueueTree_.subTree(t);return n.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(n),n.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),r},er.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var r=[],n=[],i=-1,o=0;o<e.length;o++)e[o].status===lr.SENT_NEEDS_ABORT||(e[o].status===lr.SENT?(g.assert(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=lr.SENT_NEEDS_ABORT,e[o].abortReason="set"):(g.assert(e[o].status===lr.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),n=n.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&r.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),n),o=0;o<r.length;o++)Q(r[o])}};var ur,cr=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return ur||(ur=new t),ur},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var r=e||t.options.databaseURL;void 0===r&&M("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var n=et(r),i=n.repoInfo;return yt("Invalid Firebase Database URL",1,n),n.path.isEmpty()||M("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=g.safeGet(this.repos_,t.app.name);e&&g.safeGet(e,t.repoInfo_.toURLString())===t||M("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var r=g.safeGet(this.repos_,e.name);r||(this.repos_[e.name]=r={});var n=g.safeGet(r,t.toURLString());return n&&M("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),n=new er(t,this.useRestClient_,e),r[t.toURLString()]=n,n},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),hr=function(){function t(t){this.repo_=t,t instanceof er||M("Don't call new Database() directly - please use firebase.database()."),this.root_=new or(t,X.Empty),this.INTERNAL=new pr(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),g.validateArgCount("database.ref",0,1,arguments.length),t instanceof or?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),g.validateArgCount(e,1,1,arguments.length);var r=et(t);yt(e,1,r);var n=r.repoInfo;return n.host!==this.repo_.repoInfo_.host&&M(e+": Host name does not match the current database: (found "+n.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(r.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&M("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){g.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){g.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),pr=function(){function t(t){this.database=t}return t.prototype.delete=function(){return y.__awaiter(this,void 0,void 0,function(){return y.__generator(this,function(t){return this.database.checkDeleted_("delete"),cr.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),dr=Object.freeze({forceLongPolling:function(){Ze.forceDisallow(),He.forceAllow()},forceWebSockets:function(){He.forceDisallow()},isWebSocketsAvailable:function(){return Ze.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),fr=Je;Je.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Je.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var mr=Object.freeze({DataConnection:fr,RealTimeConnection:Ke,hijackHash:function(t){var e=Je.prototype.put;return Je.prototype.put=function(r,n,i,o){void 0!==o&&(o=t()),e.call(this,r,n,i,o)},function(){Je.prototype.put=e}},ConnectionTarget:tt,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){cr.getInstance().forceRestClient(t)}}),yr=hr.ServerValue;function gr(e){var r=e.INTERNAL.registerService("database",function(t,e,r){return cr.getInstance().databaseFromApp(t,r)},{Reference:or,Query:Jt,Database:hr,DataSnapshot:Qt,enableLogging:P,INTERNAL:dr,ServerValue:yr,TEST_ACCESS:mr},null,!0);g.isNodeSdk()&&(t.exports=r)}gr(m),e.DataSnapshot=Qt,e.Database=hr,e.OnDisconnect=gt,e.Query=Jt,e.Reference=or,e.ServerValue=yr,e.enableLogging=P,e.registerDatabase=gr},O0a9:function(t,e,r){"use strict";r.r(e);var n=r("PVcy"),i=r("pZk1"),o=r("I1TF"),a=r("sDu7"),s=r("WEwH"),l=r("b/LO"),u=r("hbGf"),c=r("z5t0");r.d(e,"AngularFireDatabase",function(){return n.a}),r.d(e,"RealtimeDatabaseURL",function(){return n.b}),r.d(e,"listChanges",function(){return i.a}),r.d(e,"createListReference",function(){return o.a}),r.d(e,"snapshotChanges",function(){return a.a}),r.d(e,"stateChanges",function(){return s.a}),r.d(e,"auditTrail",function(){return l.a}),r.d(e,"fromRef",function(){return u.a}),r.d(e,"AngularFireDatabaseModule",function(){return c.a})},PVcy:function(t,e,r){"use strict";r("mrSG");var n=r("kDjp"),i=r("I1TF"),o=r("lJxs"),a=r("hbGf");function s(t){return function(){return Object(a.a)(t,"value")}}var l=r("1XSQ"),u=r("yA/v"),c=r("xs0t");r.d(e,"a",function(){return h}),r.d(e,"b",function(){return c.a});const h=(()=>(class{constructor(t,e,r,n,i){this.scheduler=new l.a(i,n),this.database=i.runOutsideAngular(()=>Object(u.e)(t,e).database(r||void 0))}list(t,e){const r=Object(n.b)(this.database,t);let o=r;return e&&(o=e(r)),Object(i.a)(o,this)}object(t){const e=Object(n.b)(this.database,t);return i=this,{query:r=e,snapshotChanges(){const t=s(r)();return i.scheduler.keepUnstableUntilFirst(i.scheduler.runOutsideAngular(t))},update:t=>r.ref.update(t),set:t=>r.ref.set(t),remove:()=>r.ref.remove(),valueChanges(){const t=s(r)();return i.scheduler.keepUnstableUntilFirst(i.scheduler.runOutsideAngular(t)).pipe(Object(o.a)(t=>t.payload.exists()?t.payload.val():null))}};var r,i}createPushId(){return this.database.ref().push().key}}))()},SVse:function(t,e,r){"use strict";r.d(e,"q",function(){return y}),r.d(e,"j",function(){return _}),r.d(e,"k",function(){return g}),r.d(e,"r",function(){return v}),r.d(e,"c",function(){return I}),r.d(e,"i",function(){return x}),r.d(e,"d",function(){return k}),r.d(e,"b",function(){return A}),r.d(e,"p",function(){return P}),r.d(e,"o",function(){return R}),r.d(e,"n",function(){return D}),r.d(e,"m",function(){return i}),r.d(e,"f",function(){return o}),r.d(e,"h",function(){return a}),r.d(e,"a",function(){return s}),r.d(e,"e",function(){return c}),r.d(e,"l",function(){return h}),r.d(e,"g",function(){return l});var n=r("8Y7J");class i{}const o=new n.o("Location Initialized");class a{}const s=new n.o("appBaseHref"),l=(()=>{class t{constructor(e,r){this._subject=new n.m,this._urlChangeListeners=[],this._platformStrategy=e;const i=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=t.stripTrailingSlash(u(i)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,state:t.state,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+t.normalizeQueryParams(r))}normalize(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,u(e)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(e,r="",n=null){this._platformStrategy.pushState(n,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+t.normalizeQueryParams(r)),n)}replaceState(e,r="",n=null){this._platformStrategy.replaceState(n,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+t.normalizeQueryParams(r)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(t){this._urlChangeListeners.push(t),this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)})}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach(r=>r(t,e))}subscribe(t,e,r){return this._subject.subscribe({next:t,error:e,complete:r})}static normalizeQueryParams(t){return t&&"?"!==t[0]?"?"+t:t}static joinWithSlash(t,e){if(0==t.length)return e;if(0==e.length)return t;let r=0;return t.endsWith("/")&&r++,e.startsWith("/")&&r++,2==r?t+e.substring(1):1==r?t+e:t+"/"+e}static stripTrailingSlash(t){const e=t.match(/#|\?|$/),r=e&&e.index||t.length;return t.slice(0,r-("/"===t[r-1]?1:0))+t.slice(r)}}return t})();function u(t){return t.replace(/\/index.html$/,"")}const c=(()=>(class extends a{constructor(t,e){super(),this._platformLocation=t,this._baseHref="",null!=e&&(this._baseHref=e)}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=l.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,r,n){let i=this.prepareExternalUrl(r+l.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(t,e,i)}replaceState(t,e,r,n){let i=this.prepareExternalUrl(r+l.normalizeQueryParams(n));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}))(),h=(()=>(class extends a{constructor(t,e){if(super(),this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return l.joinWithSlash(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+l.normalizeQueryParams(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${e}${r}`:e}pushState(t,e,r,n){const i=this.prepareExternalUrl(r+l.normalizeQueryParams(n));this._platformLocation.pushState(t,e,i)}replaceState(t,e,r,n){const i=this.prepareExternalUrl(r+l.normalizeQueryParams(n));this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}))(),p=void 0;var d=["en",[["a","p"],["AM","PM"],p],[["AM","PM"],p,p],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],p,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],p,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",p,"{1} 'at' {0}",p],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){let e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===r?1:5}];const f={},m=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),y=new n.o("UseV4Plurals");class g{}const _=(()=>(class extends g{constructor(t,e){super(),this.locale=t,this.deprecatedPluralFn=e}getPluralCategory(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){const e=t.toLowerCase().replace(/_/g,"-");let r=f[e];if(r)return r;const n=e.split("-")[0];if(r=f[n])return r;if("en"===n)return d;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[18]}(e||this.locale)(t)){case m.Zero:return"zero";case m.One:return"one";case m.Two:return"two";case m.Few:return"few";case m.Many:return"many";default:return"other"}}}))();function v(t,e){e=encodeURIComponent(e);for(const r of t.split(";")){const t=r.indexOf("="),[n,i]=-1==t?[r,""]:[r.slice(0,t),r.slice(t+1)];if(n.trim()===e)return decodeURIComponent(i)}return null}class b{constructor(t,e,r,n){this.$implicit=t,this.ngForOf=e,this.index=r,this.count=n}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}const x=(()=>(class{constructor(t,e,r){this._viewContainer=t,this._template=e,this._differs=r,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){Object(n.T)()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(t)}. `+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;if(!this._differ&&r)try{this._differ=this._differs.find(r).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${r}' of type '${t=r,t.name||typeof t}'. NgFor only supports binding to Iterables such as Arrays.`)}}var t;if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,r,n)=>{if(null==t.previousIndex){const r=this._viewContainer.createEmbeddedView(this._template,new b(null,this._ngForOf,-1,-1),n),i=new w(t,r);e.push(i)}else if(null==n)this._viewContainer.remove(r);else{const i=this._viewContainer.get(r);this._viewContainer.move(i,n);const o=new w(t,i);e.push(o)}});for(let r=0;r<e.length;r++)this._perViewChange(e[r].view,e[r].record);for(let r=0,n=this._viewContainer.length;r<n;r++){const t=this._viewContainer.get(r);t.context.index=r,t.context.count=n,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}))();class w{constructor(t,e){this.record=t,this.view=e}}class E{createSubscription(t,e){return t.subscribe({next:e,error:t=>{throw t}})}dispose(t){t.unsubscribe()}onDestroy(t){t.unsubscribe()}}class C{createSubscription(t,e){return t.then(e,t=>{throw t})}dispose(t){}onDestroy(t){}}const S=new C,T=new E,A=(()=>{class t{constructor(t){this._ref=t,this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):Object(n.sb)(this._latestValue,this._latestReturnedValue)?this._latestReturnedValue:(this._latestReturnedValue=this._latestValue,n.O.wrap(this._latestValue)):(t&&this._subscribe(t),this._latestReturnedValue=this._latestValue,this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,e=>this._updateLatestValue(t,e))}_selectStrategy(e){if(Object(n.rb)(e))return S;if(Object(n.qb)(e))return T;throw r=t,Error(`InvalidPipeArgument: '${e}' for pipe '${Object(n.yb)(r)}'`);var r}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,e){t===this._obj&&(this._latestValue=e,this._ref.markForCheck())}}return t})(),I=(()=>(class{}))(),k=new n.o("DocumentToken"),P="browser",O="server";function R(t){return t===O}const D=(()=>{class t{}return t.ngInjectableDef=Object(n.Db)({providedIn:"root",factory:()=>new M(Object(n.Hb)(k),window,Object(n.Hb)(n.l))}),t})();class M{constructor(t,e,r){this.document=t,this.window=e,this.errorHandler=r,this.offset=(()=>[0,0])}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}scrollToPosition(t){this.supportScrollRestoration()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(this.supportScrollRestoration()){t=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(t):t.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{const r=this.document.querySelector(`#${t}`);if(r)return void this.scrollToElement(r);const n=this.document.querySelector(`[name='${t}']`);if(n)return void this.scrollToElement(n)}catch(e){this.errorHandler.handleError(e)}}}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),r=e.left+this.window.pageXOffset,n=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],n-i[1])}supportScrollRestoration(){try{return!!this.window&&!!this.window.scrollTo}catch(t){return!1}}}},SeVD:function(t,e,r){"use strict";r.d(e,"a",function(){return d});var n=r("HDdC"),i=r("ngJS"),o=r("a7t3"),a=r("pLzU"),s=r("CRDf"),l=r("I55L"),u=r("c2HN"),c=r("XoHu"),h=r("Lhse"),p=r("kJWO");const d=t=>{if(t instanceof n.a)return e=>t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e);if(t&&"function"==typeof t[p.a])return Object(s.a)(t);if(Object(l.a)(t))return Object(i.a)(t);if(Object(u.a)(t))return Object(o.a)(t);if(t&&"function"==typeof t[h.a])return Object(a.a)(t);{const e=Object(c.a)(t)?"an invalid object":`'${t}'`;throw new TypeError(`You provided ${e} where a stream was expected.`+" You can provide an Observable, Promise, Array, or Iterable.")}}},SpAZ:function(t,e,r){"use strict";function n(t){return t}r.d(e,"a",function(){return n})},VRyK:function(t,e,r){"use strict";r.d(e,"a",function(){return s});var n=r("HDdC"),i=r("z+Ro"),o=r("bHdf"),a=r("yCtX");function s(...t){let e=Number.POSITIVE_INFINITY,r=null,s=t[t.length-1];return Object(i.a)(s)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof s&&(e=t.pop()),null===r&&1===t.length&&t[0]instanceof n.a?t[0]:Object(o.a)(e)(Object(a.a)(t,r))}},WEwH:function(t,e,r){"use strict";r.d(e,"a",function(){return a});var n=r("hbGf"),i=r("GIw4"),o=r("VRyK");function a(t,e){const r=(e=Object(i.a)(e)).map(e=>Object(n.a)(t,e));return Object(o.a)(...r)}},Wcq6:function(t,e,r){"use strict";var n,i=(n=r("wj3C"))&&"object"==typeof n&&"default"in n?n.default:n;t.exports=i},XNiG:function(t,e,r){"use strict";var n=r("HDdC"),i=r("7o/Q"),o=r("quSY"),a=r("9ppp");class s extends o.a{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}var l=r("2QA8");r.d(e,"b",function(){return u}),r.d(e,"a",function(){return c});class u extends i.a{constructor(t){super(t),this.destination=t}}const c=(()=>{class t extends n.a{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[l.a](){return new u(this)}lift(t){const e=new h(this,this);return e.operator=t,e}next(t){if(this.closed)throw new a.a;if(!this.isStopped){const{observers:e}=this,r=e.length,n=e.slice();for(let i=0;i<r;i++)n[i].next(t)}}error(t){if(this.closed)throw new a.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,r=e.length,n=e.slice();for(let i=0;i<r;i++)n[i].error(t);this.observers.length=0}complete(){if(this.closed)throw new a.a;this.isStopped=!0;const{observers:t}=this,e=t.length,r=t.slice();for(let n=0;n<e;n++)r[n].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new a.a;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new a.a;return this.hasError?(t.error(this.thrownError),o.a.EMPTY):this.isStopped?(t.complete(),o.a.EMPTY):(this.observers.push(t),new s(this,t))}asObservable(){const t=new n.a;return t.source=this,t}}return t.create=((t,e)=>new h(t,e)),t})();class h extends c{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):o.a.EMPTY}}},XUOw:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("HDdC");function i(t){const e=new n.a(e=>{e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}},XoHu:function(t,e,r){"use strict";function n(t){return null!==t&&"object"==typeof t}r.d(e,"a",function(){return n})},ZUHj:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("51Dv"),i=r("SeVD");function o(t,e,r,o,a=new n.a(t,r,o)){if(!a.closed)return Object(i.a)(e)(a)}},a7t3:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("NJ4a");const i=t=>e=>(t.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,n.a),e)},"b/LO":function(t,e,r){"use strict";var n=r("WEwH"),i=r("hbGf"),o=r("Kqap"),a=r("lJxs"),s=r("l7GE"),l=r("ZUHj");class u{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new c(t,this.observables,this.project))}}class c extends s.a{constructor(t,e,r){super(t),this.observables=e,this.project=r,this.toRespond=[];const n=e.length;this.values=new Array(n);for(let i=0;i<n;i++)this.toRespond.push(i);for(let i=0;i<n;i++){let t=e[i];this.add(Object(l.a)(this,t,t,i))}}notifyNext(t,e,r,n,i){this.values[r]=e;const o=this.toRespond;if(o.length>0){const t=o.indexOf(r);-1!==t&&o.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)}}var h=r("7o/Q");class p{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new d(t,this.predicate))}}class d extends h.a{constructor(t,e){super(t),this.predicate=e,this.skipping=!0,this.index=0}_next(t){const e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)}tryCallPredicate(t){try{const r=this.predicate(t,this.index++);this.skipping=Boolean(r)}catch(e){this.destination.error(e)}}}function f(t,e){return function(t,e){return function(t){return Object(i.a)(t,"value").pipe(Object(a.a)(t=>{let e;return t.payload.forEach(t=>(e=t.key,!1)),{data:t,lastKeyToLoad:e}}))}(t).pipe(function(...t){return e=>{let r;return"function"==typeof t[t.length-1]&&(r=t.pop()),e.lift(new u(t,r))}}(e),Object(a.a)(([t,e])=>{let r=t.lastKeyToLoad;const n=e.map(t=>t.key);return{actions:e,lastKeyToLoad:r,loadedKeys:n}}),(r=(t=>-1===t.loadedKeys.indexOf(t.lastKeyToLoad)),t=>t.lift(new p(r))),Object(a.a)(t=>t.actions));var r}(t,Object(n.a)(t,e).pipe(Object(o.a)((t,e)=>[...t,e],[])))}r.d(e,"a",function(){return f})},bHdf:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("5+tZ"),i=r("SpAZ");function o(t=Number.POSITIVE_INFINITY){return Object(n.a)(i.a,t)}},c2HN:function(t,e,r){"use strict";function n(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}r.d(e,"a",function(){return n})},eIep:function(t,e,r){"use strict";r.d(e,"a",function(){return l});var n=r("l7GE"),i=r("51Dv"),o=r("ZUHj"),a=r("lJxs"),s=r("Cfvw");function l(t,e){return"function"==typeof e?r=>r.pipe(l((r,n)=>Object(s.a)(t(r,n)).pipe(Object(a.a)((t,i)=>e(r,t,n,i))))):e=>e.lift(new u(t))}class u{constructor(t){this.project=t}call(t,e){return e.subscribe(new c(t,this.project))}}class c extends n.a{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(n){return void this.destination.error(n)}this._innerSub(e,t,r)}_innerSub(t,e,r){const n=this.innerSubscription;n&&n.unsubscribe();const a=new i.a(this,void 0,void 0);this.destination.add(a),this.innerSubscription=Object(o.a)(this,t,e,r,a)}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&super._complete()}notifyNext(t,e,r,n,i){this.destination.next(e)}}},gRHU:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("2fFW"),i=r("NJ4a");const o={closed:!0,next(t){},error(t){if(n.a.useDeprecatedSynchronousErrorHandling)throw t;Object(i.a)(t)},complete(){}}},hbGf:function(t,e,r){"use strict";var n=r("HDdC"),i=r("lJxs"),o=r("3N8a");const a=new(r("IjjT").a)(o.a);var s,l=r("7o/Q"),u=r("EY2u"),c=r("LRne");!function(t){t.NEXT="N",t.ERROR="E",t.COMPLETE="C"}(s||(s={}));const h=(()=>{class t{constructor(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}}accept(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)}toObservable(){switch(this.kind){case"N":return Object(c.a)(this.value);case"E":return t=this.error,new n.a(e=>e.error(t));case"C":return Object(u.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();class p{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new d(t,this.delay,this.scheduler))}}class d extends l.a{constructor(t,e,r){super(t),this.delay=e,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,r=e.queue,n=t.scheduler,i=t.destination;for(;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){const e=Math.max(0,r[0].time-n.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(d.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,r=new f(e.now()+this.delay,t);this.queue.push(r),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(h.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(h.createComplete()),this.unsubscribe()}}class f{constructor(t,e){this.time=t,this.notification=e}}var m=r("w1tV");function y(t,e,r="on"){return new n.a(n=>{const i=t[r](e,(t,e)=>{n.next({snapshot:t,prevKey:e}),"once"==r&&n.complete()},n.error.bind(n));return"on"==r?{unsubscribe(){t.off(e,i)}}:{unsubscribe(){}}}).pipe(Object(i.a)(t=>{const{snapshot:r,prevKey:n}=t;let i=null;return r.exists()&&(i=r.key),{type:e,payload:r,prevKey:n,key:i}}),function(t,e=a){const r=0 instanceof Date&&!isNaN(0)?0-e.now():Math.abs(0);return t=>t.lift(new p(r,e))}(),Object(m.a)())}r.d(e,"a",function(){return y})},kDjp:function(t,e,r){"use strict";function n(t){return null==t}function i(t){return"function"==typeof t.set}function o(t,e){return i(e)?e:t.ref(e)}function a(t,e){if("string"==typeof t)return e.stringCase();if(i(t))return e.firebaseCase();if("function"==typeof t.exportVal)return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof t}`)}r.d(e,"c",function(){return n}),r.d(e,"b",function(){return o}),r.d(e,"a",function(){return a})},kJWO:function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n="function"==typeof Symbol&&Symbol.observable||"@@observable"},l7GE:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("7o/Q");class i extends n.a{notifyNext(t,e,r,n,i){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}},lJxs:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("7o/Q");function i(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new o(t,e))}}class o{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new a(t,this.project,this.thisArg))}}class a extends n.a{constructor(t,e,r){super(t),this.project=e,this.count=0,this.thisArg=r||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(e)}}},mAIw:function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return i}),r.d(e,"__assign",function(){return o}),r.d(e,"__rest",function(){return a}),r.d(e,"__decorate",function(){return s}),r.d(e,"__param",function(){return l}),r.d(e,"__metadata",function(){return u}),r.d(e,"__awaiter",function(){return c}),r.d(e,"__generator",function(){return h}),r.d(e,"__exportStar",function(){return p}),r.d(e,"__values",function(){return d}),r.d(e,"__read",function(){return f}),r.d(e,"__spread",function(){return m}),r.d(e,"__await",function(){return y}),r.d(e,"__asyncGenerator",function(){return g}),r.d(e,"__asyncDelegator",function(){return _}),r.d(e,"__asyncValues",function(){return v}),r.d(e,"__makeTemplateObject",function(){return b}),r.d(e,"__importStar",function(){return x}),r.d(e,"__importDefault",function(){return w});var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function s(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function l(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n.throw(t))}catch(e){o(e)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})}function h(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function p(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function g(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||s(t,e)})})}function s(t,e){try{(r=i[t](e)).value instanceof y?Promise.resolve(r.value.v).then(l,u):c(o[0][2],r)}catch(n){c(o[0][3],n)}var r}function l(t){s("next",t)}function u(t){s("throw",t)}function c(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function _(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function v(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,i,(e=t[r](e)).done,e.value)})}}}function b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function w(t){return t&&t.__esModule?t:{default:t}}},mCNh:function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return o});var n=r("KqfI");function i(...t){return o(t)}function o(t){return t?1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}:n.a}},mrSG:function(t,e,r){},n6bG:function(t,e,r){"use strict";function n(t){return"function"==typeof t}r.d(e,"a",function(){return n})},ngJS:function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>e=>{for(let r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.closed||e.complete()}},pLzU:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n=r("Lhse");const i=t=>e=>{const r=t[n.a]();for(;;){const t=r.next();if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof r.return&&e.add(()=>{r.return&&r.return()}),e}},pZk1:function(t,e,r){"use strict";var n=r("hbGf"),i=r("LRne"),o=r("VRyK"),a=r("kDjp"),s=r("eIep"),l=r("Kqap"),u=r("7o/Q");class c{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new h(t,this.compare,this.keySelector))}}class h extends u.a{constructor(t,e,r){super(t),this.keySelector=r,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:r}=this;e=r?r(t):t}catch(n){return this.destination.error(n)}let r=!1;if(this.hasKey)try{const{compare:t}=this;r=t(this.key,e)}catch(n){return this.destination.error(n)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))}}function p(t,e){return Object(n.a)(t,"value","once").pipe(Object(s.a)(r=>{const a=[Object(i.a)(r)];return e.forEach(e=>a.push(Object(n.a)(t,e))),Object(o.a)(...a).pipe(Object(l.a)(f,[]))}),t=>t.lift(new c(void 0,void 0)))}function d(t,e){const r=t.length;for(let n=0;n<r;n++)if(t[n].payload.key===e)return n;return-1}function f(t,e){const{payload:r,prevKey:n,key:i}=e,o=d(t,i),s=function(t,e){if(Object(a.c)(e))return 0;{const r=d(t,e);return-1===r?t.length:r+1}}(t,n);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let r=null;e.payload.forEach(e=>{const n={payload:e,type:"value",prevKey:r,key:e.key};return r=e.key,t=[...t,n],!1})}return t;case"child_added":if(o>-1){const i=t[o-1];(i&&i.key||null)!=n&&(t=t.filter(t=>t.payload.key!==r.key)).splice(s,0,e)}else{if(null==n)return[e,...t];(t=t.slice()).splice(s,0,e)}return t;case"child_removed":return t.filter(t=>t.payload.key!==r.key);case"child_changed":return t.map(t=>t.payload.key===i?e:t);case"child_moved":if(o>-1){const e=t.splice(o,1)[0];return(t=t.slice()).splice(s,0,e),t}return t;default:return t}}r.d(e,"a",function(){return p})},"q/0M":function(t,e,r){"use strict";r.r(e),r.d(e,"LogLevel",function(){return i}),r.d(e,"Logger",function(){return s}),r.d(e,"setLogLevel",function(){return l});var n=[],i=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}({}),o=i.INFO,a=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!(e<t.logLevel)){var o=(new Date).toISOString();switch(e){case i.DEBUG:case i.VERBOSE:console.log.apply(console,["["+o+"]  "+t.name+":"].concat(r));break;case i.INFO:console.info.apply(console,["["+o+"]  "+t.name+":"].concat(r));break;case i.WARN:console.warn.apply(console,["["+o+"]  "+t.name+":"].concat(r));break;case i.ERROR:console.error.apply(console,["["+o+"]  "+t.name+":"].concat(r));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},s=function(){function t(t){this.name=t,this._logLevel=o,this._logHandler=a,n.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in i))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.ERROR].concat(t))},t}();function l(t){n.forEach(function(e){e.logLevel=t})}},quSY:function(t,e,r){"use strict";var n=r("DH7j"),i=r("XoHu"),o=r("n6bG");function a(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}a.prototype=Object.create(Error.prototype);const s=a;r.d(e,"a",function(){return l});const l=(()=>{class t{constructor(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let t,e=!1;if(this.closed)return;let{_parent:r,_parents:a,_unsubscribe:l,_subscriptions:c}=this;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;let h=-1,p=a?a.length:0;for(;r;)r.remove(this),r=++h<p&&a[h]||null;if(Object(o.a)(l))try{l.call(this)}catch(d){e=!0,t=d instanceof s?u(d.errors):[d]}if(Object(n.a)(c))for(h=-1,p=c.length;++h<p;){const r=c[h];if(Object(i.a)(r))try{r.unsubscribe()}catch(d){e=!0,t=t||[],d instanceof s?t=t.concat(u(d.errors)):t.push(d)}}if(e)throw new s(t)}add(e){let r=e;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){const e=r;(r=new t)._subscriptions=[e]}break;default:if(!e)return t.EMPTY;throw new Error("unrecognized teardown "+e+" added to Subscription.")}if(r._addParent(this)){const t=this._subscriptions;t?t.push(r):this._subscriptions=[r]}return r}remove(t){const e=this._subscriptions;if(e){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}}_addParent(t){let{_parent:e,_parents:r}=this;return e!==t&&(e?r?-1===r.indexOf(t)&&(r.push(t),!0):(this._parents=[t],!0):(this._parent=t,!0))}}return t.EMPTY=function(t){return t.closed=!0,t}(new t),t})();function u(t){return t.reduce((t,e)=>t.concat(e instanceof s?e.errors:e),[])}},sDu7:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("pZk1"),i=r("GIw4");function o(t,e){return e=Object(i.a)(e),Object(n.a)(t,e)}},w1tV:function(t,e,r){"use strict";var n=r("XNiG"),i=r("HDdC"),o=r("7o/Q"),a=r("quSY");function s(){return function(t){return t.lift(new l(t))}}class l{constructor(t){this.connectable=t}call(t,e){const{connectable:r}=this;r._refCount++;const n=new u(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i}}class u extends o.a{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:r}=this,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}const c=class extends i.a{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new a.a).add(this.source.subscribe(new p(this.getSubject(),this))),t.closed?(this._connection=null,t=a.a.EMPTY):this._connection=t),t}refCount(){return s()(this)}}.prototype,h={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:c._subscribe},_isComplete:{value:c._isComplete,writable:!0},getSubject:{value:c.getSubject},connect:{value:c.connect},refCount:{value:c.refCount}};class p extends n.b{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function d(){return new n.a}function f(){return t=>s()(function(t,e){return function(e){let r;r="function"==typeof t?t:function(){return t};const n=Object.create(e,h);return n.source=e,n.subjectFactory=r,n}}(d)(t))}r.d(e,"a",function(){return f})},wj3C:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r("30Go"),o=r("zVF4"),a=r("q/0M"),s=((n={})["no-app"]="No Firebase App '{$name}' has been created - call Firebase App.initializeApp()",n["bad-app-name"]="Illegal App name: '{$name}",n["duplicate-app"]="Firebase App named '{$name}' already exists",n["app-deleted"]="Firebase App named '{$name}' already deleted",n["duplicate-service"]="Firebase service named '{$name}' already registered",n["invalid-app-argument"]="firebase.{$name}() takes either no argument or a Firebase App instance.",n),l=new o.ErrorFactory("app","Firebase",s),u="[DEFAULT]",c=[],h=function(){function t(t,e,r){this.firebase_=r,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=o.deepCopy(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){c.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){c=c.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],r=0,n=Object.keys(t.services_);r<n.length;r++)for(var i=n[r],o=0,a=Object.keys(t.services_[i]);o<a.length;o++)e.push(t.services_[i][a[o]]);return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=u),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var r=e!==u?e:void 0,n=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),r);this.services_[t][e]=n}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;o.deepExtend(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(c.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),c=[])},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{name:this.name_})},t}();h.prototype.name&&h.prototype.options||h.prototype.delete||console.log("dc");var p=new a.Logger("@firebase/app");if(o.isBrowser()&&"firebase"in self){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var d=self.firebase.SDK_VERSION;d&&d.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var f=function t(){var e=function(t){var e={},r={},n={},i={__esModule:!0,initializeApp:function(r,n){void 0===n&&(n={}),("object"!=typeof n||null===n)&&(n={name:n});var a=n;void 0===a.name&&(a.name=u);var s=a.name;if("string"!=typeof s||!s)throw l.create("bad-app-name",{name:String(s)});if(o.contains(e,s))throw l.create("duplicate-app",{name:s});var h=new t(r,a,i);return e[s]=h,c(h,"create"),h},app:a,apps:null,SDK_VERSION:"6.2.0",INTERNAL:{registerService:function(e,u,c,h,p){if(void 0===p&&(p=!1),r[e])throw l.create("duplicate-service",{name:e});function d(t){if(void 0===t&&(t=a()),"function"!=typeof t[e])throw l.create("invalid-app-argument",{name:e});return t[e]()}return r[e]=u,h&&(n[e]=h,s().forEach(function(t){h("create",t)})),void 0!==c&&o.deepExtend(d,c),i[e]=d,t.prototype[e]=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return this._getService.bind(this,e).apply(this,p?t:[])},d},removeApp:function(t){c(e[t],"delete"),delete e[t]},factories:r,useAsService:h}};function a(t){if(!o.contains(e,t=t||u))throw l.create("no-app",{name:t});return e[t]}function s(){return Object.keys(e).map(function(t){return e[t]})}function c(t,e){for(var i=0,o=Object.keys(r);i<o.length;i++){var a=h(0,o[i]);if(null===a)return;n[a]&&n[a](e,t)}}function h(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:s}),a.App=t,i}(h);return e.INTERNAL=i.__assign({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){o.deepExtend(e,t)},createSubscribe:o.createSubscribe,ErrorFactory:o.ErrorFactory,deepExtend:o.deepExtend}),e}(),m=f.initializeApp;f.initializeApp=function(){return o.isNode()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\n      to false and "main" to true:\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),m.apply(void 0,arguments)};var y=f;e.default=y,e.firebase=y},xs0t:function(t,e,r){"use strict";var n=r("1XSQ");r.d(e,"a",function(){return n.b})},"yA/v":function(t,e,r){"use strict";r.d(e,"d",function(){return s}),r.d(e,"c",function(){return l}),r.d(e,"b",function(){return u}),r.d(e,"e",function(){return c}),r.d(e,"a",function(){return h}),r("mrSG");var n,i=r("8Y7J"),o=r("Wcq6"),a=r.n(o);const s=new i.o("angularfire2.app.options"),l=new i.o("angularfire2.app.nameOrConfig");class u{}function c(t,e){const r="object"==typeof e&&e||{};return r.name=r.name||"string"==typeof e&&e||"[DEFAULT]",a.a.apps.filter(t=>t&&t.name===r.name)[0]||a.a.initializeApp(t,r)}const h=(()=>n=class{static initializeApp(t,e){return{ngModule:n,providers:[{provide:s,useValue:t},{provide:l,useValue:e}]}}})()},yCtX:function(t,e,r){"use strict";r.d(e,"a",function(){return a});var n=r("HDdC"),i=r("quSY"),o=r("ngJS");function a(t,e){return new n.a(e?r=>{const n=new i.a;let o=0;return n.add(e.schedule(function(){o!==t.length?(r.next(t[o++]),r.closed||n.add(this.schedule())):r.complete()})),n}:Object(o.a)(t))}},"z+Ro":function(t,e,r){"use strict";function n(t){return t&&"function"==typeof t.schedule}r.d(e,"a",function(){return n})},z5t0:function(t,e,r){"use strict";r("mrSG"),r("NSPt"),r.d(e,"a",function(){return n});const n=(()=>(class{}))()},zUnb:function(t,e,r){"use strict";r.r(e);var n=r("8Y7J");const i={production:!0,mapbox:{accessToken:"pk.eyJ1IjoicGVnYWg1NjY1IiwiYSI6ImNqNGF4dHBwcTA1dGYzM3VmNzJsNXM4bnEifQ.TjZC9_VLCRHcPXjEegZV4w"}};class o{}class a{constructor(){this.title="mapbox-app"}}var s=r("SVse"),l=r("LRne"),u=r("Cfvw"),c=r("XNiG"),h=r("9ppp");class p extends c.a{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new h.a;return this._value}next(t){super.next(this._value=t)}}var d=r("HDdC");function f(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}f.prototype=Object.create(Error.prototype);const m=f;var y=r("z+Ro"),g=r("DH7j"),_=r("l7GE"),v=r("ZUHj"),b=r("yCtX");const x={};class w{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new E(t,this.resultSelector))}}class E extends _.a{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(x),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let r=0;r<e;r++){const e=t[r];this.add(Object(v.a)(this,e,e,r))}}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,r,n,i){const o=this.values,a=this.toRespond?o[r]===x?--this.toRespond:this.toRespond:0;o[r]=e,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)}}var C=r("EY2u");function S(t){return new d.a(e=>{let r;try{r=t()}catch(n){return void e.error(n)}return(r?Object(u.a)(r):Object(C.b)()).subscribe(e)})}var T=r("lJxs"),A=r("bHdf");function I(){return Object(A.a)(1)}var k=r("7o/Q");function P(t,e){return function(r){return r.lift(new O(t,e))}}class O{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new R(t,this.predicate,this.thisArg))}}class R extends k.a{constructor(t,e,r){super(t),this.predicate=e,this.thisArg=r,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}e&&this.destination.next(t)}}function D(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}D.prototype=Object.create(Error.prototype);const M=D;function L(t){return function(e){return 0===t?Object(C.b)():e.lift(new z(t))}}class z{constructor(t){if(this.total=t,this.total<0)throw new M}call(t,e){return e.subscribe(new N(t,this.total))}}class N extends k.a{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,r=this.total,n=this.count++;e.length<r?e.push(t):e[n%r]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const r=this.count>=this.total?this.total:this.count,n=this.ring;for(let i=0;i<r;i++){const i=e++%r;t.next(n[i])}}t.complete()}}var F=r("KqfI"),B=r("n6bG");function V(t,e,r){return function(n){return n.lift(new j(t,e,r))}}class j{constructor(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}call(t,e){return e.subscribe(new U(t,this.nextOrObserver,this.error,this.complete))}}class U extends k.a{constructor(t,e,r,n){super(t),this._tapNext=F.a,this._tapError=F.a,this._tapComplete=F.a,this._tapError=r||F.a,this._tapComplete=n||F.a,Object(B.a)(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||F.a,this._tapError=e.error||F.a,this._tapComplete=e.complete||F.a)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}const q=(t=function(){return new m})=>V({hasValue:!1,next(){this.hasValue=!0},complete(){if(!this.hasValue)throw t()}});function H(t=null){return e=>e.lift(new W(t))}class W{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new G(t,this.defaultValue))}}class G extends k.a{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var Z=r("SpAZ");function Q(t,e){const r=arguments.length>=2;return n=>n.pipe(t?P((e,r)=>t(e,r,n)):Z.a,L(1),r?H(e):q(()=>new m))}var K=r("51Dv");function $(t){return function(e){const r=new X(t),n=e.lift(r);return r.caught=n}}class X{constructor(t){this.selector=t}call(t,e){return e.subscribe(new Y(t,this.selector,this.caught))}}class Y extends _.a{constructor(t,e,r){super(t),this.selector=e,this.caught=r}error(t){if(!this.isStopped){let r;try{r=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const n=new K.a(this,void 0,void 0);this.add(n),Object(v.a)(this,r,void 0,void 0,n)}}}function J(t){return e=>0===t?Object(C.b)():e.lift(new tt(t))}class tt{constructor(t){if(this.total=t,this.total<0)throw new M}call(t,e){return e.subscribe(new et(t,this.total))}}class et extends k.a{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))}}function rt(t,e){const r=arguments.length>=2;return n=>n.pipe(t?P((e,r)=>t(e,r,n)):Z.a,J(1),r?H(e):q(()=>new m))}var nt=r("5+tZ");class it{constructor(t,e,r){this.predicate=t,this.thisArg=e,this.source=r}call(t,e){return e.subscribe(new ot(t,this.predicate,this.thisArg,this.source))}}class ot extends k.a{constructor(t,e,r,n){super(t),this.predicate=e,this.thisArg=r,this.source=n,this.index=0,this.thisArg=r||this}notifyComplete(t){this.destination.next(t),this.destination.complete()}_next(t){let e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(r){return void this.destination.error(r)}e||this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}var at=r("eIep"),st=r("XUOw"),lt=r("Kqap");function ut(t,e){return Object(nt.a)(t,e,1)}var ct=r("mCNh"),ht=r("quSY");class pt{constructor(t){this.callback=t}call(t,e){return e.subscribe(new dt(t,this.callback))}}class dt extends k.a{constructor(t,e){super(t),this.add(new ht.a(e))}}let ft=null;function mt(){return ft}class yt{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(t){this._attrToPropMap=t}}class gt extends yt{constructor(){super(),this._animationPrefix=null,this._transitionEnd=null;try{const e=this.createElement("div",document);if(null!=this.getStyle(e,"animationName"))this._animationPrefix="";else{const t=["Webkit","Moz","O","ms"];for(let r=0;r<t.length;r++)if(null!=this.getStyle(e,t[r]+"AnimationName")){this._animationPrefix="-"+t[r].toLowerCase()+"-";break}}const r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(r).forEach(t=>{null!=this.getStyle(e,t)&&(this._transitionEnd=r[t])})}catch(t){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(t){return t.getDistributedNodes()}resolveAndSetHref(t,e,r){t.href=null==r?e:e+"/../"+r}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}const _t={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},vt=3,bt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xt={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},wt=(()=>{if(n.ob.Node)return n.ob.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))}})();class Et extends gt{parse(t){throw new Error("parse not implemented")}static makeCurrent(){var t;t=new Et,ft||(ft=t)}hasProperty(t,e){return e in t}setProperty(t,e,r){t[e]=r}getProperty(t,e){return t[e]}invoke(t,e,r){t[e](...r)}logError(t){window.console&&(console.error?console.error(t):console.log(t))}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}get attrToPropMap(){return _t}contains(t,e){return wt.call(t,e)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return t.querySelectorAll(e)}on(t,e,r){t.addEventListener(e,r,!1)}onAndCancel(t,e,r){return t.addEventListener(e,r,!1),()=>{t.removeEventListener(e,r,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}createMouseEvent(t){const e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e}createEvent(t){const e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e}preventDefault(t){t.preventDefault(),t.returnValue=!1}isPrevented(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}getInnerHTML(t){return t.innerHTML}getTemplateContent(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}getOuterHTML(t){return t.outerHTML}nodeName(t){return t.nodeName}nodeValue(t){return t.nodeValue}type(t){return t.type}content(t){return this.hasProperty(t,"content")?t.content:t}firstChild(t){return t.firstChild}nextSibling(t){return t.nextSibling}parentElement(t){return t.parentNode}childNodes(t){return t.childNodes}childNodesAsList(t){const e=t.childNodes,r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n];return r}clearNodes(t){for(;t.firstChild;)t.removeChild(t.firstChild)}appendChild(t,e){t.appendChild(e)}removeChild(t,e){t.removeChild(e)}replaceChild(t,e,r){t.replaceChild(e,r)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}insertBefore(t,e,r){t.insertBefore(r,e)}insertAllBefore(t,e,r){r.forEach(r=>t.insertBefore(r,e))}insertAfter(t,e,r){t.insertBefore(r,e.nextSibling)}setInnerHTML(t,e){t.innerHTML=e}getText(t){return t.textContent}setText(t,e){t.textContent=e}getValue(t){return t.value}setValue(t,e){t.value=e}getChecked(t){return t.checked}setChecked(t,e){t.checked=e}createComment(t){return this.getDefaultDocument().createComment(t)}createTemplate(t){const e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createElementNS(t,e,r){return(r=r||this.getDefaultDocument()).createElementNS(t,e)}createTextNode(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}createScriptTag(t,e,r){const n=(r=r||this.getDefaultDocument()).createElement("SCRIPT");return n.setAttribute(t,e),n}createStyleElement(t,e){const r=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(r,this.createTextNode(t,e)),r}createShadowRoot(t){return t.createShadowRoot()}getShadowRoot(t){return t.shadowRoot}getHost(t){return t.host}clone(t){return t.cloneNode(!0)}getElementsByClassName(t,e){return t.getElementsByClassName(e)}getElementsByTagName(t,e){return t.getElementsByTagName(e)}classList(t){return Array.prototype.slice.call(t.classList,0)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}hasClass(t,e){return t.classList.contains(e)}setStyle(t,e,r){t.style[e]=r}removeStyle(t,e){t.style[e]=""}getStyle(t,e){return t.style[e]}hasStyle(t,e,r){const n=this.getStyle(t,e)||"";return r?n==r:n.length>0}tagName(t){return t.tagName}attributeMap(t){const e=new Map,r=t.attributes;for(let n=0;n<r.length;n++){const t=r.item(n);e.set(t.name,t.value)}return e}hasAttribute(t,e){return t.hasAttribute(e)}hasAttributeNS(t,e,r){return t.hasAttributeNS(e,r)}getAttribute(t,e){return t.getAttribute(e)}getAttributeNS(t,e,r){return t.getAttributeNS(e,r)}setAttribute(t,e,r){t.setAttribute(e,r)}setAttributeNS(t,e,r,n){t.setAttributeNS(e,r,n)}removeAttribute(t,e){t.removeAttribute(e)}removeAttributeNS(t,e,r){t.removeAttributeNS(e,r)}templateAwareRoot(t){return this.isTemplateElement(t)?this.content(t):t}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(t){return t.title}setTitle(t,e){t.title=e||""}elementMatches(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}isTemplateElement(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}isTextNode(t){return t.nodeType===Node.TEXT_NODE}isCommentNode(t){return t.nodeType===Node.COMMENT_NODE}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}hasShadowRoot(t){return null!=t.shadowRoot&&t instanceof HTMLElement}isShadowRoot(t){return t instanceof DocumentFragment}importIntoDoc(t){return document.importNode(this.templateAwareRoot(t),!0)}adoptNode(t){return document.adoptNode(t)}getHref(t){return t.getAttribute("href")}getEventKey(t){let e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),t.location===vt&&xt.hasOwnProperty(e)&&(e=xt[e]))}return bt[e]||e}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=St||(St=document.querySelector("base"))?St.getAttribute("href"):null;return null==e?null:(r=e,Ct||(Ct=document.createElement("a")),Ct.setAttribute("href",r),"/"===Ct.pathname.charAt(0)?Ct.pathname:"/"+Ct.pathname);var r}resetBaseElement(){St=null}getUserAgent(){return window.navigator.userAgent}setData(t,e,r){this.setAttribute(t,"data-"+e,r)}getData(t,e){return this.getAttribute(t,"data-"+e)}getComputedStyle(t){return getComputedStyle(t)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return Object(s.r)(document.cookie,t)}setCookie(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}}let Ct,St=null;function Tt(){return!!window.history.pushState}const At=(()=>{class t extends s.m{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=mt().getLocation(),this._history=mt().getHistory()}getBaseHrefFromDOM(){return mt().getBaseHref(this._doc)}onPopState(t){mt().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){mt().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,r){Tt()?this._history.pushState(t,e,r):this.location.hash=r}replaceState(t,e,r){Tt()?this._history.replaceState(t,e,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return t.ctorParameters=(()=>[{type:void 0,decorators:[{type:n.n,args:[s.d]}]}]),t})(),It=new n.o("TRANSITION_ID"),kt=[{provide:n.d,useFactory:function(t,e,r){return()=>{r.get(n.e).donePromise.then(()=>{const r=mt();Array.prototype.slice.apply(r.querySelectorAll(e,"style[ng-transition]")).filter(e=>r.getAttribute(e,"ng-transition")===t).forEach(t=>r.remove(t))})}},deps:[It,s.d,n.p],multi:!0}];class Pt{static init(){Object(n.V)(new Pt)}addToWindow(t){n.ob.getAngularTestability=((e,r=!0)=>{const n=t.findTestabilityInTree(e,r);if(null==n)throw new Error("Could not find testability for element.");return n}),n.ob.getAllAngularTestabilities=(()=>t.getAllTestabilities()),n.ob.getAllAngularRootElements=(()=>t.getAllRootElements()),n.ob.frameworkStabilizers||(n.ob.frameworkStabilizers=[]),n.ob.frameworkStabilizers.push(t=>{const e=n.ob.getAllAngularTestabilities();let r=e.length,i=!1;const o=function(e){i=i||e,0==--r&&t(i)};e.forEach(function(t){t.whenStable(o)})})}findTestabilityInTree(t,e,r){if(null==e)return null;const n=t.getTestability(e);return null!=n?n:r?mt().isShadowRoot(e)?this.findTestabilityInTree(t,mt().getHost(e),!0):this.findTestabilityInTree(t,mt().parentElement(e),!0):null}}function Ot(t,e){"undefined"!=typeof COMPILED&&COMPILED||((n.ob.ng=n.ob.ng||{})[t]=e)}const Rt=(()=>({ApplicationRef:n.g,NgZone:n.x}))();function Dt(t){return Object(n.S)(t)}const Mt=new n.o("EventManagerPlugins"),Lt=(()=>(class{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,r){return this._findPluginFor(e).addEventListener(t,e,r)}addGlobalEventListener(t,e,r){return this._findPluginFor(e).addGlobalEventListener(t,e,r)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const r=this._plugins;for(let n=0;n<r.length;n++){const e=r[n];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}))();class zt{constructor(t){this._doc=t}addGlobalEventListener(t,e,r){const n=mt().getGlobalEventTarget(this._doc,t);if(!n)throw new Error(`Unsupported event target ${n} for event ${e}`);return this.addEventListener(n,e,r)}}const Nt=(()=>(class{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}))(),Ft=(()=>(class extends Nt{constructor(t){super(),this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(t.head)}_addStylesToHost(t,e){t.forEach(t=>{const r=this._doc.createElement("style");r.textContent=t,this._styleNodes.add(e.appendChild(r))})}addHost(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}removeHost(t){this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach(e=>this._addStylesToHost(t,e))}ngOnDestroy(){this._styleNodes.forEach(t=>mt().remove(t))}}))(),Bt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Vt=/%COMP%/g,jt="_nghost-%COMP%",Ut="_ngcontent-%COMP%";function qt(t,e,r){for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?qt(t,i,r):(i=i.replace(Vt,t),r.push(i))}return r}function Ht(t){return e=>{!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}const Wt=(()=>(class{constructor(t,e,r){this.eventManager=t,this.sharedStylesHost=e,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new Gt(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case n.N.Emulated:{let r=this.rendererByCompId.get(e.id);return r||(r=new Kt(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,r)),r.applyToHost(t),r}case n.N.Native:case n.N.ShadowDom:return new $t(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=qt(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}))();class Gt{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(Bt[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,r){t&&t.insertBefore(e,r)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return e||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,n){if(n){e=`${n}:${e}`;const i=Bt[n];i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){const n=Bt[r];n?t.removeAttributeNS(n,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,i){i&n.D.DashCase?t.style.setProperty(e,r,i&n.D.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&n.D.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){Qt(e,"property"),t[e]=r}setValue(t,e){t.nodeValue=e}listen(t,e,r){return Qt(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Ht(r)):this.eventManager.addEventListener(t,e,Ht(r))}}const Zt=(()=>"@".charCodeAt(0))();function Qt(t,e){if(t.charCodeAt(0)===Zt)throw new Error(`Found the synthetic ${e} ${t}. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.`)}class Kt extends Gt{constructor(t,e,r,n){super(t),this.component=r;const i=qt(n+"-"+r.id,r.styles,[]);e.addStyles(i),this.contentAttr=Ut.replace(Vt,n+"-"+r.id),this.hostAttr=jt.replace(Vt,n+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}}class $t extends Gt{constructor(t,e,r,i){super(t),this.sharedStylesHost=e,this.hostEl=r,this.component=i,this.shadowRoot=i.encapsulation===n.N.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const o=qt(i.id,i.styles,[]);for(let n=0;n<o.length;n++){const t=document.createElement("style");t.textContent=o[n],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}const Xt=(()=>"undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t})(),Yt=Xt("addEventListener"),Jt=Xt("removeEventListener"),te={},ee="__zone_symbol__propagationStopped",re=(()=>{const t="undefined"!=typeof Zone&&Zone[Xt("BLACK_LISTED_EVENTS")];if(t){const e={};return t.forEach(t=>{e[t]=t}),e}})(),ne=function(t){return!!re&&re.hasOwnProperty(t)},ie=function(t){const e=te[t.type];if(!e)return;const r=this[e];if(!r)return;const n=[t];if(1===r.length){const t=r[0];return t.zone!==Zone.current?t.zone.run(t.handler,this,n):t.handler.apply(this,n)}{const e=r.slice();for(let r=0;r<e.length&&!0!==t[ee];r++){const t=e[r];t.zone!==Zone.current?t.zone.run(t.handler,this,n):t.handler.apply(this,n)}}},oe=(()=>(class extends zt{constructor(t,e,r){super(t),this.ngZone=e,r&&Object(s.o)(r)||this.patchEvent()}patchEvent(){if("undefined"==typeof Event||!Event||!Event.prototype)return;if(Event.prototype.__zone_symbol__stopImmediatePropagation)return;const t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[ee]=!0),t&&t.apply(this,arguments)}}supports(t){return!0}addEventListener(t,e,r){let i=r;if(!t[Yt]||n.x.isInAngularZone()&&!ne(e))t.addEventListener(e,i,!1);else{let r=te[e];r||(r=te[e]=Xt("ANGULAR"+e+"FALSE"));let n=t[r];const o=n&&n.length>0;n||(n=t[r]=[]);const a=ne(e)?Zone.root:Zone.current;if(0===n.length)n.push({zone:a,handler:i});else{let t=!1;for(let e=0;e<n.length;e++)if(n[e].handler===i){t=!0;break}t||n.push({zone:a,handler:i})}o||t[Yt](e,ie,!1)}return()=>this.removeEventListener(t,e,i)}removeEventListener(t,e,r){let n=t[Jt];if(!n)return t.removeEventListener.apply(t,[e,r,!1]);let i=te[e],o=i&&t[i];if(!o)return t.removeEventListener.apply(t,[e,r,!1]);let a=!1;for(let s=0;s<o.length;s++)if(o[s].handler===r){a=!0,o.splice(s,1);break}a?0===o.length&&n.apply(t,[e,ie,!1]):t.removeEventListener.apply(t,[e,r,!1])}}))(),ae={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},se=new n.o("HammerGestureConfig"),le=new n.o("HammerLoader"),ue=(()=>(class{constructor(){this.events=[],this.overrides={}}buildHammer(t){const e=new Hammer(t,this.options);e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0});for(const r in this.overrides)e.get(r).set(this.overrides[r]);return e}}))(),ce=(()=>(class extends zt{constructor(t,e,r,n){super(t),this._config=e,this.console=r,this.loader=n}supports(t){return!(!ae.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn(`The "${t}" event cannot be bound because Hammer.JS is not `+"loaded and no custom loader has been specified."),1))}addEventListener(t,e,r){const n=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){let n=!1,i=()=>{n=!0};return this.loader().then(()=>{if(!window.Hammer)return this.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(i=(()=>{}));n||(i=this.addEventListener(t,e,r))}).catch(()=>{this.console.warn(`The "${e}" event cannot be bound because the custom `+"Hammer.JS loader failed."),i=(()=>{})}),()=>{i()}}return n.runOutsideAngular(()=>{const i=this._config.buildHammer(t),o=function(t){n.runGuarded(function(){r(t)})};return i.on(e,o),()=>{i.off(e,o),"function"==typeof i.destroy&&i.destroy()}})}isCustomEvent(t){return this._config.events.indexOf(t)>-1}}))(),he=["alt","control","meta","shift"],pe={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},de=(()=>{class t extends zt{constructor(t){super(t)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,n){const i=t.parseEventName(r),o=t.eventCallback(i.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>mt().onAndCancel(e,i.domEventName,o))}static parseEventName(e){const r=e.toLowerCase().split("."),n=r.shift();if(0===r.length||"keydown"!==n&&"keyup"!==n)return null;const i=t._normalizeKey(r.pop());let o="";if(he.forEach(t=>{const e=r.indexOf(t);e>-1&&(r.splice(e,1),o+=t+".")}),o+=i,0!=r.length||0===i.length)return null;const a={};return a.domEventName=n,a.fullKey=o,a}static getEventFullKey(t){let e="",r=mt().getEventKey(t);return" "===(r=r.toLowerCase())?r="space":"."===r&&(r="dot"),he.forEach(n=>{n!=r&&(0,pe[n])(t)&&(e+=n+".")}),e+=r}static eventCallback(e,r,n){return i=>{t.getEventFullKey(i)===e&&n.runGuarded(()=>r(i))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return t})();class fe{}const me=(()=>(class extends fe{constructor(t){super(),this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case n.F.NONE:return e;case n.F.HTML:return e instanceof ge?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),Object(n.Z)(this._doc,String(e)));case n.F.STYLE:return e instanceof _e?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),Object(n.ab)(e));case n.F.SCRIPT:if(e instanceof ve)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case n.F.URL:return e instanceof xe||e instanceof be?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),Object(n.bb)(String(e)));case n.F.RESOURCE_URL:if(e instanceof xe)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(t,e){if(t instanceof ye)throw new Error(`Required a safe ${e}, got a ${t.getTypeName()} `+"(see http://g.co/ng/security#xss)")}bypassSecurityTrustHtml(t){return new ge(t)}bypassSecurityTrustStyle(t){return new _e(t)}bypassSecurityTrustScript(t){return new ve(t)}bypassSecurityTrustUrl(t){return new be(t)}bypassSecurityTrustResourceUrl(t){return new xe(t)}}))();class ye{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}`+" (see http://g.co/ng/security#xss)"}}class ge extends ye{getTypeName(){return"HTML"}}class _e extends ye{getTypeName(){return"Style"}}class ve extends ye{getTypeName(){return"Script"}}class be extends ye{getTypeName(){return"URL"}}class xe extends ye{getTypeName(){return"ResourceURL"}}const we=[{provide:n.z,useValue:s.p},{provide:n.A,useValue:function(){Et.makeCurrent(),Pt.init()},multi:!0},{provide:s.m,useClass:At,deps:[s.d]},{provide:s.d,useFactory:function(){return document},deps:[]}],Ee=Object(n.P)(n.U,"browser",we);function Ce(){return new n.l}const Se=(()=>{class t{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:n.c,useValue:e.appId},{provide:It,useExisting:n.c},kt]}}}return t})();"undefined"!=typeof window&&window;class Te{constructor(t,e){this.id=t,this.url=e}}class Ae extends Te{constructor(t,e,r="imperative",n=null){super(t,e),this.navigationTrigger=r,this.restoredState=n}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ie extends Te{constructor(t,e,r){super(t,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ke extends Te{constructor(t,e,r){super(t,e),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Pe extends Te{constructor(t,e,r){super(t,e),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Oe extends Te{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Re extends Te{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class De extends Te{constructor(t,e,r,n,i){super(t,e),this.urlAfterRedirects=r,this.state=n,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Me extends Te{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Le extends Te{constructor(t,e,r,n){super(t,e),this.urlAfterRedirects=r,this.state=n}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ze{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ne{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Fe{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Be{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ve{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class je{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ue{constructor(t,e,r){this.routerEvent=t,this.position=e,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const qe=(()=>(class{}))(),He="primary";class We{constructor(t){this.params=t||{}}has(t){return this.params.hasOwnProperty(t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ge(t){return new We(t)}const Ze="ngNavigationCancelingError";function Qe(t){const e=Error("NavigationCancelingError: "+t);return e[Ze]=!0,e}function Ke(t,e,r){const n=r.path.split("/");if(n.length>t.length)return null;if("full"===r.pathMatch&&(e.hasChildren()||n.length<t.length))return null;const i={};for(let o=0;o<n.length;o++){const e=n[o],r=t[o];if(e.startsWith(":"))i[e.substring(1)]=r;else if(e!==r.path)return null}return{consumed:t.slice(0,n.length),posParams:i}}class $e{constructor(t,e){this.routes=t,this.module=e}}function Xe(t,e=""){for(let r=0;r<t.length;r++){const n=t[r];Ye(n,Je(e,n))}}function Ye(t,e){if(!t)throw new Error(`\n      Invalid configuration of route '${e}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(t))throw new Error(`Invalid configuration of route '${e}': Array cannot be specified`);if(!t.component&&!t.children&&!t.loadChildren&&t.outlet&&t.outlet!==He)throw new Error(`Invalid configuration of route '${e}': a componentless route without children or loadChildren cannot have a named outlet set`);if(t.redirectTo&&t.children)throw new Error(`Invalid configuration of route '${e}': redirectTo and children cannot be used together`);if(t.redirectTo&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': redirectTo and loadChildren cannot be used together`);if(t.children&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': children and loadChildren cannot be used together`);if(t.redirectTo&&t.component)throw new Error(`Invalid configuration of route '${e}': redirectTo and component cannot be used together`);if(t.path&&t.matcher)throw new Error(`Invalid configuration of route '${e}': path and matcher cannot be used together`);if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error(`Invalid configuration of route '${e}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===t.path&&void 0===t.matcher)throw new Error(`Invalid configuration of route '${e}': routes must have either a path or a matcher specified`);if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error(`Invalid configuration of route '${e}': path cannot start with a slash`);if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error(`Invalid configuration of route '{path: "${e}", redirectTo: "${t.redirectTo}"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`);if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error(`Invalid configuration of route '${e}': pathMatch can only be set to 'prefix' or 'full'`);t.children&&Xe(t.children,e)}function Je(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function tr(t){const e=t.children&&t.children.map(tr),r=e?Object.assign({},t,{children:e}):Object.assign({},t);return!r.component&&(e||r.loadChildren)&&r.outlet&&r.outlet!==He&&(r.component=qe),r}function er(t,e){const r=Object.keys(t),n=Object.keys(e);if(!r||!n||r.length!=n.length)return!1;let i;for(let o=0;o<r.length;o++)if(t[i=r[o]]!==e[i])return!1;return!0}function rr(t){return Array.prototype.concat.apply([],t)}function nr(t){return t.length>0?t[t.length-1]:null}function ir(t,e){for(const r in t)t.hasOwnProperty(r)&&e(t[r],r)}function or(t){return Object(n.qb)(t)?t:Object(n.rb)(t)?Object(u.a)(Promise.resolve(t)):Object(l.a)(t)}function ar(t,e,r){return r?function(t,e){return er(t,e)}(t.queryParams,e.queryParams)&&function t(e,r){if(!cr(e.segments,r.segments))return!1;if(e.numberOfChildren!==r.numberOfChildren)return!1;for(const n in r.children){if(!e.children[n])return!1;if(!t(e.children[n],r.children[n]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(r=>e[r]===t[r])}(t.queryParams,e.queryParams)&&function t(e,r){return function e(r,n,i){if(r.segments.length>i.length){return!!cr(r.segments.slice(0,i.length),i)&&!n.hasChildren()}if(r.segments.length===i.length){if(!cr(r.segments,i))return!1;for(const e in n.children){if(!r.children[e])return!1;if(!t(r.children[e],n.children[e]))return!1}return!0}{const t=i.slice(0,r.segments.length),o=i.slice(r.segments.length);return!!cr(r.segments,t)&&!!r.children[He]&&e(r.children[He],n,o)}}(e,r,r.segments)}(t.root,e.root)}class sr{constructor(t,e,r){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ge(this.queryParams)),this._queryParamMap}toString(){return fr.serialize(this)}}class lr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,ir(e,(t,e)=>t.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return mr(this)}}class ur{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ge(this.parameters)),this._parameterMap}toString(){return xr(this)}}function cr(t,e){return t.length===e.length&&t.every((t,r)=>t.path===e[r].path)}function hr(t,e){let r=[];return ir(t.children,(t,n)=>{n===He&&(r=r.concat(e(t,n)))}),ir(t.children,(t,n)=>{n!==He&&(r=r.concat(e(t,n)))}),r}class pr{}class dr{parse(t){const e=new Tr(t);return new sr(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){var e;return`${`/${function t(e,r){if(!e.hasChildren())return mr(e);if(r){const r=e.children[He]?t(e.children[He],!1):"",n=[];return ir(e.children,(e,r)=>{r!==He&&n.push(`${r}:${t(e,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=hr(e,(r,n)=>n===He?[t(e.children[He],!1)]:[`${n}:${t(r,!1)}`]);return`${mr(e)}/(${r.join("//")})`}}(t.root,!0)}`}${function(t){const e=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(t=>`${gr(e)}=${gr(t)}`).join("&"):`${gr(e)}=${gr(r)}`});return e.length?`?${e.join("&")}`:""}(t.queryParams)}${"string"==typeof t.fragment?`#${e=t.fragment,encodeURI(e)}`:""}`}}const fr=new dr;function mr(t){return t.segments.map(t=>xr(t)).join("/")}function yr(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gr(t){return yr(t).replace(/%3B/gi,";")}function _r(t){return yr(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function vr(t){return decodeURIComponent(t)}function br(t){return vr(t.replace(/\+/g,"%20"))}function xr(t){return`${_r(t.path)}${e=t.parameters,Object.keys(e).map(t=>`;${_r(t)}=${_r(e[t])}`).join("")}`;var e}const wr=/^[^\/()?;=#]+/;function Er(t){const e=t.match(wr);return e?e[0]:""}const Cr=/^[^=?&#]+/,Sr=/^[^?&#]+/;class Tr{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new lr([],{}):new lr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[He]=new lr(t,e)),r}parseSegment(){const t=Er(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new ur(vr(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Er(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const t=Er(this.remaining);t&&this.capture(r=t)}t[vr(e)]=vr(r)}parseQueryParam(t){const e=function(t){const e=t.match(Cr);return e?e[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const t=function(t){const e=t.match(Sr);return e?e[0]:""}(this.remaining);t&&this.capture(r=t)}const n=br(e),i=br(r);if(t.hasOwnProperty(n)){let e=t[n];Array.isArray(e)||(t[n]=e=[e]),e.push(i)}else t[n]=i}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Er(this.remaining),n=this.remaining[r.length];if("/"!==n&&")"!==n&&";"!==n)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;r.indexOf(":")>-1?(i=r.substr(0,r.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=He);const o=this.parseChildren();e[i]=1===Object.keys(o).length?o[He]:new lr([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class Ar{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Ir(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=Ir(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=kr(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return kr(t,this._root).map(t=>t.value)}}function Ir(t,e){if(t===e.value)return e;for(const r of e.children){const e=Ir(t,r);if(e)return e}return null}function kr(t,e){if(t===e.value)return[e];for(const r of e.children){const n=kr(t,r);if(n.length)return n.unshift(e),n}return[]}class Pr{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Or(t){const e={};return t&&t.children.forEach(t=>e[t.value.outlet]=t),e}class Rr extends Ar{constructor(t,e){super(t),this.snapshot=e,Fr(this,t)}toString(){return this.snapshot.toString()}}function Dr(t,e){const r=function(t,e){const r=new zr([],{},{},"",{},He,e,null,t.root,-1,{});return new Nr("",new Pr(r,[]))}(t,e),n=new p([new ur("",{})]),i=new p({}),o=new p({}),a=new p({}),s=new p(""),l=new Mr(n,i,a,s,o,He,e,r.root);return l.snapshot=r.root,new Rr(new Pr(l,[]),r)}class Mr{constructor(t,e,r,n,i,o,a,s){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=a,this._futureSnapshot=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Object(T.a)(t=>Ge(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Object(T.a)(t=>Ge(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Lr(t,e="emptyOnly"){const r=t.pathFromRoot;let n=0;if("always"!==e)for(n=r.length-1;n>=1;){const t=r[n],e=r[n-1];if(t.routeConfig&&""===t.routeConfig.path)n--;else{if(e.component)break;n--}}return function(t){return t.reduce((t,e)=>({params:Object.assign({},t.params,e.params),data:Object.assign({},t.data,e.data),resolve:Object.assign({},t.resolve,e._resolvedData)}),{params:{},data:{},resolve:{}})}(r.slice(n))}class zr{constructor(t,e,r,n,i,o,a,s,l,u,c){this.url=t,this.params=e,this.queryParams=r,this.fragment=n,this.data=i,this.outlet=o,this.component=a,this.routeConfig=s,this._urlSegment=l,this._lastPathIndex=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ge(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ge(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Nr extends Ar{constructor(t,e){super(e),this.url=t,Fr(this,e)}toString(){return Br(this._root)}}function Fr(t,e){e.value._routerState=t,e.children.forEach(e=>Fr(t,e))}function Br(t){const e=t.children.length>0?` { ${t.children.map(Br).join(", ")} } `:"";return`${t.value}${e}`}function Vr(t){if(t.snapshot){const e=t.snapshot,r=t._futureSnapshot;t.snapshot=r,er(e.queryParams,r.queryParams)||t.queryParams.next(r.queryParams),e.fragment!==r.fragment&&t.fragment.next(r.fragment),er(e.params,r.params)||t.params.next(r.params),function(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!er(t[r],e[r]))return!1;return!0}(e.url,r.url)||t.url.next(r.url),er(e.data,r.data)||t.data.next(r.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function jr(t,e){var r,n;return er(t.params,e.params)&&cr(r=t.url,n=e.url)&&r.every((t,e)=>er(t.parameters,n[e].parameters))&&!(!t.parent!=!e.parent)&&(!t.parent||jr(t.parent,e.parent))}function Ur(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function qr(t,e,r,n,i){let o={};return n&&ir(n,(t,e)=>{o[e]=Array.isArray(t)?t.map(t=>`${t}`):`${t}`}),new sr(r.root===t?e:function t(e,r,n){const i={};return ir(e.children,(e,o)=>{i[o]=e===r?n:t(e,r,n)}),new lr(e.segments,i)}(r.root,t,e),o,i)}class Hr{constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&Ur(r[0]))throw new Error("Root segment cannot have matrix parameters");const n=r.find(t=>"object"==typeof t&&null!=t&&t.outlets);if(n&&n!==nr(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Wr{constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}}function Gr(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[He]:`${t}`}function Zr(t,e,r){if(t||(t=new lr([],{})),0===t.segments.length&&t.hasChildren())return Qr(t,e,r);const n=function(t,e,r){let n=0,i=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(n>=r.length)return o;const e=t.segments[i],a=Gr(r[n]),s=n<r.length-1?r[n+1]:null;if(i>0&&void 0===a)break;if(a&&s&&"object"==typeof s&&void 0===s.outlets){if(!Yr(a,s,e))return o;n+=2}else{if(!Yr(a,{},e))return o;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(t,e,r),i=r.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){const e=new lr(t.segments.slice(0,n.pathIndex),{});return e.children[He]=new lr(t.segments.slice(n.pathIndex),t.children),Qr(e,0,i)}return n.match&&0===i.length?new lr(t.segments,{}):n.match&&!t.hasChildren()?Kr(t,e,r):n.match?Qr(t,0,i):Kr(t,e,r)}function Qr(t,e,r){if(0===r.length)return new lr(t.segments,{});{const n=function(t){return"object"!=typeof t[0]?{[He]:t}:void 0===t[0].outlets?{[He]:t}:t[0].outlets}(r),i={};return ir(n,(r,n)=>{null!==r&&(i[n]=Zr(t.children[n],e,r))}),ir(t.children,(t,e)=>{void 0===n[e]&&(i[e]=t)}),new lr(t.segments,i)}}function Kr(t,e,r){const n=t.segments.slice(0,e);let i=0;for(;i<r.length;){if("object"==typeof r[i]&&void 0!==r[i].outlets){const t=$r(r[i].outlets);return new lr(n,t)}if(0===i&&Ur(r[0])){n.push(new ur(t.segments[e].path,r[0])),i++;continue}const o=Gr(r[i]),a=i<r.length-1?r[i+1]:null;o&&a&&Ur(a)?(n.push(new ur(o,Xr(a))),i+=2):(n.push(new ur(o,{})),i++)}return new lr(n,{})}function $r(t){const e={};return ir(t,(t,r)=>{null!==t&&(e[r]=Kr(new lr([],{}),0,t))}),e}function Xr(t){const e={};return ir(t,(t,r)=>e[r]=`${t}`),e}function Yr(t,e,r){return t==r.path&&er(e,r.parameters)}const Jr=(t,e,r)=>Object(T.a)(n=>(new tn(e,n.targetRouterState,n.currentRouterState,r).activate(t),n));class tn{constructor(t,e,r,n){this.routeReuseStrategy=t,this.futureState=e,this.currState=r,this.forwardEvent=n}activate(t){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,t),Vr(this.futureState.root),this.activateChildRoutes(e,r,t)}deactivateChildRoutes(t,e,r){const n=Or(e);t.children.forEach(t=>{const e=t.value.outlet;this.deactivateRoutes(t,n[e],r),delete n[e]}),ir(n,(t,e)=>{this.deactivateRouteAndItsChildren(t,r)})}deactivateRoutes(t,e,r){const n=t.value,i=e?e.value:null;if(n===i)if(n.component){const i=r.getContext(n.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const r=e.getContext(t.value.outlet);if(r&&r.outlet){const e=r.outlet.detach(),n=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:e,route:t,contexts:n})}}deactivateRouteAndOutlet(t,e){const r=e.getContext(t.value.outlet);if(r){const n=Or(t),i=t.value.component?r.children:e;ir(n,(t,e)=>this.deactivateRouteAndItsChildren(t,i)),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}activateChildRoutes(t,e,r){const n=Or(e);t.children.forEach(t=>{this.activateRoutes(t,n[t.value.outlet],r),this.forwardEvent(new je(t.value.snapshot))}),t.children.length&&this.forwardEvent(new Be(t.value.snapshot))}activateRoutes(t,e,r){const n=t.value,i=e?e.value:null;if(Vr(n),n===i)if(n.component){const i=r.getOrCreateContext(n.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,r);else if(n.component){const e=r.getOrCreateContext(n.outlet);if(this.routeReuseStrategy.shouldAttach(n.snapshot)){const t=this.routeReuseStrategy.retrieve(n.snapshot);this.routeReuseStrategy.store(n.snapshot,null),e.children.onOutletReAttached(t.contexts),e.attachRef=t.componentRef,e.route=t.route.value,e.outlet&&e.outlet.attach(t.componentRef,t.route.value),en(t.route)}else{const r=function(t){for(let e=n.snapshot.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(),i=r?r.module.componentFactoryResolver:null;e.attachRef=null,e.route=n,e.resolver=i,e.outlet&&e.outlet.activateWith(n,i),this.activateChildRoutes(t,null,e.children)}}else this.activateChildRoutes(t,null,r)}}function en(t){Vr(t.value),t.children.forEach(en)}function rn(t){return"function"==typeof t}function nn(t){return t instanceof sr}class on{constructor(t){this.segmentGroup=t||null}}class an{constructor(t){this.urlTree=t}}function sn(t){return new d.a(e=>e.error(new on(t)))}function ln(t){return new d.a(e=>e.error(new an(t)))}function un(t){return new d.a(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class cn{constructor(t,e,r,i,o){this.configLoader=e,this.urlSerializer=r,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(n.v)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,He).pipe(Object(T.a)(t=>this.createUrlTree(t,this.urlTree.queryParams,this.urlTree.fragment))).pipe($(t=>{if(t instanceof an)return this.allowRedirects=!1,this.match(t.urlTree);if(t instanceof on)throw this.noMatchError(t);throw t}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,He).pipe(Object(T.a)(e=>this.createUrlTree(e,t.queryParams,t.fragment))).pipe($(t=>{if(t instanceof on)throw this.noMatchError(t);throw t}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,r){const n=t.segments.length>0?new lr([],{[He]:t}):t;return new sr(n,e,r)}expandSegmentGroup(t,e,r,n){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,e,r).pipe(Object(T.a)(t=>new lr([],t))):this.expandSegment(t,r,e,r.segments,n,!0)}expandChildren(t,e,r){return function(t,e){if(0===Object.keys(t).length)return Object(l.a)({});const r=[],n=[],i={};return ir(t,(t,o)=>{const a=e(o,t).pipe(Object(T.a)(t=>i[o]=t));o===He?r.push(a):n.push(a)}),l.a.apply(null,r.concat(n)).pipe(I(),Q(),Object(T.a)(()=>i))}(r.children,(r,n)=>this.expandSegmentGroup(t,e,n,r))}expandSegment(t,e,r,n,i,o){return Object(l.a)(...r).pipe(Object(T.a)(a=>this.expandSegmentAgainstRoute(t,e,r,a,n,i,o).pipe($(t=>{if(t instanceof on)return Object(l.a)(null);throw t}))),I(),rt(t=>!!t),$((t,r)=>{if(t instanceof m||"EmptyError"===t.name){if(this.noLeftoversInUrl(e,n,i))return Object(l.a)(new lr([],{}));throw new on(e)}throw t}))}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}expandSegmentAgainstRoute(t,e,r,n,i,o,a){return fn(n)!==o?sn(e):void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,e,n,i):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o):sn(e)}expandSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){return"**"===n.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,n,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,r,n){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?ln(i):this.lineralizeSegments(r,i).pipe(Object(nt.a)(r=>{const i=new lr(r,{});return this.expandSegment(t,i,e,r,n,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,n,i,o){const{matched:a,consumedSegments:s,lastChild:l,positionalParamSegments:u}=hn(e,n,i);if(!a)return sn(e);const c=this.applyRedirectCommands(s,n.redirectTo,u);return n.redirectTo.startsWith("/")?ln(c):this.lineralizeSegments(n,c).pipe(Object(nt.a)(n=>this.expandSegment(t,e,r,n.concat(i.slice(l)),o,!1)))}matchSegmentAgainstRoute(t,e,r,n){if("**"===r.path)return r.loadChildren?this.configLoader.load(t.injector,r).pipe(Object(T.a)(t=>(r._loadedConfig=t,new lr(n,{})))):Object(l.a)(new lr(n,{}));const{matched:i,consumedSegments:o,lastChild:a}=hn(e,r,n);if(!i)return sn(e);const s=n.slice(a);return this.getChildConfig(t,r,n).pipe(Object(nt.a)(t=>{const r=t.module,n=t.routes,{segmentGroup:i,slicedSegments:a}=function(t,e,r,n){return r.length>0&&function(t,e,r){return n.some(r=>dn(t,e,r)&&fn(r)!==He)}(t,r)?{segmentGroup:pn(new lr(e,function(t,e){const r={};r[He]=e;for(const n of t)""===n.path&&fn(n)!==He&&(r[fn(n)]=new lr([],{}));return r}(n,new lr(r,t.children)))),slicedSegments:[]}:0===r.length&&function(t,e,r){return n.some(r=>dn(t,e,r))}(t,r)?{segmentGroup:pn(new lr(t.segments,function(t,e,r,n){const i={};for(const o of r)dn(t,e,o)&&!n[fn(o)]&&(i[fn(o)]=new lr([],{}));return Object.assign({},n,i)}(t,r,n,t.children))),slicedSegments:r}:{segmentGroup:t,slicedSegments:r}}(e,o,s,n);return 0===a.length&&i.hasChildren()?this.expandChildren(r,n,i).pipe(Object(T.a)(t=>new lr(o,t))):0===n.length&&0===a.length?Object(l.a)(new lr(o,{})):this.expandSegment(r,i,n,a,He,!0).pipe(Object(T.a)(t=>new lr(o.concat(t.segments),t.children)))}))}getChildConfig(t,e,r){return e.children?Object(l.a)(new $e(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Object(l.a)(e._loadedConfig):function(t,e,r){const n=e.canLoad;return n&&0!==n.length?Object(u.a)(n).pipe(Object(T.a)(n=>{const i=t.get(n);let o;if(function(t){return t&&rn(t.canLoad)}(i))o=i.canLoad(e,r);else{if(!rn(i))throw new Error("Invalid CanLoad guard");o=i(e,r)}return or(o)})).pipe(I(),(i=(t=>!0===t),t=>t.lift(new it(i,void 0,t)))):Object(l.a)(!0);var i}(t.injector,e,r).pipe(Object(nt.a)(r=>r?this.configLoader.load(t.injector,e).pipe(Object(T.a)(t=>(e._loadedConfig=t,t))):function(t){return new d.a(e=>e.error(Qe(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):Object(l.a)(new $e([],t))}lineralizeSegments(t,e){let r=[],n=e.root;for(;;){if(r=r.concat(n.segments),0===n.numberOfChildren)return Object(l.a)(r);if(n.numberOfChildren>1||!n.children[He])return un(t.redirectTo);n=n.children[He]}}applyRedirectCommands(t,e,r){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,r)}applyRedirectCreatreUrlTree(t,e,r,n){const i=this.createSegmentGroup(t,e.root,r,n);return new sr(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const r={};return ir(t,(t,n)=>{if("string"==typeof t&&t.startsWith(":")){const i=t.substring(1);r[n]=e[i]}else r[n]=t}),r}createSegmentGroup(t,e,r,n){const i=this.createSegments(t,e.segments,r,n);let o={};return ir(e.children,(e,i)=>{o[i]=this.createSegmentGroup(t,e,r,n)}),new lr(i,o)}createSegments(t,e,r,n){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,n):this.findOrReturn(e,r))}findPosParam(t,e,r){const n=r[e.path.substring(1)];if(!n)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return n}findOrReturn(t,e){let r=0;for(const n of e){if(n.path===t.path)return e.splice(r),n;r++}return t}}function hn(t,e,r){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||r.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const n=(e.matcher||Ke)(r,t,e);return n?{matched:!0,consumedSegments:n.consumed,lastChild:n.consumed.length,positionalParamSegments:n.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function pn(t){if(1===t.numberOfChildren&&t.children[He]){const e=t.children[He];return new lr(t.segments.concat(e.segments),e.children)}return t}function dn(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0!==r.redirectTo}function fn(t){return t.outlet||He}class mn{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class yn{constructor(t,e){this.component=t,this.route=e}}function gn(t,e,r){const n=t._root;return function t(e,r,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const a=Or(r);return e.children.forEach(e=>{!function(e,r,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const a=e.value,s=r?r.value:null,l=n?n.getContext(e.value.outlet):null;if(s&&a.routeConfig===s.routeConfig){const u=function(t,e,r){if("function"==typeof r)return r(t,e);switch(r){case"pathParamsChange":return!cr(t.url,e.url);case"pathParamsOrQueryParamsChange":return!cr(t.url,e.url)||!er(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!jr(t,e)||!er(t.queryParams,e.queryParams);case"paramsChange":default:return!jr(t,e)}}(s,a,a.routeConfig.runGuardsAndResolvers);if(u?o.canActivateChecks.push(new mn(i)):(a.data=s.data,a._resolvedData=s._resolvedData),t(e,r,a.component?l?l.children:null:n,i,o),u){o.canDeactivateChecks.push(new yn(l&&l.outlet&&l.outlet.component||null,s))}}else s&&vn(r,l,o),o.canActivateChecks.push(new mn(i)),t(e,null,a.component?l?l.children:null:n,i,o)}(e,a[e.value.outlet],n,i.concat([e.value]),o),delete a[e.value.outlet]}),ir(a,(t,e)=>vn(t,n.getContext(e),o)),o}(n,e?e._root:null,r,[n.value])}function _n(t,e,r){const n=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(n?n.module.injector:r).get(t)}function vn(t,e,r){const n=Or(t),i=t.value;ir(n,(t,n)=>{vn(t,i.component?e?e.children.getContext(n):null:e,r)}),r.canDeactivateChecks.push(new yn(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}const bn=Symbol("INITIAL_VALUE");function xn(){return Object(at.a)(t=>(function(...t){let e=null,r=null;return Object(y.a)(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(g.a)(t[0])&&(t=t[0]),Object(b.a)(t,r).lift(new w(e))})(...t.map(t=>t.pipe(J(1),function(...t){return e=>{let r=t[t.length-1];Object(y.a)(r)?t.pop():r=null;const n=t.length;return function(...t){return I()(Object(l.a)(...t))}(1!==n||r?n>0?Object(b.a)(t,r):Object(C.b)(r):Object(st.a)(t[0]),e)}}(bn)))).pipe(Object(lt.a)((t,e)=>{let r=!1;return e.reduce((t,n,i)=>{if(t!==bn)return t;if(n===bn&&(r=!0),!r){if(!1===n)return n;if(i===e.length-1||nn(n))return n}return t},t)},bn),P(t=>t!==bn),Object(T.a)(t=>nn(t)?t:!0===t),J(1)))}function wn(t,e){return null!==t&&e&&e(new Ve(t)),Object(l.a)(!0)}function En(t,e){return null!==t&&e&&e(new Fe(t)),Object(l.a)(!0)}function Cn(t,e,r){const n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||0===n.length)return Object(l.a)(!0);const i=n.map(n=>S(()=>{const i=_n(n,e,r);let o;if(function(t){return t&&rn(t.canActivate)}(i))o=or(i.canActivate(e,t));else{if(!rn(i))throw new Error("Invalid CanActivate guard");o=or(i(e,t))}return o.pipe(rt())}));return Object(l.a)(i).pipe(xn())}function Sn(t,e,r){const n=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(t=>(function(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null})(t)).filter(t=>null!==t).map(e=>S(()=>{const i=e.guards.map(i=>{const o=_n(i,e.node,r);let a;if(function(t){return t&&rn(t.canActivateChild)}(o))a=or(o.canActivateChild(n,t));else{if(!rn(o))throw new Error("Invalid CanActivateChild guard");a=or(o(n,t))}return a.pipe(rt())});return Object(l.a)(i).pipe(xn())}));return Object(l.a)(i).pipe(xn())}class Tn{}class An{constructor(t,e,r,n,i,o){this.rootComponentType=t,this.config=e,this.urlTree=r,this.url=n,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}recognize(){try{const e=Pn(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,r=this.processSegmentGroup(this.config,e,He),n=new zr([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},He,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new Pr(n,r),o=new Nr(this.url,i);return this.inheritParamsAndData(o._root),Object(l.a)(o)}catch(t){return new d.a(e=>e.error(t))}}inheritParamsAndData(t){const e=t.value,r=Lr(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),t.children.forEach(t=>this.inheritParamsAndData(t))}processSegmentGroup(t,e,r){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,r)}processChildren(t,e){const r=hr(e,(e,r)=>this.processSegmentGroup(t,e,r));return function(t){const e={};r.forEach(t=>{const r=e[t.value.outlet];if(r){const e=r.url.map(t=>t.toString()).join("/"),n=t.value.url.map(t=>t.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${e}' and '${n}'.`)}e[t.value.outlet]=t.value})}(),r.sort((t,e)=>t.value.outlet===He?-1:e.value.outlet===He?1:t.value.outlet.localeCompare(e.value.outlet)),r}processSegment(t,e,r,n){for(const o of t)try{return this.processSegmentAgainstRoute(o,e,r,n)}catch(i){if(!(i instanceof Tn))throw i}if(this.noLeftoversInUrl(e,r,n))return[];throw new Tn}noLeftoversInUrl(t,e,r){return 0===e.length&&!t.children[r]}processSegmentAgainstRoute(t,e,r,n){if(t.redirectTo)throw new Tn;if((t.outlet||He)!==n)throw new Tn;let i,o=[],a=[];if("**"===t.path){const o=r.length>0?nr(r).parameters:{};i=new zr(r,o,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Dn(t),n,t.component,t,In(e),kn(e)+r.length,Mn(t))}else{const s=function(t,e,r){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||r.length>0))throw new Tn;return{consumedSegments:[],lastChild:0,parameters:{}}}const n=(e.matcher||Ke)(r,t,e);if(!n)throw new Tn;const i={};ir(n.posParams,(t,e)=>{i[e]=t.path});const o=n.consumed.length>0?Object.assign({},i,n.consumed[n.consumed.length-1].parameters):i;return{consumedSegments:n.consumed,lastChild:n.consumed.length,parameters:o}}(e,t,r);o=s.consumedSegments,a=r.slice(s.lastChild),i=new zr(o,s.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Dn(t),n,t.component,t,In(e),kn(e)+o.length,Mn(t))}const s=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),{segmentGroup:l,slicedSegments:u}=Pn(e,o,a,s,this.relativeLinkResolution);if(0===u.length&&l.hasChildren()){const t=this.processChildren(s,l);return[new Pr(i,t)]}if(0===s.length&&0===u.length)return[new Pr(i,[])];const c=this.processSegment(s,l,u,He);return[new Pr(i,c)]}}function In(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function kn(t){let e=t,r=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)r+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return r-1}function Pn(t,e,r,n,i){if(r.length>0&&function(t,e,r){return n.some(r=>On(t,e,r)&&Rn(r)!==He)}(t,r)){const i=new lr(e,function(t,e,r,n){const i={};i[He]=n,n._sourceSegment=t,n._segmentIndexShift=e.length;for(const o of r)if(""===o.path&&Rn(o)!==He){const r=new lr([],{});r._sourceSegment=t,r._segmentIndexShift=e.length,i[Rn(o)]=r}return i}(t,e,n,new lr(r,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===r.length&&function(t,e,r){return n.some(r=>On(t,e,r))}(t,r)){const o=new lr(t.segments,function(t,e,r,n,i,o){const a={};for(const s of n)if(On(t,r,s)&&!i[Rn(s)]){const r=new lr([],{});r._sourceSegment=t,r._segmentIndexShift="legacy"===o?t.segments.length:e.length,a[Rn(s)]=r}return Object.assign({},i,a)}(t,e,r,n,t.children,i));return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:r}}const o=new lr(t.segments,t.children);return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:r}}function On(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path&&void 0===r.redirectTo}function Rn(t){return t.outlet||He}function Dn(t){return t.data||{}}function Mn(t){return t.resolve||{}}function Ln(t,e,r,n){const i=_n(t,e,n);return or(i.resolve?i.resolve(e,r):i(e,r))}function zn(t){return function(e){return e.pipe(Object(at.a)(e=>{const r=t(e);return r?Object(u.a)(r).pipe(Object(T.a)(()=>e)):Object(u.a)([e])}))}}class Nn{}class Fn{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}const Bn=new n.o("ROUTES");class Vn{constructor(t,e,r,n){this.loader=t,this.compiler=e,this.onLoadStartListener=r,this.onLoadEndListener=n}load(t,e){return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(Object(T.a)(r=>{this.onLoadEndListener&&this.onLoadEndListener(e);const n=r.create(t);return new $e(rr(n.injector.get(Bn)).map(tr),n)}))}loadModuleFactory(t){return"string"==typeof t?Object(u.a)(this.loader.load(t)):or(t()).pipe(Object(nt.a)(t=>t instanceof n.t?Object(l.a)(t):Object(u.a)(this.compiler.compileModuleAsync(t))))}}class jn{}class Un{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function qn(t){throw t}function Hn(t,e,r){return e.parse("/")}function Wn(t,e){return Object(l.a)(null)}class Gn{constructor(t,e,r,i,o,a,s,l){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=r,this.location=i,this.config=l,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new c.a,this.errorHandler=qn,this.malformedUriErrorHandler=Hn,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Wn,afterPreactivation:Wn},this.urlHandlingStrategy=new Un,this.routeReuseStrategy=new Fn,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=o.get(n.v),this.console=o.get(n.Y);const u=o.get(n.x);this.isNgZoneEnabled=u instanceof n.x,this.resetConfig(l),this.currentUrlTree=new sr(new lr([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Vn(a,s,t=>this.triggerEvent(new ze(t)),t=>this.triggerEvent(new Ne(t))),this.routerState=Dr(this.currentUrlTree,this.rootComponentType),this.transitions=new p({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(t){const e=this.events;return t.pipe(P(t=>0!==t.id),Object(T.a)(t=>Object.assign({},t,{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl)})),Object(at.a)(t=>{let r=!1,n=!1;return Object(l.a)(t).pipe(V(t=>{this.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign({},this.lastSuccessfulNavigation,{previousNavigation:null}):null}}),Object(at.a)(t=>{const r=!this.navigated||t.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||r)&&this.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Object(l.a)(t).pipe(Object(at.a)(t=>{const r=this.transitions.getValue();return e.next(new Ae(t.id,this.serializeUrl(t.extractedUrl),t.source,t.restoredState)),r!==this.transitions.getValue()?C.a:[t]}),Object(at.a)(t=>Promise.resolve(t)),function(t,e,r,n){return function(i){return i.pipe(Object(at.a)(i=>(function(t,e,r,n,o){return new cn(t,e,r,i.extractedUrl,o).apply()})(t,e,r,0,n).pipe(Object(T.a)(t=>Object.assign({},i,{urlAfterRedirects:t})))))}}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),V(t=>{this.currentNavigation=Object.assign({},this.currentNavigation,{finalUrl:t.urlAfterRedirects})}),function(t,e,r,n,i){return function(o){return o.pipe(Object(nt.a)(o=>(function(t,e,r,n,i="emptyOnly",o="legacy"){return new An(t,e,r,n,i,o).recognize()})(t,e,o.urlAfterRedirects,r(o.urlAfterRedirects),n,i).pipe(Object(T.a)(t=>Object.assign({},o,{targetSnapshot:t})))))}}(this.rootComponentType,this.config,t=>this.serializeUrl(t),this.paramsInheritanceStrategy,this.relativeLinkResolution),V(t=>{"eager"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(t.urlAfterRedirects,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects)}),V(t=>{const r=new Oe(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.next(r)}));if(r&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:r,extractedUrl:n,source:i,restoredState:o,extras:a}=t,s=new Ae(r,this.serializeUrl(n),i,o);e.next(s);const u=Dr(n,this.rootComponentType).snapshot;return Object(l.a)(Object.assign({},t,{targetSnapshot:u,urlAfterRedirects:n,extras:Object.assign({},a,{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=t.rawUrl,this.browserUrlTree=t.urlAfterRedirects,t.resolve(null),C.a}),zn(t=>{const{targetSnapshot:e,id:r,extractedUrl:n,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:a}}=t;return this.hooks.beforePreactivation(e,{navigationId:r,appliedUrlTree:n,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!a})}),V(t=>{const e=new Re(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),Object(T.a)(t=>Object.assign({},t,{guards:gn(t.targetSnapshot,t.currentSnapshot,this.rootContexts)})),function(t,e){return function(r){return r.pipe(Object(nt.a)(r=>{const{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:a}}=r;return 0===a.length&&0===o.length?Object(l.a)(Object.assign({},r,{guardsResult:!0})):function(t,e,r,n){return Object(u.a)(t).pipe(Object(nt.a)(t=>(function(t,e,r,n,i){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||0===o.length)return Object(l.a)(!0);const a=o.map(o=>{const a=_n(o,e,i);let s;if(function(t){return t&&rn(t.canDeactivate)}(a))s=or(a.canDeactivate(t,e,r,n));else{if(!rn(a))throw new Error("Invalid CanDeactivate guard");s=or(a(t,e,r,n))}return s.pipe(rt())});return Object(l.a)(a).pipe(xn())})(t.component,t.route,r,e,n)),rt(t=>!0!==t,!0))}(a,n,i,t).pipe(Object(nt.a)(r=>r&&function(t){return"boolean"==typeof r}()?function(t,e,r,n){return Object(u.a)(e).pipe(ut(e=>Object(u.a)([En(e.route.parent,n),wn(e.route,n),Sn(t,e.path,r),Cn(t,e.route,r)]).pipe(I(),rt(t=>!0!==t,!0))),rt(t=>!0!==t,!0))}(n,o,t,e):Object(l.a)(r)),Object(T.a)(t=>Object.assign({},r,{guardsResult:t})))}))}}(this.ngModule.injector,t=>this.triggerEvent(t)),V(t=>{if(nn(t.guardsResult)){const e=Qe(`Redirecting to "${this.serializeUrl(t.guardsResult)}"`);throw e.url=t.guardsResult,e}}),V(t=>{const e=new De(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.triggerEvent(e)}),P(t=>{if(!t.guardsResult){this.resetUrlToCurrentUrlTree();const r=new ke(t.id,this.serializeUrl(t.extractedUrl),"");return e.next(r),t.resolve(!1),!1}return!0}),zn(t=>{if(t.guards.canActivateChecks.length)return Object(l.a)(t).pipe(V(t=>{const e=new Me(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),function(t,e){return function(r){return r.pipe(Object(nt.a)(r=>{const{targetSnapshot:n,guards:{canActivateChecks:i}}=r;return i.length?Object(u.a)(i).pipe(ut(r=>(function(t,e,r,i){return function(t,e,r,n){const i=Object.keys(t);if(0===i.length)return Object(l.a)({});if(1===i.length){const o=i[0];return Ln(t[o],e,r,n).pipe(Object(T.a)(t=>({[o]:t})))}const o={};return Object(u.a)(i).pipe(Object(nt.a)(i=>Ln(t[i],e,r,n).pipe(Object(T.a)(t=>(o[i]=t,t))))).pipe(Q(),Object(T.a)(()=>o))}(t._resolve,t,n,i).pipe(Object(T.a)(e=>(t._resolvedData=e,t.data=Object.assign({},t.data,Lr(t,r).resolve),null)))})(r.route,0,t,e)),function(t,e){return arguments.length>=2?function(e){return Object(ct.a)(Object(lt.a)(t,void 0),L(1),H(void 0))(e)}:function(e){return Object(ct.a)(Object(lt.a)((e,r,n)=>t(e)),L(1))(e)}}((t,e)=>t),Object(T.a)(t=>r)):Object(l.a)(r)}))}}(this.paramsInheritanceStrategy,this.ngModule.injector),V(t=>{const e=new Le(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}))}),zn(t=>{const{targetSnapshot:e,id:r,extractedUrl:n,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:a}}=t;return this.hooks.afterPreactivation(e,{navigationId:r,appliedUrlTree:n,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!a})}),Object(T.a)(t=>{const e=function(t,e,r){const n=function t(e,r,n){if(n&&e.shouldReuseRoute(r.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=r.value;const o=function(e,r,n){return r.children.map(r=>{for(const i of n.children)if(e.shouldReuseRoute(i.value.snapshot,r.value))return t(e,r,i);return t(e,r)})}(e,r,n);return new Pr(i,o)}{const n=e.retrieve(r.value);if(n){const t=n.route;return function t(e,r){if(e.value.routeConfig!==r.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==r.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");r.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)t(e.children[n],r.children[n])}(r,t),t}{const n=new Mr(new p((i=r.value).url),new p(i.params),new p(i.queryParams),new p(i.fragment),new p(i.data),i.outlet,i.component,i),o=r.children.map(r=>t(e,r));return new Pr(n,o)}}var i}(t,e._root,r?r._root:void 0);return new Rr(n,e)}(this.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return Object.assign({},t,{targetRouterState:e})}),V(t=>{this.currentUrlTree=t.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl),this.routerState=t.targetRouterState,"deferred"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects)}),Jr(this.rootContexts,this.routeReuseStrategy,t=>this.triggerEvent(t)),V({next(){r=!0},complete(){r=!0}}),function(t){return e=>e.lift(new pt(t))}(()=>{if(!r&&!n){this.resetUrlToCurrentUrlTree();const r=new ke(t.id,this.serializeUrl(t.extractedUrl),`Navigation ID ${t.id} is not equal to the current navigation id ${this.navigationId}`);e.next(r),t.resolve(!1)}this.currentNavigation=null}),$(r=>{if(n=!0,function(t){return r&&r[Ze]}()){const n=nn(r.url);n||(this.navigated=!0,this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl));const i=new ke(t.id,this.serializeUrl(t.extractedUrl),r.message);e.next(i),t.resolve(!1),n&&this.navigateByUrl(r.url)}else{this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);const n=new Pe(t.id,this.serializeUrl(t.extractedUrl),r);e.next(n);try{t.resolve(this.errorHandler(r))}catch(i){t.reject(i)}}return C.a}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign({},this.getTransition(),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{let e=this.parseUrl(t.url);const r="popstate"===t.type?"popstate":"hashchange",n=t.state&&t.state.navigationId?t.state:null;setTimeout(()=>{this.scheduleNavigation(e,r,n,{replaceUrl:!0})},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){Xe(t),this.config=t.map(tr),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}createUrlTree(t,e={}){const{relativeTo:r,queryParams:i,fragment:o,preserveQueryParams:a,queryParamsHandling:s,preserveFragment:l}=e;Object(n.T)()&&a&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const u=r||this.routerState.root,c=l?this.currentUrlTree.fragment:o;let h=null;if(s)switch(s){case"merge":h=Object.assign({},this.currentUrlTree.queryParams,i);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=i||null}else h=a?this.currentUrlTree.queryParams:i||null;return null!==h&&(h=this.removeEmptyProps(h)),function(t,e,r,n,i){if(0===r.length)return qr(e.root,e.root,e,n,i);const o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Hr(!0,0,t);let e=0,r=!1;const n=t.reduce((t,n,i)=>{if("object"==typeof n&&null!=n){if(n.outlets){const e={};return ir(n.outlets,(t,r)=>{e[r]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(n.segmentPath)return[...t,n.segmentPath]}return"string"!=typeof n?[...t,n]:0===i?(n.split("/").forEach((n,i)=>{0==i&&"."===n||(0==i&&""===n?r=!0:".."===n?e++:""!=n&&t.push(n))}),t):[...t,n]},[]);return new Hr(r,e,n)}(r);if(o.toRoot())return qr(e.root,new lr([],{}),e,n,i);const a=function(t,r,n){if(t.isAbsolute)return new Wr(e.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new Wr(n.snapshot._urlSegment,!0,0);const i=Ur(t.commands[0])?0:1;return function(e,r,o){let a=n.snapshot._urlSegment,s=n.snapshot._lastPathIndex+i,l=t.numberOfDoubleDots;for(;l>s;){if(l-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new Wr(a,!1,s-l)}()}(o,0,t),s=a.processChildren?Qr(a.segmentGroup,a.index,o.commands):Zr(a.segmentGroup,a.index,o.commands);return qr(a.segmentGroup,s,e,n,i)}(u,this.currentUrlTree,t,h,c)}navigateByUrl(t,e={skipLocationChange:!1}){Object(n.T)()&&this.isNgZoneEnabled&&!n.x.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");const r=nn(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(i,"imperative",null,e)}navigate(t,e={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const r=t[e];if(null==r)throw new Error(`The requested path contains ${r} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let e;try{e=this.urlSerializer.parse(t)}catch(r){e=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return e}isActive(t,e){if(nn(t))return ar(this.currentUrlTree,t,e);const r=this.parseUrl(t);return ar(this.currentUrlTree,r,e)}removeEmptyProps(t){return Object.keys(t).reduce((e,r)=>{const n=t[r];return null!=n&&(e[r]=n),e},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.events.next(new Ie(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,t.resolve(!0)},t=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(t,e,r,n){const i=this.getTransition();if(i&&"imperative"!==e&&"imperative"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"hashchange"==e&&"popstate"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"popstate"==e&&"hashchange"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);let o=null,a=null;const s=new Promise((t,e)=>{o=t,a=e}),l=++this.navigationId;return this.setTransition({id:l,source:e,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:n,resolve:o,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch(t=>Promise.reject(t))}setBrowserUrl(t,e,r,n){const i=this.urlSerializer.serialize(t);n=n||{},this.location.isCurrentPathEqualTo(i)||e?this.location.replaceState(i,"",Object.assign({},n,{navigationId:r})):this.location.go(i,"",Object.assign({},n,{navigationId:r}))}resetStateAndUrl(t,e,r){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}class Zn{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Qn,this.attachRef=null}}class Qn{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const r=this.getOrCreateContext(t);r.outlet=e,this.contexts.set(t,r)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new Zn,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}const Kn=(()=>(class{constructor(t,e,r,i,o){this.parentContexts=t,this.location=e,this.resolver=r,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new n.m,this.deactivateEvents=new n.m,this.name=i||He,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const r=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),n=this.parentContexts.getOrCreateContext(this.name).children,i=new $n(t,n,this.location.injector);this.activated=this.location.createComponent(r,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}))();class $n{constructor(t,e,r){this.route=t,this.childContexts=e,this.parent=r}get(t,e){return t===Mr?this.route:t===Qn?this.childContexts:this.parent.get(t,e)}}class Xn{}class Yn{preload(t,e){return e().pipe($(()=>Object(l.a)(null)))}}class Jn{preload(t,e){return Object(l.a)(null)}}const ti=(()=>(class{constructor(t,e,r,n,i){this.router=t,this.injector=n,this.preloadingStrategy=i,this.loader=new Vn(e,r,e=>t.triggerEvent(new ze(e)),e=>t.triggerEvent(new Ne(e)))}setUpPreloading(){this.subscription=this.router.events.pipe(P(t=>t instanceof Ie),ut(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(n.v);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription.unsubscribe()}processRoutes(t,e){const r=[];for(const n of e)if(n.loadChildren&&!n.canLoad&&n._loadedConfig){const t=n._loadedConfig;r.push(this.processRoutes(t.module,t.routes))}else n.loadChildren&&!n.canLoad?r.push(this.preloadConfig(t,n)):n.children&&r.push(this.processRoutes(t,n.children));return Object(u.a)(r).pipe(Object(A.a)(),Object(T.a)(t=>void 0))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>this.loader.load(t.injector,e).pipe(Object(nt.a)(t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))))}}))();class ei{constructor(t,e,r={}){this.router=t,this.viewportScroller=e,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Ae?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Ie&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Ue&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,e){this.router.triggerEvent(new Ue(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}const ri=new n.o("ROUTER_CONFIGURATION"),ni=new n.o("ROUTER_FORROOT_GUARD"),ii=[s.g,{provide:pr,useClass:dr},{provide:Gn,useFactory:hi,deps:[n.g,pr,Qn,s.g,n.p,n.u,n.i,Bn,ri,[jn,new n.y],[Nn,new n.y]]},Qn,{provide:Mr,useFactory:pi,deps:[Gn]},{provide:n.u,useClass:n.H},ti,Jn,Yn,{provide:ri,useValue:{enableTracing:!1}}];function oi(){return new n.w("Router",Gn)}const ai=(()=>{class t{constructor(t,e){}static forRoot(e,r){return{ngModule:t,providers:[ii,ci(e),{provide:ni,useFactory:ui,deps:[[Gn,new n.y,new n.G]]},{provide:ri,useValue:r||{}},{provide:s.h,useFactory:li,deps:[s.m,[new n.n(s.a),new n.y],ri]},{provide:ei,useFactory:si,deps:[Gn,s.n,ri]},{provide:Xn,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:Jn},{provide:n.w,multi:!0,useFactory:oi},[di,{provide:n.d,multi:!0,useFactory:fi,deps:[di]},{provide:yi,useFactory:mi,deps:[di]},{provide:n.b,multi:!0,useExisting:yi}]]}}static forChild(e){return{ngModule:t,providers:[ci(e)]}}}return t})();function si(t,e,r){return r.scrollOffset&&e.setOffset(r.scrollOffset),new ei(t,e,r)}function li(t,e,r={}){return r.useHash?new s.e(t,e):new s.l(t,e)}function ui(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function ci(t){return[{provide:n.a,multi:!0,useValue:t},{provide:Bn,multi:!0,useValue:t}]}function hi(t,e,r,n,i,o,a,s,l={},u,c){const h=new Gn(null,e,r,n,i,o,a,rr(s));if(u&&(h.urlHandlingStrategy=u),c&&(h.routeReuseStrategy=c),l.errorHandler&&(h.errorHandler=l.errorHandler),l.malformedUriErrorHandler&&(h.malformedUriErrorHandler=l.malformedUriErrorHandler),l.enableTracing){const t=mt();h.events.subscribe(e=>{t.logGroup(`Router Event: ${e.constructor.name}`),t.log(e.toString()),t.log(e),t.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),l.urlUpdateStrategy&&(h.urlUpdateStrategy=l.urlUpdateStrategy),l.relativeLinkResolution&&(h.relativeLinkResolution=l.relativeLinkResolution),h}function pi(t){return t.routerState.root}const di=(()=>(class{constructor(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new c.a}appInitializer(){return this.injector.get(s.f,Promise.resolve(null)).then(()=>{let t=null;const e=new Promise(e=>t=e),r=this.injector.get(Gn),n=this.injector.get(ri);if(this.isLegacyDisabled(n)||this.isLegacyEnabled(n))t(!0);else if("disabled"===n.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==n.initialNavigation)throw new Error(`Invalid initialNavigation options: '${n.initialNavigation}'`);r.hooks.afterPreactivation=(()=>this.initNavigation?Object(l.a)(null):(this.initNavigation=!0,t(!0),this.resultOfPreactivationDone)),r.initialNavigation()}return e})}bootstrapListener(t){const e=this.injector.get(ri),r=this.injector.get(ti),i=this.injector.get(ei),o=this.injector.get(Gn),a=this.injector.get(n.g);t===a.components[0]&&(this.isLegacyEnabled(e)?o.initialNavigation():this.isLegacyDisabled(e)&&o.setUpLocationChangeListener(),r.setUpPreloading(),i.init(),o.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation}isLegacyDisabled(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation}}))();function fi(t){return t.appInitializer.bind(t)}function mi(t){return t.bootstrapListener.bind(t)}const yi=new n.o("Router Initializer");var gi=n.lb({encapsulation:2,styles:[],data:{}});function _i(t){return n.Bb(0,[(t()(),n.nb(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),n.mb(1,212992,null,0,Kn,[Qn,n.M,n.j,[8,null],n.h],null,null)],function(t,e){t(e,1,0)},null)}function vi(t){return n.Bb(0,[(t()(),n.nb(0,0,null,null,1,"ng-component",[],null,null,null,_i,gi)),n.mb(1,49152,null,0,qe,[],null,null)],null,null)}var bi=n.jb("ng-component",qe,vi,{},{},[]);class xi extends _.a{constructor(t,e){super(t),this.sources=e,this.completed=0,this.haveValues=0;const r=e.length;this.values=new Array(r);for(let n=0;n<r;n++){const t=e[n],r=Object(v.a)(this,t,null,n);r&&this.add(r)}}notifyNext(t,e,r,n,i){this.values[r]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)}notifyComplete(t){const{destination:e,haveValues:r,values:n}=this,i=n.length;t._hasValue?(this.completed++,this.completed===i&&(r===i&&e.next(n),e.complete())):e.complete()}}const wi=new n.o("NgValueAccessor"),Ei=(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))(),Ci=new n.o("CompositionEventMode"),Si=(()=>(class{constructor(t,e,r){this._renderer=t,this._elementRef=e,this._compositionMode=r,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=mt()?mt().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}))();class Ti{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Ai extends Ti{get formDirective(){return null}get path(){return null}}function Ii(){throw new Error("unimplemented")}class ki extends Ti{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null,this._rawValidators=[],this._rawAsyncValidators=[]}get validator(){return Ii()}get asyncValidator(){return Ii()}}const Pi=(()=>(class extends class{constructor(t){this._cd=t}get ngClassUntouched(){return!!this._cd.control&&this._cd.control.untouched}get ngClassTouched(){return!!this._cd.control&&this._cd.control.touched}get ngClassPristine(){return!!this._cd.control&&this._cd.control.pristine}get ngClassDirty(){return!!this._cd.control&&this._cd.control.dirty}get ngClassValid(){return!!this._cd.control&&this._cd.control.valid}get ngClassInvalid(){return!!this._cd.control&&this._cd.control.invalid}get ngClassPending(){return!!this._cd.control&&this._cd.control.pending}}{constructor(t){super(t)}}))();function Oi(t){return null==t||0===t.length}const Ri=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;class Di{static min(t){return e=>{if(Oi(e.value)||Oi(t))return null;const r=parseFloat(e.value);return!isNaN(r)&&r<t?{min:{min:t,actual:e.value}}:null}}static max(t){return e=>{if(Oi(e.value)||Oi(t))return null;const r=parseFloat(e.value);return!isNaN(r)&&r>t?{max:{max:t,actual:e.value}}:null}}static required(t){return Oi(t.value)?{required:!0}:null}static requiredTrue(t){return!0===t.value?null:{required:!0}}static email(t){return Oi(t.value)?null:Ri.test(t.value)?null:{email:!0}}static minLength(t){return e=>{if(Oi(e.value))return null;const r=e.value?e.value.length:0;return r<t?{minlength:{requiredLength:t,actualLength:r}}:null}}static maxLength(t){return e=>{const r=e.value?e.value.length:0;return r>t?{maxlength:{requiredLength:t,actualLength:r}}:null}}static pattern(t){if(!t)return Di.nullValidator;let e,r;return"string"==typeof t?(r="","^"!==t.charAt(0)&&(r+="^"),r+=t,"$"!==t.charAt(t.length-1)&&(r+="$"),e=new RegExp(r)):(r=t.toString(),e=t),t=>{if(Oi(t.value))return null;const n=t.value;return e.test(n)?null:{pattern:{requiredPattern:r,actualValue:n}}}}static nullValidator(t){return null}static compose(t){if(!t)return null;const e=t.filter(Mi);return 0==e.length?null:function(t){return zi(function(t,r){return e.map(e=>e(t))}(t))}}static composeAsync(t){if(!t)return null;const e=t.filter(Mi);return 0==e.length?null:function(t){return function t(...e){let r;return"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&Object(g.a)(e[0])&&(e=e[0]),0===e.length?C.a:r?t(e).pipe(Object(T.a)(t=>r(...t))):new d.a(t=>new xi(t,e))}(function(t,r){return e.map(e=>e(t))}(t).map(Li)).pipe(Object(T.a)(zi))}}}function Mi(t){return null!=t}function Li(t){const e=Object(n.rb)(t)?Object(u.a)(t):t;if(!Object(n.qb)(e))throw new Error("Expected validator to return Promise or Observable.");return e}function zi(t){const e=t.reduce((t,e)=>null!=e?Object.assign({},t,e):t,{});return 0===Object.keys(e).length?null:e}function Ni(t){return t.validate?e=>t.validate(e):t}function Fi(t){return t.validate?e=>t.validate(e):t}const Bi=(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=(e=>{t(""==e?null:parseFloat(e))})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))(),Vi=(()=>(class{constructor(){this._accessors=[]}add(t,e){this._accessors.push([t,e])}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}select(t){this._accessors.forEach(e=>{this._isSameGroup(e,t)&&e[1]!==t&&e[1].fireUncheck(t.value)})}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}))(),ji=(()=>(class{constructor(t,e,r,n){this._renderer=t,this._elementRef=e,this._registry=r,this._injector=n,this.onChange=(()=>{}),this.onTouched=(()=>{})}ngOnInit(){this._control=this._injector.get(ki),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=(()=>{t(this.value),this._registry.select(this)})}fireUncheck(t){this.writeValue(t)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_checkName(){this.name&&this.formControlName&&this.name!==this.formControlName&&this._throwNameError(),!this.name&&this.formControlName&&(this.name=this.formControlName)}_throwNameError(){throw new Error('\n      If you define both a name and a formControlName attribute on your radio button, their values\n      must match. Ex: <input type="radio" formControlName="food" name="food">\n    ')}}))(),Ui={formControlName:'\n    <div [formGroup]="myGroup">\n      <input formControlName="firstName">\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       firstName: new FormControl()\n    });',formGroupName:'\n    <div [formGroup]="myGroup">\n       <div formGroupName="person">\n          <input formControlName="firstName">\n       </div>\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       person: new FormGroup({ firstName: new FormControl() })\n    });',formArrayName:'\n    <div [formGroup]="myGroup">\n      <div formArrayName="cities">\n        <div *ngFor="let city of cityArray.controls; index as i">\n          <input [formControlName]="i">\n        </div>\n      </div>\n    </div>\n\n    In your class:\n\n    this.cityArray = new FormArray([new FormControl(\'SF\')]);\n    this.myGroup = new FormGroup({\n      cities: this.cityArray\n    });',ngModelGroup:'\n    <form>\n       <div ngModelGroup="person">\n          <input [(ngModel)]="person.name" name="firstName">\n       </div>\n    </form>',ngModelWithFormGroup:'\n    <div [formGroup]="myGroup">\n       <input formControlName="firstName">\n       <input [(ngModel)]="showMoreControls" [ngModelOptions]="{standalone: true}">\n    </div>\n  '};function qi(t,e){return[...e.path,t]}function Hi(t,e){t||Gi(e,"Cannot find control with"),e.valueAccessor||Gi(e,"No value accessor for form control with"),t.validator=Di.compose([t.validator,e.validator]),t.asyncValidator=Di.composeAsync([t.asyncValidator,e.asyncValidator]),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(r=>{t._pendingValue=r,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&Wi(t,e)})}(t,e),function(t,e){t.registerOnChange((t,r)=>{e.valueAccessor.writeValue(t),r&&e.viewToModelUpdate(t)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&Wi(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),e.valueAccessor.setDisabledState&&t.registerOnDisabledChange(t=>{e.valueAccessor.setDisabledState(t)}),e._rawValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())}),e._rawAsyncValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())})}function Wi(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Gi(t,e){let r;throw r=t.path.length>1?`path: '${t.path.join(" -> ")}'`:t.path[0]?`name: '${t.path}'`:"unspecified name attribute",new Error(`${e} ${r}`)}function Zi(t){return null!=t?Di.compose(t.map(Ni)):null}function Qi(t){return null!=t?Di.composeAsync(t.map(Fi)):null}const Ki=[Ei,(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=(t=>{}),this.onTouched=(()=>{})}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}registerOnChange(t){this.onChange=(e=>{t(""==e?null:parseFloat(e))})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))(),Bi,(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._compareWith=n.sb}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const r=function(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",r)}registerOnChange(t){this.onChange=(e=>{this.value=this._getOptionValue(e),t(this.value)})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}))(),(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=(t=>{}),this.onTouched=(()=>{}),this._compareWith=n.sb}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const r=t.map(t=>this._getOptionId(t));e=((t,e)=>{t._setSelected(r.indexOf(e.toString())>-1)})}else e=((t,e)=>{t._setSelected(!1)});this._optionMap.forEach(e)}registerOnChange(t){this.onChange=(e=>{const r=[];if(e.hasOwnProperty("selectedOptions")){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const n=t.item(e),i=this._getOptionValue(n.value);r.push(i)}}else{const t=e.options;for(let e=0;e<t.length;e++){const n=t.item(e);if(n.selected){const t=this._getOptionValue(n.value);r.push(t)}}}this.value=r,t(r)})}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}))(),ji],$i="VALID",Xi="INVALID",Yi="PENDING",Ji="DISABLED";function to(t){const e=ro(t)?t.validators:t;return Array.isArray(e)?Zi(e):e||null}function eo(t,e){const r=ro(e)?e.asyncValidators:t;return Array.isArray(r)?Qi(r):r||null}function ro(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class no{constructor(t,e){this.validator=t,this.asyncValidator=e,this._onCollectionChange=(()=>{}),this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}get parent(){return this._parent}get valid(){return this.status===$i}get invalid(){return this.status===Xi}get pending(){return this.status==Yi}get disabled(){return this.status===Ji}get enabled(){return this.status!==Ji}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this.validator=to(t)}setAsyncValidators(t){this.asyncValidator=eo(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Yi,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Ji,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign({},t,{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=$i,this._forEachChild(e=>{e.enable(Object.assign({},t,{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==$i&&this.status!==Yi||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ji:$i}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Yi;const e=Li(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>this.setErrors(e,{emitEvent:t}))}}_cancelExistingSubscription(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,r){return null==e?null:(e instanceof Array||(e=e.split(".")),e instanceof Array&&0===e.length?null:e.reduce((t,e)=>t instanceof oo?t.controls.hasOwnProperty(e)?t.controls[e]:null:t instanceof ao&&t.at(e)||null,t))}(this,t)}getError(t,e){const r=e?this.get(e):this;return r&&r.errors?r.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new n.m,this.statusChanges=new n.m}_calculateStatus(){return this._allControlsDisabled()?Ji:this.errors?Xi:this._anyControlsHaveStatus(Yi)?Yi:this._anyControlsHaveStatus(Xi)?Xi:$i}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){ro(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&this._parent&&this._parent.dirty&&!this._parent._anyControlsDirty()}}class io extends no{constructor(t=null,e,r){super(to(e),eo(r,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this._initObservables()}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_clearChangeFns(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=(()=>{})}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class oo extends no{constructor(t,e,r){super(to(e),eo(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){Object.keys(t).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t={},e={}){this._forEachChild((r,n)=>{r.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,r)=>(t[r]=e instanceof io?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>t(this.controls[e],e))}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){let e=!1;return this._forEachChild((r,n)=>{e=e||this.contains(n)&&t(r)}),e}_reduceValue(){return this._reduceChildren({},(t,e,r)=>((e.enabled||this.disabled)&&(t[r]=e.value),t))}_reduceChildren(t,e){let r=t;return this._forEachChild((t,n)=>{r=e(r,t,n)}),r}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,r)=>{if(void 0===t[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class ao extends no{constructor(t,e,r){super(to(e),eo(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,r)=>{this._throwIfControlMissing(r),this.at(r).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t.forEach((t,r)=>{this.at(r)&&this.at(r).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t=[],e={}){this._forEachChild((r,n)=>{r.reset(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof io?t.value:t.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,r)=>{t(e,r)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,r)=>{if(void 0===t[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const so=(()=>Promise.resolve(null))(),lo=(()=>(class extends Ai{constructor(t,e){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new n.m,this.form=new oo({},Zi(t),Qi(e))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){so.then(()=>{const e=this._findContainer(t.path);t.control=e.registerControl(t.name,t.control),Hi(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){so.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name),function(e,r){const n=e.indexOf(t);n>-1&&e.splice(n,1)}(this._directives)})}addFormGroup(t){so.then(()=>{const e=this._findContainer(t.path),r=new oo({});(function(t,e){null==t&&Gi(e,"Cannot find control with"),t.validator=Di.compose([t.validator,e.validator]),t.asyncValidator=Di.composeAsync([t.asyncValidator,e.asyncValidator])})(r,t),e.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){so.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,e){so.then(()=>{this.form.get(t.path).setValue(e)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,e=this._directives,this.form._syncPendingControls(),e.forEach(t=>{const e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)}),this.ngSubmit.emit(t),!1;var e}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}))();class uo{static modelParentException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroup directive.  Try using\n      formGroup's partner directive "formControlName" instead.  Example:\n\n      ${Ui.formControlName}\n\n      Or, if you'd like to avoid registering this form control, indicate that it's standalone in ngModelOptions:\n\n      Example:\n\n      ${Ui.ngModelWithFormGroup}`)}static formGroupNameException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroupName or formArrayName directive.\n\n      Option 1: Use formControlName instead of ngModel (reactive strategy):\n\n      ${Ui.formGroupName}\n\n      Option 2:  Update ngModel's parent be ngModelGroup (template-driven strategy):\n\n      ${Ui.ngModelGroup}`)}static missingNameException(){throw new Error('If ngModel is used within a form tag, either the name attribute must be set or the form\n      control must be defined as \'standalone\' in ngModelOptions.\n\n      Example 1: <input [(ngModel)]="person.firstName" name="first">\n      Example 2: <input [(ngModel)]="person.firstName" [ngModelOptions]="{standalone: true}">')}static modelGroupParentException(){throw new Error(`\n      ngModelGroup cannot be used with a parent formGroup directive.\n\n      Option 1: Use formGroupName instead of ngModelGroup (reactive strategy):\n\n      ${Ui.formGroupName}\n\n      Option 2:  Use a regular form tag instead of the formGroup directive (template-driven strategy):\n\n      ${Ui.ngModelGroup}`)}static ngFormWarning(){console.warn("\n    It looks like you're using 'ngForm'.\n\n    Support for using the 'ngForm' element selector has been deprecated in Angular v6 and will be removed\n    in Angular v9.\n\n    Use 'ng-form' instead.\n\n    Before:\n    <ngForm #myForm=\"ngForm\">\n\n    After:\n    <ng-form #myForm=\"ngForm\">\n    ")}}const co=new n.o("NgFormSelectorWarning");class ho extends Ai{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return qi(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return Zi(this._validators)}get asyncValidator(){return Qi(this._asyncValidators)}_checkParentType(){}}const po=(()=>{class t extends ho{constructor(t,e,r){super(),this._parent=t,this._validators=e,this._asyncValidators=r}_checkParentType(){this._parent instanceof t||this._parent instanceof lo||uo.modelGroupParentException()}}return t})(),fo=(()=>Promise.resolve(null))(),mo=(()=>(class extends ki{constructor(t,e,r,i){super(),this.control=new io,this._registered=!1,this.update=new n.m,this._parent=t,this._rawValidators=e||[],this._rawAsyncValidators=r||[],this.valueAccessor=function(t,e){if(!e)return null;Array.isArray(e)||Gi(t,"Value accessor was not provided as an array for form control with");let r=void 0,n=void 0,i=void 0;return e.forEach(e=>{e.constructor===Si?r=e:function(t){return Ki.some(e=>t.constructor===e)}(e)?(n&&Gi(t,"More than one built-in value accessor matches form control with"),n=e):(i&&Gi(t,"More than one custom value accessor matches form control with"),i=e)}),i||n||r||(Gi(t,"No valid value accessor for form control with"),null)}(this,i)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;const r=t.model;return!!r.isFirstChange()||!Object(n.sb)(e,r.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?qi(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return Zi(this._rawValidators)}get asyncValidator(){return Qi(this._rawAsyncValidators)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Hi(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){!(this._parent instanceof po)&&this._parent instanceof ho?uo.formGroupNameException():this._parent instanceof po||this._parent instanceof lo||uo.modelParentException()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()||this.name||uo.missingNameException()}_updateValue(t){fo.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,r=""===e||e&&"false"!==e;fo.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable()})}}))(),yo=(()=>(class{}))(),go=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:co,useValue:e.warnOnDeprecatedNgFormSelector}]}}}return t})();var _o=r("4ZJM"),vo=(r("6233"),r("PVcy"));const bo=(()=>{class t{constructor(t){this.db=t,_o.accessToken=i.mapbox.accessToken}getMarkers(){return this.db.list("/markers")}createMarker(t){return this.db.list("/markers").push(t)}removeMarker(t){return this.db.object("/markers/"+t).remove()}}return t.ngInjectableDef=n.Db({factory:function(){return new t(n.Hb(vo.a))},token:t,providedIn:"root"}),t})();class xo{constructor(t,e){this.properties=e,this.type="Feature",this.geometry={type:"Point",coordinates:t}}}class wo{constructor(t){this.features=t,this.type="FeatureCollection"}}class Eo{constructor(t){this.mapService=t,this.style="mapbox://styles/pegah5665/cjx1c81hv0p4y1cqv0new47vg",this.lat=35.6892,this.lng=51.389,this.message="Hello World!"}ngOnInit(){this.markers=this.mapService.getMarkers(),this.initializeMap()}initializeMap(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.lat=t.coords.latitude,this.lng=t.coords.longitude,this.map.flyTo({center:[this.lng,this.lat]})}),this.buildMap()}buildMap(){this.map=new _o.Map({container:"map",style:this.style,zoom:13,center:[this.lng,this.lat]}),this.map.addControl(new _o.NavigationControl),this.map.on("click",t=>{const e=new xo([t.lngLat.lng,t.lngLat.lat],{message:this.message});this.mapService.createMarker(e)}),this.map.on("load",t=>{this.map.addSource("firebase",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.source=this.map.getSource("firebase"),this.markers.subscribe(t=>{let e=new wo(t);this.source.setData(e)}),this.map.addLayer({id:"firebase",source:"firebase",type:"symbol",layout:{"text-field":"{message}","text-size":24,"text-transform":"uppercase","icon-image":"rocket-15","text-offset":[0,1.5]},paint:{"text-color":"#f16624","text-halo-color":"#fff","text-halo-width":2}})})}removeMarker(t){this.mapService.removeMarker(t.$key)}flyTo(t){this.map.flyTo({center:t.geometry.coordinates})}}var Co=n.lb({encapsulation:0,styles:[[".map[_ngcontent-%COMP%]{width:80%;height:70vh}"]],data:{}});function So(t){return n.Bb(0,[(t()(),n.nb(0,0,null,null,4,"div",[],null,null,null,null,null)),(t()(),n.nb(1,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.flyTo(t.context.$implicit)&&n),n},null,null)),(t()(),n.zb(2,null,["",""])),(t()(),n.nb(3,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,r){var n=!0;return"click"===e&&(n=!1!==t.component.removeMarker(t.context.$implicit)&&n),n},null,null)),(t()(),n.zb(-1,null,["Delete"]))],null,function(t,e){t(e,2,0,e.context.$implicit.properties.message)})}function To(t){return n.Bb(0,[(t()(),n.nb(0,0,null,null,5,"input",[["placeholder","your message..."],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(t,e,r){var i=!0,o=t.component;return"input"===e&&(i=!1!==n.vb(t,1)._handleInput(r.target.value)&&i),"blur"===e&&(i=!1!==n.vb(t,1).onTouched()&&i),"compositionstart"===e&&(i=!1!==n.vb(t,1)._compositionStart()&&i),"compositionend"===e&&(i=!1!==n.vb(t,1)._compositionEnd(r.target.value)&&i),"ngModelChange"===e&&(i=!1!==(o.message=r)&&i),i},null,null)),n.mb(1,16384,null,0,Si,[n.B,n.k,[2,Ci]],null,null),n.xb(1024,null,wi,function(t){return[t]},[Si]),n.mb(3,671744,null,0,mo,[[8,null],[8,null],[8,null],[6,wi]],{model:[0,"model"]},{update:"ngModelChange"}),n.xb(2048,null,ki,null,[mo]),n.mb(5,16384,null,0,Pi,[[4,ki]],null,null),(t()(),n.nb(6,0,null,null,1,"h1",[],null,null,null,null,null)),(t()(),n.zb(-1,null,["Markers"])),(t()(),n.cb(16777216,null,null,2,null,So)),n.mb(9,278528,null,0,s.i,[n.M,n.J,n.q],{ngForOf:[0,"ngForOf"]},null),n.wb(131072,s.b,[n.h]),(t()(),n.nb(11,0,null,null,0,"div",[["class","map"],["id","map"]],null,null,null,null,null))],function(t,e){var r=e.component;t(e,3,0,r.message),t(e,9,0,n.Ab(e,9,0,n.vb(e,10).transform(r.markers)))},function(t,e){t(e,0,0,n.vb(e,5).ngClassUntouched,n.vb(e,5).ngClassTouched,n.vb(e,5).ngClassPristine,n.vb(e,5).ngClassDirty,n.vb(e,5).ngClassValid,n.vb(e,5).ngClassInvalid,n.vb(e,5).ngClassPending)})}function Ao(t){return n.Bb(0,[(t()(),n.nb(0,0,null,null,1,"app-map-box",[],null,null,null,To,Co)),n.mb(1,114688,null,0,Eo,[bo],null,null)],function(t,e){t(e,1,0)},null)}var Io=n.jb("app-map-box",Eo,Ao,{},{},[]),ko=n.lb({encapsulation:0,styles:[[""]],data:{}});function Po(t){return n.Bb(0,[(t()(),n.nb(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),n.mb(1,212992,null,0,Kn,[Qn,n.M,n.j,[8,null],n.h],null,null)],function(t,e){t(e,1,0)},null)}function Oo(t){return n.Bb(0,[(t()(),n.nb(0,0,null,null,1,"app-root",[],null,null,null,Po,ko)),n.mb(1,49152,null,0,a,[],null,null)],null,null)}var Ro=n.jb("app-root",a,Oo,{},{},[]),Do=r("yA/v"),Mo=r("1XSQ"),Lo=r("z5t0"),zo=n.kb(o,[a],function(t){return n.tb([n.ub(512,n.j,n.X,[[8,[bi,Io,Ro]],[3,n.j],n.v]),n.ub(5120,Do.b,Do.e,[Do.d,[2,Do.c]]),n.ub(4608,vo.a,vo.a,[Do.d,[2,Do.c],[2,Mo.b],n.z,n.x]),n.ub(5120,n.s,n.hb,[[3,n.s]]),n.ub(4608,s.k,s.j,[n.s,[2,s.q]]),n.ub(5120,n.db,n.ib,[n.x]),n.ub(5120,n.c,n.eb,[]),n.ub(5120,n.q,n.fb,[]),n.ub(5120,n.r,n.gb,[]),n.ub(4608,fe,me,[s.d]),n.ub(6144,n.E,null,[fe]),n.ub(4608,se,ue,[]),n.ub(5120,Mt,function(t,e,r,n,i,o,a,s){return[new oe(t,e,r),new de(n),new ce(i,o,a,s)]},[s.d,n.x,n.z,s.d,s.d,se,n.Y,[2,le]]),n.ub(4608,Lt,Lt,[Mt,n.x]),n.ub(135680,Ft,Ft,[s.d]),n.ub(4608,Wt,Wt,[Lt,Ft,n.c]),n.ub(6144,n.C,null,[Wt]),n.ub(6144,Nt,null,[Ft]),n.ub(4608,n.K,n.K,[n.x]),n.ub(4608,Vi,Vi,[]),n.ub(5120,Mr,pi,[Gn]),n.ub(4608,Jn,Jn,[]),n.ub(6144,Xn,null,[Jn]),n.ub(135680,ti,ti,[Gn,n.u,n.i,n.p,Xn]),n.ub(4608,Yn,Yn,[]),n.ub(5120,ei,si,[Gn,s.n,ri]),n.ub(5120,yi,mi,[di]),n.ub(5120,n.b,function(t){return[t]},[yi]),n.ub(1073742336,Do.a,Do.a,[]),n.ub(1024,ni,ui,[[3,Gn]]),n.ub(1024,n.l,Ce,[]),n.ub(1024,n.w,function(){return[oi()]},[]),n.ub(512,di,di,[n.p]),n.ub(1024,n.d,function(t,e){return[(r=t,Ot("probe",Dt),Ot("coreTokens",Object.assign({},Rt,(r||[]).reduce((t,e)=>(t[e.name]=e.token,t),{}))),()=>Dt),fi(e)];var r},[[2,n.w],di]),n.ub(512,n.e,n.e,[[2,n.d]]),n.ub(131584,n.g,n.g,[n.x,n.Y,n.p,n.l,n.j,n.e]),n.ub(512,pr,dr,[]),n.ub(512,Qn,Qn,[]),n.ub(256,ri,{},[]),n.ub(1024,s.h,li,[s.m,[2,s.a],ri]),n.ub(512,s.g,s.g,[s.h,s.m]),n.ub(512,n.i,n.i,[]),n.ub(512,n.u,n.H,[n.i,[2,n.I]]),n.ub(1024,Bn,function(){return[[{path:"",component:Eo}]]},[]),n.ub(1024,Gn,hi,[n.g,pr,Qn,s.g,n.p,n.u,n.i,Bn,ri,[2,jn],[2,Nn]]),n.ub(1073742336,ai,ai,[[2,ni],[2,Gn]]),n.ub(1073742336,Lo.a,Lo.a,[]),n.ub(1073742336,s.c,s.c,[]),n.ub(1073742336,n.f,n.f,[n.g]),n.ub(1073742336,Se,Se,[[3,Se]]),n.ub(1073742336,yo,yo,[]),n.ub(1073742336,go,go,[]),n.ub(1073742336,o,o,[]),n.ub(256,Do.d,{apiKey:"AIzaSyAXncQXnFfPCli916rz-3aJBR7AkQfWXkk",databaseURL:"https://mapboxangular-c536c.firebaseio.com/"},[]),n.ub(256,Do.c,void 0,[]),n.ub(256,n.W,!0,[])])});i.production&&Object(n.Q)(),Ee().bootstrapModuleFactory(zo).catch(t=>console.error(t))},zVF4:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("+7AZ"),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw a(e)},a=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},s=function(t){for(var e=[],r=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):55296==(64512&i)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++n)),e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128)}return e},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,l=i+2<t.length,u=l?t[i+2]:0,c=(15&s)<<2|u>>6,h=63&u;l||(h=64,a||(c=64)),n.push(r[o>>2],r[(3&o)<<4|s>>4],r[c],r[h])}return n.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],r=0,n=0;r<t.length;){var i=t[r++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[r++];e[n++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=t[r++]))<<12|(63&(s=t[r++]))<<6|63&t[r++])-65536;e[n++]=String.fromCharCode(55296+(a>>10)),e[n++]=String.fromCharCode(56320+(1023&a))}else{o=t[r++];var s=t[r++];e[n++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[],i=0;i<t.length;){var o=r[t.charAt(i++)],a=i<t.length?r[t.charAt(i)]:0,s=++i<t.length?r[t.charAt(i)]:64,l=++i<t.length?r[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==l)throw Error();n.push(o<<2|a>>4),64!==s&&(n.push(a<<4&240|s>>2),64!==l&&n.push(s<<6&192|l))}return n},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},u=function(t){try{return l.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var r in e)e.hasOwnProperty(r)&&(t[r]=c(t[r],e[r]));return t}var h=function(){function t(){var t=this;this.promise=new Promise(function(e,r){t.resolve=e,t.reject=r})}return t.prototype.wrapCallback=function(t){var e=this;return function(r,n){r?e.reject(r):e.resolve(n),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(r):t(r,n))}},t}();function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d="FirebaseError",f=function(t){function e(r,n){var i=t.call(this,n)||this;return i.code=r,i.name=d,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,m.prototype.create),i}return n.__extends(e,t),e}(Error),m=function(){function t(t,e,r){this.service=t,this.serviceName=e,this.errors=r}return t.prototype.create=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(y,function(t,r){var n=e[r];return null!=n?n.toString():"<"+r+"?>"})}(o,n):"Error",s=new f(i,this.serviceName+": "+a+" ("+i+")."),l=0,u=Object.keys(n);l<u.length;l++){var c=u[l];"_"!==c.slice(-1)&&(c in s&&console.warn('Overwriting FirebaseError base field "'+c+'" can cause unexpected behavior.'),s[c]=n[c])}return s},t}(),y=/\{\$([^}]+)}/g;function g(t){return JSON.parse(t)}var _=function(t){var e={},r={},n={},i="";try{var o=t.split(".");e=g(u(o[0])||""),r=g(u(o[1])||""),i=o[2],n=r.d||{},delete r.d}catch(a){}return{header:e,claims:r,data:n,signature:i}},v=function(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])},b=function(t,e){return v(e,function(e,r){t[e]=r}),t},x=function(t,e,r){for(var n in t)if(e.call(r,t[n],n,t))return n},w=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var r=this.W_;if("string"==typeof t)for(var n=0;n<16;n++)r[n]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(n=0;n<16;n++)r[n]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(n=16;n<80;n++)r[n]=4294967295&((h=r[n-3]^r[n-8]^r[n-14]^r[n-16])<<1|h>>>31);var i,o,a=this.chain_[0],s=this.chain_[1],l=this.chain_[2],u=this.chain_[3],c=this.chain_[4];for(n=0;n<80;n++){n<40?n<20?(i=u^s&(l^u),o=1518500249):(i=s^l^u,o=1859775393):n<60?(i=s&l|u&(s|l),o=2400959708):(i=s^l^u,o=3395469782);var h=(a<<5|a>>>27)+i+c+o+r[n]&4294967295;c=u,u=l,l=4294967295&(s<<30|s>>>2),s=a,a=h}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var r=e-this.blockSize,n=0,i=this.buf_,o=this.inbuf_;n<e;){if(0===o)for(;n<=r;)this.compress_(t,n),n+=this.blockSize;if("string"==typeof t){for(;n<e;)if(i[o]=t.charCodeAt(n),++n,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;n<e;)if(i[o]=t[n],++n,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);var n=0;for(r=0;r<5;r++)for(var i=24;i>=0;i-=8)t[n]=this.chain_[r]>>i&255,++n;return t},t}(),E=function(){function t(t,e){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(r)}).catch(function(t){r.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,r){var n,i=this;if(void 0===t&&void 0===e&&void 0===r)throw new Error("Missing Observer.");void 0===(n=function(t,e){if("object"!=typeof t||null===t)return!1;for(var r=0,n=["next","error","complete"];r<n.length;r++){var i=n[r];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:r}).next&&(n.next=C),void 0===n.error&&(n.error=C),void 0===n.complete&&(n.complete=C);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?n.error(i.finalError):n.complete()}catch(t){}}),this.observers.push(n),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var r=this;this.task.then(function(){if(void 0!==r.observers&&void 0!==r.observers[t])try{e(r.observers[t])}catch(n){"undefined"!=typeof console&&console.error&&console.error(n)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function C(){}function S(t,e,r){var n="";switch(e){case 1:n=r?"first":"First";break;case 2:n=r?"second":"Second";break;case 3:n=r?"third":"Third";break;case 4:n=r?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+n+" argument "}e.CONSTANTS=i,e.Deferred=h,e.ErrorFactory=m,e.FirebaseError=f,e.Sha1=w,e.assert=o,e.assertionError=a,e.async=function(t,e){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];Promise.resolve(!0).then(function(){t.apply(void 0,r)}).catch(function(t){e&&e(t)})}},e.base64=l,e.base64Decode=u,e.base64Encode=function(t){var e=s(t);return l.encodeByteArray(e,!0)},e.clone=function(t){return b({},t)},e.contains=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var r=new E(t,e);return r.subscribe.bind(r)},e.decode=_,e.deepCopy=function(t){return c(void 0,t)},e.deepExtend=c,e.errorPrefix=S,e.every=function(t,e){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&!e(r,t[r]))return!1;return!0},e.extend=b,e.findKey=x,e.findValue=function(t,e,r){var n=x(t,e,r);return n&&t[n]},e.forEach=v,e.getAnyKey=function(t){for(var e in t)return e},e.getCount=function(t){var e=0;for(var r in t)e++;return e},e.getUA=p,e.getValues=function(t){var e=[],r=0;for(var n in t)e[r++]=t[n];return e},e.isAdmin=function(t){var e=_(t).claims;return"object"==typeof e&&!0===e.admin},e.isBrowser=function(){return"object"==typeof self&&self.self===self},e.isEmpty=function(t){for(var e in t)return!1;return!0},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())},e.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}},e.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},e.isNonNullObject=function(t){return"object"==typeof t&&null!==t},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.isValidFormat=function(t){var e=_(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e,r,n=_(t).claims,i=Math.floor((new Date).getTime()/1e3);return"object"==typeof n&&(n.hasOwnProperty("nbf")?e=n.nbf:n.hasOwnProperty("iat")&&(e=n.iat),r=n.hasOwnProperty("exp")?n.exp:e+86400),i&&e&&r&&i>=e&&i<=r},e.issuedAtTime=function(t){var e=_(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=g,e.map=function(t,e,r){var n={};for(var i in t)n[i]=e.call(r,t[i],i,t);return n},e.querystring=function(t){var e=[];return v(t,function(t,r){Array.isArray(r)?r.forEach(function(r){e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}),e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var r=t.split("=");e[r[0]]=r[1]}}),e},e.safeGet=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},e.stringLength=function(t){for(var e=0,r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,r++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],r=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);if(i>=55296&&i<=56319){var a=i-55296;o(++n<t.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(t.charCodeAt(n)-56320)}i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):i<65536?(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,r,n){var i;if(n<e?i="at least "+e:n>r&&(i=0===r?"none":"no more than "+r),i)throw new Error(t+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,r,n){if((!n||r)&&"function"!=typeof r)throw new Error(S(t,e,n)+"must be a valid function.")},e.validateContextObject=function(t,e,r,n){if((!n||r)&&("object"!=typeof r||null===r))throw new Error(S(t,e,n)+"must be a valid context object.")},e.validateNamespace=function(t,e,r,n){if((!n||r)&&"string"!=typeof r)throw new Error(S(t,e,n)+"must be a valid firebase namespace.")}},zn8P:function(t,e){function r(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="zn8P"}},[[0,0]]]);